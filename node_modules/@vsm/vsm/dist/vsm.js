/*! @vsm/vsm 1.1.2 @2023. 08. 16. 14:08:03 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Vsm=e()}(this,(function(){"use strict";let t;!function(e,r){t={dependencies:e,factory:r}}(["exports"],(function(t){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},e(t,r)};function r(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}function i(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))}function o(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function a(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function l(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}t.__assign=function(){return t.__assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.__assign.apply(this,arguments)};var u=function(){function t(t){this._replacements=t}return t.prototype.replace=function(t){return this._replacements.reduce((function(t,e){var r=e.from,n=e.to;return t.replace(r,n)}),t)},t}(),h=u;function c(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var f={};function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function y(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function _(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},m.apply(this,arguments)}Object.defineProperty(f,"__esModule",{value:!0});var b=function(){function t(){p(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return y(t,[{key:"addEventListener",value:function(t,e,r){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push({callback:e,options:r})}},{key:"removeEventListener",value:function(t,e){if(t in this.listeners)for(var r=this.listeners[t],n=0,i=r.length;n<i;n++)if(r[n].callback===e)return void r.splice(n,1)}},{key:"dispatchEvent",value:function(t){if(t.type in this.listeners){for(var e=this.listeners[t.type].slice(),r=0,n=e.length;r<n;r++){var i=e[r];try{i.callback.call(this,t)}catch(t){Promise.resolve().then((function(){throw t}))}i.options&&i.options.once&&this.removeEventListener(t.type,i.callback)}return!t.defaultPrevented}}}]),t}(),x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g(t);if(e){var i=g(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _(t)}(this,r)}}(r);function r(){var t;return p(this,r),(t=e.call(this)).listeners||b.call(_(t)),Object.defineProperty(_(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(_(t),"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(_(t),"reason",{value:void 0,writable:!0,configurable:!0}),t}return y(r,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(t){"abort"===t.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,t)),m(g(r.prototype),"dispatchEvent",this).call(this,t)}}]),r}(b),w=function(){function t(){p(this,t),Object.defineProperty(this,"signal",{value:new x,writable:!0,configurable:!0})}return y(t,[{key:"abort",value:function(t){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}var r=t;if(void 0===r)if("undefined"==typeof document)(r=new Error("This operation was aborted")).name="AbortError";else try{r=new DOMException("signal is aborted without reason")}catch(t){(r=new Error("This operation was aborted")).name="AbortError"}this.signal.reason=r,this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(w.prototype[Symbol.toStringTag]="AbortController",x.prototype[Symbol.toStringTag]="AbortSignal");var M=f.AbortController=w;f.AbortSignal=x;var S=f.abortableFetch=function(t){"function"==typeof t&&(t={fetch:t});var e=t,r=e.fetch,n=e.Request,i=void 0===n?r.Request:n,o=e.AbortController,a=e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,s=void 0!==a&&a;if(!function(t){return!!t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL||("function"==typeof t.Request&&!t.Request.prototype.hasOwnProperty("signal")||!t.AbortController)}({fetch:r,Request:i,AbortController:o,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s}))return{fetch:r,Request:l};var l=i;(l&&!l.prototype.hasOwnProperty("signal")||s)&&(l=function(t,e){var r;e&&e.signal&&(r=e.signal,delete e.signal);var n=new i(t,e);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n},l.prototype=i.prototype);var u=r;return{fetch:function(t,e){var r=l&&l.prototype.isPrototypeOf(t)?t.signal:e?e.signal:void 0;if(r){var n;try{n=new DOMException("Aborted","AbortError")}catch(t){(n=new Error("Aborted")).name="AbortError"}if(r.aborted)return Promise.reject(n);var i=new Promise((function(t,e){r.addEventListener("abort",(function(){return e(n)}),{once:!0})}));return e&&e.signal&&delete e.signal,Promise.race([i,u(t,e)])}return u(t,e)},Request:l}},P="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global||{},T="URLSearchParams"in P,E="Symbol"in P&&"iterator"in Symbol,L="FileReader"in P&&"Blob"in P&&function(){try{return new Blob,!0}catch(t){return!1}}(),k="FormData"in P,I="ArrayBuffer"in P;if(I)var A=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],C=ArrayBuffer.isView||function(t){return t&&A.indexOf(Object.prototype.toString.call(t))>-1};function O(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function R(t){return"string"!=typeof t&&(t=String(t)),t}function D(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return E&&(e[Symbol.iterator]=function(){return e}),e}function F(t){this.map={},t instanceof F?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){if(2!=t.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function B(t){if(!t._noBody)return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function N(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function z(t){var e=new FileReader,r=N(e);return e.readAsArrayBuffer(t),r}function U(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function j(){return this.bodyUsed=!1,this._initBody=function(t){var e;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:L&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:k&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:T&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():I&&L&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=U(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):I&&(ArrayBuffer.prototype.isPrototypeOf(t)||C(t))?this._bodyArrayBuffer=U(t):this._bodyText=t=Object.prototype.toString.call(t):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):T&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},L&&(this.blob=function(){var t=B(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer)return B(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer));if(L)return this.blob().then(z);throw new Error("could not read as ArrayBuffer")},this.text=function(){var t=B(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,r=N(e),n=/charset=([A-Za-z0-9_-]+)/.exec(t.type),i=n?n[1]:"utf-8";return e.readAsText(t,i),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},k&&(this.formData=function(){return this.text().then(q)}),this.json=function(){return this.text().then(JSON.parse)},this}F.prototype.append=function(t,e){t=O(t),e=R(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},F.prototype.delete=function(t){delete this.map[O(t)]},F.prototype.get=function(t){return t=O(t),this.has(t)?this.map[t]:null},F.prototype.has=function(t){return this.map.hasOwnProperty(O(t))},F.prototype.set=function(t,e){this.map[O(t)]=R(e)},F.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},F.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),D(t)},F.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),D(t)},F.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),D(t)},E&&(F.prototype[Symbol.iterator]=F.prototype.entries);var V=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function G(t,e){if(!(this instanceof G))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,i=(e=e||{}).body;if(t instanceof G){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new F(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new F(e.headers)),this.method=(n=(r=e.method||this.method||"GET").toUpperCase(),V.indexOf(n)>-1?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in P)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function q(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(i))}})),e}function Z(t,e){if(!(this instanceof Z))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===e.statusText?"":""+e.statusText,this.headers=new F(e.headers),this.url=e.url||"",this._initBody(t)}G.prototype.clone=function(){return new G(this,{body:this._bodyInit})},j.call(G.prototype),j.call(Z.prototype),Z.prototype.clone=function(){return new Z(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new F(this.headers),url:this.url})},Z.error=function(){var t=new Z(null,{status:200,statusText:""});return t.status=0,t.type="error",t};var W=[301,302,303,307,308];Z.redirect=function(t,e){if(-1===W.indexOf(e))throw new RangeError("Invalid status code");return new Z(null,{status:e,headers:{location:t}})};var H=P.DOMException;try{new H}catch(t){(H=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack}).prototype=Object.create(Error.prototype),H.prototype.constructor=H}function Y(t,e){return new Promise((function(r,n){var i=new G(t,e);if(i.signal&&i.signal.aborted)return n(new H("Aborted","AbortError"));var o=new XMLHttpRequest;function a(){o.abort()}if(o.onload=function(){var t,e,n={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",e=new F,t.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(t){return 0===t.indexOf("\n")?t.substr(1,t.length):t})).forEach((function(t){var r=t.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();try{e.append(n,i)}catch(t){console.warn("Response "+t.message)}}})),e)};n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");var i="response"in o?o.response:o.responseText;setTimeout((function(){r(new Z(i,n))}),0)},o.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){n(new H("Aborted","AbortError"))}),0)},o.open(i.method,function(t){try{return""===t&&P.location.href?P.location.href:t}catch(e){return t}}(i.url),!0),"include"===i.credentials?o.withCredentials=!0:"omit"===i.credentials&&(o.withCredentials=!1),"responseType"in o&&(L?o.responseType="blob":I&&(o.responseType="arraybuffer")),e&&"object"==typeof e.headers&&!(e.headers instanceof F||P.Headers&&e.headers instanceof P.Headers)){var s=[];Object.getOwnPropertyNames(e.headers).forEach((function(t){s.push(O(t)),o.setRequestHeader(t,R(e.headers[t]))})),i.headers.forEach((function(t,e){-1===s.indexOf(e)&&o.setRequestHeader(e,t)}))}else i.headers.forEach((function(t,e){o.setRequestHeader(e,t)}));i.signal&&(i.signal.addEventListener("abort",a),o.onreadystatechange=function(){4===o.readyState&&i.signal.removeEventListener("abort",a)}),o.send(void 0===i._bodyInit?null:i._bodyInit)}))}Y.polyfill=!0,P.fetch||(P.fetch=Y,P.Headers=F,P.Request=G,P.Response=Z);var X=!self.fetch||"function"!=typeof self.Request||!("signal"in self.Request.prototype)||!self.AbortController,K=(X?S({fetch:Y,Request:G}):self).fetch,Q=X?M:self.AbortController;function J(e,r){return i(this,void 0,void 0,(function(){var n,i,a,s,l;return o(this,(function(o){switch(o.label){case 0:n=r.timeOut,i=r.abortInvoker,a=new Q,s={execute:function(){return a.abort()}},i&&(i.setCommand(s),i.isAborted()&&a.abort()),l=setTimeout(s.execute,n),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,K(e,t.__assign(t.__assign({},r),{signal:a.signal}))];case 2:return[2,o.sent()];case 3:return clearTimeout(l),[7];case 4:return[2]}}))}))}function $(t,e){var r;return(r=[]).concat.apply(r,l([],s(t.map(e)),!1))}function tt(t,e,r){var n=t.get(e);if(n)return n;var i=r(e);return i&&t.set(e,i),i}var et=function(){function t(t,e){void 0===e&&(e={}),this._name=t,this._data=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),t}(),rt=function(){function t(){this._parent=null,this._listenersMap=new Map,this._oneTimeListenersMap=new Map}return t.prototype.on=function(e,r){return t._addEventListener(this._listenersMap,e,r),this},t.prototype.once=function(e,r){return t._addEventListener(this._oneTimeListenersMap,e,r),this},t._addEventListener=function(t,e,r){var n=tt(t,e,(function(){return[]}));-1===n.indexOf(r)&&n.push(r)},t.prototype.off=function(e,r){return t._removeEventListener(this._listenersMap,e,r),t._removeEventListener(this._oneTimeListenersMap,e,r),this},t._removeEventListener=function(t,e,r){var n=t.get(e);if(n)if(r){var i=n.indexOf(r);-1!==i&&n.splice(i,1)}else t.delete(e)},t.prototype.emit=function(e){var r,n,i,o;if(this.listens(e.name)){var s=this._listenersMap.get(e.name),l=s&&s.length>0?s.slice():[];try{for(var u=a(l),h=u.next();!h.done;h=u.next())(y=h.value)(e)}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}var c=this._oneTimeListenersMap.get(e.name),f=c&&c.length>0?c.slice():[];try{for(var p=a(f),d=p.next();!d.done;d=p.next()){var y=d.value;t._removeEventListener(this._oneTimeListenersMap,e.name,y),y(e)}}catch(t){i={error:t}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}var g=this._parent;g&&g.emit(e)}return this},t.prototype.listens=function(t){var e=this._listenersMap.get(t),r=this._oneTimeListenersMap.get(t);return!!e&&e.length>0||!!r&&r.length>0||!!this._parent&&this._parent.listens(t)},t.prototype.setParent=function(t){return this._parent=t,this},t.prototype.removeAllListeners=function(){this._listenersMap.clear(),this._oneTimeListenersMap.clear()},t}();function nt(t){return function(t){return t>=200&&t<400}(t.statusCode)}var it={maxConnections:8,maxConnectionsPerHost:6},ot=function(e){function n(r){var n=e.call(this)||this;return n._activeHosts={},n._items={},n._queue=[],n._activeConnections=0,n._currentId=0,n._options=t.__assign(t.__assign({},it),r),n}return r(n,e),n.prototype.addRequest=function(t,e){var r=this._getHostKey(t),n=this._currentId++,i={active:!1,id:n,hostKey:r,url:t,data:e};return this._items[n]=i,this._queue.push(n),this._process(),i},n.prototype.abortRequest=function(t){return!this._items[t].active&&(r=t,(n=(e=this._queue).indexOf(r))>-1&&e.splice(n,1),this._removeItem(t),!0);var e,r,n},n.prototype._getHostKey=function(t){try{return function(t){return t.hostname}(new URL(t))}catch(t){return location.hostname}},n.prototype._process=function(){var t=this,e=this._options.maxConnections-this._activeConnections;if(!(e<=0))for(var r=function(r){var i=n._queue[r],o=n._items[i],a=o.hostKey,s=o.url,l=o.data,u=n._options.maxConnectionsPerHost,h=n._activeHosts[a],c=!1;return h?h<u&&(n._activeHosts[a]++,c=!0):(n._activeHosts[a]=1,c=!0),c?(n._activeConnections++,o.active=!0,n._queue.splice(r,1),n.emit(new et("item",{url:s,itemData:l,done:function(){t._activeConnections--,t._activeHosts[a]--,t._activeHosts[a]<=0&&delete t._activeHosts[a],t._removeItem(i),t._process()}})),e-1<=0?"break":void 0):"continue"},n=this,i=0;i<this._queue.length&&"break"!==r(i);i++);},n.prototype._removeItem=function(t){delete this._items[t],this._queue.length<=0&&this._activeConnections<=0&&(this._currentId=0,this.emit(new et("end")))},n.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},n.prototype.setOptions=function(e){this._options=t.__assign(t.__assign({},this._options),e)},n}(rt),at=ot,st=function(){function t(){var t=this;this._requestQueue=new at,this._referrer="",this._requestQueue.on("item",(function(e){return i(t,void 0,void 0,(function(){var t,r,n,i,a,s,l,u,h,c,f,p,d,y;return o(this,(function(o){switch(o.label){case 0:t=e.data,r=t.itemData,n=t.done,a=(i=r).url,s=i.headers,l=i.cache,u=i.timeOut,h=i.abortInvoker,c=i.responseType,f=i.callbacks,o.label=1;case 1:return o.trys.push([1,12,13,14]),[4,J(a,{timeOut:u,headers:s,cache:l,abortInvoker:h,referrer:this._referrer})];case 2:switch(p=o.sent(),d=void 0,c){case"ArrayBuffer":return[3,3];case"Json":return[3,5];case"Text":return[3,7];case"Blob":return[3,9]}return[3,11];case 3:return[4,p.arrayBuffer()];case 4:return d=o.sent(),[3,11];case 5:return[4,p.json()];case 6:return d=o.sent(),[3,11];case 7:return[4,p.text()];case 8:return d=o.sent(),[3,11];case 9:return[4,p.blob()];case 10:return d=o.sent(),[3,11];case 11:return f.resolve({statusCode:p.status,headers:lt(p),body:d}),[3,14];case 12:return y=o.sent(),f.reject(y),[3,14];case 13:return n(),[7];case 14:return[2]}}))}))}))}return t.prototype.setConnectionLimits=function(t){this._requestQueue.setOptions(t)},t.prototype.setReferrer=function(t){this._referrer=t},t.prototype.call=function(t,e,r){var n=this;void 0===r&&(r={});var i=r.defaultTimeOut,o=void 0===i?1e4:i,a=r.timeOut,s=r.headers,l=r.cache,u=r.abortInvoker,c=r.urlReplacements,f=function(t,e){return e.reduce((function(t,e){return e.replace(t)}),t)}(t,[new h(void 0===c?[]:c)]),p={url:f,headers:s,cache:l,timeOut:a||o,abortInvoker:u,responseType:e},d=new Promise((function(t,e){p.callbacks={resolve:t,reject:e}})),y=this._requestQueue.addRequest(f,p);return u&&!y.active&&u.setCommand({execute:function(){var t;n._requestQueue.abortRequest(y.id)&&(null===(t=p.callbacks)||void 0===t||t.reject(new DOMException("The user aborted a request.","AbortError")))}}),d},t.prototype.callBinary=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this.call(t,"ArrayBuffer",e)]}))}))},t.prototype.callJson=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this.call(t,"Json",e)]}))}))},t.prototype.callText=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this.call(t,"Text",e)]}))}))},t.prototype.callBlob=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this.call(t,"Blob",e)]}))}))},t}();function lt(t){var e,r,n={};try{for(var i=a(t.headers.entries()),o=i.next();!o.done;o=i.next()){var l=s(o.value,2),u=l[0],h=l[1];n[u]=h}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}var ut=new st,ht=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ct=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},ft=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};function pt(t,e){var r,n,i={},o=[];try{for(var a=ht(Object.entries(t)),s=a.next();!s.done;s=a.next()){var l=ct(s.value,2),u=l[0],h=l[1],c=e.serialize(h);i[u]=c.data,o.push.apply(o,ft([],ct(c.transferable),!1))}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return{data:i,transferable:o}}function dt(t,e){var r,n,i={};try{for(var o=ht(Object.entries(t)),a=o.next();!a.done;a=o.next()){var s=ct(a.value,2),l=s[0],u=s[1];l!==e.serializeNameKey&&(i[l]=e.deserialize(u))}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}var yt,gt=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},vt=function(){function t(t){this._prototype=t}return t.prototype.serialize=function(t,e){return pt(t,e)},t.prototype.deserialize=function(t,e){var r,n,i=dt(t,e),o=Object.create(this._prototype);try{for(var a=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.entries(i)),s=a.next();!s.done;s=a.next()){var l=gt(s.value,2),u=l[0],h=l[1];o[u]=h}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},t}(),_t=vt,mt=function(){},bt=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},xt=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},wt=function(){function t(t){void 0===t&&(t="$$serializeName"),this._registry=new Map,this._serializeNameKey=t}return t.prototype.registerTypeAdapter=function(t,e){return this._registry.set(t,e),this},t.prototype.registerPrototype=function(t){return this.registerTypeAdapter(t.getSerializeName(),new _t(t))},t.prototype.serialize=function(t){var e,r;if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return{data:t,transferable:[]};if(t instanceof ArrayBuffer)return{data:t,transferable:[t]};if(ArrayBuffer.isView(t))return{data:t,transferable:[t.buffer]};if(Array.isArray(t)){var n=[],i=[];try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),a=o.next();!a.done;a=o.next()){var s=a.value,l=this.serialize(s);n.push(l.data),i.push.apply(i,xt([],bt(l.transferable),!1))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return{data:n,transferable:i}}if("object"==typeof t){if(t instanceof mt){var u=t.getSerializeName(),h=this._registry.get(u);if(h){var c=h.serialize(t,this);return c.data[this._serializeNameKey]=u,c}}return pt(t,this)}throw new Error},t.prototype.deserialize=function(t){var e=this;if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t))return t;if(Array.isArray(t))return t.map((function(t){return e.deserialize(t)}));if("object"==typeof t){var r=t[this._serializeNameKey],n=r&&this._registry.get(r);return n?n.deserialize(t,this):dt(t,this)}throw new Error},Object.defineProperty(t.prototype,"serializeNameKey",{get:function(){return this._serializeNameKey},enumerable:!1,configurable:!0}),t}(),Mt=wt,St={exports:{}},Pt={exports:{}};!function(t){
/**
        	 * @license bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
        	 * Backing buffer: ArrayBuffer, Accessor: Uint8Array
        	 * Released under the Apache License, Version 2.0
        	 * see: https://github.com/dcodeIO/bytebuffer.js for details
        	 */
!function(e,r){t&&t.exports?t.exports=function(){var t;try{yt||(yt=1,function(t){
/**
        		 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
        		 * Released under the Apache License, Version 2.0
        		 * see: https://github.com/dcodeIO/long.js for details
        		 */
!function(e,r){t&&t.exports?t.exports=r():(e.dcodeIO=e.dcodeIO||{}).Long=r()}(this,(function(){function t(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function e(t){return!0===(t&&t.__isLong__)}Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var r={},n={};function i(t,e){var i,o,s;return e?(s=0<=(t>>>=0)&&t<256)&&(o=n[t])?o:(i=a(t,(0|t)<0?-1:0,!0),s&&(n[t]=i),i):(s=-128<=(t|=0)&&t<128)&&(o=r[t])?o:(i=a(t,t<0?-1:0,!1),s&&(r[t]=i),i)}function o(t,e){if(isNaN(t)||!isFinite(t))return e?y:d;if(e){if(t<0)return y;if(t>=c)return b}else{if(t<=-f)return x;if(t+1>=f)return m}return t<0?o(-t,e).neg():a(t%h|0,t/h|0,e)}function a(e,r,n){return new t(e,r,n)}t.fromInt=i,t.fromNumber=o,t.fromBits=a;var s=Math.pow;function l(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return d;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return l(t.substring(1),e,r).neg();for(var i=o(s(r,8)),a=d,u=0;u<t.length;u+=8){var h=Math.min(8,t.length-u),c=parseInt(t.substring(u,u+h),r);if(h<8){var f=o(s(r,h));a=a.mul(f).add(o(c))}else a=(a=a.mul(i)).add(o(c))}return a.unsigned=e,a}function u(e){return e instanceof t?e:"number"==typeof e?o(e):"string"==typeof e?l(e):a(e.low,e.high,e.unsigned)}t.fromString=l,t.fromValue=u;var h=4294967296,c=h*h,f=c/2,p=i(1<<24),d=i(0);t.ZERO=d;var y=i(0,!0);t.UZERO=y;var g=i(1);t.ONE=g;var v=i(1,!0);t.UONE=v;var _=i(-1);t.NEG_ONE=_;var m=a(-1,2147483647,!1);t.MAX_VALUE=m;var b=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=b;var x=a(0,-2147483648,!1);t.MIN_VALUE=x;var w=t.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},w.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var e=o(t),r=this.div(e),n=r.mul(e).sub(this);return r.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=o(s(t,6),this.unsigned),a=this,l="";;){var u=a.div(i),h=(a.sub(u.mul(i)).toInt()>>>0).toString(t);if((a=u).isZero())return h+l;for(;h.length<6;)h="0"+h;l=""+h+l}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1==(1&this.low)},w.isEven=function(){return 0==(1&this.low)},w.equals=function(t){return e(t)||(t=u(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},w.eq=w.equals,w.notEquals=function(t){return!this.eq(t)},w.neq=w.notEquals,w.lessThan=function(t){return this.comp(t)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(t){return this.comp(t)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(t){return this.comp(t)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(t){return this.comp(t)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(t){if(e(t)||(t=u(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(g)},w.neg=w.negate,w.add=function(t){e(t)||(t=u(t));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=t.high>>>16,l=65535&t.high,h=t.low>>>16,c=0,f=0,p=0,d=0;return p+=(d+=o+(65535&t.low))>>>16,f+=(p+=i+h)>>>16,c+=(f+=n+l)>>>16,c+=r+s,a((p&=65535)<<16|(d&=65535),(c&=65535)<<16|(f&=65535),this.unsigned)},w.subtract=function(t){return e(t)||(t=u(t)),this.add(t.neg())},w.sub=w.subtract,w.multiply=function(t){if(this.isZero())return d;if(e(t)||(t=u(t)),t.isZero())return d;if(this.eq(x))return t.isOdd()?x:d;if(t.eq(x))return this.isOdd()?x:d;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(p)&&t.lt(p))return o(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,s=65535&this.low,l=t.high>>>16,h=65535&t.high,c=t.low>>>16,f=65535&t.low,y=0,g=0,v=0,_=0;return v+=(_+=s*f)>>>16,g+=(v+=i*f)>>>16,v&=65535,g+=(v+=s*c)>>>16,y+=(g+=n*f)>>>16,g&=65535,y+=(g+=i*c)>>>16,g&=65535,y+=(g+=s*h)>>>16,y+=r*f+n*c+i*h+s*l,a((v&=65535)<<16|(_&=65535),(y&=65535)<<16|(g&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(t){if(e(t)||(t=u(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?y:d;var r,n,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return v;i=y}else{if(this.eq(x))return t.eq(g)||t.eq(_)?x:t.eq(x)?g:(r=this.shr(1).div(t).shl(1)).eq(d)?t.isNegative()?g:_:(n=this.sub(t.mul(r)),i=r.add(n.div(t)));if(t.eq(x))return this.unsigned?y:d;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=d}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),l=a<=48?1:s(2,a-48),h=o(r),c=h.mul(t);c.isNegative()||c.gt(n);)c=(h=o(r-=l,this.unsigned)).mul(t);h.isZero()&&(h=g),i=i.add(h),n=n.sub(c)}return i},w.div=w.divide,w.modulo=function(t){return e(t)||(t=u(t)),this.sub(this.div(t).mul(t))},w.mod=w.modulo,w.not=function(){return a(~this.low,~this.high,this.unsigned)},w.and=function(t){return e(t)||(t=u(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},w.or=function(t){return e(t)||(t=u(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},w.xor=function(t){return e(t)||(t=u(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},w.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var r=this.high;return t<32?a(this.low>>>t|r<<32-t,r>>>t,this.unsigned):a(32===t?r:r>>>t-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},w.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},w.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t}))}(Pt)),t=Pt.exports}catch(t){}return r(t)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=r(e.dcodeIO.Long)}(this,(function(t){var e=function(t,r,i){if(void 0===t&&(t=e.DEFAULT_CAPACITY),void 0===r&&(r=e.DEFAULT_ENDIAN),void 0===i&&(i=e.DEFAULT_NOASSERT),!i){if((t|=0)<0)throw RangeError("Illegal capacity");r=!!r,i=!!i}this.buffer=0===t?n:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=r,this.noAssert=i};e.VERSION="5.0.1",e.LITTLE_ENDIAN=!0,e.BIG_ENDIAN=!1,e.DEFAULT_CAPACITY=16,e.DEFAULT_ENDIAN=e.BIG_ENDIAN,e.DEFAULT_NOASSERT=!1,e.Long=t||null;var r=e.prototype;Object.defineProperty(r,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var n=new ArrayBuffer(0),i=String.fromCharCode;function o(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function a(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+i.apply(String,t);t.length+arguments.length>1024&&(e.push(i.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}function s(t,e,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,h=-7,c=r?i-1:0,f=r?-1:1,p=t[e+c];for(c+=f,o=p&(1<<-h)-1,p>>=-h,h+=s;h>0;o=256*o+t[e+c],c+=f,h-=8);for(a=o&(1<<-h)-1,o>>=-h,h+=n;h>0;a=256*a+t[e+c],c+=f,h-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=u}return(p?-1:1)*a*Math.pow(2,o-n)}function l(t,e,r,n,i,o){var a,s,l,u=8*o-i-1,h=(1<<u)-1,c=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=h):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+c>=1?f/l:f*Math.pow(2,1-c))*l>=2&&(a++,l/=2),a+c>=h?(s=0,a=h):a+c>=1?(s=(e*l-1)*Math.pow(2,i),a+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;t[r+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[r+p]=255&a,p+=d,a/=256,u-=8);t[r+p-d]|=128*y}e.accessor=function(){return Uint8Array},e.allocate=function(t,r,n){return new e(t,r,n)},e.concat=function(t,r,n,i){"boolean"!=typeof r&&"string"==typeof r||(i=n,n=r,r=void 0);for(var o,a=0,s=0,l=t.length;s<l;++s)e.isByteBuffer(t[s])||(t[s]=e.wrap(t[s],r)),(o=t[s].limit-t[s].offset)>0&&(a+=o);if(0===a)return new e(0,n,i);var u,h=new e(a,n,i);for(s=0;s<l;)(o=(u=t[s++]).limit-u.offset)<=0||(h.view.set(u.view.subarray(u.offset,u.limit),h.offset),h.offset+=o);return h.limit=h.offset,h.offset=0,h},e.isByteBuffer=function(t){return!0===(t&&t.__isByteBuffer__)},e.type=function(){return ArrayBuffer},e.wrap=function(t,n,i,o){if("string"!=typeof n&&(o=i,i=n,n=void 0),"string"==typeof t)switch(void 0===n&&(n="utf8"),n){case"base64":return e.fromBase64(t,i);case"hex":return e.fromHex(t,i);case"binary":return e.fromBinary(t,i);case"utf8":return e.fromUTF8(t,i);case"debug":return e.fromDebug(t,i);default:throw Error("Unsupported encoding: "+n)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var a;if(e.isByteBuffer(t))return(a=r.clone.call(t)).markedOffset=-1,a;if(t instanceof Uint8Array)a=new e(0,i,o),t.length>0&&(a.buffer=t.buffer,a.offset=t.byteOffset,a.limit=t.byteOffset+t.byteLength,a.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)a=new e(0,i,o),t.byteLength>0&&(a.buffer=t,a.offset=0,a.limit=t.byteLength,a.view=t.byteLength>0?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");(a=new e(t.length,i,o)).limit=t.length;for(var s=0;s<t.length;++s)a.view[s]=t[s]}return a},r.writeBitSet=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if(!(t instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i=e,o=t.length,a=o>>3,s=0;for(e+=this.writeVarint32(o,e);a--;)n=1&!!t[s++]|(1&!!t[s++])<<1|(1&!!t[s++])<<2|(1&!!t[s++])<<3|(1&!!t[s++])<<4|(1&!!t[s++])<<5|(1&!!t[s++])<<6|(1&!!t[s++])<<7,this.writeByte(n,e++);if(s<o){var l=0;for(n=0;s<o;)n|=(1&!!t[s++])<<l++;this.writeByte(n,e++)}return r?(this.offset=e,this):e-i},r.readBitSet=function(t){var e=void 0===t;e&&(t=this.offset);var r,n=this.readVarint32(t),i=n.value,o=i>>3,a=0,s=[];for(t+=n.length;o--;)r=this.readByte(t++),s[a++]=!!(1&r),s[a++]=!!(2&r),s[a++]=!!(4&r),s[a++]=!!(8&r),s[a++]=!!(16&r),s[a++]=!!(32&r),s[a++]=!!(64&r),s[a++]=!!(128&r);if(a<i){var l=0;for(r=this.readByte(t++);a<i;)s[a++]=!!(r>>l++&1)}return e&&(this.offset=t),s},r.readBytes=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+t+") <= "+this.buffer.byteLength)}var n=this.slice(e,e+t);return r&&(this.offset+=t),n},r.writeBytes=r.append,r.writeInt8=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=1,this.view[e]=t,r&&(this.offset+=1),this},r.writeByte=r.writeInt8,r.readInt8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=this.view[t];return 128==(128&r)&&(r=-(255-r+1)),e&&(this.offset+=1),r},r.readByte=r.readInt8,r.writeUint8=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=1,this.view[e]=t,r&&(this.offset+=1),this},r.writeUInt8=r.writeUint8,r.readUint8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=this.view[t];return e&&(this.offset+=1),r},r.readUInt8=r.readUint8,r.writeInt16=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},r.writeShort=r.writeInt16,r.readInt16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),32768==(32768&r)&&(r=-(65535-r+1)),e&&(this.offset+=2),r},r.readShort=r.readInt16,r.writeUint16=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},r.writeUInt16=r.writeUint16,r.readUint16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),e&&(this.offset+=2),r},r.readUInt16=r.readUint16,r.writeInt32=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},r.writeInt=r.writeInt32,r.readInt32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),r|=0,e&&(this.offset+=4),r},r.readInt=r.readInt32,r.writeUint32=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},r.writeUInt32=r.writeUint32,r.readUint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),e&&(this.offset+=4),r},r.readUInt32=r.readUint32,t&&(r.writeInt64=function(e,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),r+=8;var i=this.buffer.byteLength;r>i&&this.resize((i*=2)>r?i:r),r-=8;var o=e.low,a=e.high;return this.littleEndian?(this.view[r+3]=o>>>24&255,this.view[r+2]=o>>>16&255,this.view[r+1]=o>>>8&255,this.view[r]=255&o,r+=4,this.view[r+3]=a>>>24&255,this.view[r+2]=a>>>16&255,this.view[r+1]=a>>>8&255,this.view[r]=255&a):(this.view[r]=a>>>24&255,this.view[r+1]=a>>>16&255,this.view[r+2]=a>>>8&255,this.view[r+3]=255&a,r+=4,this.view[r]=o>>>24&255,this.view[r+1]=o>>>16&255,this.view[r+2]=o>>>8&255,this.view[r+3]=255&o),n&&(this.offset+=8),this},r.writeLong=r.writeInt64,r.readInt64=function(e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var n=0,i=0;this.littleEndian?(n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0);var o=new t(n,i,!1);return r&&(this.offset+=8),o},r.readLong=r.readInt64,r.writeUint64=function(e,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),r+=8;var i=this.buffer.byteLength;r>i&&this.resize((i*=2)>r?i:r),r-=8;var o=e.low,a=e.high;return this.littleEndian?(this.view[r+3]=o>>>24&255,this.view[r+2]=o>>>16&255,this.view[r+1]=o>>>8&255,this.view[r]=255&o,r+=4,this.view[r+3]=a>>>24&255,this.view[r+2]=a>>>16&255,this.view[r+1]=a>>>8&255,this.view[r]=255&a):(this.view[r]=a>>>24&255,this.view[r+1]=a>>>16&255,this.view[r+2]=a>>>8&255,this.view[r+3]=255&a,r+=4,this.view[r]=o>>>24&255,this.view[r+1]=o>>>16&255,this.view[r+2]=o>>>8&255,this.view[r+3]=255&o),n&&(this.offset+=8),this},r.writeUInt64=r.writeUint64,r.readUint64=function(e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var n=0,i=0;this.littleEndian?(n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0);var o=new t(n,i,!0);return r&&(this.offset+=8),o},r.readUInt64=r.readUint64),r.writeFloat32=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=4,l(this.view,t,e,this.littleEndian,23,4),r&&(this.offset+=4),this},r.writeFloat=r.writeFloat32,r.readFloat32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=s(this.view,t,this.littleEndian,23,4);return e&&(this.offset+=4),r},r.readFloat=r.readFloat32,r.writeFloat64=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=8,l(this.view,t,e,this.littleEndian,52,8),r&&(this.offset+=8),this},r.writeDouble=r.writeFloat64,r.readFloat64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=s(this.view,t,this.littleEndian,52,8);return e&&(this.offset+=8),r},r.readDouble=r.readFloat64,e.MAX_VARINT32_BYTES=5,e.calculateVarint32=function(t){return(t>>>=0)<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},e.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},e.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},r.writeVarint32=function(t,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,o=e.calculateVarint32(t);r+=o;var a=this.buffer.byteLength;for(r>a&&this.resize((a*=2)>r?a:r),r-=o,t>>>=0;t>=128;)i=127&t|128,this.view[r++]=i,t>>>=7;return this.view[r++]=t,n?(this.offset=r,this):o},r.writeVarint32ZigZag=function(t,r){return this.writeVarint32(e.zigZagEncode32(t),r)},r.readVarint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r,n=0,i=0;do{if(!this.noAssert&&t>this.limit){var o=Error("Truncated");throw o.truncated=!0,o}r=this.view[t++],n<5&&(i|=(127&r)<<7*n),++n}while(0!=(128&r));return i|=0,e?(this.offset=t,i):{value:i,length:n}},r.readVarint32ZigZag=function(t){var r=this.readVarint32(t);return"object"==typeof r?r.value=e.zigZagDecode32(r.value):r=e.zigZagDecode32(r),r},t&&(e.MAX_VARINT64_BYTES=10,e.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var r=e.toInt()>>>0,n=e.shiftRightUnsigned(28).toInt()>>>0,i=e.shiftRightUnsigned(56).toInt()>>>0;return 0==i?0==n?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10},e.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},e.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},r.writeVarint64=function(r,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"==typeof r)r=t.fromNumber(r);else if("string"==typeof r)r=t.fromString(r);else if(!(r&&r instanceof t))throw TypeError("Illegal value: "+r+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof r?r=t.fromNumber(r,!1):"string"==typeof r?r=t.fromString(r,!1):!1!==r.unsigned&&(r=r.toSigned());var o=e.calculateVarint64(r),a=r.toInt()>>>0,s=r.shiftRightUnsigned(28).toInt()>>>0,l=r.shiftRightUnsigned(56).toInt()>>>0;n+=o;var u=this.buffer.byteLength;switch(n>u&&this.resize((u*=2)>n?u:n),n-=o,o){case 10:this.view[n+9]=l>>>7&1;case 9:this.view[n+8]=9!==o?128|l:127&l;case 8:this.view[n+7]=8!==o?s>>>21|128:s>>>21&127;case 7:this.view[n+6]=7!==o?s>>>14|128:s>>>14&127;case 6:this.view[n+5]=6!==o?s>>>7|128:s>>>7&127;case 5:this.view[n+4]=5!==o?128|s:127&s;case 4:this.view[n+3]=4!==o?a>>>21|128:a>>>21&127;case 3:this.view[n+2]=3!==o?a>>>14|128:a>>>14&127;case 2:this.view[n+1]=2!==o?a>>>7|128:a>>>7&127;case 1:this.view[n]=1!==o?128|a:127&a}return i?(this.offset+=o,this):o},r.writeVarint64ZigZag=function(t,r){return this.writeVarint64(e.zigZagEncode64(t),r)},r.readVarint64=function(e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var n=e,i=0,o=0,a=0,s=0;if(i=127&(s=this.view[e++]),128&s&&(i|=(127&(s=this.view[e++]))<<7,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[e++]))<<14,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[e++]))<<21,(128&s||this.noAssert&&void 0===s)&&(o=127&(s=this.view[e++]),(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<7,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<14,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<21,(128&s||this.noAssert&&void 0===s)&&(a=127&(s=this.view[e++]),(128&s||this.noAssert&&void 0===s)&&(a|=(127&(s=this.view[e++]))<<7,128&s||this.noAssert&&void 0===s))))))))))throw Error("Buffer overrun");var l=t.fromBits(i|o<<28,o>>>4|a<<24,!1);return r?(this.offset=e,l):{value:l,length:e-n}},r.readVarint64ZigZag=function(r){var n=this.readVarint64(r);return n&&n.value instanceof t?n.value=e.zigZagDecode64(n.value):n=e.zigZagDecode64(n),n}),r.writeCString=function(t,e){var r=void 0===e;r&&(e=this.offset);var n,i=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(n=0;n<i;++n)if(0===t.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}i=h.calculateUTF16asUTF8(o(t))[1],e+=i+1;var a=this.buffer.byteLength;return e>a&&this.resize((a*=2)>e?a:e),e-=i+1,h.encodeUTF16toUTF8(o(t),function(t){this.view[e++]=t}.bind(this)),this.view[e++]=0,r?(this.offset=e,this):i},r.readCString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r,n=t,i=-1;return h.decodeUTF8toUTF16(function(){if(0===i)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return 0===(i=this.view[t++])?null:i}.bind(this),r=a(),!0),e?(this.offset=t,r()):{string:r(),length:t-n}},r.writeIString=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i=e;n=h.calculateUTF16asUTF8(o(t),this.noAssert)[1],e+=4+n;var a=this.buffer.byteLength;if(e>a&&this.resize((a*=2)>e?a:e),e-=4+n,this.littleEndian?(this.view[e+3]=n>>>24&255,this.view[e+2]=n>>>16&255,this.view[e+1]=n>>>8&255,this.view[e]=255&n):(this.view[e]=n>>>24&255,this.view[e+1]=n>>>16&255,this.view[e+2]=n>>>8&255,this.view[e+3]=255&n),e+=4,h.encodeUTF16toUTF8(o(t),function(t){this.view[e++]=t}.bind(this)),e!==i+4+n)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+4+n));return r?(this.offset=e,this):e-i},r.readIString=function(t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=t,i=this.readUint32(t),o=this.readUTF8String(i,e.METRICS_BYTES,t+=4);return t+=o.length,r?(this.offset=t,o.string):{string:o.string,length:t-n}},e.METRICS_CHARS="c",e.METRICS_BYTES="b",r.writeUTF8String=function(t,e){var r,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var i=e;r=h.calculateUTF16asUTF8(o(t))[1],e+=r;var a=this.buffer.byteLength;return e>a&&this.resize((a*=2)>e?a:e),e-=r,h.encodeUTF16toUTF8(o(t),function(t){this.view[e++]=t}.bind(this)),n?(this.offset=e,this):e-i},r.writeString=r.writeUTF8String,e.calculateUTF8Chars=function(t){return h.calculateUTF16asUTF8(o(t))[0]},e.calculateUTF8Bytes=function(t){return h.calculateUTF16asUTF8(o(t))[1]},e.calculateString=e.calculateUTF8Bytes,r.readUTF8String=function(t,r,n){"number"==typeof r&&(n=r,r=void 0);var i=void 0===n;if(i&&(n=this.offset),void 0===r&&(r=e.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var o,s=0,l=n;if(r===e.METRICS_CHARS){if(o=a(),h.decodeUTF8(function(){return s<t&&n<this.limit?this.view[n++]:null}.bind(this),(function(t){++s,h.UTF8toUTF16(t,o)})),s!==t)throw RangeError("Illegal range: Truncated data, "+s+" == "+t);return i?(this.offset=n,o()):{string:o(),length:n-l}}if(r===e.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+"+t+") <= "+this.buffer.byteLength)}var u=n+t;if(h.decodeUTF8toUTF16(function(){return n<u?this.view[n++]:null}.bind(this),o=a(),this.noAssert),n!==u)throw RangeError("Illegal range: Truncated data, "+n+" == "+u);return i?(this.offset=n,o()):{string:o(),length:n-l}}throw TypeError("Unsupported metrics: "+r)},r.readString=r.readUTF8String,r.writeVString=function(t,r){var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,a,s=r;i=h.calculateUTF16asUTF8(o(t),this.noAssert)[1],a=e.calculateVarint32(i),r+=a+i;var l=this.buffer.byteLength;if(r>l&&this.resize((l*=2)>r?l:r),r-=a+i,r+=this.writeVarint32(i,r),h.encodeUTF16toUTF8(o(t),function(t){this.view[r++]=t}.bind(this)),r!==s+i+a)throw RangeError("Illegal range: Truncated data, "+r+" == "+(r+i+a));return n?(this.offset=r,this):r-s},r.readVString=function(t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=t,i=this.readVarint32(t),o=this.readUTF8String(i.value,e.METRICS_BYTES,t+=i.length);return t+=o.length,r?(this.offset=t,o.string):{string:o.string,length:t-n}},r.append=function(t,r,n){"number"!=typeof r&&"string"==typeof r||(n=r,r=void 0);var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,r));var o=t.limit-t.offset;if(o<=0)return this;n+=o;var a=this.buffer.byteLength;return n>a&&this.resize((a*=2)>n?a:n),n-=o,this.view.set(t.view.subarray(t.offset,t.limit),n),t.offset+=o,i&&(this.offset+=o),this},r.appendTo=function(t,e){return t.append(this,e),this},r.assert=function(t){return this.noAssert=!t,this},r.capacity=function(){return this.buffer.byteLength},r.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},r.clone=function(t){var r=new e(0,this.littleEndian,this.noAssert);return t?(r.buffer=new ArrayBuffer(this.buffer.byteLength),r.view=new Uint8Array(r.buffer)):(r.buffer=this.buffer,r.view=this.view),r.offset=this.offset,r.markedOffset=this.markedOffset,r.limit=this.limit,r},r.compact=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var r=e-t;if(0===r)return this.buffer=n,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var i=new ArrayBuffer(r),o=new Uint8Array(i);return o.set(this.view.subarray(t,e)),this.buffer=i,this.view=o,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=r,this},r.copy=function(t,r){if(void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||t>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(t===r)return new e(0,this.littleEndian,this.noAssert);var n=r-t,i=new e(n,this.littleEndian,this.noAssert);return i.offset=0,i.limit=n,i.markedOffset>=0&&(i.markedOffset-=t),this.copyTo(i,0,t,r),i},r.copyTo=function(t,r,n,i){var o,a;if(!this.noAssert&&!e.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(r=(a=void 0===r)?t.offset:0|r,n=(o=void 0===n)?this.offset:0|n,i=void 0===i?this.limit:0|i,r<0||r>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+r+" <= "+t.buffer.byteLength);if(n<0||i>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+n+" <= "+this.buffer.byteLength);var s=i-n;return 0===s?t:(t.ensureCapacity(r+s),t.view.set(this.view.subarray(n,i),r),o&&(this.offset+=s),a&&(t.offset+=s),this)},r.ensureCapacity=function(t){var e=this.buffer.byteLength;return e<t?this.resize((e*=2)>t?e:t):this},r.fill=function(t,e,r){var n=void 0===e;if(n&&(e=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),void 0===e&&(e=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,e<0||e>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(e>=r)return this;for(;e<r;)this.view[e++]=t;return n&&(this.offset=e),this},r.flip=function(){return this.limit=this.offset,this.offset=0,this},r.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},r.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},r.LE=function(t){return this.littleEndian=void 0===t||!!t,this},r.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},r.prepend=function(t,r,n){"number"!=typeof r&&"string"==typeof r||(n=r,r=void 0);var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,r));var o=t.limit-t.offset;if(o<=0)return this;var a=o-n;if(a>0){var s=new ArrayBuffer(this.buffer.byteLength+a),l=new Uint8Array(s);l.set(this.view.subarray(n,this.buffer.byteLength),o),this.buffer=s,this.view=l,this.offset+=a,this.markedOffset>=0&&(this.markedOffset+=a),this.limit+=a,n+=a}return this.view.set(t.view.subarray(t.offset,t.limit),n-o),t.offset=t.limit,i&&(this.offset-=o),this},r.prependTo=function(t,e){return t.prepend(this,e),this},r.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},r.remaining=function(){return this.limit-this.offset},r.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},r.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t),r=new Uint8Array(e);r.set(this.view),this.buffer=e,this.view=r}return this},r.reverse=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e||Array.prototype.reverse.call(this.view.subarray(t,e)),this},r.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(e<0||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},r.slice=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=t,r.limit=e,r},r.toBuffer=function(t){var e=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,e<0||e>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(!t&&0===e&&r===this.buffer.byteLength)return this.buffer;if(e===r)return n;var i=new ArrayBuffer(r-e);return new Uint8Array(i).set(new Uint8Array(this.buffer).subarray(e,r),0),i},r.toArrayBuffer=r.toBuffer,r.toString=function(t,e,r){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(r=e=t="utf8"),t){case"utf8":return this.toUTF8(e,r);case"base64":return this.toBase64(e,r);case"hex":return this.toHex(e,r);case"binary":return this.toBinary(e,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var u=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],r=[],n=0,i=e.length;n<i;++n)r[e[n]]=n;return t.encode=function(t,r){for(var n,i;null!==(n=t());)r(e[n>>2&63]),i=(3&n)<<4,null!==(n=t())?(r(e[63&((i|=n>>4&15)|n>>4&15)]),i=(15&n)<<2,null!==(n=t())?(r(e[63&(i|n>>6&3)]),r(e[63&n])):(r(e[63&i]),r(61))):(r(e[63&i]),r(61),r(61))},t.decode=function(t,e){var n,i,o;function a(t){throw Error("Illegal character code: "+t)}for(;null!==(n=t());)if(void 0===(i=r[n])&&a(n),null!==(n=t())&&(void 0===(o=r[n])&&a(n),e(i<<2>>>0|(48&o)>>4),null!==(n=t()))){if(void 0===(i=r[n])){if(61===n)break;a(n)}if(e((15&o)<<4>>>0|(60&i)>>2),null!==(n=t())){if(void 0===(o=r[n])){if(61===n)break;a(n)}e((3&i)<<6>>>0|o)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},t}();r.toBase64=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity||t>e)throw RangeError("begin, end");var r;return u.encode(function(){return t<e?this.view[t++]:null}.bind(this),r=a()),r()},e.fromBase64=function(t,r){if("string"!=typeof t)throw TypeError("str");var n=new e(t.length/4*3,r),i=0;return u.decode(o(t),(function(t){n.view[i++]=t})),n.limit=i,n},e.btoa=function(t){return e.fromBinary(t).toBase64()},e.atob=function(t){return e.fromBase64(t).toBinary()},r.toBinary=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity()||t>e)throw RangeError("begin, end");if(t===e)return"";for(var r=[],n=[];t<e;)r.push(this.view[t++]),r.length>=1024&&(n.push(String.fromCharCode.apply(String,r)),r=[]);return n.join("")+String.fromCharCode.apply(String,r)},e.fromBinary=function(t,r){if("string"!=typeof t)throw TypeError("str");for(var n,i=0,o=t.length,a=new e(o,r);i<o;){if((n=t.charCodeAt(i))>255)throw RangeError("illegal char code: "+n);a.view[i++]=n}return a.limit=o,a},r.toDebug=function(t){for(var e,r=-1,n=this.buffer.byteLength,i="",o="",a="";r<n;){if(-1!==r&&(i+=(e=this.view[r])<16?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),t&&(o+=e>32&&e<127?String.fromCharCode(e):".")),++r,t&&r>0&&r%16==0&&r!==n){for(;i.length<51;)i+=" ";a+=i+o+"\n",i=o=""}r===this.offset&&r===this.limit?i+=r===this.markedOffset?"!":"|":r===this.offset?i+=r===this.markedOffset?"[":"<":r===this.limit?i+=r===this.markedOffset?"]":">":i+=r===this.markedOffset?"'":t||0!==r&&r!==n?" ":""}if(t&&" "!==i){for(;i.length<51;)i+=" ";a+=i+o+"\n"}return t?a:i},e.fromDebug=function(t,r,n){for(var i,o,a=t.length,s=new e((a+1)/3|0,r,n),l=0,u=0,h=!1,c=!1,f=!1,p=!1,d=!1;l<a;){switch(i=t.charAt(l++)){case"!":if(!n){if(c||f||p){d=!0;break}c=f=p=!0}s.offset=s.markedOffset=s.limit=u,h=!1;break;case"|":if(!n){if(c||p){d=!0;break}c=p=!0}s.offset=s.limit=u,h=!1;break;case"[":if(!n){if(c||f){d=!0;break}c=f=!0}s.offset=s.markedOffset=u,h=!1;break;case"<":if(!n){if(c){d=!0;break}c=!0}s.offset=u,h=!1;break;case"]":if(!n){if(p||f){d=!0;break}p=f=!0}s.limit=s.markedOffset=u,h=!1;break;case">":if(!n){if(p){d=!0;break}p=!0}s.limit=u,h=!1;break;case"'":if(!n){if(f){d=!0;break}f=!0}s.markedOffset=u,h=!1;break;case" ":h=!1;break;default:if(!n&&h){d=!0;break}if(o=parseInt(i+t.charAt(l++),16),!n&&(isNaN(o)||o<0||o>255))throw TypeError("Illegal str: Not a debug encoded string");s.view[u++]=o,h=!0}if(d)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!n){if(!c||!p)throw TypeError("Illegal str: Missing offset or limit");if(u<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+u+" < "+a)}return s},r.toHex=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var r,n=new Array(e-t);t<e;)(r=this.view[t++])<16?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},e.fromHex=function(t,r,n){if(!n){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var i,o=t.length,a=new e(o/2|0,r),s=0,l=0;s<o;s+=2){if(i=parseInt(t.substring(s,s+2),16),!n&&(!isFinite(i)||i<0||i>255))throw TypeError("Illegal str: Contains non-hex characters");a.view[l++]=i}return a.limit=l,a};var h=function(){var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)r<128?e(127&r):r<2048?(e(r>>6&31|192),e(63&r|128)):r<65536?(e(r>>12&15|224),e(r>>6&63|128),e(63&r|128)):(e(r>>18&7|240),e(r>>12&63|128),e(r>>6&63|128),e(63&r|128)),r=null},decodeUTF8:function(t,e){for(var r,n,i,o,a=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(r=t());)if(0==(128&r))e(r);else if(192==(224&r))null===(n=t())&&a([r,n]),e((31&r)<<6|63&n);else if(224==(240&r))(null===(n=t())||null===(i=t()))&&a([r,n,i]),e((15&r)<<12|(63&n)<<6|63&i);else{if(240!=(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=t())||null===(i=t())||null===(o=t()))&&a([r,n,i,o]),e((7&r)<<18|(63&n)<<12|(63&i)<<6|63&o)}},UTF16toUTF8:function(t,e){for(var r,n=null;null!==(r=null!==n?n:t());)r>=55296&&r<=57343&&null!==(n=t())&&n>=56320&&n<=57343?(e(1024*(r-55296)+n-56320+65536),n=null):e(r);null!==n&&e(n)},UTF8toUTF16:function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)r<=65535?e(r):(e(55296+((r-=65536)>>10)),e(r%1024+56320)),r=null},encodeUTF16toUTF8:function(e,r){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,r)}))},decodeUTF8toUTF16:function(e,r){t.decodeUTF8(e,(function(e){t.UTF8toUTF16(e,r)}))},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(t){for(var e,r=0;null!==(e=t());)r+=e<128?1:e<2048?2:e<65536?3:4;return r},calculateUTF16asUTF8:function(e){var r=0,n=0;return t.UTF16toUTF8(e,(function(t){++r,n+=t<128?1:t<2048?2:t<65536?3:4})),[r,n]}};return t}();return r.toUTF8=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var r;try{h.decodeUTF8toUTF16(function(){return t<e?this.view[t++]:null}.bind(this),r=a())}catch(r){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return r()},e.fromUTF8=function(t,r,n){if(!n&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var i=new e(h.calculateUTF16asUTF8(o(t),!0)[1],r,n),a=0;return h.encodeUTF16toUTF8(o(t),(function(t){i.view[a++]=t})),i.limit=a,i},e}))}(St);var Tt,Et=c(St.exports),Lt=function(t){function e(e,r,n){var i=t.call(this)||this;return i._byteBuffer=null,i._arrayBuffer=e,i._size=r,i._dictionary=n,i}return r(e,t),e.prototype.getFeatureId=function(t){this._byteBuffer||(this._byteBuffer=Et.wrap(this._arrayBuffer));var e=2*t*3;return{stackId:this._dictionary[this._byteBuffer.readUint16(e)],featurePos:this._byteBuffer.readUint16(e+2),styleId:this._dictionary[this._byteBuffer.readUint16(e+4)]}},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.getSerializeName=function(){return e.SERIALIZE_NAME},e.serialize=function(t){return{data:{arrayBuffer:t._arrayBuffer,size:t._size,dictionary:t._dictionary},transferable:[t._arrayBuffer]}},e.deserialize=function(t){return new e(t.arrayBuffer,t.size,t.dictionary)},e.SERIALIZE_NAME="FeatureIdCollection",e}(mt);t.MapErrorName=void 0,(Tt=t.MapErrorName||(t.MapErrorName={})).Config="Config",Tt.Source="Source",Tt.Initialize="Initialize";var kt=function(){function t(t,e){this._name=t,this._message=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),t}(),It=function(e){function n(r){return e.call(this,t.MapErrorName.Config,r)||this}return r(n,e),n}(kt),At=function(e){function n(r){return e.call(this,t.MapErrorName.Source,r)||this}return r(n,e),n}(kt),Ct=function(e){function n(r){return e.call(this,t.MapErrorName.Initialize,r)||this}return r(n,e),n}(kt);function Ot(t,e){return!!t&&e in t}function Rt(e,r){return i(this,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:if(!e.properties)return[2,e];if(!e.properties.samurl||"jpeg"!==e.map.format)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,ut.callJson(e.properties.samurl,t.__assign(t.__assign({},r),{timeOut:500}))];case 2:return(n=o.sent()).body.uri&&((i=new URL(e.map.uri)).host=n.body.uri,e.map.uri=i.toString()),[3,4];case 3:return o.sent(),console.warn("Failed to load ".concat(e.properties.samurl)),[3,4];case 4:return[2,e]}}))}))}function Dt(t){var e=t.uri,r=t.version;return e&&r?"".concat(e,".").concat(r):e||""}var Ft=function(t){function e(e){var r=t.call(this)||this,n=e.id,i=e.name,o=e.priority,a=e.properties,s=e.viewLevels,l=e.geometryType,u=e.visibility,h=e.noPopupCategories;return r._id=n,r._name=i,r._priority=null!=o?o:1,r._properties=a||{},r._viewLevels=Array.isArray(s)?s:void 0,r._geometryType=l||"",r._noPopupCategories=(null==h?void 0:h.length)?h:null,r._visibility=null==u||u,r}return r(e,t),e.prototype.getVisibility=function(){return this._visibility},e.prototype.setVisibility=function(t){this._visibility=t},e.prototype.getId=function(){return this._id},e.prototype.getName=function(){return this._name},e.prototype.getPriority=function(){return this._priority},e.prototype.getProperties=function(){return this._properties},e.prototype.getViewLevels=function(){return this._viewLevels},e.prototype.getNoPopupCategories=function(){return this._noPopupCategories},e.prototype.hasViewLevel=function(t){return void 0===this._viewLevels||this._viewLevels.includes(t)},e.prototype.getGeometryType=function(){return this._geometryType},e.prototype.getSerializeName=function(){return"Stack"},e}(mt);Ft.DUMMY=new Ft({id:-1,name:"dummy",priority:-1,properties:{},geometryType:""});var Bt=Ft,Nt=.1,zt="function"==typeof Float32Array;function Ut(t,e){return 1-3*e+3*t}function jt(t,e){return 3*e-6*t}function Vt(t){return 3*t}function Gt(t,e,r){return((Ut(e,r)*t+jt(e,r))*t+Vt(e))*t}function qt(t,e,r){return 3*Ut(e,r)*t*t+2*jt(e,r)*t+Vt(e)}function Zt(t){return t}var Wt=c((function(t,e,r,n){if(!(0<=t&&t<=1&&0<=r&&r<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&r===n)return Zt;for(var i=zt?new Float32Array(11):new Array(11),o=0;o<11;++o)i[o]=Gt(o*Nt,t,r);function a(e){for(var n=0,o=1;10!==o&&i[o]<=e;++o)n+=Nt;--o;var a=n+(e-i[o])/(i[o+1]-i[o])*Nt,s=qt(a,t,r);return s>=.001?function(t,e,r,n){for(var i=0;i<4;++i){var o=qt(e,r,n);if(0===o)return e;e-=(Gt(e,r,n)-t)/o}return e}(e,a,t,r):0===s?a:function(t,e,r,n,i){var o,a,s=0;do{(o=Gt(a=e+(r-e)/2,n,i)-t)>0?r=a:e=a}while(Math.abs(o)>1e-7&&++s<10);return a}(e,n,n+Nt,t,r)}return function(t){return 0===t?0:1===t?1:Gt(a(t),e,n)}}));function Ht(t){return t/180*Math.PI}function Yt(t,e,r){var n=r-e,i=((t-e)%n+n)%n;return 0===i?r:e+i}function Xt(t,e,r){return Math.min(Math.max(t,e),r)}function Kt(t){return t.reduce((function(t,e){return t+e}),0)/t.length}var Qt,Jt;!function(t){t.None="1",t.InStack="2",t.Screen="3"}(Qt||(Qt={})),function(t){t.Basic="1",t.Background="2",t.Spatial="3"}(Jt||(Jt={}));var $t=function(t){function e(e,r){var n,i,o=t.call(this)||this,s=e.config,l=s.id,u=s.type,h=s.map,c=s.properties,f=s.extent,p=[];try{for(var d=a(s.stacks),y=d.next();!y.done;y=d.next()){var g=y.value;p.push(ee(g,s))}}catch(t){n={error:t}}finally{try{y&&!y.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}o._stacks=p,o._stackIndex={};for(var v=0;v<p.length;v++)o._stackIndex[p[v].getId()]=v;return o._order=r,o._versionedUrl=Dt(e)||Dt(e.config),o._id=l,o._type=u,o._map=h,o._properties=c||{},o._extent=f||{},o}return r(e,t),e.prototype.getId=function(){return this._id},e.prototype.getType=function(){return this._type},e.prototype.getSourceSpec=function(){return this._map},e.prototype.getStacks=function(){return this._stacks},e.prototype.getStack=function(t){var e=this._stackIndex[t];return void 0!==e?this._stacks[e]:null},e.prototype.getOrder=function(){return this._order},e.prototype.getProperties=function(){return this._properties},e.prototype.getExtent=function(){return this._extent},e.prototype.getVersionedUrl=function(){return this._versionedUrl},e.prototype.getSerializeName=function(){return"Layer"},e}(mt),te=$t;function ee(e,r){var n=r.map,i=n.format,o=n.srid;return"ld1"===i&&(e=function(e,r){var n=e.viewLevels,i=e.properties,o=void 0===i?{}:i;return t.__assign(t.__assign({},e),{geometryType:"POINT",properties:t.__assign(t.__assign({},o),{poi:o.poi||Jt.Basic,sortBy:"grade"}),viewLevels:Array.isArray(n)&&r?n.map((function(t){return t+6})):n})}(e,4162===o)),new Bt(e)}var re=function(t){function e(e){var r=t.call(this)||this;return r._renderable=null,r._renderableDto=e,r}return r(e,t),e.prototype.prepare=function(t){!this._renderable&&this._renderableDto&&(this._renderable=this._renderableDto.get(t),this._renderableDto.destroy(),this._renderableDto=null)},e.prototype.getRenderable=function(){return this._renderable},e.prototype.clear=function(){},e.prototype.destroy=function(){this._renderable&&(this._renderable.destroy(),this._renderable=null),this._renderableDto&&(this._renderableDto.destroy(),this._renderableDto=null)},e.prototype.getSerializeName=function(){return"LazyInitStyleData"},e}(mt),ne=function(t){function e(e){var r=t.call(this)||this;return r._viewLevel=e,r}return r(e,t),e.prototype.evaluate=function(t){return Boolean(this._viewLevel&32768>>t)},Object.defineProperty(e.prototype,"viewLevel",{get:function(){return this._viewLevel},enumerable:!1,configurable:!0}),e.prototype.getSerializeName=function(){return"BitwiseLevelFilter"},e}(mt),ie=function(t){function e(e,r){var n=t.call(this)||this;return n._minLevel=e,n._maxLevel=r,n}return r(e,t),e.prototype.evaluate=function(t){return t>=this._minLevel&&t<=this._maxLevel},Object.defineProperty(e.prototype,"minLevel",{get:function(){return this._minLevel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!1,configurable:!0}),e.prototype.getSerializeName=function(){return"RangeLevelFilter"},e}(mt),oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.evaluate=function(t){return!0},e.prototype.getSerializeName=function(){return"AlwaysLevelFilter"},e}(mt),ae={origin:{x:0,y:0},scale:{x:1,y:1}},se=function(){function e(e){void 0===e&&(e=t.__assign({},ae)),this._transform=e}return Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){},e}(),le=se,ue=function(t){function e(e){var r=t.call(this)||this;return r._transform=e,r}return r(e,t),e.prototype.get=function(t){return new le(this._transform)},e.prototype.getSerializeName=function(){return"RasterRenderableDto"},e.prototype.destroy=function(){},e}(mt),he=ue,ce=function(t){function e(e){var r=t.call(this)||this;return r._styleData=new re(new he(e)),r}return r(e,t),e.prototype.prepare=function(t){this._styleData.prepare(t)},e.prototype.getRenderable=function(){return this._styleData.getRenderable()},e.prototype.clear=function(){this._styleData.clear()},e.prototype.destroy=function(){this._styleData.destroy()},e.prototype.getSerializeName=function(){return"RasterStyleData"},e}(mt),fe=ce,pe=function(t){function e(){return t.call(this)||this}return r(e,t),e.prototype.createPath=function(t,e){var r=Math.trunc(e/256),n=256*r,i=256*(r+1)-1;return"".concat(t,"/").concat(n,"-").concat(i)},e.prototype.clone=function(){return new e},e.prototype.getSerializeName=function(){return"DefaultGlyphPathFactory"},e}(mt),de=pe,ye=function(t){function e(e,r){var n=t.call(this)||this;return n._packageName=e,n._iconName=r,n}return r(e,t),e.parse=function(t){var r=t.split(":");return new e(r[0].trim(),r[1].trim())},Object.defineProperty(e.prototype,"packageName",{get:function(){return this._packageName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconName",{get:function(){return this._iconName},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"".concat(this._packageName,":").concat(this._iconName)},e.prototype.getSerializeName=function(){return"IconId"},e}(mt);const ge={read:function(t,e){return t.readFields(ge._readField,{id:0,bitmap:null,width:0,height:0,left:0,top:0,advance:0},e)},_readField:function(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())},write:function(t,e){t.id&&e.writeVarintField(1,t.id),t.bitmap&&e.writeBytesField(2,t.bitmap),t.width&&e.writeVarintField(3,t.width),t.height&&e.writeVarintField(4,t.height),t.left&&e.writeSVarintField(5,t.left),t.top&&e.writeSVarintField(6,t.top),t.advance&&e.writeVarintField(7,t.advance)}},ve={read:function(t,e){return t.readFields(ve._readField,{name:"",range:"",glyphs:[]},e)},_readField:function(t,e,r){1===t?e.name=r.readString():2===t?e.range=r.readString():3===t&&e.glyphs.push(ge.read(r,r.readVarint()+r.pos))},write:function(t,e){if(t.name&&e.writeStringField(1,t.name),t.range&&e.writeStringField(2,t.range),t.glyphs)for(var r=0;r<t.glyphs.length;r++)e.writeMessage(3,ge.write,t.glyphs[r])}},_e={read:function(t,e){return t.readFields(_e._readField,{stacks:[]},e)},_readField:function(t,e,r){1===t&&e.stacks.push(ve.read(r,r.readVarint()+r.pos))},write:function(t,e){if(t.stacks)for(var r=0;r<t.stacks.length;r++)e.writeMessage(1,ve.write,t.stacks[r])}},me={read:function(t,e){return t.readFields(me._readField,{mappings:{}},e)},_readField:function(t,e,r){if(1===t){var n=me._FieldEntry1.read(r,r.readVarint()+r.pos);e.mappings[n.key]=n.value}},write:function(t,e){if(t.mappings)for(var r in t.mappings)Object.prototype.hasOwnProperty.call(t.mappings,r)&&e.writeMessage(1,me._FieldEntry1.write,{key:r,value:t.mappings[r]})},_FieldEntry1:{}};me._FieldEntry1.read=function(t,e){return t.readFields(me._FieldEntry1._readField,{key:0,value:0},e)},me._FieldEntry1._readField=function(t,e,r){1===t?e.key=r.readVarint():2===t&&(e.value=r.readVarint())},me._FieldEntry1.write=function(t,e){t.key&&e.writeVarintField(1,t.key),t.value&&e.writeVarintField(2,t.value)};var be=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._width=0,o._height=0,o._channels=0,o._data=new Uint8Array,o._createImage(e,r,n,i),o}return r(e,t),e.prototype._createImage=function(t,e,r,n){if(n)if(n instanceof Uint8ClampedArray)this._data=new Uint8Array(n.buffer);else{if(n.length!==t*e*r)throw new Error("Mismatched image size");this._data=n}else this._data=new Uint8Array(t*e*r);this._width=t,this._height=e,this._channels=r},e.prototype.getWidth=function(){return this._width},e.prototype.getHeight=function(){return this._height},e.prototype.getChannels=function(){return this._channels},e.prototype.getData=function(){return this._data},e.prototype.replace=function(t,e){},e.prototype.resize=function(t,e){},e.prototype.drawImage=function(t,e,r,n,i){if(0!==n&&0!==i){var o=this;if(n>t.getWidth()||i>t.getHeight()||e.x>t.getWidth()-n||e.y>t.getHeight()-i||n>o.getWidth()||i>o.getHeight()||r.x>o.getWidth()-n||r.y>o.getHeight()-i)throw new Error("Out of range");if(t.getChannels()!==o.getChannels())throw new Error("Channels mismatch");for(var a=o.getChannels(),s=t.getData(),l=o.getData(),u=0;u<i;u++)for(var h=((e.y+u)*t.getWidth()+e.x)*a,c=((r.y+u)*o.getWidth()+r.x)*a,f=0;f<n*a;f++)l[c+f]=s[h+f]}},e.prototype.getPixel=function(t,e){var r=(e*this._width+t)*this._channels;return Array.from(this._data.slice(r,r+this._channels))},e.prototype.setPixel=function(t,e,r){for(var n=0;n<this._channels;n++)this._data[(e*this._width+t)*this._channels+n]=r[n]},e}(mt),xe=be,we=function(t){function e(e,r,n){return t.call(this,e,r,1,n)||this}return r(e,t),e.prototype.clone=function(){return new e(this.getWidth(),this.getHeight(),new Uint8Array(this.getData()))},e.prototype.getFormat=function(t){return t.ALPHA},e.prototype.getSerializeName=function(){return"AlphaImage"},e}(xe),Me={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,h=-7,c=r?i-1:0,f=r?-1:1,p=t[e+c];for(c+=f,o=p&(1<<-h)-1,p>>=-h,h+=s;h>0;o=256*o+t[e+c],c+=f,h-=8);for(a=o&(1<<-h)-1,o>>=-h,h+=n;h>0;a=256*a+t[e+c],c+=f,h-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=u}return(p?-1:1)*a*Math.pow(2,o-n)},write:function(t,e,r,n,i,o){var a,s,l,u=8*o-i-1,h=(1<<u)-1,c=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=h):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+c>=1?f/l:f*Math.pow(2,1-c))*l>=2&&(a++,l/=2),a+c>=h?(s=0,a=h):a+c>=1?(s=(e*l-1)*Math.pow(2,i),a+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;t[r+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[r+p]=255&a,p+=d,a/=256,u-=8);t[r+p-d]|=128*y}},Se=Te,Pe=Me;function Te(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Te.Varint=0,Te.Fixed64=1,Te.Bytes=2,Te.Fixed32=5;var Ee=4294967296,Le=1/Ee,ke="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Ie(t){return t.type===Te.Bytes?t.readVarint()+t.pos:t.pos+1}function Ae(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Ce(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function Oe(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Re(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function De(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Fe(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Be(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Ne(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function ze(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Ue(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function je(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Ve(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ge(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function qe(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Te.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ve(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=qe(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ve(this.buf,this.pos)+Ve(this.buf,this.pos+4)*Ee;return this.pos+=8,t},readSFixed64:function(){var t=Ve(this.buf,this.pos)+qe(this.buf,this.pos+4)*Ee;return this.pos+=8,t},readFloat:function(){var t=Pe.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Pe.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return Ae(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return Ae(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return Ae(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return Ae(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return Ae(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return Ae(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&ke?function(t,e,r){return ke.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var n="",i=e;i<r;){var o,a,s,l=t[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h>r)break;1===h?l<128&&(u=l):2===h?128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===h?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===h&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,h=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=h}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Te.Bytes)return t.push(this.readVarint(e));var r=Ie(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Te.Bytes)return t.push(this.readSVarint());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Te.Bytes)return t.push(this.readBoolean());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Te.Bytes)return t.push(this.readFloat());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Te.Bytes)return t.push(this.readDouble());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Te.Bytes)return t.push(this.readFixed32());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Te.Bytes)return t.push(this.readSFixed32());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Te.Bytes)return t.push(this.readFixed64());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Te.Bytes)return t.push(this.readSFixed64());var e=Ie(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Te.Varint)for(;this.buf[this.pos++]>127;);else if(e===Te.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Te.Fixed32)this.pos+=4;else{if(e!==Te.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ge(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ge(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ge(this.buf,-1&t,this.pos),Ge(this.buf,Math.floor(t*Le),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ge(this.buf,-1&t,this.pos),Ge(this.buf,Math.floor(t*Le),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Ce(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Pe.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Pe.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&Ce(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,Te.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Oe,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Re,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Be,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,De,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Fe,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Ne,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ze,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ue,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,je,e)},writeBytesField:function(t,e){this.writeTag(t,Te.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Te.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Te.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Te.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Te.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Te.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Te.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Te.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Te.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Te.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Ze,We,He,Ye=c(Se),Xe=function(t){function e(e){var r=t.call(this)||this;return r._mapping=null,r._startPoints=null,r._pbf=e,r}return r(e,t),e.prototype.createPath=function(t,e){var r;this._mapping&&this._startPoints||(this._mapping=(r=this._pbf,me.read(new Ye(r)).mappings),this._startPoints=Object.keys(this._mapping).map(Number));var n=function(t,e){for(var r=0,n=t.length-1;r<=n;){var i=Math.trunc((r+n)/2),o=t[i];if(o<e)r=i+1;else{if(!(o>e))return o;n=i-1}}return t[Math.min(t.length-1,n)]}(this._startPoints,e);return"".concat(t,"/").concat(this._mapping[n])},e.prototype.clone=function(){return new e(this._pbf.slice(0))},e.prototype.getSerializeName=function(){return"MappedGlyphPathFactory"},e}(mt),Ke=Xe,Qe=function(t){function e(e){var r=t.call(this)||this;return r._styleData=e,r}return r(e,t),e.valueOf=function(t){return new e(t)},e.prototype.get=function(){return this._styleData},e.prototype.values=function(){return[this._styleData]},e.prototype.merge=function(t){if(!(t instanceof e))throw new Error("Can't not merge. Type mismatch.");this._styleData=t._styleData},e.prototype.destroy=function(){},e.prototype.getSerializeName=function(){return"SingleStyleDataMap"},e}(mt),Je=function(t){function e(e){var r=t.call(this)||this;return r._styleData=new re(e.build()),r}return r(e,t),e.prototype.prepare=function(t){this._styleData.prepare(t)},e.prototype.getRenderable=function(){return this._styleData.getRenderable()},e.prototype.clear=function(){this._styleData.clear()},e.prototype.destroy=function(){this._styleData.destroy()},e.prototype.getSerializeName=function(){return"VectorStyleData"},e}(mt),$e=function(t){function e(e,r){var n=t.call(this)||this;return n._properties={},n._styleData=new Je(n._createRenderableBuilder(e,r)),n._style=e.style,n}return r(e,t),e.prototype.prepare=function(t){this._styleData.prepare(t)},e.prototype.getRenderable=function(){return this._styleData.getRenderable()},e.prototype.getQueryPadding=function(){return 0},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o){return!1},e.prototype.clear=function(){this._styleData.clear()},e.prototype.destroy=function(){this._styleData.destroy()},e.prototype.getStyle=function(){return this._style},e.prototype.setProperty=function(t,e){this._properties[t]=e},e.prototype.getProperty=function(t){return this._properties[t]},e}(mt),tr=$e,er=72,rr=[0,0,0,1],nr=rr,ir=rr,or=rr,ar="center";t.Alignment=void 0,(Ze=t.Alignment||(t.Alignment={}))[Ze.Viewport=1]="Viewport",Ze[Ze.Map=2]="Map",t.OverlapType=void 0,(We=t.OverlapType||(t.OverlapType={}))[We.None=0]="None",We[We.Group=1]="Group",We[We.Screen=2]="Screen",function(t){t.Invalid="Invalid",t.Point="Point",t.Circle="Circle",t.Line="Line",t.Polygon="Polygon",t.Building="Building",t.TrafficLine="TrafficLine",t.Poi="Poi",t.BackgroundPoi="BackgroundPoi",t.RoadName="RoadName",t.TexturedPolygon="TexturedPolygon",t.BufferedLine="BufferedLine",t.Crosswalk="Crosswalk",t.Railroad="Railroad",t.TileBackground="TileBackground",t.Image="Image",t.Heatmap="Heatmap"}(He||(He={}));var sr=He;function lr(t){var e=t.replace(/[^0-9.]/g,",").split(",").filter((function(t){return!!t}));if(!(e.length<3)){var r=s(e.map(Number),4),n=r[0],i=r[1],o=r[2],a=r[3];return[n,i,o,void 0===a?1:a]}}function ur(t,e){var r,n,i,o,a,l;if(void 0===e&&(e=rr),!t)return e;if("string"==typeof t){var u=lr(t);if(!u)return e;i=(r=s(u.map(Number),4))[0],o=r[1],a=r[2],l=r[3]}else i=(n=s(t,4))[0],o=n[1],a=n[2],l=n[3];return[i/255,o/255,a/255,null!=l?l:1]}function hr(t,e){return void 0===e&&(e=rr),t?"string"==typeof t?t.includes("#")?function(t,e){if(void 0===e&&(e=rr),!t)return e;var r=t;r.includes("#")&&(r=r.replace("#","")),3===r.length&&(r=r.split("").map((function(t){return t+t})).join(""));var n=parseInt(r,16);return[(n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1]}(t,e):t.includes("hsl")?function(t,e){var r,n,i,o,a,l,u;if(void 0===e&&(e=rr),!t)return e;if("string"==typeof t){var h=lr(t);if(!h)return e;o=(r=s(h.map(Number),4))[0],a=r[1],l=r[2],u=r[3]}else o=(n=s(t,4))[0],a=n[1],l=n[2],u=void 0===(i=n[3])?1:i;if(l/=100,0==(a/=100))return[l,l,l,u];var c=function(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t},f=l<.5?l*(1+a):l+a-l*a,p=2*l-f;return[c(p,f,(o/=360)+1/3),c(p,f,o),c(p,f,o-1/3),u]}(t,e):ur(t,e):ur(t,e):e}var cr={exports:{}};(function(){var t,e,r,n,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?cr.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(cr.exports=function(){return(t()-i)/1e6},e=process.hrtime,n=(t=function(){var t;return 1e9*(t=e())[0]+t[1]})(),o=1e9*process.uptime(),i=n-o):Date.now?(cr.exports=function(){return Date.now()-r},r=Date.now()):(cr.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(void 0);var fr=cr.exports,pr=c(fr),dr={now:pr,get devicePixelRatio(){return window.devicePixelRatio},get dpi(){return 96},get hardwareConcurrency(){return window.navigator.hardwareConcurrency||4},resolveURL:function(t){var e=window.document.createElement("a");return e.href=t,e.href}};function yr(t,e){return void 0===e&&(e=0),t?"number"==typeof t?Math.floor(t):parseInt(t):e}function gr(t,e){return void 0===e&&(e=0),t?"number"==typeof t?t:parseFloat(t):e}function vr(t){return t?t.split(",").map(parseFloat):[]}function _r(t){return void 0===t&&(t=!1),dr.dpi/160*(t?dr.devicePixelRatio:1)}function mr(){return dr.dpi/er}function br(t){return!!t&&"off"===t}var xr=function(e){var r,n=e.poi||Jt.Basic,i=e.poiOverlay||wr(n);switch(n){case Jt.Basic:case Jt.Spatial:r=i===Qt.None?t.OverlapType.None:i===Qt.InStack?t.OverlapType.Group:t.OverlapType.Screen;break;case Jt.Background:default:r=t.OverlapType.None}return r},wr=function(t){return t===Jt.Basic?Qt.Screen:Qt.None},Mr=function(t){if(!t)return new oe;var e=t.sort((function(t,e){return t-e}));return new ie(e[0],e[e.length-1])},Sr=function(t){var e,r=t.get("type"),n=t.get("name1"),i=t.get("name2");switch(r){case"2":e="".concat(n).concat(i);break;case"3":e="".concat(n,"\n").concat(i);break;default:e=n}return e?e.trim():null};function Pr(t){var e,r=mr();return null!==(e=Lr(t["font-size"],r))&&void 0!==e?e:10}function Tr(t){return gr(t["icon-size"],1)}var Er=function(t){var e=mr(),r=Lr(t["offset-x"],e),n=Lr(t["offset-y"],e);return{x:null!=r?r:0,y:null!=n?n:0}};function Lr(t,e){if(void 0!==t)return"string"==typeof t&&t.includes("px")?(t=t.replace("px",""),parseFloat(t)):("number"==typeof t?t:parseFloat(t))*e}var kr=function(t){var e,r,n,i,o={},a=mr(),s=Lr(null!==(e=t["gap-top"])&&void 0!==e?e:t["margin-top"],a),l=Lr(null!==(r=t["gap-bottom"])&&void 0!==r?r:t["margin-bottom"],a),u=Lr(null!==(n=t["gap-left"])&&void 0!==n?n:t["margin-left"],a),h=Lr(null!==(i=t["gap-right"])&&void 0!==i?i:t["margin-right"],a);return void 0!==s?o.top=s:void 0!==l&&(o.bottom=l),void 0!==u?o.left=u:void 0!==h&&(o.right=h),o},Ir=function(t){switch(t.justify||t["align-x"]){case"left":return 0;case"right":return 1;default:return.5}},Ar=function(t){return{horizontal:Cr(t["align-x"]),vertical:Or(t["align-y"])}};function Cr(t,e){switch(void 0===e&&(e=ar),t||e){case"left":return 0;case"right":return 1;default:return.5}}function Or(t,e){switch(void 0===e&&(e="mid"),t||e){case"top":return 0;case"bottom":return 1;default:return.5}}var Rr=function(t,e){return yr(e&&t.get(e),Number.MAX_SAFE_INTEGER)},Dr=function(t){var e=t.get("angle");return Ht(e?parseInt(e,10):0)},Fr=function(t){return{optional:t["label-optional"]||!1,allowOverlap:t["label-allow-overlap"]||!1}},Br=function(t,e){var r=t["icon-allow-overlap"]||!1;return(e.uturn||e.oneway)&&(r=!0),{optional:t["icon-optional"]||!1,allowOverlap:r}},Nr=function(t){var e=t["keep-upright"];return!(!1===e||"false"===e)},zr=function(e,r){var n=e["pitch-alignment"];return"map"===n?t.Alignment.Map:"viewport"===n?t.Alignment.Viewport:r===sr.RoadName?t.Alignment.Map:t.Alignment.Viewport},Ur=function(e,r){var n=e["rotation-alignment"];return"map"===n?t.Alignment.Map:"viewport"===n?t.Alignment.Viewport:r===sr.RoadName?t.Alignment.Map:t.Alignment.Viewport},jr=function(t,e,r,n){void 0===n&&(n={}),Vr(t,e,r,n),Gr(t,e,r,n),qr(t,e,r,n)},Vr=function(t,e,r,n){var i="poi-pitch-alignment",o="pitch-alignment";r[i]?t.setPoiPaint(o,r[i]):n[i]?t.setPoiPaint(o,n[i]):(e.poi===Jt.Background||e.uturn||e.oneway)&&t.setPoiPaint(o,"map")},Gr=function(t,e,r,n){var i="poi-rotation-alignment",o="rotation-alignment";r[i]?t.setPoiPaint(o,r[i]):n[i]?t.setPoiPaint(o,n[i]):(e.uturn||e.oneway)&&t.setPoiPaint(o,"map")},qr=function(t,e,r,n){var i="poi-keep-upright",o="keep-upright";r[i]?t.setPoiPaint(o,r[i]):n[i]?t.setPoiPaint(o,n[i]):(e.uturn||e.oneway)&&t.setPoiPaint(o,"false")},Zr=function(t){function e(e){var r=t.call(this)||this;return r._vertices=e,r}return r(e,t),e.prototype.getVertices=function(){return this._vertices},e}(mt),Wr=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype.getVertex=function(){return this.getVertices()[0]},e.prototype.getSerializeName=function(){return"VectorTilePoint"},e}(Zr),Hr=function(t){function e(e,r){var n=t.call(this,e)||this;return n._partRanges=r,n}return r(e,t),e.prototype.getPartRanges=function(){return this._partRanges},e.prototype.getSerializeName=function(){return"VectorTilePolyline"},e}(Zr),Yr=function(t){function e(e,r){var n=t.call(this,e)||this;return n._multiPartRanges=r,n}return r(e,t),e.prototype.getMultiPartRanges=function(){return this._multiPartRanges},e.prototype.getSerializeName=function(){return"VectorTilePolygon"},e}(Zr),Xr=function(){function t(){}return t.prototype.getVertices=function(){throw new Error("Unsupported operation")},t}();function Kr(t){return t.maxX-t.minX}function Qr(t){return t.maxY-t.minY}function Jr(){return{minX:Number.MAX_VALUE,maxX:Number.MIN_VALUE,minY:Number.MAX_VALUE,maxY:Number.MIN_VALUE}}function $r(t){return Kr(t)<0||Qr(t)<0}function tn(t,e){var r=e.x,n=e.y;return $r(t)?{minX:r,maxX:r,minY:n,maxY:n}:{minX:Math.min(t.minX,r),maxX:Math.max(t.maxX,r),minY:Math.min(t.minY,n),maxY:Math.max(t.maxY,n)}}function en(t,e){return!$r(t)&&!$r(e)&&!(t.maxX<e.minX||t.minX>e.maxX||t.maxY<e.minY||t.minY>e.maxY)}function rn(t,e){return e.x>=t.minX&&e.x<=t.maxX&&e.y>=t.minY&&e.y<=t.maxY}function nn(t){var e=t.minX,r=t.maxX,n=t.minY,i=t.maxY;return[{x:e,y:n},{x:r,y:n},{x:r,y:i},{x:e,y:i}]}function on(t){return t.reduce((function(t,e){return tn(t,e)}),Jr())}var an={x:0,y:0},sn={x:Number.NaN,y:Number.NaN};function ln(t,e){return t.x===e.x&&t.y===e.y}function un(){for(var t,e,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=0,o=0;try{for(var s=a(r),l=s.next();!l.done;l=s.next()){var u=l.value;u&&(i+=u.x,o+=u.y)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return{x:i,y:o}}function hn(t,e){var r=t.x-e.x,n=t.y-e.y;return r*r+n*n}function cn(t,e){return Math.sqrt(hn(t,e))}function fn(t,e){return{x:e(t.x),y:e(t.y)}}function pn(t,e){return{x:t.x+e.x,y:t.y+e.y}}function dn(t,e){return{x:t.x-e.x,y:t.y-e.y}}function yn(t,e){return{x:t.x*e,y:t.y*e}}function gn(t,e){return{x:t.x/e,y:t.y/e}}function vn(t,e){return t.x*e.x+t.y*e.y}function _n(t){var e=t.x,r=t.y;return Math.sqrt(e*e+r*r)}function mn(t){var e=_n(t);return e>0?gn(t,e):{x:0,y:0}}function bn(t,e){var r=Math.cos(e),n=Math.sin(e);return{x:r*t.x-n*t.y,y:n*t.x+r*t.y}}function xn(t){return{x:-t.y,y:t.x}}function wn(t,e){return t.x*e.y-t.y*e.x>0}function Mn(t,e){return Sn(t,e)%2==1}function Sn(t,e){for(var r=0,n=0;n<t.length;n++){var i=t[(n+1)%t.length],o=t[n];i.y>e.y!=o.y>e.y&&e.x<(o.x-i.x)*(e.y-i.y)/(o.y-i.y)+i.x&&r++}return r}function Pn(t,e,r){var n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return!1;for(var o=Tn(t,e,r[0]),a=1;a<4;a++)if(o!==Tn(t,e,r[a]))return!0;return!1}function Tn(t,e,r){return wn(dn(e,t),dn(r,t))}function En(t,e){var r,n,i,o,s,l,u,h;if(1===t.length)return In(e,t[0]);try{for(var c=a(e),f=c.next();!f.done;f=c.next()){var p=f.value;try{for(var d=(i=void 0,a(p)),y=d.next();!y.done;y=d.next())if(Mn(t,y.value))return!0}catch(t){i={error:t}}finally{try{y&&!y.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}try{for(var g=a(t),v=g.next();!v.done;v=g.next())if(In(e,v.value))return!0}catch(t){s={error:t}}finally{try{v&&!v.done&&(l=g.return)&&l.call(g)}finally{if(s)throw s.error}}try{for(var _=a(e),m=_.next();!m.done;m=_.next())if(An(t,p=m.value))return!0}catch(t){u={error:t}}finally{try{m&&!m.done&&(h=_.return)&&h.call(_)}finally{if(u)throw u.error}}return!1}function Ln(t,e,r){var n,i,o,s;try{for(var l=a(e),u=l.next();!u.done;u=l.next()){var h=u.value;try{for(var c=(o=void 0,a(h)),f=c.next();!f.done;f=c.next())if(Mn(t,f.value))return!0}catch(t){o={error:t}}finally{try{f&&!f.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}if(kn(t,h,r))return!0}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return!1}function kn(t,e,r){var n,i,o,s;if(An(t,e))return!0;try{for(var l=a(e),u=l.next();!u.done;u=l.next())if(Cn(u.value,t,r))return!0}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}try{for(var h=a(t),c=h.next();!c.done;c=h.next())if(Cn(c.value,e,r))return!0}catch(t){o={error:t}}finally{try{c&&!c.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}return!1}function In(t,e){var r,n,i=0;try{for(var o=a(t),s=o.next();!s.done;s=o.next())i+=Sn(s.value,e)}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i%2==1}function An(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var n=0;n<e.length-1;n++)if(i=t[r],o=t[r+1],Tn(i,a=e[n],s=e[n+1])!==Tn(o,a,s)&&Tn(i,o,a)!==Tn(i,o,s))return!0;var i,o,a,s;return!1}function Cn(t,e,r){for(var n=r*r,i=1;i<e.length;i++)if(On(e[i-1],e[i],t)<n)return!0;return!1}function On(t,e,r){var n=hn(t,e);if(0===n)return hn(r,t);var i=Xt(vn(dn(r,t),dn(e,t))/n,0,1);return hn(r,pn(t,yn(dn(e,t),i)))}var Rn=2*Math.PI*6378137,Dn=8192,Fn=function(t){function e(e,r,n){var i=t.call(this)||this;return i._length=r,i._bytesPerElement=n,i._arrayBuffer=e,i}return r(e,t),e.prototype.getLength=function(){return this._length},e.prototype.getBytesPerElement=function(){return this._bytesPerElement},e.prototype.toArrayBuffer=function(){return this._arrayBuffer},e.prototype.clear=function(){this._arrayBuffer=null,this._length=0},e.prototype.getSerializeName=function(){return"StructArray"},e}(mt);function Bn(t){return t.offset===t.limit?Nn():t.toArrayBuffer()}function Nn(){return new ArrayBuffer(0)}var zn=function(){function t(t){this._bytesPerElement=t,this._byteBuffer=Et.allocate(Et.DEFAULT_CAPACITY,!0)}return t.prototype.compile=function(){this._byteBuffer.flip();var t=Bn(this._byteBuffer);return new Fn(t,t.byteLength,this._bytesPerElement)},Object.defineProperty(t.prototype,"byteBuffer",{get:function(){return this._byteBuffer},enumerable:!1,configurable:!0}),t}(),Un=function(){function t(t){this._assembler=new zn(t),this._elementSize=0}return t.prototype.pushAll=function(){for(var t,e,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{for(var i=a(r),o=i.next();!o.done;o=i.next()){var s=o.value;this.pushElement(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return this},t.prototype._onPush=function(){this._elementSize++},t.prototype._getAssembler=function(){return this._assembler},t.prototype.build=function(){return this._assembler.compile()},t.prototype.getElementSize=function(){return this._elementSize},t}(),jn=Un,Vn={Int8:{size:1,glType:"BYTE"},Uint8:{size:1,glType:"UNSIGNED_BYTE"},Int16:{size:2,glType:"SHORT"},Uint16:{size:2,glType:"UNSIGNED_SHORT"},Int32:{size:4,glType:"INT"},Uint32:{size:4,glType:"UNSIGNED_INT"},Float32:{size:4,glType:"FLOAT"}};function Gn(t){var e,r,n=0,i=[];try{for(var o=a(t),s=o.next();!s.done;s=o.next()){var l=s.value,u=l.name,h=l.type,c=l.numberOfComponents,f=Vn[h].size;i.push({name:u,type:h,numberOfComponents:c,offset:n}),n+=f*c}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return{fields:i,size:n}}var qn=Gn([{name:"aPosition",numberOfComponents:2,type:"Int16"},{name:"aData",numberOfComponents:4,type:"Uint8"},{name:"aDistance",numberOfComponents:1,type:"Float32"}]),Zn=function(t){function e(){return t.call(this,qn.size)||this}return r(e,t),e.prototype.push=function(t,e,r,n,i,o,a){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeUint8(r).writeUint8(n).writeUint8(i).writeUint8(o).writeFloat32(a),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.x,r=t.y,n=t.extrudeX,i=t.extrudeY,o=t.normal,a=t.direction,s=t.distance;return this.push(e,r,n,i,o,a,s)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),Wn=Zn,Hn=function(t){function e(){return t.call(this,2*Vn.Int16.size)||this}return r(e,t),e.prototype.push=function(t,e,r){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeInt16(r),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.i0,r=t.i1,n=t.i2;return this.push(e,r,n)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),Yn=Hn,Xn=function(){function t(t){this._boundProgram=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundVertexOffset=null,this._boundDynamicVertexBuffers=[],this._vao=null,this._context=t}return t.prototype.bind=function(t,e,r,n,i){var o,s,l,u,h,c,f=this._context.glVaoExtension;if(this._needRebind(t,e,r,n,i)){this.destroy(),this._boundProgram=t,this._boundVertexBuffer=e,this._boundIndexBuffer=r,this._boundVertexOffset=n,this._boundDynamicVertexBuffers=i,this._vao=f.createVertexArrayOES(),f.bindVertexArrayOES(this._vao),e.enableAttributes(t.attribLocations);try{for(var p=a(i),d=p.next();!d.done;d=p.next())d.value.enableAttributes(t.attribLocations)}catch(t){o={error:t}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(o)throw o.error}}e.bind(),e.setVertexAttribPointers(t.attribLocations,n);try{for(var y=a(i),g=y.next();!g.done;g=y.next()){var v=g.value;v.bind(),v.setVertexAttribPointers(t.attribLocations,n)}}catch(t){l={error:t}}finally{try{g&&!g.done&&(u=y.return)&&u.call(y)}finally{if(l)throw l.error}}r.bind()}else{f.bindVertexArrayOES(this._vao);try{for(var _=a(i),m=_.next();!m.done;m=_.next())m.value.bind()}catch(t){h={error:t}}finally{try{m&&!m.done&&(c=_.return)&&c.call(_)}finally{if(h)throw h.error}}r&&r.dynamicDraw&&r.bind()}},t.prototype._needRebind=function(t,e,r,n,i){return!this._vao||t!==this._boundProgram||e!==this._boundVertexBuffer||r!==this._boundIndexBuffer||n!==this._boundVertexOffset||this._hasDifference(i)},t.prototype._hasDifference=function(t){if(this._boundDynamicVertexBuffers===t)return!1;if(this._boundDynamicVertexBuffers.length!==t.length)return!0;for(var e=0;e<t.length;e++)if(this._boundDynamicVertexBuffers[e]!==t[e])return!0;return!1},t.prototype.unbind=function(){this._vao&&this._context.glVaoExtension.bindVertexArrayOES(null)},t.prototype.destroy=function(){this._vao&&(this._context.glVaoExtension.deleteVertexArrayOES(this._vao),this._vao=null,this._boundProgram=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundVertexOffset=null,this._boundDynamicVertexBuffers=[])},t}(),Kn=Xn,Qn=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._vertexOffset=e,o._vertexLength=r,o._primitiveOffset=n,o._primitiveLength=i,o._vaoMap={},o}return r(e,t),e.copyFrom=function(t){return new e(t.vertexOffset,t.vertexLength,t.primitiveOffset,t.primitiveLength)},e.prototype.getVertexArrayObject=function(t,e){var r=this._vaoMap[e];return r||(r=new Kn(t),this._vaoMap[e]=r),r},e.prototype.destroy=function(){var t,e;try{for(var r=a(Object.values(this._vaoMap)),n=r.next();!n.done;n=r.next())n.value.destroy()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},Object.defineProperty(e.prototype,"vertexOffset",{get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertexLength",{get:function(){return this._vertexLength},set:function(t){this._vertexLength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitiveOffset",{get:function(){return this._primitiveOffset},set:function(t){this._primitiveOffset=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitiveLength",{get:function(){return this._primitiveLength},set:function(t){this._primitiveLength=t},enumerable:!1,configurable:!0}),e.prototype.getSerializeName=function(){return"Segment"},e}(mt),Jn=Qn,$n=Math.pow(2,16)-1,ti=function(t){function e(e){void 0===e&&(e=[]);var r=t.call(this)||this;return r._segments=e,r}return r(e,t),e.prototype.clone=function(){},e.prototype.prepareSegment=function(t,e,r){var n=this._segments[this._segments.length-1];if(!n||n.vertexLength+t>$n){var i=new Jn(e,0,r,0);return this._segments.push(i),i}return n},Object.defineProperty(e.prototype,"values",{get:function(){return this._segments},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t,e;try{for(var r=a(this._segments),n=r.next();!n.done;n=r.next())n.value.destroy()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.newSimpleArray=function(t,r,n,i){return new e([new Jn(t,r,n,i)])},e.copyFrom=function(t){return new e(t._segments.map(Jn.copyFrom))},e.prototype.getSerializeName=function(){return"SegmentArray"},e}(mt),ei=ti,ri=function(){function t(t,e,r){this._vertexBuffer=t,this._indexBuffer=e,this._segments=r}return Object.defineProperty(t.prototype,"vertexBuffer",{get:function(){return this._vertexBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"segments",{get:function(){return this._segments},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._segments.destroy()},t}(),ni=function(t){function e(e,r,n,i,o){var a=t.call(this,e,r,n)||this;return a._patternPosition=i,a._patternPixelRatio=o,a}return r(e,t),Object.defineProperty(e.prototype,"patternPosition",{get:function(){return this._patternPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"patternPixelRatio",{get:function(){return this._patternPixelRatio},enumerable:!1,configurable:!0}),e}(ri),ii=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._vertexArray=e,o._attributes=r,o._indexArray=n,o._segments=i,o}return r(e,t),e.prototype.get=function(t){return new ri(t.createVertexBuffer(this._vertexArray,this._attributes),t.createIndexBuffer(this._indexArray),ei.copyFrom(this._segments))},Object.defineProperty(e.prototype,"vertexArray",{get:function(){return this._vertexArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this._attributes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indexArray",{get:function(){return this._indexArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"segments",{get:function(){return this._segments},enumerable:!1,configurable:!0}),e.prototype.getSerializeName=function(){return"VectorRenderableDto"},e.prototype.destroy=function(){this._segments.destroy()},e}(mt),oi=function(t){function e(e,r,n,i,o){var a=t.call(this,e,qn.fields,r,n)||this;return a._patternPosition=i,a._patternPixelRatio=o,a}return r(e,t),e.prototype.get=function(t){return new ni(t.createVertexBuffer(this.vertexArray,this.attributes),t.createIndexBuffer(this.indexArray),ei.copyFrom(this.segments),this._patternPosition,this._patternPixelRatio)},e.prototype.getSerializeName=function(){return"LineRenderableDto"},e}(ii),ai=Math.cos(Ht(40)),si=Math.pow(2,14)/.5,li=function(){function t(){this.i0=-1,this.i1=-1,this.i2=-1,this.reset()}return t.prototype.shift=function(){this.i0=this.i1,this.i1=this.i2},t.prototype.isValid=function(){return this.i0>=0&&this.i1>=0&&this.i2>=0},t.prototype.reset=function(){this.i0=-1,this.i1=-1,this.i2=-1},t}(),ui=function(){function t(t,e,r){void 0===t&&(t=1),this._vertexBuilder=new Wn,this._indexBuilder=new Yn,this._segmentArray=new ei,this._pixelScale=t,this._distance=0,this._patternPosition=e,this._patternPixelRatio=r}return t.prototype.add=function(e){var r=t._pickOut(e);if(!(r.length<2))for(var n,i,o=this._segmentArray.prepareSegment(10*r.length,this._vertexBuilder.getElementSize(),this._indexBuilder.getElementSize()),a=new li,s=this._pixelScale/1*15,l=null,u=null,h=0;h<r.length;h++){var c=r[h],f=(i=h+1)<0||i>r.length-1?null:r[i],p=f?xn(mn(dn(f,c))):u,d=pn(u=u||p,p),y=0===(n=d).x&&0===n.y?d:mn(d),g=vn(y,p),v=0!==g?1/g:1/0,_=l&&f&&g<ai,m="Round";if(l&&_){var b=cn(c,l);if(b>2*s){var x=dn(c,fn(yn(dn(c,l),s/b),(function(t){return Math.round(t)})));this._distance+=cn(l,x),this._addCurrentVertex(x,this._distance,u,!1,0,0,a,o),l=x}}switch(l&&f&&(v<1.05?m="Miter":v<=2&&(m="FakeRound")),l&&(this._distance+=cn(l,c)),m){case"Miter":this._addCurrentVertex(c,this._distance,yn(y,Math.min(v,1.05)),!1,0,0,a,o);break;case"Round":var w=.525;h>0&&(this._addCurrentVertex(c,this._distance,u,!1,0,0,a,o),this._addCurrentVertex(c,this._distance,u,!0,w,w,a,o),a.reset()),f&&(this._addCurrentVertex(c,this._distance,p,!0,-w,-w,a,o),this._addCurrentVertex(c,this._distance,p,!1,0,0,a,o));break;case"FakeRound":var M=wn(u,p),S=(w=-Math.sqrt(v*v-1),M?w:0),P=M?0:w,T=Math.floor(8*(.5-(g-.5)));h>0&&this._addCurrentVertex(c,this._distance,u,!1,S,P,a,o);for(var E=0;E<T;E++){var L=mn(pn(yn(p,(E+1)/(T+1)),u));this._addPieSliceVertex(c,L,M,a,o)}for(this._addPieSliceVertex(c,y,M,a,o),E=T-1;E>=0;E--)L=mn(pn(yn(u,(E+1)/(T+1)),p)),this._addPieSliceVertex(c,L,M,a,o);f&&this._addCurrentVertex(c,this._distance,p,!1,-S,-P,a,o)}if(f&&_){var k=cn(c,f);if(k>2*s){var I=pn(c,fn(yn(dn(f,c),s/k),(function(t){return Math.round(t)})));this._distance+=cn(c,I),this._addCurrentVertex(I,this._distance,p,!1,0,0,a,o),c=I}}l=c,u=p}},t._pickOut=function(t){for(var e=[],r=0;r<t.length;r++)0!==r&&ln(e[e.length-1],t[r])||e.push(t[r]);return e},t.prototype._addCurrentVertex=function(t,e,r,n,i,o,a,s){var l=i?dn(r,yn(xn(r),i)):r;this._pushVertex(t,l,n,!1,i),a.i2=s.vertexLength++,a.isValid()&&(this._indexBuilder.pushElement(a),s.primitiveLength++),a.i0=a.i2;var u=yn(r,-1),h=o?dn(u,yn(xn(r),o)):u;this._pushVertex(t,h,n,!0,-o),a.i2=s.vertexLength++,a.isValid()&&(this._indexBuilder.pushElement(a),s.primitiveLength++),a.i1=a.i2,e>si/2&&(this._distance=0,this._addCurrentVertex(t,this._distance,r,n,i,o,a,s))},t.prototype._addPieSliceVertex=function(t,e,r,n,i){var o=yn(e,r?-1:1);this._pushVertex(t,o,!1,r,0),n.i2=i.vertexLength++,n.isValid()&&(this._indexBuilder.pushElement(n),i.primitiveLength++),r?n.i1=n.i2:n.i0=n.i2},t.prototype._pushVertex=function(t,e,r,n,i){this._vertexBuilder.push(t.x,t.y,Math.round(63*e.x)+128,Math.round(63*e.y)+128,((r?1:0)<<1)+(n?1:0),Math.sign(i)+1,this._distance)},t.prototype.build=function(){return new oi(this._vertexBuilder.build(),this._indexBuilder.build(),this._segmentArray,this._patternPosition,this._patternPixelRatio)},t}(),hi=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.valueOf=function(t,r){return new e(t,r)},e.prototype._createRenderableBuilder=function(t,e){var r,n,i,o,s=t.vectorTile,l=t.features,u=t.stack,h=t.style,c=t.tileAdapter,f=e.featureIndex,p=new ui(c.getTileExtent()/Dn);try{for(var d=a(l),y=d.next();!y.done;y=d.next()){var g=y.value,v=g.feature,_=g.pos,m=s.loadGeometry(v);if(m instanceof Hr){var b=m,x=b.getPartRanges();try{for(var w=(i=void 0,a(x)),M=w.next();!M.done;M=w.next()){var S=M.value,P=b.getVertices().slice(S.start,S.end);p.add(P)}}catch(t){i={error:t}}finally{try{M&&!M.done&&(o=w.return)&&o.call(w)}finally{if(i)throw i.error}}f.add(on(m.getVertices()),u.getId(),_,h.getId())}}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}return p},e.prototype.getQueryPadding=function(){return this._getLineWidth()/2},e.prototype._getLineWidth=function(){var t=this.getStyle().getGeomPaint(),e=gr(t["stroke-width"],0);return gr(t.buffer,0)+2*e},e.prototype.queryIntersectsFeature=function(t,e,r,n,i){var o,s,l=[];try{for(var u=a(n.getPartRanges()),h=u.next();!h.done;h=u.next()){var c=h.value,f=n.getVertices().slice(c.start,c.end);l.push(f)}}catch(t){o={error:t}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(o)throw o.error}}var p=t.tileUnitsPerPixel*this._getLineWidth()/2;return Ln(t.bufferedGeometry,l,p)},e.prototype.getSerializeName=function(){return"BufferedLineStackStyleData"},e}(tr),ci=hi,fi=Gn([{name:"aPosition",numberOfComponents:3,type:"Int16"},{name:"aNormal",numberOfComponents:3,type:"Int16"}]),pi=function(t){function e(){return t.call(this,fi.size)||this}return r(e,t),e.prototype.push=function(t,e,r,n,i,o){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeInt16(r).writeInt16(n).writeInt16(i).writeInt16(o),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.x,r=t.y,n=t.z,i=t.nx,o=t.ny,a=t.nz;return this.push(e,r,n,i,o,a)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),di=pi,yi=function(t){function e(){return t.call(this,2*Vn.Int16.size)||this}return r(e,t),e.prototype.push=function(t,e){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.from,r=t.to;return this.push(e,r)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),gi=yi,vi=function(t){function e(e,r,n,i,o){var a=t.call(this,e,r,n)||this;return a._outlineIndexBuffer=i||null,a._outlineSegments=o||null,a}return r(e,t),Object.defineProperty(e.prototype,"outlineIndexBuffer",{get:function(){return this._outlineIndexBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineSegments",{get:function(){return this._outlineSegments},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var e,r;t.prototype.destroy.call(this),null===(e=this._outlineIndexBuffer)||void 0===e||e.destroy(),null===(r=this._outlineSegments)||void 0===r||r.destroy()},e}(ri),_i=vi,mi=function(t){function e(e,r,n,i,o){var a=t.call(this,e,fi.fields,r,n)||this;return a._outlineIndexArray=i||null,a._outlineSegments=o||null,a}return r(e,t),e.prototype.get=function(t){return new _i(t.createVertexBuffer(this.vertexArray,this.attributes),t.createIndexBuffer(this.indexArray),ei.copyFrom(this.segments),this._outlineIndexArray&&t.createIndexBuffer(this._outlineIndexArray),this._outlineSegments&&ei.copyFrom(this._outlineSegments))},e.prototype.getSerializeName=function(){return"BuildingPartRenderableDto"},e.prototype.destroy=function(){var e;t.prototype.destroy.call(this),null===(e=this._outlineSegments)||void 0===e||e.destroy()},e}(ii),bi=mi,xi=function(){function t(t,e,r){this._wall=t,this._roof=e,this._heightScale=r}return Object.defineProperty(t.prototype,"wall",{get:function(){return this._wall},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roof",{get:function(){return this._roof},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightScale",{get:function(){return this._heightScale},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._wall.destroy(),this._roof.destroy()},t}(),wi=function(t){function e(e,r,n){var i=t.call(this)||this;return i._wallDto=e,i._roofDto=r,i._heightScale=n,i}return r(e,t),e.prototype.get=function(t){return new xi(this._wallDto.get(t),this._roofDto.get(t),this._heightScale)},e.prototype.getSerializeName=function(){return"BuildingRenderableDto"},e.prototype.destroy=function(){this._wallDto.destroy(),this._roofDto.destroy()},e}(mt),Mi={exports:{}};function Si(t,e,r){r=r||2;var n,i,o,a,s,l,u,h=e&&e.length,c=h?e[0]*r:t.length,f=Pi(t,0,c,r,!0),p=[];if(!f||f.next===f.prev)return p;if(h&&(f=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Pi(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(Fi(a));for(s.sort(Ci),i=0;i<s.length;i++)r=Oi(s[i],r);return r}(t,e,f,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var d=r;d<c;d+=r)(s=t[d])<n&&(n=s),(l=t[d+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-i))?32767/u:0}return Ei(f,p,r,n,i,u,0),p}function Pi(t,e,r,n,i){var o,a;if(i===Xi(t,e,r,n)>0)for(o=e;o<r;o+=n)a=Wi(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=Wi(o,t[o],t[o+1],a);return a&&Ui(a,a.next)&&(Hi(a),a=a.next),a}function Ti(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Ui(n,n.next)&&0!==zi(n.prev,n,n.next))n=n.next;else{if(Hi(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Ei(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{0===i.z&&(i.z=Di(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,u=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(a>1)}(i)}(t,n,i,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?ki(t,n,i,o):Li(t))e.push(s.i/r|0),e.push(t.i/r|0),e.push(l.i/r|0),Hi(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?Ei(t=Ii(Ti(t),e,r),e,r,n,i,o,2):2===a&&Ai(t,e,r,n,i,o):Ei(Ti(t),e,r,n,i,o,1);break}}}function Li(t){var e=t.prev,r=t,n=t.next;if(zi(e,r,n)>=0)return!1;for(var i=e.x,o=r.x,a=n.x,s=e.y,l=r.y,u=n.y,h=i<o?i<a?i:a:o<a?o:a,c=s<l?s<u?s:u:l<u?l:u,f=i>o?i>a?i:a:o>a?o:a,p=s>l?s>u?s:u:l>u?l:u,d=n.next;d!==e;){if(d.x>=h&&d.x<=f&&d.y>=c&&d.y<=p&&Bi(i,s,o,l,a,u,d.x,d.y)&&zi(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function ki(t,e,r,n){var i=t.prev,o=t,a=t.next;if(zi(i,o,a)>=0)return!1;for(var s=i.x,l=o.x,u=a.x,h=i.y,c=o.y,f=a.y,p=s<l?s<u?s:u:l<u?l:u,d=h<c?h<f?h:f:c<f?c:f,y=s>l?s>u?s:u:l>u?l:u,g=h>c?h>f?h:f:c>f?c:f,v=Di(p,d,e,r,n),_=Di(y,g,e,r,n),m=t.prevZ,b=t.nextZ;m&&m.z>=v&&b&&b.z<=_;){if(m.x>=p&&m.x<=y&&m.y>=d&&m.y<=g&&m!==i&&m!==a&&Bi(s,h,l,c,u,f,m.x,m.y)&&zi(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,b.x>=p&&b.x<=y&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&Bi(s,h,l,c,u,f,b.x,b.y)&&zi(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;m&&m.z>=v;){if(m.x>=p&&m.x<=y&&m.y>=d&&m.y<=g&&m!==i&&m!==a&&Bi(s,h,l,c,u,f,m.x,m.y)&&zi(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;b&&b.z<=_;){if(b.x>=p&&b.x<=y&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&Bi(s,h,l,c,u,f,b.x,b.y)&&zi(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Ii(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Ui(i,o)&&ji(i,n,n.next,o)&&qi(i,o)&&qi(o,i)&&(e.push(i.i/r|0),e.push(n.i/r|0),e.push(o.i/r|0),Hi(n),Hi(n.next),n=t=o),n=n.next}while(n!==t);return Ti(n)}function Ai(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Ni(a,s)){var l=Zi(a,s);return a=Ti(a,a.next),l=Ti(l,l.next),Ei(a,e,r,n,i,o,0),void Ei(l,e,r,n,i,o,0)}s=s.next}a=a.next}while(a!==t)}function Ci(t,e){return t.x-e.x}function Oi(t,e){var r=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a&&(a=s,r=n.x<n.next.x?n:n.next,s===i))return r}n=n.next}while(n!==e);if(!r)return null;var l,u=r,h=r.x,c=r.y,f=1/0;n=r;do{i>=n.x&&n.x>=h&&i!==n.x&&Bi(o<c?i:a,o,h,c,o<c?a:i,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(i-n.x),qi(n,t)&&(l<f||l===f&&(n.x>r.x||n.x===r.x&&Ri(r,n)))&&(r=n,f=l)),n=n.next}while(n!==u);return r}(t,e);if(!r)return e;var n=Zi(r,t);return Ti(n,n.next),Ti(r,r.next)}function Ri(t,e){return zi(t.prev,t,e.prev)<0&&zi(e.next,t,t.next)<0}function Di(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Fi(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Bi(t,e,r,n,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(n-s)>=(r-a)*(e-s)&&(r-a)*(o-s)>=(i-a)*(n-s)}function Ni(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ji(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(qi(t,e)&&qi(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(zi(t.prev,t,e.prev)||zi(t,e.prev,e))||Ui(t,e)&&zi(t.prev,t,t.next)>0&&zi(e.prev,e,e.next)>0)}function zi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ui(t,e){return t.x===e.x&&t.y===e.y}function ji(t,e,r,n){var i=Gi(zi(t,e,r)),o=Gi(zi(t,e,n)),a=Gi(zi(r,n,t)),s=Gi(zi(r,n,e));return i!==o&&a!==s||!(0!==i||!Vi(t,r,e))||!(0!==o||!Vi(t,n,e))||!(0!==a||!Vi(r,t,n))||!(0!==s||!Vi(r,e,n))}function Vi(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Gi(t){return t>0?1:t<0?-1:0}function qi(t,e){return zi(t.prev,t,t.next)<0?zi(t,e,t.next)>=0&&zi(t,t.prev,e)>=0:zi(t,e,t.prev)<0||zi(t,t.next,e)<0}function Zi(t,e){var r=new Yi(t.i,t.x,t.y),n=new Yi(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Wi(t,e,r,n){var i=new Yi(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Hi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Yi(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xi(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}Mi.exports=Si,Mi.exports.default=Si,Si.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(Xi(t,0,o,r));if(i)for(var s=0,l=e.length;s<l;s++){var u=e[s]*r,h=s<l-1?e[s+1]*r:t.length;a-=Math.abs(Xi(t,u,h,r))}var c=0;for(s=0;s<n.length;s+=3){var f=n[s]*r,p=n[s+1]*r,d=n[s+2]*r;c+=Math.abs((t[f]-t[d])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[d+1]-t[f+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},Si.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r};var Ki=c(Mi.exports),Qi=function(){function t(){}return t.prototype.tessellate=function(t,e){for(var r=l([t],s(e),!1),n=$(r,(function(t){return l([],s(t),!1)})),i=$(n,(function(t){return[t.x,t.y]})),o=[],a=0;a<e.length;a++){var u=a>0?o[a-1]:0;o.push(u+r[a].length)}var h=Ki(i,o),c=[];for(a=0;a<h.length;a+=3)c.push({i0:h[a],i1:h[a+1],i2:h[a+2]});return{vertices:n,triangles:c,correct:!0,keepVertexOrder:!0}},t}(),Ji=Qi,$i={},to=$i;$i.WINDING_ODD=0,$i.WINDING_NONZERO=1,$i.WINDING_POSITIVE=2,$i.WINDING_NEGATIVE=3,$i.WINDING_ABS_GEQ_TWO=4,$i.POLYGONS=0,$i.CONNECTED_POLYGONS=1,$i.BOUNDARY_CONTOURS=2,$i.tesselate=function(t){for(var e=t.debug||!1,r=new yo,n=0;n<t.contours.length;n++)r.addContour(t.vertexSize||2,t.contours[n]);return r.tesselate(t.windingRule||$i.WINDING_ODD,t.elementType||$i.POLYGONS,t.polySize||3,t.vertexSize||2,t.normal||[0,0,1]),{vertices:r.vertices,vertexIndices:r.vertexIndices,vertexCount:r.vertexCount,elements:r.elements,elementCount:r.elementCount,mesh:e?r.mesh:void 0}};var eo=function(t){if(!t)throw"Assertion Failed!"};function ro(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function no(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function io(t){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=t}function oo(){var t=new ro,e=new no,r=new io(0),n=new io(1);t.next=t.prev=t,t.anEdge=null,e.next=e.prev=e,e.anEdge=null,e.trail=null,e.marked=!1,e.inside=!1,r.next=r,r.Sym=n,r.Onext=null,r.Lnext=null,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,n.next=n,n.Sym=r,n.Onext=null,n.Lnext=null,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,this.vHead=t,this.fHead=e,this.eHead=r,this.eHeadSym=n}io.prototype={get Rface(){return this.Sym.Lface},set Rface(t){this.Sym.Lface=t},get Dst(){return this.Sym.Org},set Dst(t){this.Sym.Org=t},get Oprev(){return this.Sym.Lnext},set Oprev(t){this.Sym.Lnext=t},get Lprev(){return this.Onext.Sym},set Lprev(t){this.Onext.Sym=t},get Dprev(){return this.Lnext.Sym},set Dprev(t){this.Lnext.Sym=t},get Rprev(){return this.Sym.Onext},set Rprev(t){this.Sym.Onext=t},get Dnext(){return this.Sym.Onext.Sym},set Dnext(t){this.Sym.Onext.Sym=t},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(t){this.Sym.Lnext.Sym=t}},oo.prototype={makeEdge_:function(t){var e=new io(0),r=new io(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=e,e.next=t,t.Sym.next=r,e.Sym=r,e.Onext=e,e.Lnext=r,e.Org=null,e.Lface=null,e.winding=0,e.activeRegion=null,r.Sym=e,r.Onext=r,r.Lnext=e,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,e},splice_:function(t,e){var r=t.Onext,n=e.Onext;r.Sym.Lnext=e,n.Sym.Lnext=t,t.Onext=n,e.Onext=r},makeVertex_:function(t,e,r){var n=t;eo(null!==n);var i=r.prev;n.prev=i,i.next=n,n.next=r,r.prev=n,n.anEdge=e;var o=e;do{o.Org=n,o=o.Onext}while(o!==e)},makeFace_:function(t,e,r){var n=t;eo(null!==n);var i=r.prev;n.prev=i,i.next=n,n.next=r,r.prev=n,n.anEdge=e,n.trail=null,n.marked=!1,n.inside=r.inside;var o=e;do{o.Lface=n,o=o.Lnext}while(o!==e)},killEdge_:function(t){t.Sym.side<t.side&&(t=t.Sym);var e=t.next,r=t.Sym.next;e.Sym.next=r,r.Sym.next=e},killVertex_:function(t,e){var r=t.anEdge,n=r;do{n.Org=e,n=n.Onext}while(n!==r);var i=t.prev,o=t.next;o.prev=i,i.next=o},killFace_:function(t,e){var r=t.anEdge,n=r;do{n.Lface=e,n=n.Lnext}while(n!==r);var i=t.prev,o=t.next;o.prev=i,i.next=o},makeEdge:function(){var t=new ro,e=new ro,r=new no,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(e,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},splice:function(t,e){var r=!1,n=!1;if(t!==e){if(e.Org!==t.Org&&(n=!0,this.killVertex_(e.Org,t.Org)),e.Lface!==t.Lface&&(r=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(e,t),!n){var i=new ro;this.makeVertex_(i,e,t.Org),t.Org.anEdge=t}if(!r){var o=new no;this.makeFace_(o,e,t.Lface),t.Lface.anEdge=t}}},delete:function(t){var e=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new no;this.makeFace_(n,t,t.Lface)}e.Onext===e?(this.killVertex_(e.Org,null),this.killFace_(e.Lface,null)):(t.Lface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),this.killEdge_(t)},addEdgeVertex:function(t){var e=this.makeEdge_(t),r=e.Sym;this.splice_(e,t.Lnext),e.Org=t.Dst;var n=new ro;return this.makeVertex_(n,r,e.Org),e.Lface=r.Lface=t.Lface,e},splitEdge:function(t,e){var r=this.addEdgeVertex(t).Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r},connect:function(t,e){var r=!1,n=this.makeEdge_(t),i=n.Sym;if(e.Lface!==t.Lface&&(r=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(i,e),n.Org=t.Dst,i.Org=e.Org,n.Lface=i.Lface=t.Lface,t.Lface.anEdge=i,!r){var o=new no;this.makeFace_(o,n,t.Lface)}return n},zapFace:function(t){var e,r,n,i,o,a=t.anEdge;r=a.Lnext;do{r=(e=r).Lnext,e.Lface=null,null===e.Rface&&(e.Onext===e?this.killVertex_(e.Org,null):(e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),(n=e.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(e))}while(e!=a);i=t.prev,(o=t.next).prev=i,i.next=o},countFaceVerts_:function(t){var e=t.anEdge,r=0;do{r++,e=e.Lnext}while(e!==t.anEdge);return r},mergeConvexFaces:function(t){var e,r,n,i,o;for(e=this.fHead.next;e!==this.fHead;e=e.next)if(e.inside)for(o=(r=e.anEdge).Org;n=r.Lnext,(i=r.Sym)&&i.Lface&&i.Lface.inside&&this.countFaceVerts_(e)+this.countFaceVerts_(i.Lface)-2<=t&&ao.vertCCW(r.Lprev.Org,r.Org,i.Lnext.Lnext.Org)&&ao.vertCCW(i.Lprev.Org,i.Org,r.Lnext.Lnext.Org)&&(n=i.Lnext,this.delete(i),r=null,i=null),!r||r.Lnext.Org!==o;)r=n;return!0},check:function(){var t,e,r,n,i,o,a=this.fHead,s=this.vHead,l=this.eHead;for(e=a,e=a;(t=e.next)!==a;e=t){eo(t.prev===e),i=t.anEdge;do{eo(i.Sym!==i),eo(i.Sym.Sym===i),eo(i.Lnext.Onext.Sym===i),eo(i.Onext.Sym.Lnext===i),eo(i.Lface===t),i=i.Lnext}while(i!==t.anEdge)}for(eo(t.prev===e&&null===t.anEdge),n=s,n=s;(r=n.next)!==s;n=r){eo(r.prev===n),i=r.anEdge;do{eo(i.Sym!==i),eo(i.Sym.Sym===i),eo(i.Lnext.Onext.Sym===i),eo(i.Onext.Sym.Lnext===i),eo(i.Org===r),i=i.Onext}while(i!==r.anEdge)}for(eo(r.prev===n&&null===r.anEdge),o=l,o=l;(i=o.next)!==l;o=i)eo(i.Sym.next===o.Sym),eo(i.Sym!==i),eo(i.Sym.Sym===i),eo(null!==i.Org),eo(null!==i.Dst),eo(i.Lnext.Onext.Sym===i),eo(i.Onext.Sym.Lnext===i);eo(i.Sym.next===o.Sym&&i.Sym===this.eHeadSym&&i.Sym.Sym===i&&null===i.Org&&null===i.Dst&&null===i.Lface&&null===i.Rface)}};var ao={};function so(){this.key=null,this.next=null,this.prev=null}function lo(t,e){this.head=new so,this.head.next=this.head,this.head.prev=this.head,this.frame=t,this.leq=e}function uo(){this.handle=null}function ho(){this.key=null,this.node=null}function co(t,e){this.size=0,this.max=t,this.nodes=[],this.nodes.length=t+1;for(var r=0;r<this.nodes.length;r++)this.nodes[r]=new uo;for(this.handles=[],this.handles.length=t+1,r=0;r<this.handles.length;r++)this.handles[r]=new ho;this.initialized=!1,this.freeList=0,this.leq=e,this.nodes[1].handle=1,this.handles[1].key=null}function fo(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}ao.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},ao.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},ao.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},ao.edgeGoesLeft=function(t){return ao.vertLeq(t.Dst,t.Org)},ao.edgeGoesRight=function(t){return ao.vertLeq(t.Org,t.Dst)},ao.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},ao.edgeEval=function(t,e,r){eo(ao.vertLeq(t,e)&&ao.vertLeq(e,r));var n=e.s-t.s,i=r.s-e.s;return n+i>0?n<i?e.t-t.t+(t.t-r.t)*(n/(n+i)):e.t-r.t+(r.t-t.t)*(i/(n+i)):0},ao.edgeSign=function(t,e,r){eo(ao.vertLeq(t,e)&&ao.vertLeq(e,r));var n=e.s-t.s,i=r.s-e.s;return n+i>0?(e.t-r.t)*n+(e.t-t.t)*i:0},ao.transEval=function(t,e,r){eo(ao.transLeq(t,e)&&ao.transLeq(e,r));var n=e.t-t.t,i=r.t-e.t;return n+i>0?n<i?e.s-t.s+(t.s-r.s)*(n/(n+i)):e.s-r.s+(r.s-t.s)*(i/(n+i)):0},ao.transSign=function(t,e,r){eo(ao.transLeq(t,e)&&ao.transLeq(e,r));var n=e.t-t.t,i=r.t-e.t;return n+i>0?(e.s-r.s)*n+(e.s-t.s)*i:0},ao.vertCCW=function(t,e,r){return t.s*(e.t-r.t)+e.s*(r.t-t.t)+r.s*(t.t-e.t)>=0},ao.interpolate=function(t,e,r,n){return(t=t<0?0:t)<=(r=r<0?0:r)?0==r?(e+n)/2:e+t/(t+r)*(n-e):n+r/(t+r)*(e-n)},ao.intersect=function(t,e,r,n,i){var o,a,s;ao.vertLeq(t,e)||(s=t,t=e,e=s),ao.vertLeq(r,n)||(s=r,r=n,n=s),ao.vertLeq(t,r)||(s=t,t=r,r=s,s=e,e=n,n=s),ao.vertLeq(r,e)?ao.vertLeq(e,n)?((o=ao.edgeEval(t,r,e))+(a=ao.edgeEval(r,e,n))<0&&(o=-o,a=-a),i.s=ao.interpolate(o,r.s,a,e.s)):((o=ao.edgeSign(t,r,e))+(a=-ao.edgeSign(t,n,e))<0&&(o=-o,a=-a),i.s=ao.interpolate(o,r.s,a,n.s)):i.s=(r.s+e.s)/2,ao.transLeq(t,e)||(s=t,t=e,e=s),ao.transLeq(r,n)||(s=r,r=n,n=s),ao.transLeq(t,r)||(s=t,t=r,r=s,s=e,e=n,n=s),ao.transLeq(r,e)?ao.transLeq(e,n)?((o=ao.transEval(t,r,e))+(a=ao.transEval(r,e,n))<0&&(o=-o,a=-a),i.t=ao.interpolate(o,r.t,a,e.t)):((o=ao.transSign(t,r,e))+(a=-ao.transSign(t,n,e))<0&&(o=-o,a=-a),i.t=ao.interpolate(o,r.t,a,n.t)):i.t=(r.t+e.t)/2},lo.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(t){return this.insertBefore(this.head,t)},search:function(t){var e=this.head;do{e=e.next}while(null!==e.key&&!this.leq(this.frame,t,e.key));return e},insertBefore:function(t,e){do{t=t.prev}while(null!==t.key&&!this.leq(this.frame,t.key,e));var r=new so;return r.key=e,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},delete:function(t){t.next.prev=t.prev,t.prev.next=t.next}},co.prototype={floatDown_:function(t){var e,r,n,i=this.nodes,o=this.handles;for(e=i[t].handle;;){if((n=t<<1)<this.size&&this.leq(o[i[n+1].handle].key,o[i[n].handle].key)&&++n,eo(n<=this.max),r=i[n].handle,n>this.size||this.leq(o[e].key,o[r].key)){i[t].handle=e,o[e].node=t;break}i[t].handle=r,o[r].node=t,t=n}},floatUp_:function(t){var e,r,n,i=this.nodes,o=this.handles;for(e=i[t].handle;;){if(r=i[n=t>>1].handle,0==n||this.leq(o[r].key,o[e].key)){i[t].handle=e,o[e].node=t;break}i[t].handle=r,o[r].node=t,t=n}},init:function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){},insert:function(t){var e,r;if(2*(e=++this.size)>this.max){var n;this.max*=2,n=this.nodes.length,this.nodes.length=this.max+1;for(var i=n;i<this.nodes.length;i++)this.nodes[i]=new uo;for(n=this.handles.length,this.handles.length=this.max+1,i=n;i<this.handles.length;i++)this.handles[i]=new ho}return 0===this.freeList?r=e:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[e].handle=r,this.handles[r].node=e,this.handles[r].key=t,this.initialized&&this.floatUp_(e),r},extractMin:function(){var t=this.nodes,e=this.handles,r=t[1].handle,n=e[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,e[t[1].handle].node=1,e[r].key=null,e[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},delete:function(t){var e,r=this.nodes,n=this.handles;eo(t>=1&&t<=this.max&&null!==n[t].key),r[e=n[t].node].handle=r[this.size].handle,n[r[e].handle].node=e,--this.size,e<=this.size&&(e<=1||this.leq(n[r[e>>1].handle].key,n[r[e].handle].key)?this.floatDown_(e):this.floatUp_(e)),n[t].key=null,n[t].node=this.freeList,this.freeList=t}};var po={};function yo(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=$i.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}po.regionBelow=function(t){return t.nodeUp.prev.key},po.regionAbove=function(t){return t.nodeUp.next.key},po.debugEvent=function(t){},po.addWinding=function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},po.edgeLeq=function(t,e,r){var n=t.event,i=e.eUp,o=r.eUp;return i.Dst===n?o.Dst===n?ao.vertLeq(i.Org,o.Org)?ao.edgeSign(o.Dst,i.Org,o.Org)<=0:ao.edgeSign(i.Dst,o.Org,i.Org)>=0:ao.edgeSign(o.Dst,n,o.Org)<=0:o.Dst===n?ao.edgeSign(i.Dst,n,i.Org)>=0:ao.edgeEval(i.Dst,n,i.Org)>=ao.edgeEval(o.Dst,n,o.Org)},po.deleteRegion=function(t,e){e.fixUpperEdge&&eo(0===e.eUp.winding),e.eUp.activeRegion=null,t.dict.delete(e.nodeUp)},po.fixUpperEdge=function(t,e,r){eo(e.fixUpperEdge),t.mesh.delete(e.eUp),e.fixUpperEdge=!1,e.eUp=r,r.activeRegion=e},po.topLeftRegion=function(t,e){var r,n=e.eUp.Org;do{e=po.regionAbove(e)}while(e.eUp.Org===n);if(e.fixUpperEdge){if(null===(r=t.mesh.connect(po.regionBelow(e).eUp.Sym,e.eUp.Lnext)))return null;po.fixUpperEdge(t,e,r),e=po.regionAbove(e)}return e},po.topRightRegion=function(t){var e=t.eUp.Dst;t=null;do{t=po.regionAbove(t)}while(t.eUp.Dst===e);return t},po.addRegionBelow=function(t,e,r){var n=new fo;return n.eUp=r,n.nodeUp=t.dict.insertBefore(e.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},po.isWindingInside=function(t,e){switch(t.windingRule){case $i.WINDING_ODD:return 0!=(1&e);case $i.WINDING_NONZERO:return 0!=e;case $i.WINDING_POSITIVE:return e>0;case $i.WINDING_NEGATIVE:return e<0;case $i.WINDING_ABS_GEQ_TWO:return e>=2||e<=-2}return eo(!1),!1},po.computeWinding=function(t,e){e.windingNumber=po.regionAbove(e).windingNumber+e.eUp.winding,e.inside=po.isWindingInside(t,e.windingNumber)},po.finishRegion=function(t,e){var r=e.eUp,n=r.Lface;n.inside=e.inside,n.anEdge=r,po.deleteRegion(t,e)},po.finishLeftRegions=function(t,e,r){for(var n,i=null,o=e,a=e.eUp;o!==r;){if(o.fixUpperEdge=!1,(n=(i=po.regionBelow(o)).eUp).Org!=a.Org){if(!i.fixUpperEdge){po.finishRegion(t,o);break}n=t.mesh.connect(a.Lprev,n.Sym),po.fixUpperEdge(t,i,n)}a.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(a,n)),po.finishRegion(t,o),a=i.eUp,o=i}return a},po.addRightEdges=function(t,e,r,n,i,o){var a,s,l,u,h=!0;l=r;do{eo(ao.vertLeq(l.Org,l.Dst)),po.addRegionBelow(t,e,l.Sym),l=l.Onext}while(l!==n);for(null===i&&(i=po.regionBelow(e).eUp.Rprev),s=e,u=i;(l=(a=po.regionBelow(s)).eUp.Sym).Org===u.Org;)l.Onext!==u&&(t.mesh.splice(l.Oprev,l),t.mesh.splice(u.Oprev,l)),a.windingNumber=s.windingNumber-l.winding,a.inside=po.isWindingInside(t,a.windingNumber),s.dirty=!0,!h&&po.checkForRightSplice(t,s)&&(po.addWinding(l,u),po.deleteRegion(t,s),t.mesh.delete(u)),h=!1,s=a,u=l;s.dirty=!0,eo(s.windingNumber-l.winding===a.windingNumber),o&&po.walkDirtyRegions(t,s)},po.spliceMergeVertices=function(t,e,r){t.mesh.splice(e,r)},po.vertexWeights=function(t,e,r){var n=ao.vertL1dist(e,t),i=ao.vertL1dist(r,t),o=.5*i/(n+i),a=.5*n/(n+i);t.coords[0]+=o*e.coords[0]+a*r.coords[0],t.coords[1]+=o*e.coords[1]+a*r.coords[1],t.coords[2]+=o*e.coords[2]+a*r.coords[2]},po.getIntersectData=function(t,e,r,n,i,o){e.coords[0]=e.coords[1]=e.coords[2]=0,e.idx=-1,po.vertexWeights(e,r,n),po.vertexWeights(e,i,o)},po.checkForRightSplice=function(t,e){var r=po.regionBelow(e),n=e.eUp,i=r.eUp;if(ao.vertLeq(n.Org,i.Org)){if(ao.edgeSign(i.Dst,n.Org,i.Org)>0)return!1;ao.vertEq(n.Org,i.Org)?n.Org!==i.Org&&(t.pq.delete(n.Org.pqHandle),po.spliceMergeVertices(t,i.Oprev,n)):(t.mesh.splitEdge(i.Sym),t.mesh.splice(n,i.Oprev),e.dirty=r.dirty=!0)}else{if(ao.edgeSign(n.Dst,i.Org,n.Org)<0)return!1;po.regionAbove(e).dirty=e.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(i.Oprev,n)}return!0},po.checkForLeftSplice=function(t,e){var r,n=po.regionBelow(e),i=e.eUp,o=n.eUp;if(eo(!ao.vertEq(i.Dst,o.Dst)),ao.vertLeq(i.Dst,o.Dst)){if(ao.edgeSign(i.Dst,o.Dst,i.Org)<0)return!1;po.regionAbove(e).dirty=e.dirty=!0,r=t.mesh.splitEdge(i),t.mesh.splice(o.Sym,r),r.Lface.inside=e.inside}else{if(ao.edgeSign(o.Dst,i.Dst,o.Org)>0)return!1;e.dirty=n.dirty=!0,r=t.mesh.splitEdge(o),t.mesh.splice(i.Lnext,o.Sym),r.Rface.inside=e.inside}return!0},po.checkForIntersect=function(t,e){var r,n,i=po.regionBelow(e),o=e.eUp,a=i.eUp,s=o.Org,l=a.Org,u=o.Dst,h=a.Dst,c=new ro;if(eo(!ao.vertEq(h,u)),eo(ao.edgeSign(u,t.event,s)<=0),eo(ao.edgeSign(h,t.event,l)>=0),eo(s!==t.event&&l!==t.event),eo(!e.fixUpperEdge&&!i.fixUpperEdge),s===l)return!1;if(Math.min(s.t,u.t)>Math.max(l.t,h.t))return!1;if(ao.vertLeq(s,l)){if(ao.edgeSign(h,s,l)>0)return!1}else if(ao.edgeSign(u,l,s)<0)return!1;return po.debugEvent(t),ao.intersect(u,s,h,l,c),eo(Math.min(s.t,u.t)<=c.t),eo(c.t<=Math.max(l.t,h.t)),eo(Math.min(h.s,u.s)<=c.s),eo(c.s<=Math.max(l.s,s.s)),ao.vertLeq(c,t.event)&&(c.s=t.event.s,c.t=t.event.t),r=ao.vertLeq(s,l)?s:l,ao.vertLeq(r,c)&&(c.s=r.s,c.t=r.t),ao.vertEq(c,s)||ao.vertEq(c,l)?(po.checkForRightSplice(t,e),!1):!ao.vertEq(u,t.event)&&ao.edgeSign(u,t.event,c)>=0||!ao.vertEq(h,t.event)&&ao.edgeSign(h,t.event,c)<=0?h===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(a.Sym,o),e=po.topLeftRegion(t,e),o=po.regionBelow(e).eUp,po.finishLeftRegions(t,po.regionBelow(e),i),po.addRightEdges(t,e,o.Oprev,o,o,!0),TRUE):u===t.event?(t.mesh.splitEdge(a.Sym),t.mesh.splice(o.Lnext,a.Oprev),i=e,e=po.topRightRegion(e),n=po.regionBelow(e).eUp.Rprev,i.eUp=a.Oprev,a=po.finishLeftRegions(t,i,null),po.addRightEdges(t,e,a.Onext,o.Rprev,n,!0),!0):(ao.edgeSign(u,t.event,c)>=0&&(po.regionAbove(e).dirty=e.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),ao.edgeSign(h,t.event,c)<=0&&(e.dirty=i.dirty=!0,t.mesh.splitEdge(a.Sym),a.Org.s=t.event.s,a.Org.t=t.event.t),!1):(t.mesh.splitEdge(o.Sym),t.mesh.splitEdge(a.Sym),t.mesh.splice(a.Oprev,o),o.Org.s=c.s,o.Org.t=c.t,o.Org.pqHandle=t.pq.insert(o.Org),po.getIntersectData(t,o.Org,s,u,l,h),po.regionAbove(e).dirty=e.dirty=i.dirty=!0,!1)},po.walkDirtyRegions=function(t,e){for(var r,n,i=po.regionBelow(e);;){for(;i.dirty;)e=i,i=po.regionBelow(i);if(!e.dirty&&(i=e,null==(e=po.regionAbove(e))||!e.dirty))return;if(e.dirty=!1,r=e.eUp,n=i.eUp,r.Dst!==n.Dst&&po.checkForLeftSplice(t,e)&&(i.fixUpperEdge?(po.deleteRegion(t,i),t.mesh.delete(n),n=(i=po.regionBelow(e)).eUp):e.fixUpperEdge&&(po.deleteRegion(t,e),t.mesh.delete(r),r=(e=po.regionAbove(i)).eUp)),r.Org!==n.Org)if(r.Dst===n.Dst||e.fixUpperEdge||i.fixUpperEdge||r.Dst!==t.event&&n.Dst!==t.event)po.checkForRightSplice(t,e);else if(po.checkForIntersect(t,e))return;r.Org===n.Org&&r.Dst===n.Dst&&(po.addWinding(n,r),po.deleteRegion(t,e),t.mesh.delete(r),e=po.regionAbove(i))}},po.connectRightVertex=function(t,e,r){var n,i=r.Onext,o=po.regionBelow(e),a=e.eUp,s=o.eUp,l=!1;a.Dst!==s.Dst&&po.checkForIntersect(t,e),ao.vertEq(a.Org,t.event)&&(t.mesh.splice(i.Oprev,a),e=po.topLeftRegion(t,e),i=po.regionBelow(e).eUp,po.finishLeftRegions(t,po.regionBelow(e),o),l=!0),ao.vertEq(s.Org,t.event)&&(t.mesh.splice(r,s.Oprev),r=po.finishLeftRegions(t,o,null),l=!0),l?po.addRightEdges(t,e,r.Onext,i,i,!0):(n=ao.vertLeq(s.Org,a.Org)?s.Oprev:a,n=t.mesh.connect(r.Lprev,n),po.addRightEdges(t,e,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,po.walkDirtyRegions(t,e))},po.connectLeftDegenerate=function(t,e,r){var n,i,o,a,s;return n=e.eUp,ao.vertEq(n.Org,r)?(eo(!1),void po.spliceMergeVertices(t,n,r.anEdge)):ao.vertEq(n.Dst,r)?(eo(!1),e=po.topRightRegion(e),i=a=(o=(s=po.regionBelow(e)).eUp.Sym).Onext,s.fixUpperEdge&&(eo(i!==o),po.deleteRegion(t,s),t.mesh.delete(o),o=i.Oprev),t.mesh.splice(r.anEdge,o),ao.edgeGoesLeft(i)||(i=null),void po.addRightEdges(t,e,o.Onext,a,i,!0)):(t.mesh.splitEdge(n.Sym),e.fixUpperEdge&&(t.mesh.delete(n.Onext),e.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),void po.sweepEvent(t,r))},po.connectLeftVertex=function(t,e){var r,n,i,o,a,s,l=new fo;l.eUp=e.anEdge.Sym,r=t.dict.search(l).key,(n=po.regionBelow(r))&&(o=r.eUp,a=n.eUp,0!==ao.edgeSign(o.Dst,e,o.Org)?(i=ao.vertLeq(a.Dst,o.Dst)?r:n,r.inside||i.fixUpperEdge?(s=i===r?t.mesh.connect(e.anEdge.Sym,o.Lnext):t.mesh.connect(a.Dnext,e.anEdge).Sym,i.fixUpperEdge?po.fixUpperEdge(t,i,s):po.computeWinding(t,po.addRegionBelow(t,r,s)),po.sweepEvent(t,e)):po.addRightEdges(t,r,e.anEdge,e.anEdge,null,!0)):po.connectLeftDegenerate(t,r,e))},po.sweepEvent=function(t,e){t.event=e,po.debugEvent(t);for(var r=e.anEdge;null===r.activeRegion;)if((r=r.Onext)==e.anEdge)return void po.connectLeftVertex(t,e);var n=po.topLeftRegion(t,r.activeRegion);eo(null!==n);var i=po.regionBelow(n),o=i.eUp,a=po.finishLeftRegions(t,i,null);a.Onext===o?po.connectRightVertex(t,n,a):po.addRightEdges(t,n,a.Onext,o,o,!0)},po.addSentinel=function(t,e,r,n){var i=new fo,o=t.mesh.makeEdge();o.Org.s=r,o.Org.t=n,o.Dst.s=e,o.Dst.t=n,t.event=o.Dst,i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},po.initEdgeDict=function(t){t.dict=new lo(t,po.edgeLeq);var e=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-e,i=t.bmax[0]+e,o=t.bmin[1]-r,a=t.bmax[1]+r;po.addSentinel(t,n,i,o),po.addSentinel(t,n,i,a)},po.doneEdgeDict=function(t){for(var e,r=0;null!==(e=t.dict.min().key);)e.sentinel||(eo(e.fixUpperEdge),eo(1==++r)),eo(0==e.windingNumber),po.deleteRegion(t,e)},po.removeDegenerateEdges=function(t){var e,r,n,i=t.mesh.eHead;for(e=i.next;e!==i;e=r)r=e.next,n=e.Lnext,ao.vertEq(e.Org,e.Dst)&&e.Lnext.Lnext!==e&&(po.spliceMergeVertices(t,n,e),t.mesh.delete(e),n=(e=n).Lnext),n.Lnext===e&&(n!==e&&(n!==r&&n!==r.Sym||(r=r.next),t.mesh.delete(n)),e!==r&&e!==r.Sym||(r=r.next),t.mesh.delete(e))},po.initPriorityQ=function(t){var e,r,n,i=0;for(r=(n=t.mesh.vHead).next;r!==n;r=r.next)i++;for(i+=8,e=t.pq=new co(i,ao.vertLeq),r=(n=t.mesh.vHead).next;r!==n;r=r.next)r.pqHandle=e.insert(r);return r===n&&(e.init(),!0)},po.donePriorityQ=function(t){t.pq=null},po.removeDegenerateFaces=function(t,e){var r,n,i;for(r=e.fHead.next;r!==e.fHead;r=n)n=r.next,i=r.anEdge,eo(i.Lnext!==i),i.Lnext.Lnext===i&&(po.addWinding(i.Onext,i),t.mesh.delete(i));return!0},po.computeInterior=function(t){var e,r;if(po.removeDegenerateEdges(t),!po.initPriorityQ(t))return!1;for(po.initEdgeDict(t);null!==(e=t.pq.extractMin());){for(;null!==(r=t.pq.min())&&ao.vertEq(r,e);)r=t.pq.extractMin(),po.spliceMergeVertices(t,e.anEdge,r.anEdge);po.sweepEvent(t,e)}return t.event=t.dict.min().key.eUp.Org,po.debugEvent(t),po.doneEdgeDict(t),po.donePriorityQ(t),!!po.removeDegenerateFaces(t,t.mesh)&&(t.mesh.check(),!0)},yo.prototype={dot_:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},normalize_:function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];eo(e>0),e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},longAxis_:function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},computeNormal_:function(t){var e,r,n,i,o,a,s,l=[0,0,0],u=[0,0,0],h=[0,0,0],c=[0,0,0],f=[0,0,0],p=[null,null,null],d=[null,null,null],y=this.mesh.vHead;for(e=y.next,s=0;s<3;++s)i=e.coords[s],u[s]=i,d[s]=e,l[s]=i,p[s]=e;for(e=y.next;e!==y;e=e.next)for(s=0;s<3;++s)(i=e.coords[s])<u[s]&&(u[s]=i,d[s]=e),i>l[s]&&(l[s]=i,p[s]=e);if(s=0,l[1]-u[1]>l[0]-u[0]&&(s=1),l[2]-u[2]>l[s]-u[s]&&(s=2),u[s]>=l[s])return t[0]=0,t[1]=0,void(t[2]=1);for(a=0,r=d[s],n=p[s],h[0]=r.coords[0]-n.coords[0],h[1]=r.coords[1]-n.coords[1],h[2]=r.coords[2]-n.coords[2],e=y.next;e!==y;e=e.next)c[0]=e.coords[0]-n.coords[0],c[1]=e.coords[1]-n.coords[1],c[2]=e.coords[2]-n.coords[2],f[0]=h[1]*c[2]-h[2]*c[1],f[1]=h[2]*c[0]-h[0]*c[2],f[2]=h[0]*c[1]-h[1]*c[0],(o=f[0]*f[0]+f[1]*f[1]+f[2]*f[2])>a&&(a=o,t[0]=f[0],t[1]=f[1],t[2]=f[2]);a<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(h)]=1)},checkOrientation_:function(){var t,e,r,n,i=this.mesh.fHead,o=this.mesh.vHead;for(t=0,e=i.next;e!==i;e=e.next)if(!((n=e.anEdge).winding<=0))do{t+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext}while(n!==e.anEdge);if(t<0){for(r=o.next;r!==o;r=r.next)r.t=-r.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var t,e,r,n,i,o=this.mesh.vHead,a=[0,0,0],s=!1;for(a[0]=this.normal[0],a[1]=this.normal[1],a[2]=this.normal[2],0===a[0]&&0===a[1]&&0===a[2]&&(this.computeNormal_(a),s=!0),e=this.sUnit,r=this.tUnit,e[n=this.longAxis_(a)]=0,e[(n+1)%3]=1,e[(n+2)%3]=0,r[n]=0,r[(n+1)%3]=0,r[(n+2)%3]=a[n]>0?1:-1,t=o.next;t!==o;t=t.next)t.s=this.dot_(t.coords,e),t.t=this.dot_(t.coords,r);for(s&&this.checkOrientation_(),i=!0,t=o.next;t!==o;t=t.next)i?(this.bmin[0]=this.bmax[0]=t.s,this.bmin[1]=this.bmax[1]=t.t,i=!1):(t.s<this.bmin[0]&&(this.bmin[0]=t.s),t.s>this.bmax[0]&&(this.bmax[0]=t.s),t.t<this.bmin[1]&&(this.bmin[1]=t.t),t.t>this.bmax[1]&&(this.bmax[1]=t.t))},addWinding_:function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},tessellateMonoRegion_:function(t,e){var r,n;for(r=e.anEdge,eo(r.Lnext!==r&&r.Lnext.Lnext!==r);ao.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;ao.vertLeq(r.Org,r.Dst);r=r.Lnext);for(n=r.Lprev;r.Lnext!==n;)if(ao.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(ao.edgeGoesLeft(n.Lnext)||ao.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)n=t.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!=r&&(ao.edgeGoesRight(r.Lprev)||ao.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)r=t.connect(r,r.Lprev).Sym;r=r.Lnext}for(eo(n.Lnext!==r);n.Lnext.Lnext!==r;)n=t.connect(n.Lnext,n).Sym;return!0},tessellateInterior_:function(t){var e,r;for(e=t.fHead.next;e!==t.fHead;e=r)if(r=e.next,e.inside&&!this.tessellateMonoRegion_(t,e))return!1;return!0},discardExterior_:function(t){var e,r;for(e=t.fHead.next;e!==t.fHead;e=r)r=e.next,e.inside||t.zapFace(e)},setWindingNumber_:function(t,e,r){var n,i;for(n=t.eHead.next;n!==t.eHead;n=i)i=n.next,n.Rface.inside!==n.Lface.inside?n.winding=n.Lface.inside?e:-e:r?t.delete(n):n.winding=0},getNeighbourFace_:function(t){return t.Rface&&t.Rface.inside?t.Rface.n:-1},outputPolymesh_:function(t,e,r,n){var i,o,a,s,l,u=0,h=0;for(r>3&&t.mergeConvexFaces(r),i=t.vHead.next;i!==t.vHead;i=i.next)i.n=-1;for(o=t.fHead.next;o!=t.fHead;o=o.next)if(o.n=-1,o.inside){a=o.anEdge,s=0;do{-1===(i=a.Org).n&&(i.n=h,h++),s++,a=a.Lnext}while(a!==o.anEdge);eo(s<=r),o.n=u,++u}for(this.elementCount=u,e==$i.CONNECTED_POLYGONS&&(u*=2),this.elements=[],this.elements.length=u*r,this.vertexCount=h,this.vertices=[],this.vertices.length=h*n,this.vertexIndices=[],this.vertexIndices.length=h,i=t.vHead.next;i!==t.vHead;i=i.next)if(-1!=i.n){var c=i.n*n;this.vertices[c+0]=i.coords[0],this.vertices[c+1]=i.coords[1],n>2&&(this.vertices[c+2]=i.coords[2]),this.vertexIndices[i.n]=i.idx}var f=0;for(o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=o.anEdge,s=0;do{i=a.Org,this.elements[f++]=i.n,s++,a=a.Lnext}while(a!==o.anEdge);for(l=s;l<r;++l)this.elements[f++]=-1;if(e==$i.CONNECTED_POLYGONS){a=o.anEdge;do{this.elements[f++]=this.getNeighbourFace_(a),a=a.Lnext}while(a!==o.anEdge);for(l=s;l<r;++l)this.elements[f++]=-1}}},outputContours_:function(t,e){var r,n,i,o=0,a=0;for(this.vertexCount=0,this.elementCount=0,r=t.fHead.next;r!==t.fHead;r=r.next)if(r.inside){i=n=r.anEdge;do{this.vertexCount++,n=n.Lnext}while(n!==i);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*e,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var s=0,l=0,u=0;for(o=0,r=t.fHead.next;r!==t.fHead;r=r.next)if(r.inside){a=0,i=n=r.anEdge;do{this.vertices[s++]=n.Org.coords[0],this.vertices[s++]=n.Org.coords[1],e>2&&(this.vertices[s++]=n.Org.coords[2]),this.vertexIndices[l++]=n.Org.idx,a++,n=n.Lnext}while(n!==i);this.elements[u++]=o,this.elements[u++]=a,o+=a}},addContour:function(t,e){var r,n;for(null===this.mesh&&(this.mesh=new oo),t<2&&(t=2),t>3&&(t=3),r=null,n=0;n<e.length;n+=t)null==r?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=e[n+0],r.Org.coords[1]=e[n+1],r.Org.coords[2]=t>2?e[n+2]:0,r.Org.idx=this.vertexIndexCounter++,r.winding=1,r.Sym.winding=-1},tesselate:function(t,e,r,n,i){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,i&&(this.normal[0]=i[0],this.normal[1]=i[1],this.normal[2]=i[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),po.computeInterior(this);var o=this.mesh;return e==$i.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),o.check(),e==$i.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,e,r,n),!0}};var go=c(to),vo=function(){function t(){}return t.prototype.tessellate=function(t,e){var r=l([t],s(e),!1),n=r.map((function(t){return $(t,(function(t){return[t.x,t.y]}))}));try{for(var i=go.tesselate({contours:n,windingRule:go.WINDING_ODD,elementType:go.POLYGONS,polySize:3,vertexSize:2}),o=i.elements,a=i.vertexIndices,u=i.vertices,h=$(r,(function(t){return l([],s(t),!1)})),c=[],f=0;f<a.length;f++)if(!(a[f]>=0)){var p=Math.round(u[2*f]),d=Math.round(u[2*f+1]);h.push({x:p,y:d}),a[f]=h.length-1}for(f=0;f<o.length;f+=3)c.push({i0:a[o[f]],i1:a[o[f+1]],i2:a[o[f+2]]});return{vertices:h,triangles:c,correct:!0,keepVertexOrder:!0}}catch(t){return{vertices:[],triangles:[],correct:!1,keepVertexOrder:!1}}},t}(),_o=new Ji,mo=new vo;function bo(t,e,r){return void 0===r&&(r="Medium"),function(t){switch(t){case"Medium":return _o;case"SlowAndTolerant":return mo}}(r).tessellate(t,e)}var xo=[2.5,2.5,1.7,1.6,1.5,1.4],wo=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.valueOf=function(t,r){return new e(t,r)},e.prototype._createRenderableBuilder=function(t,e){var r,n,i,o,s,l,u,h,c,f,p,d,y,g,v,_=t.vectorTile,m=t.features,b=t.stack,x=t.style,w=t.tessellationPreset,M=e.featureIndex,S=gr(x.getGeomPaint()["stroke-width"],0)>0,P=new di,T=new Yn,E=new ei,L=new di,k=new Yn,I=new ei,A=[],C=function(t){return Math.floor(16384*t)},O=function(t,e,r,n,i,o,a){t.push(e,r,n,C(i),C(o),C(a))};try{for(var R=a(m),D=R.next();!D.done;D=R.next()){var F=D.value,B=F.feature,N=F.pos,z=_.loadGeometry(B),U=B.properties;if(z instanceof Yr){var j=z,V=(c=So(U),void 0,void 0,p=(f=Math.trunc(c/5))<xo.length?xo[f]:xo[xo.length-1],Math.trunc(c*p*10)),G=function(t){for(var e,r,n,i,o,s,l=[],u=0;u<t.length;u++){var h=t[u],c=j.getVertices().slice(h.start,h.end);l.push(c)}var f=bo(l[0],l.slice(1),w),p=f.vertices,d=f.triangles,y=f.correct,g=f.keepVertexOrder;if(!y)return"continue";var v=I.prepareSegment(p.length,L.getElementSize(),k.getElementSize());try{for(var _=(e=void 0,a(p)),m=_.next();!m.done;m=_.next()){var b=m.value,x=b.x,M=b.y;O(L,x,M,V,0,0,1)}}catch(t){e={error:t}}finally{try{m&&!m.done&&(r=_.return)&&r.call(_)}finally{if(e)throw e.error}}var S=function(t){return t+v.vertexLength};try{for(var C=(n=void 0,a(d)),R=C.next();!R.done;R=C.next()){var D=R.value,F=D.i0,B=D.i1,N=D.i2;k.push(S(F),S(B),S(N))}}catch(t){n={error:t}}finally{try{R&&!R.done&&(i=C.return)&&i.call(C)}finally{if(n)throw n.error}}v.vertexLength+=p.length,v.primitiveLength+=d.length;try{for(var z=(o=void 0,a(l)),U=z.next();!U.done;U=z.next()){c=U.value;var G=function(t){var e=c[t-1],r=c[t],n=E.prepareSegment(4,P.getElementSize(),T.getElementSize()),i=mn(xn(dn(e,r)));O(P,e.x,e.y,0,i.x,i.y,0),O(P,e.x,e.y,V,i.x,i.y,0),O(P,r.x,r.y,0,i.x,i.y,0),O(P,r.x,r.y,V,i.x,i.y,0);var o=function(t){return t+n.vertexLength};T.push(o(0),o(2),o(1)),T.push(o(1),o(2),o(3)),n.vertexLength+=4,n.primitiveLength+=2};for(u=1;u<c.length;u++)G(u);A.push(g?c.length:0)}}catch(t){o={error:t}}finally{try{U&&!U.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}};try{for(var q=(i=void 0,a(j.getMultiPartRanges())),Z=q.next();!Z.done;Z=q.next())G(Z.value)}catch(t){i={error:t}}finally{try{Z&&!Z.done&&(o=q.return)&&o.call(q)}finally{if(i)throw i.error}}M.add(on(z.getVertices()),b.getId(),N,x.getId())}}}catch(t){r={error:t}}finally{try{D&&!D.done&&(n=R.return)&&n.call(R)}finally{if(r)throw r.error}}if(S){d=new gi,y=new ei;var W=0;try{for(var H=a(A),Y=H.next();!Y.done;Y=H.next())for(var X=Y.value,K=function(t){var e=y.prepareSegment(4,W,d.getElementSize());W+=4;var r=function(t){return t+e.vertexLength};d.push(r(0),r(1)),e.vertexLength+=4,e.primitiveLength+=1},Q=1;Q<X;Q++)K()}catch(t){s={error:t}}finally{try{Y&&!Y.done&&(l=H.return)&&l.call(H)}finally{if(s)throw s.error}}g=new gi,v=new ei,W=0;var J=function(t){var e=v.prepareSegment(t,W,g.getElementSize());W+=t;for(var r=function(t){return t+e.vertexLength},n=0;n<t-1;n++)g.push(r(n),r(n+1));g.push(r(t-1),r(0)),e.vertexLength+=t,e.primitiveLength+=t};try{for(var $=a(A),tt=$.next();!tt.done;tt=$.next())J(tt.value)}catch(t){u={error:t}}finally{try{tt&&!tt.done&&(h=$.return)&&h.call($)}finally{if(u)throw u.error}}}return{build:function(){var t=new bi(P.build(),T.build(),E,d&&d.build(),y),e=new bi(L.build(),k.build(),I,g&&g.build(),v);return new wi(t,e,.1)}}},e.prototype.getQueryPadding=function(){return 0},e.prototype.queryIntersectsFeature=function(t,e,r,n,i){var o,s,l,u,h=[];try{for(var c=a(n.getMultiPartRanges()),f=c.next();!f.done;f=c.next()){var p=f.value;try{for(var d=(l=void 0,a(p)),y=d.next();!y.done;y=d.next()){var g=y.value,v=n.getVertices().slice(g.start,g.end);h.push(v)}}catch(t){l={error:t}}finally{try{y&&!y.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}}}catch(t){o={error:t}}finally{try{f&&!f.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}return En(t.bufferedGeometry,h)},e.prototype.getSerializeName=function(){return"BuildingStackStyleData"},e}(tr),Mo=wo;function So(t){var e=t.get("bd_floor"),r=e?parseFloat(e):0;return isNaN(r)?0:r}var Po=Gn([{name:"aPosition",numberOfComponents:2,type:"Int16"},{name:"aData",numberOfComponents:1,type:"Float32"}]),To=function(t){function e(){return t.call(this,Po.size)||this}return r(e,t),e.prototype.push=function(t,e,r){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeFloat32(r),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.x,r=t.y,n=t.data;return this.push(e,r,n)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),Eo=To,Lo=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.valueOf=function(t,r){return new e(t,r)},e.prototype._createRenderableBuilder=function(t,e){var r,n,i=t.vectorTile,o=t.features,l=t.stack,u=t.style,h=e.featureIndex,c=new Eo,f=new Yn,p=new ei,d=l.getProperties().radiusBy,y=l.getProperties().weightBy,g=l.getProperties().weightRange,v=0,_=function(t){var e=t.feature,r=t.pos,n=i.loadGeometry(e);if(!(n instanceof Wr))return"continue";var o=0;if(d)o=e.properties.get(d),v=o>v?o:v,u.setGeomPaint("circle-radius",v);else if(y){var a=s(null!=g?g:[0,1],2),_=a[0],m=a[1]-_;o=(e.properties.get(y)+(0-_))/m}var b=n.getVertex(),x=p.prepareSegment(4,c.getElementSize(),f.getElementSize()),w=function(t){return t+x.vertexLength},M=function(t){return{x:2*b.x+(t.x+1)/2,y:2*b.y+(t.y+1)/2,data:o}};c.pushAll(M({x:-1,y:-1}),M({x:1,y:-1}),M({x:1,y:1}),M({x:-1,y:1})),f.push(w(0),w(1),w(2)),f.push(w(0),w(2),w(3)),x.vertexLength+=4,x.primitiveLength+=2,h.add(on(n.getVertices()),l.getId(),r,u.getId())};try{for(var m=a(o),b=m.next();!b.done;b=m.next())_(b.value)}catch(t){r={error:t}}finally{try{b&&!b.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}return{build:function(){return new ii(c.build(),Po.fields,f.build(),p)}}},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o){var a,s,l,u,h=Math.floor(i.getZoom());return u=i.getTileUnitsPerPixel(h)*(null!==(a=gr(r.properties.get(o.radiusBy)))&&void 0!==a?a:this._getRadius()),!!Mn(s=t.geometry,l=n.getVertex())||Cn(l,s,u)},e.prototype.getQueryPadding=function(){return this._getRadius()},e.prototype._getRadius=function(){var t=this.getStyle().getGeomPaint();return gr(t["circle-radius"],0)+gr(t["stroke-width"],0)},e.prototype.getSerializeName=function(){return"CircleStackStyleData"},e}(tr),ko=Lo,Io=Gn([{name:"aPosition",numberOfComponents:2,type:"Int16"}]),Ao=function(t){function e(){return t.call(this,Io.size)||this}return r(e,t),e.prototype.push=function(t,e){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.x,r=t.y;return this.push(e,r)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),Co=Ao,Oo=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.valueOf=function(t,r){return new e(t,r)},e.prototype._createRenderableBuilder=function(t,e){var r,n,i,o,u=t.vectorTile,h=t.features,c=t.stack,f=t.style,p=e.featureIndex,d=this._getPaintProperties(t),y=d.dashArray,g=d.buffer,v=new Co,_=new Yn,m=new ei,b=y.reduce((function(t,e){return t+e}),0),x=function(t){return fn(t,Math.round)},w={};try{for(var M=a(h),S=M.next();!S.done;S=M.next()){var P=S.value,T=P.feature,E=P.pos,L=u.loadGeometry(T);if(L instanceof Hr){var k=[],I=L,A=I.getPartRanges();try{for(var C=(i=void 0,a(A)),O=C.next();!O.done;O=C.next())for(var R=O.value,D=I.getVertices().slice(R.start,R.end),F=function(t){var e=D[t-1],r=D[t],n=dn(r,e),i=_n(n);if(0===i)return"continue";for(var o=gn(n,i),a=yn(xn(o),g/2),u=m.prepareSegment(Math.trunc(i/b+1)*y.length*4,v.getElementSize(),_.getElementSize()),h=function(t){return t+u.vertexLength},c=function(t,e){var r=yn(o,e),n=dn(t,a),i=pn(t,a),s=pn(n,r),l=pn(i,r);v.pushAll(x(n),x(i),x(s),x(l)),_.push(h(0),h(2),h(1)).push(h(1),h(2),h(3)),u.vertexLength+=4,u.primitiveLength+=2},f=!0,p=0,d=e,w=0;i-p>0;w++){var M=y[w%y.length],S=p+M>i?i-p:M;f&&c(d,S),d=pn(d,yn(o,S)),p+=S,f=!f}var P=[pn(e,a),dn(e,a),dn(r,a),pn(r,a)];k.push(l(l([],s(P),!1),[P[0]],!1))},B=1;B<D.length;B++)F(B)}catch(t){i={error:t}}finally{try{O&&!O.done&&(o=C.return)&&o.call(C)}finally{if(i)throw i.error}}w[E]=k,p.add(on($(k,(function(t){return t}))),c.getId(),E,f.getId())}}}catch(t){r={error:t}}finally{try{S&&!S.done&&(n=M.return)&&n.call(M)}finally{if(r)throw r.error}}return this.setProperty("collisionBoxesMap",w),{build:function(){return new ii(v.build(),Io.fields,_.build(),m)}}},e.prototype._getPaintProperties=function(t){var e=t.vectorTile,r=t.style,n=t.tileAdapter,i=r.getGeomPaint(),o=n.getTileService().getMapDefine(),a=n.getTileExtent()/Dn/_r(),s=n.getTileExtent()/(o.getTileSize()*o.getResolution(e.tileId.z)),l=Boolean(i["geo-dasharray"]),u=vr(l?i["geo-dasharray"]:i["stroke-dasharray"]).map((function(t){return t*(l?s:a/2)})),h=Boolean(i["geo-bufferWidth"]);return{dashArray:u,buffer:gr(h?i["geo-bufferWidth"]:i["stroke-width"],0)*(h?s:2*a)}},e.prototype.getQueryPadding=function(){return 0},e.prototype.queryIntersectsFeature=function(t,e,r,n,i){var o=this.getProperty("collisionBoxesMap");return En(t.bufferedGeometry,o[e])},e.prototype.getSerializeName=function(){return"CrosswalkStackStyleData"},e}(tr),Ro=Oo,Do=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.valueOf=function(t,r){return new e(t,r)},e.prototype._createRenderableBuilder=function(t,e){var r,n,i,o,s,l,u=t.vectorTile,h=t.features,c=t.stack,f=t.style,p=t.tileAdapter,d=e.featureIndex,y=e.patternPositionMap,g=e.patternMap,v=f.getGeomPaint()["stroke-pattern"];v&&g&&y&&y[v]&&(s=y[v].positions,l=g[v].pixelRatio||1/_r());var _=new ui(p.getTileExtent()/Dn,s,l);try{for(var m=a(h),b=m.next();!b.done;b=m.next()){var x=b.value,w=x.feature,M=x.pos,S=u.loadGeometry(w);if(S instanceof Hr){var P=S,T=P.getPartRanges();try{for(var E=(i=void 0,a(T)),L=E.next();!L.done;L=E.next()){var k=L.value,I=P.getVertices().slice(k.start,k.end);_.add(I)}}catch(t){i={error:t}}finally{try{L&&!L.done&&(o=E.return)&&o.call(E)}finally{if(i)throw i.error}}d.add(on(S.getVertices()),c.getId(),M,f.getId())}}}catch(t){r={error:t}}finally{try{b&&!b.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}return _},e.prototype.getQueryPadding=function(){return this._getLineWidth()/2},e.prototype._getLineWidth=function(){var t=gr(this.getStyle().getGeomPaint()["stroke-width"],0);return Math.max(1*t,1)},e.prototype.queryIntersectsFeature=function(t,e,r,n,i){var o,s,l=[];try{for(var u=a(n.getPartRanges()),h=u.next();!h.done;h=u.next()){var c=h.value,f=n.getVertices().slice(c.start,c.end);l.push(f)}}catch(t){o={error:t}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(o)throw o.error}}var p=t.tileUnitsPerPixel*this._getLineWidth()/2;return Ln(t.bufferedGeometry,l,p)},e.prototype.getSerializeName=function(){return"LineStackStyleData"},e}(tr),Fo=Do;function Bo(t,e){return t.priority!==e.priority?t.priority-e.priority:t.uniqueId.localeCompare(e.uniqueId)}var No=function(){function t(t,e,r,n,i){this._image=t,this._top=e,this._bottom=r,this._left=n,this._right=i}return t.translate=function(e,r){var n=e.image,i=e.top,o=e.bottom,a=e.left,s=e.right;return new t(n,i+r.y,o+r.y,a+r.x,s+r.x)},t.valueOf=function(e,r,n,i){if(!e)return null;var o=e.displaySize,a=o.width*i,s=o.height*i,l=-s*r.vertical+n.y,u=l+s,h=-a*r.horizontal+n.x;return new t(e,l,u,h,h+a)},Object.defineProperty(t.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._bottom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._left},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._right},enumerable:!1,configurable:!0}),t.prototype.getBBox=function(){return{minX:this.left,minY:this.top,maxX:this.right,maxY:this.bottom}},t}(),zo=No,Uo=new Set([9,10,13,32]),jo=new Set([10,32,8203]);function Vo(t){return Uo.has(t)}var Go=function(){function t(){}return t.prototype.calculate=function(e,r,n,i){if(n<=0||!e||!r)return[];for(var o=t._getAverageOfLineWidth(e,r,n,i),s=0,l=[],u=function(n){var u,h,c=e.charCodeAt(n),f=r[c];f&&!Vo(c)&&(s+=f.metrics.advance+i);var p=n===e.length-1,d=p||function(t){return jo.has(t)}(c)||!1;if(!d)return"continue";var y=p?0:t._getPenalty(c),g=function(e){var r=t._getBadness(e,o,y);return p?e<o?r/2:2*r:r},v=null,_=g(s);try{for(var m=(u=void 0,a(l)),b=m.next();!b.done;b=m.next()){var x=b.value,w=g(s-x.sumOfWidth)+x.badness;w<=_&&(v=x,_=w)}}catch(t){u={error:t}}finally{try{b&&!b.done&&(h=m.return)&&h.call(m)}finally{if(u)throw u.error}}l.push({index:n+1,sumOfWidth:s,previous:v,badness:_})},h=0;h<e.length;h++)u(h);return t._findBest(l[l.length-1])},t._findBest=function(t){if(!t)return[];var e=this._findBest(t.previous);return e.push(t.index),e},t._getAverageOfLineWidth=function(t,e,r,n){for(var i=0,o=0;o<t.length;o++){var a=e[t.charCodeAt(o)];a&&(i+=a.metrics.advance+n)}return i/Math.max(Math.ceil(i/r),1)},t._getBadness=function(t,e,r){var n=function(t){return Math.pow(t,2)};return n(t-e)+Math.sign(r)*n(r)},t._getPenalty=function(t){return 10===t?-1e4:8203===t?150:0},t}(),qo=new Go,Zo=function(){function t(t,e,r,n,i,o,a,s){this._text=t,this._positionedGlyphs=e,this._lineCount=r,this._top=n,this._bottom=i,this._left=o,this._right=a,this._translate=s}return t.translate=function(e,r){var n=e.text,i=e.positionedGlyphs,o=e.lineCount,a=e.top,s=e.bottom,l=e.left,u=e.right,h=e.translate,c=i.map((function(t){var e=t.fontStack,n=t.glyph,i=t.x,o=t.y;return{fontStack:e,glyph:n,x:i+r.x,y:o+r.y}}));return new t(n,c,o,a+r.y,s+r.y,l+r.x,u+r.x,un(h,r))},t.valueOf=function(e,r,n,i,o,s,l,u,h,c,f,p,d){var y,g,v=r[n],_=h/24;if(!v)return null;var m=Qo(e,qo.calculate(e,v,c,p)),b=d,x=0,w=[];try{for(var M=a(m),S=M.next();!S.done;S=M.next()){var P=S.value,T=Ho(P,r,n,p,b),E=T.positionedGlyphs,L=T.lineWidth;E.length&&(Yo(E,L,o),w=w.concat(E)),x=Math.max(x,L),b+=f}}catch(t){y={error:t}}finally{try{S&&!S.done&&(g=M.return)&&g.call(M)}finally{if(y)throw y.error}}Xo(w,o,i,x,f,m.length);var k=b-d,I=Ko(x,k,i,s,l,u,_),A=(I.y-i.vertical*k)*_,C=A+k*_,O=(I.x-i.horizontal*x)*_,R=O+x*_;return new t(e,w,m.length,A,C,O,R,I)},Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionedGlyphs",{get:function(){return this._positionedGlyphs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._left},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._right},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._bottom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineCount",{get:function(){return this._lineCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translate",{get:function(){return this._translate},enumerable:!1,configurable:!0}),t.prototype.getBBox=function(){return{minX:this._left,maxX:this._right,minY:this._top,maxY:this._bottom}},t}(),Wo=Zo,Ho=function(t,e,r,n,i){for(var o=e[r],a=[],s=0,l=i,u=0;u<t.length;u++){var h=o[t.charCodeAt(u)];h&&(a.push({fontStack:r,glyph:h.id,x:s,y:l}),s+=h.metrics.advance+n)}return{positionedGlyphs:a,lineWidth:s-n}},Yo=function(t,e,r){var n,i;void 0===r&&(r=.5);var o=e*r;try{for(var s=a(t),l=s.next();!l.done;l=s.next())l.value.x-=o}catch(t){n={error:t}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},Xo=function(t,e,r,n,i,o){var s,l,u=(e-r.horizontal)*n,h=(.5-r.vertical*o)*i;try{for(var c=a(t),f=c.next();!f.done;f=c.next()){var p=f.value;p.x+=u,p.y+=h}}catch(t){s={error:t}}finally{try{f&&!f.done&&(l=c.return)&&l.call(c)}finally{if(s)throw s.error}}},Ko=function(t,e,r,n,i,o,a){if(n&&Object.keys(i).length){var s=0,l=0,u=n.left,h=n.right,c=n.top,f=n.bottom;if(void 0!==i.top){var p=e*r.vertical;l=(f+i.top)/a+p}else void 0!==i.bottom&&(p=e*(r.vertical-1),l=(c-i.bottom)/a+p);if(void 0!==i.left){var d=t*r.horizontal;s=(h+i.left)/a+d}else void 0!==i.right&&(d=t*(r.horizontal-1),s=(u-i.right)/a+d);return{x:s,y:l}}return 0===a?o:gn(o,a)},Qo=function(t,e){var r,n,i=[],o=0;try{for(var s=a(e),l=s.next();!l.done;l=s.next()){var u=l.value;i.push(t.substring(o,u)),o=u}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o<t.length&&i.push(t.substring(o,t.length)),i.map(Jo).filter((function(t){return t}))},Jo=function(t){for(var e=0,r=t.length;e<t.length&&Vo(t.charCodeAt(e));)e++;for(;r>e&&Vo(t.charCodeAt(r-1));)r--;return r-e<t.length?t.substring(e,r):t},$o="SKPGo",ta=Gn([{name:"aFadeOpacity",numberOfComponents:1,type:"Uint8"}]),ea=function(t){function e(){return t.call(this,ta.size)||this}return r(e,t),e.prototype.push=function(t){return this._getAssembler().byteBuffer.writeUint8(t),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.value;return this.push(e)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),ra=ea;function na(t,e){void 0===e&&(e=1);var r=t.topLeft,n=t.topRight,i=t.bottomLeft,o=t.bottomRight,a=r.x,s=r.y,l=n.x,u=n.y,h=i.x,c=i.y,f=o.x,p=o.y;return{minX:Math.min.apply(Math,[a,l,h,f])*e,maxX:Math.max.apply(Math,[a,l,h,f])*e,minY:Math.min.apply(Math,[s,u,c,p])*e,maxY:Math.max.apply(Math,[s,u,c,p])*e}}var ia=function(t,e,r,n){var i,o;void 0===r&&(r={x:0,y:0});var s=[];try{for(var l=a(t),u=l.next();!u.done;u=l.next()){var h=u.value,c=e[h.fontStack],f=c&&c[h.glyph];if(f&&f.rect){var p=h.x+r.x,d=h.y+r.y,y=p+f.metrics.left-4,g=d-f.metrics.top-4,v=y+f.rect.width,_=g+f.rect.height,m={x:y,y:g},b={x:v,y:g},x={x:y,y:_},w={x:v,y:_};n&&(m=bn(m,n),b=bn(b,n),x=bn(x,n),w=bn(w,n)),s.push({topLeft:m,topRight:b,bottomLeft:x,bottomRight:w,texture:f.rect})}}}catch(t){i={error:t}}finally{try{u&&!u.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return s},oa=function(t,e){var r=t.left,n=t.right,i=t.top,o=t.bottom,a={x:r-=1,y:i-=1},s={x:n+=1,y:i},l={x:r,y:o+=1},u={x:n,y:o};return e&&(a=bn(a,e),s=bn(s,e),l=bn(l,e),u=bn(u,e)),{topLeft:a,topRight:s,bottomLeft:l,bottomRight:u,texture:t.image.rect}},aa=Gn([{name:"aPosition",numberOfComponents:2,type:"Int16"},{name:"aTexturePosition",numberOfComponents:2,type:"Uint16"},{name:"aPitchWithMap",numberOfComponents:1,type:"Uint16"},{name:"aRotateWithMap",numberOfComponents:1,type:"Uint16"}]),sa=function(t){function e(){return t.call(this,aa.size)||this}return r(e,t),e.prototype.push=function(t,e,r,n,i,o){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeUint16(r).writeUint16(n).writeUint16(i?1:0).writeUint16(o?1:0),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.x,r=t.y,n=t.textureX,i=t.textureY,o=t.pitchWithMap,a=t.rotateWithMap;return this.push(e,r,n,i,o,a)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),la=sa,ua=Gn([{name:"aOffset",numberOfComponents:2,type:"Int16"}]),ha=function(t){function e(){return t.call(this,ua.size)||this}return r(e,t),e.prototype.push=function(t,e){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.offsetX,r=t.offsetY;return this.push(e,r)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),ca=ha;t.OverlapType={None:{value:0,options:{}},Group:{value:1,options:{}},Screen:{value:2,options:{}}},t.Alignment={Undefined:{value:0,options:{}},Viewport:{value:1,options:{}},Map:{value:2,options:{}}};const fa={read:function(t,e){return t.readFields(fa._readField,{infoArray:[]},e)},_readField:function(t,e,r){1===t&&e.infoArray.push(pa.read(r,r.readVarint()+r.pos))},write:function(t,e){if(t.infoArray)for(var r=0;r<t.infoArray.length;r++)e.writeMessage(1,pa.write,t.infoArray[r])}},pa={read:function(t,e){return t.readFields(pa._readField,{uniqueId:"",featurePos:0,glyphVerticesLength:0,iconVerticesLength:0,textCollisionBoxes:[],iconCollisionBox:null,anchor:null,levelFilter:null,priority:0,groupId:0,overlapType:0,pitchAlignment:0,rotateAlignment:0,keepUpright:!1,angle:0,textPlaceInfo:[],iconQuad:null,textCollisionOptions:null,iconCollisionOptions:null,textPlaced:!1,iconPlaced:!1,notUsed:!1},e)},_readField:function(t,e,r){1===t?e.uniqueId=r.readString():2===t?e.featurePos=r.readVarint():3===t?e.glyphVerticesLength=r.readVarint():4===t?e.iconVerticesLength=r.readVarint():5===t?e.textCollisionBoxes.push(da.read(r,r.readVarint()+r.pos)):6===t?e.iconCollisionBox=da.read(r,r.readVarint()+r.pos):7===t?e.anchor=ya.read(r,r.readVarint()+r.pos):8===t?e.levelFilter=ga.read(r,r.readVarint()+r.pos):9===t?e.priority=r.readFloat():10===t?e.groupId=r.readVarint(!0):11===t?e.overlapType=r.readVarint():12===t?e.pitchAlignment=r.readVarint():13===t?e.rotateAlignment=r.readVarint():14===t?e.keepUpright=r.readBoolean():15===t?e.angle=r.readFloat():16===t?e.textPlaceInfo.push(ba.read(r,r.readVarint()+r.pos)):17===t?e.iconQuad=xa.read(r,r.readVarint()+r.pos):18===t?e.textCollisionOptions=Ma.read(r,r.readVarint()+r.pos):19===t?e.iconCollisionOptions=Ma.read(r,r.readVarint()+r.pos):20===t?e.textPlaced=r.readBoolean():21===t?e.iconPlaced=r.readBoolean():22===t&&(e.notUsed=r.readBoolean())},write:function(t,e){if(t.uniqueId&&e.writeStringField(1,t.uniqueId),t.featurePos&&e.writeVarintField(2,t.featurePos),t.glyphVerticesLength&&e.writeVarintField(3,t.glyphVerticesLength),t.iconVerticesLength&&e.writeVarintField(4,t.iconVerticesLength),t.textCollisionBoxes)for(var r=0;r<t.textCollisionBoxes.length;r++)e.writeMessage(5,da.write,t.textCollisionBoxes[r]);if(t.iconCollisionBox&&e.writeMessage(6,da.write,t.iconCollisionBox),t.anchor&&e.writeMessage(7,ya.write,t.anchor),t.levelFilter&&e.writeMessage(8,ga.write,t.levelFilter),t.priority&&e.writeFloatField(9,t.priority),t.groupId&&e.writeVarintField(10,t.groupId),t.overlapType&&e.writeVarintField(11,t.overlapType),t.pitchAlignment&&e.writeVarintField(12,t.pitchAlignment),t.rotateAlignment&&e.writeVarintField(13,t.rotateAlignment),t.keepUpright&&e.writeBooleanField(14,t.keepUpright),t.angle&&e.writeFloatField(15,t.angle),t.textPlaceInfo)for(r=0;r<t.textPlaceInfo.length;r++)e.writeMessage(16,ba.write,t.textPlaceInfo[r]);t.iconQuad&&e.writeMessage(17,xa.write,t.iconQuad),t.textCollisionOptions&&e.writeMessage(18,Ma.write,t.textCollisionOptions),t.iconCollisionOptions&&e.writeMessage(19,Ma.write,t.iconCollisionOptions),t.textPlaced&&e.writeBooleanField(20,t.textPlaced),t.iconPlaced&&e.writeBooleanField(21,t.iconPlaced),t.notUsed&&e.writeBooleanField(22,t.notUsed)}},da={read:function(t,e){return t.readFields(da._readField,{minX:0,maxX:0,minY:0,maxY:0},e)},_readField:function(t,e,r){1===t?e.minX=r.readFloat():2===t?e.maxX=r.readFloat():3===t?e.minY=r.readFloat():4===t&&(e.maxY=r.readFloat())},write:function(t,e){t.minX&&e.writeFloatField(1,t.minX),t.maxX&&e.writeFloatField(2,t.maxX),t.minY&&e.writeFloatField(3,t.minY),t.maxY&&e.writeFloatField(4,t.maxY)}},ya={read:function(t,e){return t.readFields(ya._readField,{x:0,y:0},e)},_readField:function(t,e,r){1===t?e.x=r.readFloat():2===t&&(e.y=r.readFloat())},write:function(t,e){t.x&&e.writeFloatField(1,t.x),t.y&&e.writeFloatField(2,t.y)}},ga={read:function(t,e){return t.readFields(ga._readField,{bitwise:null,type:null,range:null,always:null},e)},_readField:function(t,e,r){1===t?(e.bitwise=va.read(r,r.readVarint()+r.pos),e.type="bitwise"):2===t?(e.range=_a.read(r,r.readVarint()+r.pos),e.type="range"):3===t&&(e.always=ma.read(r,r.readVarint()+r.pos),e.type="always")},write:function(t,e){t.bitwise&&e.writeMessage(1,va.write,t.bitwise),t.range&&e.writeMessage(2,_a.write,t.range),t.always&&e.writeMessage(3,ma.write,t.always)}},va={read:function(t,e){return t.readFields(va._readField,{viewLevel:0},e)},_readField:function(t,e,r){1===t&&(e.viewLevel=r.readVarint())},write:function(t,e){t.viewLevel&&e.writeVarintField(1,t.viewLevel)}},_a={read:function(t,e){return t.readFields(_a._readField,{minLevel:0,maxLevel:0},e)},_readField:function(t,e,r){1===t?e.minLevel=r.readVarint(!0):2===t&&(e.maxLevel=r.readVarint(!0))},write:function(t,e){t.minLevel&&e.writeVarintField(1,t.minLevel),t.maxLevel&&e.writeVarintField(2,t.maxLevel)}},ma={read:function(t,e){return t.readFields(ma._readField,{},e)},_readField:function(t,e,r){},write:function(t,e){}},ba={read:function(t,e){return t.readFields(ba._readField,{textCollisionBoxes:[],quads:[]},e)},_readField:function(t,e,r){1===t?e.textCollisionBoxes.push(da.read(r,r.readVarint()+r.pos)):2===t&&e.quads.push(xa.read(r,r.readVarint()+r.pos))},write:function(t,e){if(t.textCollisionBoxes)for(var r=0;r<t.textCollisionBoxes.length;r++)e.writeMessage(1,da.write,t.textCollisionBoxes[r]);if(t.quads)for(r=0;r<t.quads.length;r++)e.writeMessage(2,xa.write,t.quads[r])}},xa={read:function(t,e){return t.readFields(xa._readField,{topLeft:null,topRight:null,bottomLeft:null,bottomRight:null,texture:null},e)},_readField:function(t,e,r){1===t?e.topLeft=ya.read(r,r.readVarint()+r.pos):2===t?e.topRight=ya.read(r,r.readVarint()+r.pos):3===t?e.bottomLeft=ya.read(r,r.readVarint()+r.pos):4===t?e.bottomRight=ya.read(r,r.readVarint()+r.pos):5===t&&(e.texture=wa.read(r,r.readVarint()+r.pos))},write:function(t,e){t.topLeft&&e.writeMessage(1,ya.write,t.topLeft),t.topRight&&e.writeMessage(2,ya.write,t.topRight),t.bottomLeft&&e.writeMessage(3,ya.write,t.bottomLeft),t.bottomRight&&e.writeMessage(4,ya.write,t.bottomRight),t.texture&&e.writeMessage(5,wa.write,t.texture)}},wa={read:function(t,e){return t.readFields(wa._readField,{x:0,y:0,width:0,height:0},e)},_readField:function(t,e,r){1===t?e.x=r.readVarint(!0):2===t?e.y=r.readVarint(!0):3===t?e.width=r.readVarint(!0):4===t&&(e.height=r.readVarint(!0))},write:function(t,e){t.x&&e.writeVarintField(1,t.x),t.y&&e.writeVarintField(2,t.y),t.width&&e.writeVarintField(3,t.width),t.height&&e.writeVarintField(4,t.height)}},Ma={};function Sa(t){return t instanceof ne?{type:"bitwise",bitwise:{viewLevel:t.viewLevel}}:t instanceof ie?{type:"range",range:{minLevel:t.minLevel,maxLevel:t.maxLevel}}:{type:"always",always:{}}}function Pa(t){switch(t.type){case"bitwise":return new ne(t.bitwise.viewLevel);case"range":return new ie(t.range.minLevel,t.range.maxLevel);default:return new oe}}function Ta(e){switch(e){case t.OverlapType.None:return 0;case t.OverlapType.Group:return 1;case t.OverlapType.Screen:return 2;default:throw new Error}}function Ea(e){switch(e){case 0:return t.OverlapType.None;case 1:return t.OverlapType.Group;case 2:return t.OverlapType.Screen;default:throw new Error}}function La(e){switch(e){case t.Alignment.Viewport:return 1;case t.Alignment.Map:return 2;default:throw new Error}}function ka(e){switch(e){case 1:return t.Alignment.Viewport;case 2:return t.Alignment.Map;default:throw new Error}}Ma.read=function(t,e){return t.readFields(Ma._readField,{optional:!1,allowOverlap:!1},e)},Ma._readField=function(t,e,r){1===t?e.optional=r.readBoolean():2===t&&(e.allowOverlap=r.readBoolean())},Ma.write=function(t,e){t.optional&&e.writeBooleanField(1,t.optional),t.allowOverlap&&e.writeBooleanField(2,t.allowOverlap)};var Ia=function(t){function e(e){var r=t.call(this)||this;return r._serializedBuffer=null,r._infoArray=null,e instanceof ArrayBuffer?r._serializedBuffer=e:r._infoArray=e,r}return r(e,t),e.prototype.get=function(){if(!this._infoArray){if(!this._serializedBuffer)throw new Error;var t=new Ye(this._serializedBuffer),e=fa.read(t).infoArray;this._infoArray=e.map(Oa),this._serializedBuffer=null}return this._infoArray},e.prototype.getSerializeName=function(){return e.SERIALIZE_NAME},e.serialize=function(t){var e;if(t._serializedBuffer)e=t._serializedBuffer;else{if(!t._infoArray)throw new Error;var r=new Ye,n={infoArray:t._infoArray.map(Ca)};fa.write(n,r),e=r.finish().buffer}return{data:{buffer:e},transferable:[e]}},e.deserialize=function(t){return new e(t.buffer)},e.SERIALIZE_NAME="PoiInfoArrayDto",e}(mt),Aa=Ia;function Ca(e){var r=e.levelFilter,i=e.overlapType,o=e.pitchAlignment,a=e.rotateAlignment,s=n(e,["levelFilter","overlapType","pitchAlignment","rotateAlignment"]);return t.__assign(t.__assign({},s),{levelFilter:Sa(r),overlapType:Ta(i),pitchAlignment:La(o),rotateAlignment:La(a)})}function Oa(e){var r=e.textCollisionBoxes,i=e.levelFilter,o=e.overlapType,a=e.pitchAlignment,s=e.rotateAlignment,l=n(e,["textCollisionBoxes","levelFilter","overlapType","pitchAlignment","rotateAlignment"]);return t.__assign(t.__assign({},l),{textCollisionBoxes:0===(null==r?void 0:r.length)?null:r,levelFilter:Pa(i),overlapType:Ea(o),pitchAlignment:ka(a),rotateAlignment:ka(s)})}var Ra=function(t){function e(e,r,n,i,o){var a=t.call(this,e,r,n)||this;return a._opacityBuffer=i,a._offsetBuffer=o,a}return r(e,t),Object.defineProperty(e.prototype,"opacityBuffer",{get:function(){return this._opacityBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetBuffer",{get:function(){return this._offsetBuffer},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this._opacityBuffer.destroy(),this._offsetBuffer.destroy()},e}(ri),Da=function(t){function e(e,r,n,i,o){var a=t.call(this,e,aa.fields,r,n)||this;return a._opacityArray=i,a._offsetArray=o,a}return r(e,t),e.prototype.get=function(t){return new Ra(t.createVertexBuffer(this.vertexArray,this.attributes),t.createIndexBuffer(this.indexArray),ei.copyFrom(this.segments),t.createVertexBuffer(this._opacityArray,ta.fields,!0),t.createVertexBuffer(this._offsetArray,ua.fields,!0))},e.prototype.getSerializeName=function(){return"PoiPartRenderableDto"},e}(ii),Fa=Gn([{name:"aPlaced",numberOfComponents:1,type:"Uint8"},{name:"aNotUsed",numberOfComponents:1,type:"Uint8"},{name:"aShift",numberOfComponents:2,type:"Float32"}]),Ba=function(t){function e(){return t.call(this,Fa.size)||this}return r(e,t),e.prototype.push=function(t,e,r,n){return void 0===r&&(r=0),void 0===n&&(n=0),this._getAssembler().byteBuffer.writeUint8(t?1:0).writeUint8(e?1:0).writeFloat32(r).writeFloat32(n),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.placed,r=t.notUsed,n=t.shiftX,i=t.shiftY;return this.push(e,r,n,i)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),Na=Ba,za=Gn([{name:"aPosition",numberOfComponents:2,type:"Int16"},{name:"aExtrude",numberOfComponents:2,type:"Int16"}]),Ua=function(t){function e(){return t.call(this,za.size)||this}return r(e,t),e.prototype.push=function(t,e,r,n){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeInt16(r).writeInt16(n),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.x,r=t.y,n=t.extrudeX,i=t.extrudeY;return this.push(e,r,n,i)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),ja=Ua,Va=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n)||this;return o._collisionBuffer=i,o}return r(e,t),Object.defineProperty(e.prototype,"collisionBuffer",{get:function(){return this._collisionBuffer},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this._collisionBuffer.destroy()},e}(ri),Ga=function(t){function e(e,r,n,i){var o=t.call(this,e,za.fields,r,n)||this;return o._collisionArray=i,o}return r(e,t),e.prototype.get=function(t){return new Va(t.createVertexBuffer(this.vertexArray,this.attributes),t.createIndexBuffer(this.indexArray),ei.copyFrom(this.segments),t.createVertexBuffer(this._collisionArray,Fa.fields,!0))},e.prototype.getSerializeName=function(){return"CollisionBoxRenderableDto"},e}(ii),qa=function(){function t(){this._vertexBuildr=new ja,this._indexBuilder=new gi,this._segmentArray=new ei,this._collisionVertexBuilder=new Na}return t.prototype.add=function(t,e){var r=this._segmentArray.prepareSegment(4,this._vertexBuildr.getElementSize(),this._indexBuilder.getElementSize()),n=function(t){return t+r.vertexLength},i=t.minX,o=t.minY,a=t.maxX,s=t.maxY;this._addVertex(e,{x:i,y:o}),this._addVertex(e,{x:a,y:o}),this._addVertex(e,{x:a,y:s}),this._addVertex(e,{x:i,y:s});for(var l=0;l<4;l++)this._indexBuilder.push(n(l),n((l+1)%4));r.vertexLength+=4,r.primitiveLength+=4},t.prototype._addVertex=function(t,e){this._vertexBuildr.push(t.x,t.y,Math.round(e.x),Math.round(e.y)),this._collisionVertexBuilder.push(!1,!1)},t.prototype.build=function(){return new Ga(this._vertexBuildr.build(),this._indexBuilder.build(),this._segmentArray,this._collisionVertexBuilder.build())},t}(),Za=function(){function t(t,e,r,n){this._collisionBox=null,this._text=t,this._icon=e,this._infoArray=r,this._fontSize=n}return Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!1,configurable:!0}),t.prototype.getInfoArray=function(){return this._infoArray},t.prototype.getCollisionBox=function(t){return this._collisionBox||(this._collisionBox=this._newCollisionBox(t)),this._collisionBox},t.prototype._newCollisionBox=function(t){var e,r,n,i,o=new qa;try{for(var s=a(this._infoArray),l=s.next();!l.done;l=s.next()){var u=l.value,h=u.anchor,c=u.textCollisionBoxes,f=u.iconCollisionBox;if(c)try{for(var p=(n=void 0,a(c)),d=p.next();!d.done;d=p.next()){var y=d.value;o.add(y,h)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}f&&o.add(f,h)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return o.build().get(t)},t.prototype.updateCollisionBox=function(t){var e,r,n,i,o,s=new Na;try{for(var l=a(this._infoArray),u=l.next();!u.done;u=l.next()){var h=u.value,c=h.textCollisionBoxes,f=h.iconCollisionBox,p=h.textPlaced,d=h.iconPlaced,y=h.notUsed;if(c)try{for(var g=(n=void 0,a(c)),v=g.next();!v.done;v=g.next())for(var _=0;_<4;_++)s.push(p,y)}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}if(f)for(_=0;_<4;_++)s.push(d,y)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}var m=this._newCollisionBox(t);m.collisionBuffer.updateData(s.build()),null===(o=this._collisionBox)||void 0===o||o.destroy(),this._collisionBox=m},t.prototype.destroy=function(){var t;this._text.destroy(),this._icon.destroy(),null===(t=this._collisionBox)||void 0===t||t.destroy()},t}(),Wa=Za,Ha=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._textDto=e,o._iconDto=r,o._infoArrayDto=n,o._fontSize=i,o}return r(e,t),e.prototype.get=function(t){return new Wa(this._textDto.get(t),this._iconDto.get(t),this._infoArrayDto.get(),this._fontSize)},e.prototype.destroy=function(){this._textDto.destroy(),this._iconDto.destroy()},e.prototype.getSerializeName=function(){return"PoiRenderableDto"},e}(mt),Ya=function(){function t(){this._vertexBuilder=new la,this._indexBuilder=new Yn,this._segmentArray=new ei,this._opacityVertexBuilder=new ra,this._offsetBuilder=new ca}return Object.defineProperty(t.prototype,"vertexBuilder",{get:function(){return this._vertexBuilder},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexBuilder",{get:function(){return this._indexBuilder},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"segmentArray",{get:function(){return this._segmentArray},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacityVertexBuilder",{get:function(){return this._opacityVertexBuilder},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetBuilder",{get:function(){return this._offsetBuilder},enumerable:!1,configurable:!0}),t}(),Xa=function(){function t(){this._textBuffers=new Ya,this._iconBuffers=new Ya,this._infoArray=[],this._fontSize=10}return t.prototype.add=function(t,e,r,n,i,o,a,s,l,u,h,c,f,p,d,y,g){var v=0,_=null,m=0,b=null,x=[],w=null;g&&(w=oa(g,p),Qa(this._iconBuffers,[w],t,h,c),b=p?na(w):g.getBBox(),m=4),n.length&&i&&(n.forEach((function(t){var e=ia(t.positionedGlyphs,i,t.translate,p),r=p?e.map((function(t){return na(t,o/24)})):[t.getBBox()];x.push({textCollisionBoxes:r,quads:e})})),Qa(this._textBuffers,x[0].quads,t,h,c),_=x[0].textCollisionBoxes,v=4*x[0].quads.length),this._fontSize=o,this._infoArray.push({uniqueId:e,featurePos:r,glyphVerticesLength:v,iconVerticesLength:m,textCollisionBoxes:_,iconCollisionBox:b,anchor:t,levelFilter:a,priority:s,groupId:l,overlapType:u,pitchAlignment:h,rotateAlignment:c,keepUpright:f,angle:p,textPlaceInfo:x,iconQuad:w,textCollisionOptions:d,iconCollisionOptions:y,textPlaced:!1,iconPlaced:!1,notUsed:!1})},t.prototype.build=function(){var t=new Da(this._textBuffers.vertexBuilder.build(),this._textBuffers.indexBuilder.build(),this._textBuffers.segmentArray,this._textBuffers.opacityVertexBuilder.build(),this._textBuffers.offsetBuilder.build()),e=new Da(this._iconBuffers.vertexBuilder.build(),this._iconBuffers.indexBuilder.build(),this._iconBuffers.segmentArray,this._iconBuffers.opacityVertexBuilder.build(),this._iconBuffers.offsetBuilder.build()),r=new Aa(this._infoArray);return new Ha(t,e,r,this._fontSize)},t}(),Ka=Xa,Qa=function(e,r,n,i,o){var s,l;void 0===o&&(o=t.Alignment.Viewport);var u=e.vertexBuilder,h=e.indexBuilder,c=e.segmentArray.prepareSegment(4*r.length,u.getElementSize(),h.getElementSize()),f=i===t.Alignment.Map,p=o===t.Alignment.Map;try{for(var d=a(r),y=d.next();!y.done;y=d.next()){var g=y.value,v=g.topLeft,_=g.topRight,m=g.bottomLeft,b=g.bottomRight,x=g.texture,w=function(t){return t+c.vertexLength};Ja(e,n,v,{x:x.x,y:x.y},f,p),Ja(e,n,_,{x:x.x+x.width,y:x.y},f,p),Ja(e,n,m,{x:x.x,y:x.y+x.height},f,p),Ja(e,n,b,{x:x.x+x.width,y:x.y+x.height},f,p),h.push(w(0),w(1),w(2)),h.push(w(1),w(2),w(3)),c.vertexLength+=4,c.primitiveLength+=2}}catch(t){s={error:t}}finally{try{y&&!y.done&&(l=d.return)&&l.call(d)}finally{if(s)throw s.error}}},Ja=function(t,e,r,n,i,o){var a=t.vertexBuilder,s=t.offsetBuilder,l=t.opacityVertexBuilder;a.push(e.x,e.y,n.x,n.y,i,o),s.push(Math.round(32*r.x),Math.round(32*r.y)),l.push(0)},$a=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.valueOf=function(t,r){return new e(t,r)},e.prototype._createRenderableBuilder=function(t,e){var r,n,i=t.vectorTile,o=t.features,s=t.stack,l=t.style,u=t.globalVariables,h=t.layerId,c=t.isPoiLayer,f=t.conversionType,p=e.glyphMap,d=e.glyphPositionMap,y=e.iconMap,g=e.iconPositionMap,v=e.featureIndex,_=s.getProperties(),m=l.getLabelPaint(),b=l.getIconPaint();jr(l,_,m,b);var x=l.getPoiPaint(),w=$o,M=xr(_),S=m&&!br(m.display),P=Pr(m)*u.fontScale,T=m.placement,E=b&&!br(b.display),L=Tr(b)*u.iconScale,k=Ar(b),I=Er(b),A=zr(x),C=Ur(x,f),O=Nr(x),R=Fr(m),D=Br(b,_),F=new Ka,B=s.getId(),N=i.tileId.toString(),z=o.map((function(t){var e=t.feature,r=t.pos,n=e.properties.get("id");return{feature:e,pos:r,uniqueId:c&&n?"".concat(h,"/").concat(B,":").concat(n):"".concat(h,"/").concat(B,":").concat(N,":").concat(r),priority:Rr(e.properties,_.sortBy)}})).sort(Bo),U=function(t,e,r,n){var o=i.loadGeometry(t),a=t.properties;if(!(o instanceof Wr))return"continue";var u=o.getVertex(),h=Sr(a),f=a.get("landmark_icon_replaced")||a.get("poi_icon")||b.icon,_=f?"".concat(r,":").concat(f):r,x=Dr(a),B=null;if(E&&y&&g&&f&&y[f]){var N=y[f].pixelRatio||1/_r();B=zo.valueOf(g[f],k,I,L/N)}var z=[];if(S&&p&&h)if(T)T.forEach((function(t){var e=Wo.valueOf(h,p,w,Ar(t),Ir(t),B,kr(t),Er(t),P,500,30,0,-15);e&&z.push(e)}));else{var U=Wo.valueOf(h,p,w,Ar(m),Ir(m),B,kr(m),Er(m),P,500,30,0,-15);U&&z.push(U)}var j=c?function(t){var e=t.get("minLevel"),r=t.get("maxLevel"),n=t.get("poi_view");return e&&r?new ie(parseInt(e),parseInt(r)):n?new ne(parseInt(n,16)):new oe}(a):Mr(s.getViewLevels());(B||z.length)&&F.add(u,_,e,z,d,P,j,n,s.getId(),M,A,C,O,x,R,D,B),v.add(on(o.getVertices()),s.getId(),e,l.getId())};try{for(var j=a(z),V=j.next();!V.done;V=j.next()){var G=V.value;U(G.feature,G.pos,G.uniqueId,G.priority)}}catch(t){r={error:t}}finally{try{V&&!V.done&&(n=j.return)&&n.call(j)}finally{if(r)throw r.error}}return F},e.prototype.clear=function(){var e,r;t.prototype.clear.call(this);var n=this.getRenderable();if(n){var i=new ra,o=new ra;try{for(var s=a(n.getInfoArray()),l=s.next();!l.done;l=s.next()){var u=l.value,h=u.glyphVerticesLength,c=u.iconVerticesLength,f=c>0;if(h>0)for(var p=0;p<h;p++)i.push(0);if(f)for(p=0;p<c;p++)o.push(0);u.textPlaced=!1,u.iconPlaced=!1,u.notUsed=!1}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}n.text&&n.text.opacityBuffer.updateData(i.build()),n.icon&&n.icon.opacityBuffer.updateData(o.build())}},e.prototype.getSerializeName=function(){return"PoiStackStyleData"},e}(tr),ts=$a,es=function(t){function e(e,r,n,i,o,a){void 0===i&&(i=null);var s=t.call(this,e,r,n)||this;return s._outlineRenderable=i,s._patternPosition=o,s._patternPixelRatio=a,s}return r(e,t),Object.defineProperty(e.prototype,"outlineRenderable",{get:function(){return this._outlineRenderable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"patternPosition",{get:function(){return this._patternPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"patternPixelRatio",{get:function(){return this._patternPixelRatio},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var e;t.prototype.destroy.call(this),null===(e=this._outlineRenderable)||void 0===e||e.destroy()},e}(ri),rs=es,ns=function(t){function e(e,r,n,i,o,a){var s=t.call(this,e,Io.fields,r,n)||this;return s._outlineDto=i,s._patternPosition=o,s._patternPixelRatio=a,s}return r(e,t),e.prototype.get=function(t){return new rs(t.createVertexBuffer(this.vertexArray,this.attributes),t.createIndexBuffer(this.indexArray),ei.copyFrom(this.segments),this._outlineDto?this._outlineDto.get(t):null,this._patternPosition,this._patternPixelRatio)},e.prototype.getSerializeName=function(){return"PolygonRenderableDto"},e.prototype.destroy=function(){var e;t.prototype.destroy.call(this),null===(e=this._outlineDto)||void 0===e||e.destroy()},e}(ii),is=ns,os=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.valueOf=function(t,r){return new e(t,r)},e.prototype._createRenderableBuilder=function(t,e){var r,n,i,o,u,h,c=t.vectorTile,f=t.features,p=t.stack,d=t.style,y=t.tileAdapter,g=t.tessellationPreset,v=e.featureIndex,_=e.patternPositionMap,m=e.patternMap,b=d.getGeomPaint(),x=gr(b["stroke-width"],0)>0,w=b["fill-pattern"];w&&m&&_&&_[w]&&(u=_[w].positions,h=m[w].pixelRatio||1/_r());var M=new Co,S=new Yn,P=new ei,T=new ui(y.getTileExtent()/Dn);try{for(var E=a(f),L=E.next();!L.done;L=E.next()){var k=L.value,I=k.feature,A=k.pos,C=c.loadGeometry(I);if(C instanceof Yr){var O=C,R=function(t){for(var e,r,n=[],i=0;i<t.length;i++){var o=t[i],u=O.getVertices().slice(o.start,o.end);n.push(u)}var h=bo(n[0],n.slice(1),g),c=h.vertices,f=h.triangles;if(!h.correct)return"continue";var p=P.prepareSegment(c.length,M.getElementSize(),S.getElementSize());M.pushAll.apply(M,l([],s(c),!1));var d=function(t){return t+p.vertexLength};try{for(var y=(e=void 0,a(f)),v=y.next();!v.done;v=y.next()){var _=v.value,m=_.i0,b=_.i1,w=_.i2;S.push(d(m),d(b),d(w))}}catch(t){e={error:t}}finally{try{v&&!v.done&&(r=y.return)&&r.call(y)}finally{if(e)throw e.error}}p.vertexLength+=c.length,p.primitiveLength+=f.length,x&&n.forEach((function(t){return T.add(t)}))};try{for(var D=(i=void 0,a(O.getMultiPartRanges())),F=D.next();!F.done;F=D.next())R(F.value)}catch(t){i={error:t}}finally{try{F&&!F.done&&(o=D.return)&&o.call(D)}finally{if(i)throw i.error}}v.add(on(C.getVertices()),p.getId(),A,d.getId())}}}catch(t){r={error:t}}finally{try{L&&!L.done&&(n=E.return)&&n.call(E)}finally{if(r)throw r.error}}return{build:function(){return new is(M.build(),S.build(),P,x?T.build():null,u,h)}}},e.prototype.getQueryPadding=function(){return gr(this.getStyle().getGeomPaint()["stroke-width"],0)},e.prototype.queryIntersectsFeature=function(t,e,r,n,i){var o,s,l,u,h=[];try{for(var c=a(n.getMultiPartRanges()),f=c.next();!f.done;f=c.next()){var p=f.value;try{for(var d=(l=void 0,a(p)),y=d.next();!y.done;y=d.next()){var g=y.value,v=n.getVertices().slice(g.start,g.end);h.push(v)}}catch(t){l={error:t}}finally{try{y&&!y.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}}}catch(t){o={error:t}}finally{try{f&&!f.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}return En(t.bufferedGeometry,h)},e.prototype.getSerializeName=function(){return"PolygonStackStyleData"},e}(tr),as=os,ss=Gn([{name:"aPosition",numberOfComponents:2,type:"Int16"},{name:"aColor",numberOfComponents:3,type:"Int16"}]),ls=function(t){function e(){return t.call(this,ss.size)||this}return r(e,t),e.prototype.push=function(t,e,r,n,i){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeInt16(r).writeInt16(n).writeInt16(i),this._onPush(),this},e.prototype.pushElement=function(t){var e=t.x,r=t.y,n=t.r,i=t.g,o=t.b;return this.push(e,r,n,i,o)},e.prototype.pushAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.prototype.pushAll.apply(this,l([],s(e),!1)),this},e}(jn),us=ls;t.OverlapType={None:{value:0,options:{}},Group:{value:1,options:{}},Screen:{value:2,options:{}}},t.Alignment={Undefined:{value:0,options:{}},Viewport:{value:1,options:{}},Map:{value:2,options:{}}};const hs={read:function(t,e){return t.readFields(hs._readField,{infoArray:[]},e)},_readField:function(t,e,r){1===t&&e.infoArray.push(cs.read(r,r.readVarint()+r.pos))},write:function(t,e){if(t.infoArray)for(var r=0;r<t.infoArray.length;r++)e.writeMessage(1,cs.write,t.infoArray[r])}},cs={read:function(t,e){return t.readFields(cs._readField,{uniqueId:"",featurePos:0,glyphVerticesLength:0,iconVerticesLength:0,textCollisionBoxes:[],iconCollisionBox:null,anchor:null,levelFilter:null,priority:0,groupId:0,overlapType:0,pitchAlignment:0,rotateAlignment:0,keepUpright:!1,angle:0,textQuads:[],iconQuad:null,textCollisionOptions:null,iconCollisionOptions:null,textPlaced:!1,iconPlaced:!1,notUsed:!1,updatedTextQuads:[],updatedIconQuad:null,fontSize:0,vertices:[],anchorIdx:0,anchorT:0},e)},_readField:function(t,e,r){1===t?e.uniqueId=r.readString():2===t?e.featurePos=r.readVarint():3===t?e.glyphVerticesLength=r.readVarint():4===t?e.iconVerticesLength=r.readVarint():5===t?e.textCollisionBoxes.push(ys.read(r,r.readVarint()+r.pos)):6===t?e.iconCollisionBox=ys.read(r,r.readVarint()+r.pos):7===t?e.anchor=ps.read(r,r.readVarint()+r.pos):8===t?e.levelFilter=gs.read(r,r.readVarint()+r.pos):9===t?e.priority=r.readFloat():10===t?e.groupId=r.readVarint(!0):11===t?e.overlapType=r.readVarint():12===t?e.pitchAlignment=r.readVarint():13===t?e.rotateAlignment=r.readVarint():14===t?e.keepUpright=r.readBoolean():15===t?e.angle=r.readFloat():16===t?e.textQuads.push(fs.read(r,r.readVarint()+r.pos)):17===t?e.iconQuad=fs.read(r,r.readVarint()+r.pos):18===t?e.textCollisionOptions=bs.read(r,r.readVarint()+r.pos):19===t?e.iconCollisionOptions=bs.read(r,r.readVarint()+r.pos):20===t?e.textPlaced=r.readBoolean():21===t?e.iconPlaced=r.readBoolean():22===t?e.notUsed=r.readBoolean():23===t?e.updatedTextQuads.push(fs.read(r,r.readVarint()+r.pos)):24===t?e.updatedIconQuad=fs.read(r,r.readVarint()+r.pos):25===t?e.fontSize=r.readFloat():26===t?e.vertices.push(ps.read(r,r.readVarint()+r.pos)):27===t?e.anchorIdx=r.readVarint():28===t&&(e.anchorT=r.readFloat())},write:function(t,e){if(t.uniqueId&&e.writeStringField(1,t.uniqueId),t.featurePos&&e.writeVarintField(2,t.featurePos),t.glyphVerticesLength&&e.writeVarintField(3,t.glyphVerticesLength),t.iconVerticesLength&&e.writeVarintField(4,t.iconVerticesLength),t.textCollisionBoxes)for(var r=0;r<t.textCollisionBoxes.length;r++)e.writeMessage(5,ys.write,t.textCollisionBoxes[r]);if(t.iconCollisionBox&&e.writeMessage(6,ys.write,t.iconCollisionBox),t.anchor&&e.writeMessage(7,ps.write,t.anchor),t.levelFilter&&e.writeMessage(8,gs.write,t.levelFilter),t.priority&&e.writeFloatField(9,t.priority),t.groupId&&e.writeVarintField(10,t.groupId),t.overlapType&&e.writeVarintField(11,t.overlapType),t.pitchAlignment&&e.writeVarintField(12,t.pitchAlignment),t.rotateAlignment&&e.writeVarintField(13,t.rotateAlignment),t.keepUpright&&e.writeBooleanField(14,t.keepUpright),t.angle&&e.writeFloatField(15,t.angle),t.textQuads)for(r=0;r<t.textQuads.length;r++)e.writeMessage(16,fs.write,t.textQuads[r]);if(t.iconQuad&&e.writeMessage(17,fs.write,t.iconQuad),t.textCollisionOptions&&e.writeMessage(18,bs.write,t.textCollisionOptions),t.iconCollisionOptions&&e.writeMessage(19,bs.write,t.iconCollisionOptions),t.textPlaced&&e.writeBooleanField(20,t.textPlaced),t.iconPlaced&&e.writeBooleanField(21,t.iconPlaced),t.notUsed&&e.writeBooleanField(22,t.notUsed),t.updatedTextQuads)for(r=0;r<t.updatedTextQuads.length;r++)e.writeMessage(23,fs.write,t.updatedTextQuads[r]);if(t.updatedIconQuad&&e.writeMessage(24,fs.write,t.updatedIconQuad),t.fontSize&&e.writeFloatField(25,t.fontSize),t.vertices)for(r=0;r<t.vertices.length;r++)e.writeMessage(26,ps.write,t.vertices[r]);t.anchorIdx&&e.writeVarintField(27,t.anchorIdx),t.anchorT&&e.writeFloatField(28,t.anchorT)}},fs={read:function(t,e){return t.readFields(fs._readField,{topLeft:null,topRight:null,bottomLeft:null,bottomRight:null,texture:null},e)},_readField:function(t,e,r){1===t?e.topLeft=ps.read(r,r.readVarint()+r.pos):2===t?e.topRight=ps.read(r,r.readVarint()+r.pos):3===t?e.bottomLeft=ps.read(r,r.readVarint()+r.pos):4===t?e.bottomRight=ps.read(r,r.readVarint()+r.pos):5===t&&(e.texture=ds.read(r,r.readVarint()+r.pos))},write:function(t,e){t.topLeft&&e.writeMessage(1,ps.write,t.topLeft),t.topRight&&e.writeMessage(2,ps.write,t.topRight),t.bottomLeft&&e.writeMessage(3,ps.write,t.bottomLeft),t.bottomRight&&e.writeMessage(4,ps.write,t.bottomRight),t.texture&&e.writeMessage(5,ds.write,t.texture)}},ps={read:function(t,e){return t.readFields(ps._readField,{x:0,y:0},e)},_readField:function(t,e,r){1===t?e.x=r.readFloat():2===t&&(e.y=r.readFloat())},write:function(t,e){t.x&&e.writeFloatField(1,t.x),t.y&&e.writeFloatField(2,t.y)}},ds={read:function(t,e){return t.readFields(ds._readField,{x:0,y:0,width:0,height:0},e)},_readField:function(t,e,r){1===t?e.x=r.readVarint(!0):2===t?e.y=r.readVarint(!0):3===t?e.width=r.readVarint(!0):4===t&&(e.height=r.readVarint(!0))},write:function(t,e){t.x&&e.writeVarintField(1,t.x),t.y&&e.writeVarintField(2,t.y),t.width&&e.writeVarintField(3,t.width),t.height&&e.writeVarintField(4,t.height)}},ys={read:function(t,e){return t.readFields(ys._readField,{minX:0,maxX:0,minY:0,maxY:0},e)},_readField:function(t,e,r){1===t?e.minX=r.readFloat():2===t?e.maxX=r.readFloat():3===t?e.minY=r.readFloat():4===t&&(e.maxY=r.readFloat())},write:function(t,e){t.minX&&e.writeFloatField(1,t.minX),t.maxX&&e.writeFloatField(2,t.maxX),t.minY&&e.writeFloatField(3,t.minY),t.maxY&&e.writeFloatField(4,t.maxY)}},gs={read:function(t,e){return t.readFields(gs._readField,{bitwise:null,type:null,range:null,always:null},e)},_readField:function(t,e,r){1===t?(e.bitwise=vs.read(r,r.readVarint()+r.pos),e.type="bitwise"):2===t?(e.range=_s.read(r,r.readVarint()+r.pos),e.type="range"):3===t&&(e.always=ms.read(r,r.readVarint()+r.pos),e.type="always")},write:function(t,e){t.bitwise&&e.writeMessage(1,vs.write,t.bitwise),t.range&&e.writeMessage(2,_s.write,t.range),t.always&&e.writeMessage(3,ms.write,t.always)}},vs={read:function(t,e){return t.readFields(vs._readField,{viewLevel:0},e)},_readField:function(t,e,r){1===t&&(e.viewLevel=r.readVarint())},write:function(t,e){t.viewLevel&&e.writeVarintField(1,t.viewLevel)}},_s={read:function(t,e){return t.readFields(_s._readField,{minLevel:0,maxLevel:0},e)},_readField:function(t,e,r){1===t?e.minLevel=r.readVarint(!0):2===t&&(e.maxLevel=r.readVarint(!0))},write:function(t,e){t.minLevel&&e.writeVarintField(1,t.minLevel),t.maxLevel&&e.writeVarintField(2,t.maxLevel)}},ms={read:function(t,e){return t.readFields(ms._readField,{},e)},_readField:function(t,e,r){},write:function(t,e){}},bs={read:function(t,e){return t.readFields(bs._readField,{optional:!1,allowOverlap:!1},e)},_readField:function(t,e,r){1===t?e.optional=r.readBoolean():2===t&&(e.allowOverlap=r.readBoolean())},write:function(t,e){t.optional&&e.writeBooleanField(1,t.optional),t.allowOverlap&&e.writeBooleanField(2,t.allowOverlap)}};var xs=function(t){function e(e){var r=t.call(this)||this;return r._serializedBuffer=null,r._infoArray=null,e instanceof ArrayBuffer?r._serializedBuffer=e:r._infoArray=e,r}return r(e,t),e.prototype.get=function(){if(!this._infoArray){if(!this._serializedBuffer)throw new Error;var t=new Ye(this._serializedBuffer),e=hs.read(t).infoArray;this._infoArray=e.map(Ss)}return this._infoArray},e.prototype.getSerializeName=function(){return e.SERIALIZAE_NAME},e.serialize=function(t){var e;if(t._serializedBuffer)e=t._serializedBuffer;else{if(!t._infoArray)throw new Error;var r=new Ye,n={infoArray:t._infoArray.map(Ms)};hs.write(n,r),e=r.finish().buffer}return{data:{buffer:e},transferable:[e]}},e.deserialize=function(t){return new e(t.buffer)},e.SERIALIZAE_NAME="RoadNameInfoArrayDto",e}(mt),ws=xs;function Ms(e){var r=e.overlapType,i=e.pitchAlignment,o=n(e,["overlapType","pitchAlignment","levelFilter"]);return t.__assign(t.__assign({},o),{levelFilter:Sa(e.levelFilter),overlapType:Ta(r),pitchAlignment:La(i)})}function Ss(e){var r=e.overlapType,i=e.pitchAlignment,o=n(e,["overlapType","pitchAlignment"]);return t.__assign(t.__assign({},o),{levelFilter:Pa(e.levelFilter),overlapType:Ea(r),pitchAlignment:ka(i)})}var Ps=function(){function t(t,e,r,n,i){this._collisionBox=null,this._text=t,this._icon=e,this._infoArray=r,this._network=n,this._fontSize=i}return Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"network",{get:function(){return this._network},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!1,configurable:!0}),t.prototype.getInfoArray=function(){return this._infoArray},t.prototype.getCollisionBox=function(t){return this._collisionBox||(this._collisionBox=this._newCollisionBox(t)),this._collisionBox},t.prototype._newCollisionBox=function(t){var e,r,n,i,o=new qa;try{for(var s=a(this._infoArray),l=s.next();!l.done;l=s.next()){var u=l.value,h=u.anchor,c=u.textCollisionBoxes,f=u.iconCollisionBox;if(c)try{for(var p=(n=void 0,a(c)),d=p.next();!d.done;d=p.next()){var y=d.value;o.add(y,h)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}f&&o.add(f,h)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return o.build().get(t)},t.prototype.updateCollisionBox=function(t){var e,r,n,i,o,s=new Na;try{for(var l=a(this._infoArray),u=l.next();!u.done;u=l.next()){var h=u.value,c=h.textCollisionBoxes,f=h.iconCollisionBox,p=h.textPlaced,d=h.iconPlaced,y=h.notUsed;if(c)try{for(var g=(n=void 0,a(c)),v=g.next();!v.done;v=g.next())for(var _=0;_<4;_++)s.push(p,y)}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}if(f)for(_=0;_<4;_++)s.push(d,y)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}var m=this._newCollisionBox(t);m.collisionBuffer.updateData(s.build()),null===(o=this._collisionBox)||void 0===o||o.destroy(),this._collisionBox=m},t.prototype.destroy=function(){var t;this._text.destroy(),this._icon.destroy(),this._network.destroy(),null===(t=this._collisionBox)||void 0===t||t.destroy()},t}(),Ts=Ps,Es=function(t){function e(e,r,n,i,o){var a=t.call(this)||this;return a._textDto=e,a._iconDto=r,a._infoArrayDto=n,a._networkDto=i,a._fontSize=o,a}return r(e,t),e.prototype.get=function(t){return new Ts(this._textDto.get(t),this._iconDto.get(t),this._infoArrayDto.get(),this._networkDto.get(t),this._fontSize)},e.prototype.getSerializeName=function(){return"RoadNameRenderableDto"},e.prototype.destroy=function(){this._textDto.destroy(),this._iconDto.destroy(),this._networkDto.destroy()},e}(mt),Ls=function(){function t(){this._vertexBuilder=new us,this._indexBuilder=new gi,this._segmentArray=new ei}return Object.defineProperty(t.prototype,"vertexBuilder",{get:function(){return this._vertexBuilder},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexBuilder",{get:function(){return this._indexBuilder},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"segmentArray",{get:function(){return this._segmentArray},enumerable:!1,configurable:!0}),t}(),ks=function(){function t(){this._textBuffers=new Ya,this._iconBuffers=new Ya,this._networkBuffer=new Ls,this._infoArray=[],this._fontSize=10}return t.prototype.add=function(t,e,r,n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m){this._fontSize=a;var b=null,x=0,w=null,M=[],S=0,P=null;n&&(b=oa(n,d),Qa(this._iconBuffers,[b],e,c,f),w=d?na(b):n.getBBox(),x=4),i&&o&&(M=ia(i.positionedGlyphs,o,i.translate,d),Qa(this._textBuffers,M,e,c),P=d?M.map((function(t){return na(t,a/24)})):[i.getBBox()],S=4*M.length),this._infoArray.push({uniqueId:t,featurePos:r,glyphVerticesLength:S,iconVerticesLength:x,textCollisionBoxes:P,iconCollisionBox:w,levelFilter:s,priority:l,groupId:u,overlapType:h,pitchAlignment:c,rotateAlignment:f,keepUpright:p,angle:d,textQuads:M,iconQuad:b,textCollisionOptions:y,iconCollisionOptions:g,textPlaced:!1,iconPlaced:!1,notUsed:!1,updatedTextQuads:[],updatedIconQuad:null,anchor:e,fontSize:a,vertices:v,anchorIdx:_,anchorT:m})},t.prototype.addNetwork=function(t,e){var r=this._networkBuffer,n=r.vertexBuilder,i=r.indexBuilder,o=r.segmentArray,a=s(t,2),l=a[0],u=a[1],h=s(e,3),c=h[0],f=h[1],p=h[2],d=o.prepareSegment(t.length,n.getElementSize(),i.getElementSize());n.push(l.x,l.y,c,f,p),n.push(u.x,u.y,c,f,p),i.push(d.vertexLength,d.vertexLength+1),d.vertexLength+=2,d.primitiveLength+=1},t.prototype.build=function(){var t=new Da(this._textBuffers.vertexBuilder.build(),this._textBuffers.indexBuilder.build(),this._textBuffers.segmentArray,this._textBuffers.opacityVertexBuilder.build(),this._textBuffers.offsetBuilder.build()),e=new Da(this._iconBuffers.vertexBuilder.build(),this._iconBuffers.indexBuilder.build(),this._iconBuffers.segmentArray,this._iconBuffers.opacityVertexBuilder.build(),this._iconBuffers.offsetBuilder.build()),r=new ws(this._infoArray),n=new ii(this._networkBuffer.vertexBuilder.build(),ss.fields,this._networkBuffer.indexBuilder.build(),this._networkBuffer.segmentArray);return new Es(t,e,r,n,this._fontSize)},t}(),Is=ks,As=function(e){function n(t,r){return e.call(this,t,r)||this}return r(n,e),n.valueOf=function(t,e){return new n(t,e)},n.prototype._createRenderableBuilder=function(e,r){var n,i,o=e.vectorTile,s=e.features,l=e.stack,u=e.style,h=e.globalVariables,c=e.tileAdapter,f=e.layerId,p=e.conversionType,d=r.glyphMap,y=r.glyphPositionMap,g=r.iconMap,v=r.iconPositionMap,_=r.featureIndex,m=l.getProperties(),b=u.getLabelPaint(),x=u.getIconPaint();jr(u,m,b,x);var w=u.getPoiPaint(),M=$o,S=xr(m),P=b&&!br(b.display),T=Pr(b)*h.fontScale,E=Ar(b),L=Er(b),k=kr(b),I=Ir(b),A=x&&!br(x.display),C=Tr(x)*h.iconScale,O=Ar(x),R=Er(x),D=zr(w,p),F=Ur(w,p),B=Nr(w),N=w["line-alignment"]||"line-center",z=function(t){var e,r=mr(),n=100*r;return null!==(e=Lr(t["line-alignment-min-spacing"],r))&&void 0!==e?e:n}(w),U=function(t){return gr(t["line-alignment-max-angle"])||30}(w),j=Fr(b),V=Br(x,m),G=new Is,q=l.getId(),Z=o.tileId.toString(),W=s.map((function(t){var e=t.feature,r=t.pos;return{feature:e,pos:r,uniqueId:"".concat(f,"/").concat(q,":").concat(Z,":").concat(r),priority:Rr(e.properties,m.sortBy)}})).sort(Bo),H=function(e,r,n,i){var s,f,p=o.loadGeometry(e),m=e.properties,b=Sr(m),w=m.get("landmark_icon_replaced")||m.get("poi_icon")||x.icon,q=F===t.Alignment.Viewport?Dr(m):0;if(!(p instanceof Hr)||p.getVertices().length<2)return"continue";var Z=null;if(A&&g&&v&&w&&g[w]){var W=g[w].pixelRatio||1/_r();Z=zo.valueOf(v[w],O,yn(R,2),C/W)}var H=null;P&&d&&b&&(H=Wo.valueOf(b,d,M,E,I,Z,k,L,T,500,30,0,-15));var Y=[],X=p.getPartRanges(),K=Mr(l.getViewLevels());try{for(var Q=(s=void 0,a(X)),J=Q.next();!J.done;J=Q.next()){var $=J.value,tt=p.getVertices().slice($.start,$.end);Y=Y.concat(Os(tt,U))}}catch(t){s={error:t}}finally{try{J&&!J.done&&(f=Q.return)&&f.call(Q)}finally{if(s)throw s.error}}Y.forEach((function(t,e){if(Z||H){var o=c.getTileExtent()/(c.getTileSize()*h.enlargeScaleFactor);Rs(t,z,o,N).forEach((function(o,a){G.add("".concat(n,"/").concat(e,"/").concat(a),o.anchor,r,Z,H,y,T,K,i,l.getId(),S,D,F,B,q,j,V,t,o.anchorIdx,o.anchorT)}))}for(var a=Fs.next().value,s=1;s<t.length;s++){var u=t[s-1],f=t[s];G.addNetwork([u,f],a)}})),_.add(on(p.getVertices()),l.getId(),r,u.getId())};try{for(var Y=a(W),X=Y.next();!X.done;X=Y.next()){var K=X.value;H(K.feature,K.pos,K.uniqueId,K.priority)}}catch(t){n={error:t}}finally{try{X&&!X.done&&(i=Y.return)&&i.call(Y)}finally{if(n)throw n.error}}return G},n.prototype.clear=function(){var t,r;e.prototype.clear.call(this);var n=this.getRenderable();if(n){var i=new ra,o=new ra;try{for(var s=a(n.getInfoArray()),l=s.next();!l.done;l=s.next()){var u=l.value,h=u.glyphVerticesLength,c=u.iconVerticesLength,f=c>0;if(h>0)for(var p=0;p<h;p++)i.push(0);if(f)for(p=0;p<c;p++)o.push(0);u.textPlaced=!1,u.iconPlaced=!1,u.notUsed=!1}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}n.text&&n.text.opacityBuffer.updateData(i.build()),n.icon&&n.icon.opacityBuffer.updateData(o.build())}},n.prototype.getSerializeName=function(){return"RoadNameStackStyleData"},n}(tr),Cs=As,Os=function(t,e){var r=[];if(180===e)return r.push(t),r;var n=Math.cos(Ht(e)),i=t.length;if(2===i)return cn(t[0],t[1])>=500&&r.push(t),r;for(var o=0,a=cn(t[0],t[1]),s=1;s<i-1;s++){var l=dn(t[s],t[s-1]),u=dn(t[s+1],t[s]),h=_n(u);vn(mn(l),mn(u))<n?(a>=500&&r.push(t.slice(o,s+1)),a=h,o=s):a+=h}return a>=500&&r.push(t.slice(o,i)),r},Rs=function(t,e,r,n){void 0===n&&(n="line-center");for(var i=[0],o=0,a=1;a<t.length;a++){var s=cn(t[a-1],t[a]);i.push(s),o+=s}var l=e*r,u=Math.floor(o/l);if(u<1)return[];var h=[];if("line"===n)for(a=0;a<u;a++){var c=l*(a+1);h.push(c/o)}else h=[.5];return h.map((function(e){return function(e){for(var r=[],n=0,a=-1,s=0,l=0;l<i.length;l++){var u=(n+=i[l])/o;if(r.push(u),a<0&&u>e){var h=r[l-1],c=e-h,f=r[l]-h;f>0&&(a=l-1,s=c/f)}else u===e&&(a=l,s=0)}var p=t[a],d=t[a+1],y=pn(yn(p,1-s),yn(d,s));return{anchorIdx:a,anchorT:s,anchor:{x:Math.round(y.x),y:Math.round(y.y)}}}(e)}))},Ds=function(t,e,r){var n=function(n,i){return void 0===i&&(i=(n+t/60)%6),r-r*e*Math.max(Math.min(i,4-i,1),0)};return[Math.round(255*n(5)),Math.round(255*n(3)),Math.round(255*n(1))]},Fs=function(){var t,e,r;return o(this,(function(n){switch(n.label){case 0:e=function(t){for(var e=360/(t-1),r=[],n=0;n<t;n++)r.push(Ds(e*n,1,1));return r}(t=8),r=0,n.label=1;case 1:return[4,e[r=(r+1)%t]];case 2:return n.sent(),[3,1];case 3:return[2]}}))}(),Bs=function(t){function e(){var e=t.call(this)||this;return e._map={},e}return r(e,t),e.prototype.put=function(t,r,n){if(n){var i=e._key(t,r),o=this._map[i];this._map[i]=n,o&&o.destroy()}},e.prototype.get=function(t,r){return this._map[e._key(t,r)]||null},e._key=function(t,e){return"stack-".concat(t,":style-").concat(e)},e.prototype.keys=function(){return Object.keys(this._map)},e.prototype.values=function(){return Object.values(this._map)},e.prototype.merge=function(t){var r,n;if(!(t instanceof e))throw new Error("Can't not merge. Type mismatch.");try{for(var i=a(Object.entries(t._map)),o=i.next();!o.done;o=i.next()){var l=s(o.value,2),u=l[0],h=l[1],c=this._map[u];this._map[u]=h,c&&c.destroy()}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype.destroy=function(){var t,e;try{for(var r=a(Object.values(this._map)),n=r.next();!n.done;n=r.next())n.value.destroy()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.prototype.getSerializeName=function(){return"StackStyleDataMap"},e}(mt),Ns=Bs,zs=function(t){function e(e){var r=t.call(this)||this,n=e.id,i=e.condition,o=e.priority,a=e.geometry,s=e.icon,l=e.label,u=e.poi;return r._id=n,r._condition=i,r._priority=o,r._geometry=a,r._icon=s,r._label=l,r._poi=u,r}return r(e,t),e.prototype.getId=function(){return this._id},e.prototype.getCondition=function(){return this._condition},e.prototype.getPriority=function(){return this._priority},e.prototype.getGeomPaint=function(){return this._geometry||{}},e.prototype.setGeomPaint=function(t,e){this._geometry||(this._geometry={}),this._geometry[t]=e},e.prototype.getLabelPaint=function(){return this._label||{}},e.prototype.setLabelPaint=function(t,e){this._label||(this._label={}),this._label[t]=e},e.prototype.getIconPaint=function(){return this._icon||{}},e.prototype.setIconPaint=function(t,e){this._icon||(this._icon={}),this._icon[t]=e},e.prototype.getPoiPaint=function(){return this._poi||{}},e.prototype.setPoiPaint=function(t,e){this._poi||(this._poi={}),this._poi[t]=e},e.prototype.getSerializeName=function(){return"ConditionedStackStyle"},e}(mt),Us=function(t){function e(e){var r,n,i=t.call(this)||this,o=[];try{for(var s=a(e),l=s.next();!l.done;l=s.next()){var u=l.value;o.push(new zs(u))}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i._styles=o.sort((function(t,e){return t.getPriority()-e.getPriority()})),i}return r(e,t),e.prototype.getStyles=function(){return this._styles},e.prototype.getStyle=function(t){return this._styles.find((function(e){return e.getId()===t}))},e.prototype.isTranslucent=function(){return function(t){var e,r;try{for(var n=a(t),i=n.next();!i.done;i=n.next()){var o=i.value;if(o&&!br(o.display)){if(gr(o["fill-opacity"],1)<1||gr(o["stroke-opacity"],1)<1)return!0;if(hr(o.fill)[3]<1||hr(o.stroke)[3]<1||hr(o["model-wall-color"])[3]<1)return!0}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!1}(this._styles.map((function(t){return t.getGeomPaint()})))},e.prototype.getSerializeName=function(){return"StackStyle"},e}(mt);Us.DUMMY=new Us([]);var js=Us,Vs=function(t){function e(e){var r,n,i=t.call(this)||this;i._stackStyles={};try{for(var o=a(Object.entries(e)),l=o.next();!l.done;l=o.next()){var u=s(l.value,2),h=u[0],c=u[1];i._stackStyles[parseInt(h)]=new js(c)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}return r(e,t),e.prototype.getStackStyles=function(){return this._stackStyles},e.prototype.getStackStyle=function(t){return this._stackStyles[t]},e.prototype.getSerializeName=function(){return"LayerStyle"},e}(mt),Gs=Vs,qs=function(t){function e(e){var r,n,i=t.call(this)||this;i._totalStackCount=0;var o=e.styles,l=e.layers,u=e.properties;i._layerStyles={};try{for(var h=a(Object.entries(o)),c=h.next();!c.done;c=h.next()){var f=s(c.value,2),p=f[0],d=f[1];i._layerStyles[parseInt(p)]=new Gs(d)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}return i.updateTotalStackCount(i._layerStyles),i._targetLayerIdSet=new Set(l),i._properties=u,i}return r(e,t),e.prototype.getLayerStyle=function(t){return this._layerStyles[t]||null},e.prototype.addLayerStyle=function(t,e){this._layerStyles[t]=new Gs(e),this.updateTotalStackCount(this._layerStyles),this._targetLayerIdSet.add(t)},e.prototype.removeLayerStyle=function(t){this._targetLayerIdSet.delete(t),this.updateTotalStackCount(this._layerStyles),delete this._layerStyles[t]},e.prototype.updateTotalStackCount=function(t){this._totalStackCount=Object.values(t).map((function(t){return Object.keys(t.getStackStyles()).length})).reduce((function(t,e){return t+e}),0)},e.prototype.getTotalStackCount=function(){return this._totalStackCount},e.prototype.isTargetLayer=function(t){return this._targetLayerIdSet.has(t)},e.prototype.getProperties=function(){return this._properties},e.prototype.getSerializeName=function(){return"Style"},e}(mt),Zs=qs,Ws=function(t){function e(){return t.call(this)||this}return r(e,t),e.prototype.prepare=function(t){},e.prototype.getTileInfo=function(){return{responseBodySize:0}},e.prototype.destroy=function(){},e.prototype.getSerializeName=function(){return"EmptyTileCompositeData"},e}(mt),Hs=function(t){function e(e,r,n){var i=t.call(this)||this;return i._linkedData=[],i._prepared=!1,i._willReplace=!1,i._merged=!1,i._dirty=!1,i._tileId=e,i._styleDataMap=r,i._tileCompositeData=n,i._createdAt="".concat(Date.now()),i}return r(e,t),Object.defineProperty(e.prototype,"tileId",{get:function(){return this._tileId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return"".concat(this._tileId.toString(),"@").concat(this._createdAt)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"styleDataMap",{get:function(){return this._styleDataMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileCompositeData",{get:function(){return this._tileCompositeData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prepared",{get:function(){return this._prepared},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"willReplace",{get:function(){return this._willReplace},enumerable:!1,configurable:!0}),e.prototype.markPrepared=function(){this._prepared=!0},e.prototype.markWillReplace=function(){this._willReplace=!0},e.prototype.pushLink=function(t){this._linkedData.push(t)},e.prototype.popLink=function(){return this._linkedData.shift()},e.prototype.hasLink=function(){return this._linkedData.length>0},e.prototype.frontLink=function(){return this._linkedData[0]},e.prototype.rearLink=function(){return this._linkedData[this._linkedData.length-1]},e.prototype.merge=function(t){var e;if(!this._tileId.equals(t._tileId))throw new Error("Can't not merge. Different tile id.");this._styleDataMap.merge(t._styleDataMap),this._tileCompositeData&&this._tileCompositeData.destroy(),this._tileCompositeData=t._tileCompositeData,this._prepared&&(this._prepared=t._prepared),(e=this._linkedData).push.apply(e,l([],s(t._linkedData),!1)),t._merged=!0},e.prototype.markDirty=function(){this._dirty=!0},e.prototype.clear=function(){var t,e;if(this._dirty){try{for(var r=a(this._styleDataMap.values()),n=r.next();!n.done;n=r.next())n.value.clear()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this._dirty=!1}},e.prototype.destroy=function(){var t,e;if(!this._merged){this._styleDataMap.destroy(),this._tileCompositeData.destroy();try{for(var r=a(this._linkedData),n=r.next();!n.done;n=r.next())n.value.destroy()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}},e.prototype.getSerializeName=function(){return"PreparedTileData"},e}(mt),Ys=Hs,Xs=function(t){function e(e,r,n){var i=t.call(this)||this;return i._z=e,i._x=r,i._y=n,i}return r(e,t),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"".concat(this._z,"/").concat(this._x,"/").concat(this._y)},e.prototype.toObject=function(){var t=this;return{x:t.x,y:t.y,z:t.z}},e.prototype.equals=function(t){return this._z===t._z&&this._x===t._x&&this._y===t._y},e.prototype.parent=function(){return new e(this._z-1,this._x>>1,this._y>>1)},e.prototype.newChildren=function(){var t=this._z+1,r=2*this._x,n=2*this._y;return[new e(t,r,n),new e(t,r+1,n),new e(t,r,n+1),new e(t,r+1,n+1)]},e.prototype.getSerializeName=function(){return"TileId"},e}(mt),Ks=Xs,Qs=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o._tileId=e,o._data=r,o._format=n,o._tileServiceName=i,o}return r(e,t),Object.defineProperty(e.prototype,"tileId",{get:function(){return this._tileId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this._format},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileServiceName",{get:function(){return this._tileServiceName},enumerable:!1,configurable:!0}),e.prototype.clearData=function(){this._data=Nn()},e.prototype.getSerializeName=function(){return"RawVectorTile"},e}(mt),Js=function(){function e(){}return e.prototype.getBounds=function(){return t.__assign({},e.BOUNDS)},e.prototype.getMinLevel=function(){return 0},e.prototype.getMaxLevel=function(){return 21},e.prototype.getTileSize=function(){return 256},e.prototype.getResolution=function(t){return e.MAX_RESOLUTION/this.toScale(t)},e.prototype.toScale=function(t){return Math.pow(2,t)},e.prototype.toLevel=function(t){return Math.log(t)/Math.LN2},e.prototype.getTileEnvelope=function(t,e,r){var n=this.getBounds(),i=this.getResolution(t)*this.getTileSize(),o=n.minX+i*e,a=n.maxY-i*r;return{minX:o,maxX:o+i,minY:a-i,maxY:a}},e}();Js.BOUNDS={minX:-20037508.352,maxX:20037508.352,minY:-20037508.352,maxY:20037508.352},Js.MAX_RESOLUTION=156543.034,Js.MAX_ZOOM=21;var $s,tl,el=Js,rl={minX:112,minY:24,maxX:144,maxY:48},nl=function(){function e(){}return e.prototype.getBounds=function(){return t.__assign({},rl)},e.prototype.getMinLevel=function(){return 0},e.prototype.getMaxLevel=function(){return 13},e.prototype.getTileSize=function(){return 2048},e.prototype.getResolution=function(t){return 8/this.getTileSize()/this.toScale(t)},e.prototype.toScale=function(t){return Math.pow(2,t)},e.prototype.toLevel=function(t){return Math.log(t)/Math.LN2},e.prototype.getTileEnvelope=function(t,e,r){var n=this.getResolution(t)*this.getTileSize();return{minX:e*n,maxX:(e+1)*n,minY:r*n,maxY:(r+1)*n}},e}(),il={minX:112,minY:24,maxX:144,maxY:48},ol=[1,2,16,64,256,512],al=function(){function e(){}return e.prototype.getBounds=function(){return t.__assign({},il)},e.prototype.getMinLevel=function(){return 0},e.prototype.getMaxLevel=function(){return 5},e.prototype.getTileSize=function(){return 2048},e.prototype.getResolution=function(t){return 8/this.getTileSize()/this.toScale(t)},e.prototype.toScale=function(t){return ol[t]},e.prototype.toLevel=function(t){if(t<ol[0])return 0;for(var e=0;e<ol.length-1;e++){var r=ol[e],n=ol[e+1];if(t>=r&&t<n)return e+(t-r)/(n-r)}return ol.length-1},e.prototype.getTileEnvelope=function(t,e,r){var n=this.getResolution(t)*this.getTileSize();return{minX:e*n,maxX:(e+1)*n,minY:r*n,maxY:(r+1)*n}},e}(),sl=new el,ll=new al,ul=new nl,hl=ll.getTileSize(),cl=10*hl;!function(t){t[t.LegacyFourBytes=0]="LegacyFourBytes",t[t.LegacyTwoBytesDiff=1]="LegacyTwoBytesDiff",t[t.LegacyFourBytesDiff=2]="LegacyFourBytesDiff",t[t.LegacyNetwork=3]="LegacyNetwork",t[t.FourBytesDiff=4]="FourBytesDiff"}($s||($s={})),t.VectorTileStackDataType=void 0,(tl=t.VectorTileStackDataType||(t.VectorTileStackDataType={}))[tl.None=0]="None",tl[tl.Point=1]="Point",tl[tl.Polyline=2]="Polyline",tl[tl.Polygon=3]="Polygon";var fl={1:"id",2:"name",3:"text",4:"context",5:"style",6:"poi",7:"bda",8:"3d",9:"resource",10:"touch",11:"poi_icon",12:"bd_floor",13:"poi_view",14:"code",15:"categoryLargeId",16:"categoryMediumId",17:"categorySmallId",18:"categoryDetailId",19:"tsdlink",20:"dir",21:"type",22:"grade",23:"name1",24:"name2",25:"angle",26:"scaleX",27:"scaleY",28:"scaleZ",29:"model",30:"group",31:"pos_id",32:"p_code",33:"subCode",34:"do_code",36:"gu_name",37:"do_name",38:"bcode",39:"gu_code",40:"hcode",42:"pos_id",43:"IDXNAME",44:"LANE",45:"ROAD_CATE",46:"LINK_ID",47:"ONEWAY",48:"LINK_FACIL",49:"SPEEDLH",50:"LINK_CATE",51:"lnadmark_icon",52:"pid"},pl=function(t){function e(e){var r=t.call(this)||this;return r._map=e,r}return r(e,t),e.empty=function(){return new e({})},e.from=function(t){var r,n,i={},o=t.match(/[^;]+/g);if(o)try{for(var s=a(o),l=s.next();!l.done;l=s.next()){var u=l.value,h=this.parseProperty(u),c=h.key,f=h.value;c&&f&&(i[c]=f)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return new e(i)},e.parseProperty=function(t){var e=t.match(/[^=]+/g);return e?{key:this.convertKey(e[0]),value:e[1]}:{key:null,value:null}},e.convertKey=function(t){return fl[t]||t},e.prototype.get=function(t){return this._map[t]},e.prototype.set=function(t,e){this._map[t]=e},e.prototype.getPreDefined=function(t){return this._map[e.convertKey(t)]},e.prototype.keys=function(){return Object.keys(this._map)},e.prototype.entries=function(){return Object.entries(this._map)},e.prototype.toString=function(){return JSON.stringify(this._map)},e.prototype.getSerializeName=function(){return"VectorTileProperties"},e}(mt),dl=pl,yl=function(t){function e(e,r,n,i){void 0===i&&(i=0);var o=t.call(this)||this;return o._geometryType=e,o._geometryOffset=r,o._properties=n||new dl({}),o._tileExtent=i,o}return r(e,t),Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"geometryOffset",{get:function(){return this._geometryOffset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return this._properties},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileExtent",{get:function(){return this._tileExtent},enumerable:!1,configurable:!0}),e.prototype.getSerializeName=function(){return"VectorTileFeature"},e}(mt),gl=function(t){function e(e,r,n){var i=t.call(this)||this;return i._stackId=e,i._geometryType=r,i._features=n,i}return r(e,t),e.prototype.getStackId=function(){return this._stackId},e.prototype.getGeometryType=function(){return this._geometryType},e.prototype.getFeatures=function(){return this._features},e.prototype.getFeature=function(t){return this._features[t]},e.prototype.getSerializeName=function(){return"VectorTileStack"},e}(mt),vl=function(){function t(){}return t.create=function(t,e,r){switch(t){case $s.LegacyTwoBytesDiff:case $s.LegacyNetwork:return new ml(e,r,hl);case $s.LegacyFourBytesDiff:return new bl(e,r,cl);case $s.LegacyFourBytes:return new xl(e,r,hl);case $s.FourBytesDiff:return new bl(e,r,16383);default:throw new At("Unknown data format")}},t}(),_l=function(){function t(t,e,r){this._tileId=t,this._tileEnvelope=e.getTileEnvelope(t),this._tileAdapter=e,this._sourceExtent=r}return t.prototype._getSourceExtent=function(){return this._sourceExtent},t.prototype._convertVertex=function(t){return this._tileAdapter.convert(this._tileId,this._getSourceExtent(),t,this._tileEnvelope)},t.prototype._parseFirst=function(t){return{x:t.readInt16(),y:t.readInt16()}},t}(),ml=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return r(e,t),e.prototype.parse=function(t,e){var r=[],n=this._parseFirst(t);r.push(this._convertVertex(n));for(var i=1;i<e;i++){var o=t.readInt8(),a=t.readInt8();n={x:n.x+o,y:n.y+a},r.push(this._convertVertex(n))}return r},e.prototype.estimateByteLength=function(t){return 4+2*(t-1)},e}(_l),bl=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return r(e,t),e.prototype.parse=function(t,e){var r=[],n=this._parseFirst(t);r.push(this._convertVertex(n));for(var i=1;i<e;i++){var o=t.readInt16(),a=t.readInt16();n={x:n.x+o,y:n.y+a},r.push(this._convertVertex(n))}return r},e.prototype.estimateByteLength=function(t){return 4+4*(t-1)},e}(_l),xl=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return r(e,t),e.prototype.parse=function(t,e){var r=this._parseFirst(t),n=[];n.push(this._convertVertex(r));for(var i=1;i<e;i++){var o={x:t.readInt8(),y:t.readInt8()};n.push(this._convertVertex(o))}return n},e.prototype.estimateByteLength=function(t){return 4+2*(t-1)},e}(_l),wl=function(){function t(e,r){t._checkValid(e,r),this._lng=e,this._lat=r}return t.valueOf=function(e){return e instanceof t?e:Array.isArray(e)?new t(Number(e[0]),Number(e[1])):new t(Number(e.lng),Number(e.lat))},t._checkValid=function(t,e){if(isNaN(t)||isNaN(e)||e>90||e<-90)throw new Error("Invalid LngLat value")},Object.defineProperty(t.prototype,"lng",{get:function(){return this._lng},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lat",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"circumference",{get:function(){return Rn*Math.cos(Ht(this._lat))},enumerable:!1,configurable:!0}),t.prototype.wrap=function(){return new t(Yt(this._lng,-180,180),this._lat)},t.prototype.toString=function(){return"[".concat(this._lng.toFixed(7),", ").concat(this._lat.toFixed(7),"]")},t.prototype.toArray=function(){return[this._lng,this._lat]},t.prototype.clone=function(){return new t(this._lng,this._lat)},t}(),Ml=1,Sl=2,Pl=3,Tl=4,El=5,Ll=6378137,kl=6356752.314,Il=.0066943799901413165,Al=484813681109536e-20,Cl=Math.PI/2,Ol=.16666666666666666,Rl=.04722222222222222,Dl=.022156084656084655,Fl=1e-10,Bl=.017453292519943295,Nl=57.29577951308232,zl=Math.PI/4,Ul=2*Math.PI,jl=3.14159265359,Vl={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Gl={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},ql=/[\s_\-\/\(\)]/g;function Zl(t,e){if(t[e])return t[e];for(var r,n=Object.keys(t),i=e.toLowerCase().replace(ql,""),o=-1;++o<n.length;)if((r=n[o]).toLowerCase().replace(ql,"")===i)return t[r]}function Wl(t){var e,r,n,i={},o=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t}),{}),a={proj:"projName",datum:"datumCode",rf:function(t){i.rf=parseFloat(t)},lat_0:function(t){i.lat0=t*Bl},lat_1:function(t){i.lat1=t*Bl},lat_2:function(t){i.lat2=t*Bl},lat_ts:function(t){i.lat_ts=t*Bl},lon_0:function(t){i.long0=t*Bl},lon_1:function(t){i.long1=t*Bl},lon_2:function(t){i.long2=t*Bl},alpha:function(t){i.alpha=parseFloat(t)*Bl},gamma:function(t){i.rectified_grid_angle=parseFloat(t)},lonc:function(t){i.longc=t*Bl},x_0:function(t){i.x0=parseFloat(t)},y_0:function(t){i.y0=parseFloat(t)},k_0:function(t){i.k0=parseFloat(t)},k:function(t){i.k0=parseFloat(t)},a:function(t){i.a=parseFloat(t)},b:function(t){i.b=parseFloat(t)},r_a:function(){i.R_A=!0},zone:function(t){i.zone=parseInt(t,10)},south:function(){i.utmSouth=!0},towgs84:function(t){i.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){i.to_meter=parseFloat(t)},units:function(t){i.units=t;var e=Zl(Gl,t);e&&(i.to_meter=e.to_meter)},from_greenwich:function(t){i.from_greenwich=t*Bl},pm:function(t){var e=Zl(Vl,t);i.from_greenwich=(e||parseFloat(t))*Bl},nadgrids:function(t){"@null"===t?i.datumCode="none":i.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(i.axis=t)},approx:function(){i.approx=!0}};for(e in o)r=o[e],e in a?"function"==typeof(n=a[e])?n(r):i[n]=r:i[e]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}var Hl=1,Yl=/\s/,Xl=/[A-Za-z]/,Kl=/[A-Za-z84_]/,Ql=/[,\]]/,Jl=/[\d\.E\-\+]/;function $l(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Hl}function tu(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var n=e?{}:t,i=r.reduce((function(t,e){return eu(e,t),t}),n);e&&(t[e]=i)}function eu(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void eu(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){if("AXIS"===r)return r in e||(e[r]=[]),void e[r].push(t);var n;switch(Array.isArray(r)||(e[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&eu(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&eu(t[3],e[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void tu(e,r,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return eu(t,e[r]);return tu(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}$l.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Yl.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Hl:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},$l.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(Ql.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},$l.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Hl)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Hl,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},$l.prototype.number=function(t){if(!Jl.test(t)){if(Ql.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},$l.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},$l.prototype.keyword=function(t){if(Kl.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=Hl)}if(!Ql.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},$l.prototype.neutral=function(t){if(Xl.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(Jl.test(t))return this.word=t,void(this.state=3);if(!Ql.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},$l.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var ru=.017453292519943295;function nu(t){return t*ru}function iu(t){var e=new $l(t).output(),r=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",r]);var i={};return eu(e,i),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",r=0,n=t.AXIS.length;r<n;++r){var i=[t.AXIS[r][0].toLowerCase(),t.AXIS[r][1].toLowerCase()];-1!==i[0].indexOf("north")||("y"===i[0]||"lat"===i[0])&&"north"===i[1]?e+="n":-1!==i[0].indexOf("south")||("y"===i[0]||"lat"===i[0])&&"south"===i[1]?e+="s":-1!==i[0].indexOf("east")||("x"===i[0]||"lon"===i[0])&&"east"===i[1]?e+="e":-1===i[0].indexOf("west")&&("x"!==i[0]&&"lon"!==i[0]||"west"!==i[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var o=t.GEOGCS;function a(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(o=t),o&&(o.DATUM?t.datumCode=o.DATUM.name.toLowerCase():t.datumCode=o.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(t.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=o.DATUM.SPHEROID.a,t.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(t.datum_params=o.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",nu],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",nu],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",nu],["lat0","latitude_of_origin",nu],["lat0","standard_parallel_1",nu],["lat1","standard_parallel_1",nu],["lat2","standard_parallel_2",nu],["azimuth","Azimuth"],["alpha","azimuth",nu],["srsCode","name"]].forEach((function(e){return function(t,e){var r=e[0],n=e[1];!(r in t)&&n in t&&(t[r]=t[n],3===e.length&&(t[r]=e[2](t[r])))}(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName?!t.lat_ts&&t.lat0&&"Polar_Stereographic"===t.projName&&(t.lat_ts=t.lat0,t.lat0=nu(t.lat0>0?90:-90)):(t.lat0=nu(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(i),i}function ou(t){var e=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?ou[t]=Wl(arguments[1]):ou[t]=iu(arguments[1]):ou[t]=r}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?ou.apply(e,t):ou(t)}));if("string"==typeof t){if(t in ou)return ou[t]}else"EPSG"in t?ou["EPSG:"+t.EPSG]=t:"ESRI"in t?ou["ESRI:"+t.ESRI]=t:"IAU2000"in t&&(ou["IAU2000:"+t.IAU2000]=t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(ou);var au=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],su=["3857","900913","3785","102113"];function lu(t,e){var r,n;if(t=t||{},!e)return t;for(n in e)void 0!==(r=e[n])&&(t[n]=r);return t}function uu(t,e,r){var n=t*e;return r/Math.sqrt(1-n*n)}function hu(t){return t<0?-1:1}function cu(t){return Math.abs(t)<=jl?t:t-hu(t)*Ul}function fu(t,e,r){var n=t*r,i=.5*t;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(Cl-e))/n}function pu(t,e){for(var r,n,i=.5*t,o=Cl-2*Math.atan(e),a=0;a<=15;a++)if(r=t*Math.sin(o),o+=n=Cl-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-o,Math.abs(n)<=1e-10)return o;return-9999}function du(t){return t}var yu=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=uu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,r,n=t.x,i=t.y;if(i*Nl>90&&i*Nl<-90&&n*Nl>180&&n*Nl<-180)return null;if(Math.abs(Math.abs(i)-Cl)<=Fl)return null;if(this.sphere)e=this.x0+this.a*this.k0*cu(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(zl+.5*i));else{var o=Math.sin(i),a=fu(this.e,i,o);e=this.x0+this.a*this.k0*cu(n-this.long0),r=this.y0-this.a*this.k0*Math.log(a)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n=t.x-this.x0,i=t.y-this.y0;if(this.sphere)r=Cl-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(r=pu(this.e,o)))return null}return e=cu(this.long0+n/(this.a*this.k0)),t.x=e,t.y=r,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:du,inverse:du,names:["longlat","identity"]}],gu={},vu=[];function _u(t,e){var r=vu.length;return!t.names||(vu[r]=t,t.names.forEach((function(t){gu[t.toLowerCase()]=r})),this)}var mu={start:function(){yu.forEach(_u)},add:_u,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==gu[e]&&vu[gu[e]]?vu[gu[e]]:void 0}},bu={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},xu=bu.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};bu.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var wu={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},Mu={};function Su(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:Mu[t]||null,isNull:!1}}function Pu(t){return t/3600*Math.PI/180}function Tu(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function Eu(t){return t.map((function(t){return[Pu(t.longitudeShift),Pu(t.latitudeShift)]}))}function Lu(t,e,r){return{name:Tu(t,e+8,e+16).trim(),parent:Tu(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function ku(t,e,r,n){for(var i=e+176,o=[],a=0;a<r.gridNodeCount;a++){var s={latitudeShift:t.getFloat32(i+16*a,n),longitudeShift:t.getFloat32(i+16*a+4,n),latitudeAccuracy:t.getFloat32(i+16*a+8,n),longitudeAccuracy:t.getFloat32(i+16*a+12,n)};o.push(s)}return o}function Iu(t,e){if(!(this instanceof Iu))return new Iu(t);e=e||function(t){if(t)throw t};var r=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in ou}(t))return ou[t];if(function(t){return au.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=iu(t);if(function(t){var e=Zl(t,"authority");if(e){var r=Zl(e,"epsg");return r&&su.indexOf(r)>-1}}(e))return ou["EPSG:3857"];var r=function(t){var e=Zl(t,"extension");if(e)return Zl(e,"proj4")}(e);return r?Wl(r):e}return function(t){return"+"===t[0]}(t)?Wl(t):void 0}(t);if("object"==typeof r){var n=Iu.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=Zl(wu,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var o,a,s,l,u,h,c=function(t,e,r,n,i){if(!t){var o=Zl(bu,n);o||(o=xu),t=o.a,e=o.b,r=o.rf}return r&&!e&&(e=(1-1/r)*t),(0===r||Math.abs(t-e)<Fl)&&(i=!0,e=t),{a:t,b:e,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),f=(o=c.a,a=c.b,c.rf,u=((s=o*o)-(l=a*a))/s,h=0,r.R_A?(s=(o*=1-u*(Ol+u*(Rl+u*Dl)))*o,u=0):h=Math.sqrt(u),{es:u,e:h,ep2:(s-l)/l}),p=function(t){return void 0===t?null:t.split(",").map(Su)}(r.nadgrids),d=r.datum||function(t,e,r,n,i,o,a){var s={};return s.datum_type=void 0===t||"none"===t?El:Tl,e&&(s.datum_params=e.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=Ml),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=Sl,s.datum_params[3]*=Al,s.datum_params[4]*=Al,s.datum_params[5]*=Al,s.datum_params[6]=s.datum_params[6]/1e6+1))),a&&(s.datum_type=Pl,s.grids=a),s.a=r,s.b=n,s.es=i,s.ep2=o,s}(r.datumCode,r.datum_params,c.a,c.b,f.es,f.ep2,p);lu(this,r),lu(this,n),this.a=c.a,this.b=c.b,this.rf=c.rf,this.sphere=c.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=d,this.init(),e(null,this)}else e(t)}else e(t)}function Au(t,e,r){var n,i,o,a,s=t.x,l=t.y,u=t.z?t.z:0;if(l<-Cl&&l>-1.001*Cl)l=-Cl;else if(l>Cl&&l<1.001*Cl)l=Cl;else{if(l<-Cl)return{x:-1/0,y:-1/0,z:t.z};if(l>Cl)return{x:1/0,y:1/0,z:t.z}}return s>Math.PI&&(s-=2*Math.PI),i=Math.sin(l),a=Math.cos(l),o=i*i,{x:((n=r/Math.sqrt(1-e*o))+u)*a*Math.cos(s),y:(n+u)*a*Math.sin(s),z:(n*(1-e)+u)*i}}function Cu(t,e,r,n){var i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m=t.x,b=t.y,x=t.z?t.z:0;if(i=Math.sqrt(m*m+b*b),o=Math.sqrt(m*m+b*b+x*x),i/r<1e-12){if(v=0,o/r<1e-12)return _=-n,{x:t.x,y:t.y,z:t.z}}else v=Math.atan2(b,m);a=x/o,c=(s=i/o)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*s*s)),f=a*l,g=0;do{g++,u=e*(h=r/Math.sqrt(1-e*f*f))/(h+(_=i*c+x*f-h*(1-e*f*f))),y=(d=a*(l=1/Math.sqrt(1-u*(2-u)*s*s)))*c-(p=s*(1-u)*l)*f,c=p,f=d}while(y*y>1e-24&&g<30);return{x:v,y:Math.atan(d/Math.abs(p)),z:_}}function Ou(t){return t===Ml||t===Sl}function Ru(t,e,r){if(null===t.grids||0===t.grids.length)return-1;for(var n={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},o=[],a=0;a<t.grids.length;a++){var s=t.grids[a];if(o.push(s.name),s.isNull){i=n;break}if(null!==s.grid){var l=s.grid.subgrids[0],u=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,h=l.ll[0]-u,c=l.ll[1]-u,f=l.ll[0]+(l.lim[0]-1)*l.del[0]+u,p=l.ll[1]+(l.lim[1]-1)*l.del[1]+u;if(!(c>n.y||h>n.x||p<n.y||f<n.x||(i=Du(n,e,l),isNaN(i.x))))break}else if(s.mandatory)return-1}return isNaN(i.x)?-1:(r.x=-i.x,r.y=i.y,0)}function Du(t,e,r){var n={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return n;var i={x:t.x,y:t.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=cu(i.x-Math.PI)+Math.PI;var o=Fu(i,r);if(e){if(isNaN(o.x))return n;o.x=i.x-o.x,o.y=i.y-o.y;var a,s,l=9;do{if(s=Fu(o,r),isNaN(s.x))break;a={x:i.x-(s.x+o.x),y:i.y-(s.y+o.y)},o.x+=a.x,o.y+=a.y}while(l--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(l<0)return n;n.x=cu(o.x+r.ll[0]),n.y=o.y+r.ll[1]}else isNaN(o.x)||(n.x=t.x+o.x,n.y=t.y+o.y);return n}function Fu(t,e){var r,n={x:t.x/e.del[0],y:t.y/e.del[1]},i=Math.floor(n.x),o=Math.floor(n.y),a=n.x-1*i,s=n.y-1*o,l={x:Number.NaN,y:Number.NaN};if(i<0||i>=e.lim[0])return l;if(o<0||o>=e.lim[1])return l;r=o*e.lim[0]+i;var u=e.cvs[r][0],h=e.cvs[r][1];r++;var c=e.cvs[r][0],f=e.cvs[r][1];r+=e.lim[0];var p=e.cvs[r][0],d=e.cvs[r][1];r--;var y=e.cvs[r][0],g=e.cvs[r][1],v=a*s,_=a*(1-s),m=(1-a)*(1-s),b=(1-a)*s;return l.x=m*u+_*c+b*y+v*p,l.y=m*h+_*f+b*g+v*d,l}function Bu(t,e,r){var n,i,o,a=r.x,s=r.y,l=r.z||0,u={};for(o=0;o<3;o++)if(!e||2!==o||void 0!==r.z)switch(0===o?(n=a,i=-1!=="ew".indexOf(t.axis[o])?"x":"y"):1===o?(n=s,i=-1!=="ns".indexOf(t.axis[o])?"y":"x"):(n=l,i="z"),t.axis[o]){case"e":case"n":u[i]=n;break;case"w":case"s":u[i]=-n;break;case"u":void 0!==r[i]&&(u.z=n);break;case"d":void 0!==r[i]&&(u.z=-n);break;default:return null}return u}function Nu(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function zu(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Uu(t,e,r,n){var i,o=void 0!==(r=Array.isArray(r)?Nu(r):{x:r.x,y:r.y,z:r.z,m:r.m}).z;if(function(t){zu(t.x),zu(t.y)}(r),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===Ml||t.datum.datum_type===Sl||t.datum.datum_type===Pl)&&"WGS84"!==e.datumCode||(e.datum.datum_type===Ml||e.datum.datum_type===Sl||e.datum.datum_type===Pl)&&"WGS84"!==t.datumCode}(t,e)&&(r=Uu(t,i=new Iu("WGS84"),r,n),t=i),n&&"enu"!==t.axis&&(r=Bu(t,!1,r)),"longlat"===t.projName)r={x:r.x*Bl,y:r.y*Bl,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),!(r=t.inverse(r)))return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=function(t,e,r){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===Ml?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==Sl||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return r;if(t.datum_type===El||e.datum_type===El)return r;var n=t.a,i=t.es;if(t.datum_type===Pl){if(0!==Ru(t,!1,r))return;n=Ll,i=Il}var o=e.a,a=e.b,s=e.es;return e.datum_type===Pl&&(o=Ll,a=kl,s=Il),i!==s||n!==o||Ou(t.datum_type)||Ou(e.datum_type)?(r=Au(r,i,n),Ou(t.datum_type)&&(r=function(t,e,r){if(e===Ml)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===Sl){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],u=r[6];return{x:u*(t.x-l*t.y+s*t.z)+n,y:u*(l*t.x+t.y-a*t.z)+i,z:u*(-s*t.x+a*t.y+t.z)+o}}}(r,t.datum_type,t.datum_params)),Ou(e.datum_type)&&(r=function(t,e,r){if(e===Ml)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===Sl){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],u=r[6],h=(t.x-n)/u,c=(t.y-i)/u,f=(t.z-o)/u;return{x:h+l*c-s*f,y:-l*h+c+a*f,z:s*h-a*c+f}}}(r,e.datum_type,e.datum_params)),r=Cu(r,s,o,a),e.datum_type!==Pl||0===Ru(e,!0,r)?r:void 0):r}(t.datum,e.datum,r))return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*Nl,y:r.y*Nl,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),n&&"enu"!==e.axis?Bu(e,!0,r):(o||delete r.z,r)}Iu.projections=mu,Iu.projections.start();var ju=Iu("WGS84");function Vu(t,e,r,n){var i,o,a;return Array.isArray(r)?(i=Uu(t,e,r,n)||{x:NaN,y:NaN},r.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.splice(3)):[i.x,i.y,r[2]].concat(r.splice(3)):[i.x,i.y].concat(r.splice(2)):[i.x,i.y]):(o=Uu(t,e,r,n),2===(a=Object.keys(r)).length||a.forEach((function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;o[n]=r[n]})),o)}function Gu(t){return t instanceof Iu?t:t.oProj?t.oProj:Iu(t)}function qu(t,e,r){t=Gu(t);var n,i=!1;return void 0===e?(e=t,t=ju,i=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=ju,i=!0),e=Gu(e),r?Vu(t,e,r):(n={forward:function(r,n){return Vu(t,e,r,n)},inverse:function(r,n){return Vu(e,t,r,n)}},i&&(n.oProj=e),n)}var Zu=6,Wu="AJSAJS",Hu="AFAFAF",Yu=65,Xu=73,Ku=79,Qu=86,Ju=90,$u={forward:th,inverse:function(t){var e=ih(sh(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:eh};function th(t,e){return e=e||5,function(t,e){var r,n,i,o,a,s,l,u,h,c,f,p="00000"+t.easting,d="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(h=t.easting,c=t.northing,f=ah(t.zoneNumber),r=Math.floor(h/1e5),n=Math.floor(c/1e5)%20,i=f-1,o=Wu.charCodeAt(i),a=Hu.charCodeAt(i),u=!1,(s=o+r-1)>Ju&&(s=s-Ju+Yu-1,u=!0),(s===Xu||o<Xu&&s>Xu||(s>Xu||o<Xu)&&u)&&s++,(s===Ku||o<Ku&&s>Ku||(s>Ku||o<Ku)&&u)&&++s===Xu&&s++,s>Ju&&(s=s-Ju+Yu-1),(l=a+n)>Qu?(l=l-Qu+Yu-1,u=!0):u=!1,(l===Xu||a<Xu&&l>Xu||(l>Xu||a<Xu)&&u)&&l++,(l===Ku||a<Ku&&l>Ku||(l>Ku||a<Ku)&&u)&&++l===Xu&&l++,l>Qu&&(l=l-Qu+Yu-1),String.fromCharCode(s)+String.fromCharCode(l))+p.substr(p.length-5,e)+d.substr(d.length-5,e)}(function(t){var e,r,n,i,o,a,s,l=t.lat,u=t.lon,h=6378137,c=.00669438,f=.9996,p=rh(l),d=rh(u);s=Math.floor((u+180)/6)+1,180===u&&(s=60),l>=56&&l<64&&u>=3&&u<12&&(s=32),l>=72&&l<84&&(u>=0&&u<9?s=31:u>=9&&u<21?s=33:u>=21&&u<33?s=35:u>=33&&u<42&&(s=37)),a=rh(6*(s-1)-180+3),e=c/(1-c),r=h/Math.sqrt(1-c*Math.sin(p)*Math.sin(p)),n=Math.tan(p)*Math.tan(p),i=e*Math.cos(p)*Math.cos(p);var y=f*r*((o=Math.cos(p)*(d-a))+(1-n+i)*o*o*o/6+(5-18*n+n*n+72*i-58*e)*o*o*o*o*o/120)+5e5,g=f*(h*(.9983242984503243*p-.002514607064228144*Math.sin(2*p)+2639046602129982e-21*Math.sin(4*p)-35*c*c*c/3072*Math.sin(6*p))+r*Math.tan(p)*(o*o/2+(5-n+9*i+4*i*i)*o*o*o*o/24+(61-58*n+n*n+600*i-330*e)*o*o*o*o*o*o/720));return l<0&&(g+=1e7),{northing:Math.round(g),easting:Math.round(y),zoneNumber:s,zoneLetter:oh(l)}}({lat:t[1],lon:t[0]}),e)}function eh(t){var e=ih(sh(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function rh(t){return t*(Math.PI/180)}function nh(t){return t/Math.PI*180}function ih(t){var e=t.northing,r=t.easting,n=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var o,a,s,l,u,h,c,f,p,d=.9996,y=6378137,g=.00669438,v=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),_=r-5e5,m=e;n<"N"&&(m-=1e7),c=6*(i-1)-180+3,o=.006739496752268451,p=(f=m/d/6367449.145945056)+(3*v/2-27*v*v*v/32)*Math.sin(2*f)+(21*v*v/16-55*v*v*v*v/32)*Math.sin(4*f)+151*v*v*v/96*Math.sin(6*f),a=y/Math.sqrt(1-g*Math.sin(p)*Math.sin(p)),s=Math.tan(p)*Math.tan(p),l=o*Math.cos(p)*Math.cos(p),u=.99330562*y/Math.pow(1-g*Math.sin(p)*Math.sin(p),1.5),h=_/(a*d);var b=p-a*Math.tan(p)/u*(h*h/2-(5+3*s+10*l-4*l*l-9*o)*h*h*h*h/24+(61+90*s+298*l+45*s*s-1.6983531815716497-3*l*l)*h*h*h*h*h*h/720);b=nh(b);var x,w=(h-(1+2*s+l)*h*h*h/6+(5-2*l+28*s-3*l*l+8*o+24*s*s)*h*h*h*h*h/120)/Math.cos(p);if(w=c+nh(w),t.accuracy){var M=ih({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});x={top:M.lat,right:M.lon,bottom:b,left:w}}else x={lat:b,lon:w};return x}function oh(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function ah(t){var e=t%Zu;return 0===e&&(e=Zu),e}function sh(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,n=null,i="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;i+=e,o++}var a=parseInt(i,10);if(0===o||o+3>r)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(o,o+=2);for(var l=ah(a),u=function(t,e){for(var r=Wu.charCodeAt(e-1),n=1e5,i=!1;r!==t.charCodeAt(0);){if(++r===Xu&&r++,r===Ku&&r++,r>Ju){if(i)throw"Bad character: "+t;r=Yu,i=!0}n+=1e5}return n}(n.charAt(0),l),h=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var r=Hu.charCodeAt(e-1),n=0,i=!1;r!==t.charCodeAt(0);){if(++r===Xu&&r++,r===Ku&&r++,r>Qu){if(i)throw"Bad character: "+t;r=Yu,i=!0}n+=1e5}return n}(n.charAt(1),l);h<lh(s);)h+=2e6;var c=r-o;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var f,p,d,y=c/2,g=0,v=0;return y>0&&(f=1e5/Math.pow(10,y),p=t.substring(o,o+y),g=parseFloat(p)*f,d=t.substring(o+y),v=parseFloat(d)*f),{easting:g+u,northing:v+h,zoneLetter:s,zoneNumber:a,accuracy:f}}function lh(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function uh(t,e,r){if(!(this instanceof uh))return new uh(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}uh.fromMGRS=function(t){return new uh(eh(t))},uh.prototype.toMGRS=function(t){return th([this.x,this.y],t)};var hh=.046875,ch=.01953125,fh=.01068115234375;function ph(t){var e=[];e[0]=1-t*(.25+t*(hh+t*(ch+t*fh))),e[1]=t*(.75-t*(hh+t*(ch+t*fh)));var r=t*t;return e[2]=r*(.46875-t*(.013020833333333334+.007120768229166667*t)),r*=t,e[3]=r*(.3645833333333333-.005696614583333333*t),e[4]=r*t*.3076171875,e}function dh(t,e,r,n){return r*=e,e*=e,n[0]*t-r*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}function yh(t,e,r){for(var n=1/(1-e),i=t,o=20;o;--o){var a=Math.sin(i),s=1-e*a*a;if(i-=s=(dh(i,a,Math.cos(i),r)-t)*(s*Math.sqrt(s))*n,Math.abs(s)<Fl)return i}return i}var gh={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=ph(this.es),this.ml0=dh(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,r,n,i=t.x,o=t.y,a=cu(i-this.long0),s=Math.sin(o),l=Math.cos(o);if(this.es){var u=l*a,h=Math.pow(u,2),c=this.ep2*Math.pow(l,2),f=Math.pow(c,2),p=Math.abs(l)>Fl?Math.tan(o):0,d=Math.pow(p,2),y=Math.pow(d,2);e=1-this.es*Math.pow(s,2),u/=Math.sqrt(e);var g=dh(o,s,l,this.en);r=this.a*(this.k0*u*(1+h/6*(1-d+c+h/20*(5-18*d+y+14*c-58*d*c+h/42*(61+179*y-y*d-479*d)))))+this.x0,n=this.a*(this.k0*(g-this.ml0+s*a*u/2*(1+h/12*(5-d+9*c+4*f+h/30*(61+y-58*d+270*c-330*d*c+h/56*(1385+543*y-y*d-3111*d))))))+this.y0}else{var v=l*Math.sin(a);if(Math.abs(Math.abs(v)-1)<Fl)return 93;if(r=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=l*Math.cos(a)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>Fl)return 93;n=0}else n=Math.acos(n);o<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=r,t.y=n,t},inverse:function(t){var e,r,n,i,o=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(r=yh(e=this.ml0+a/this.k0,this.es,this.en),Math.abs(r)<Cl){var s=Math.sin(r),l=Math.cos(r),u=Math.abs(l)>Fl?Math.tan(r):0,h=this.ep2*Math.pow(l,2),c=Math.pow(h,2),f=Math.pow(u,2),p=Math.pow(f,2);e=1-this.es*Math.pow(s,2);var d=o*Math.sqrt(e)/this.k0,y=Math.pow(d,2);n=r-(e*=u)*y/(1-this.es)*.5*(1-y/12*(5+3*f-9*h*f+h-4*c-y/30*(61+90*f-252*h*f+45*p+46*h-y/56*(1385+3633*f+4095*p+1574*p*f)))),i=cu(this.long0+d*(1-y/6*(1+2*f+h-y/20*(5+28*f+24*p+8*h*f+6*h-y/42*(61+662*f+1320*p+720*p*f))))/l)}else n=Cl*hu(a),i=0;else{var g=Math.exp(o/this.k0),v=.5*(g-1/g),_=this.lat0+a/this.k0,m=Math.cos(_);e=Math.sqrt((1-Math.pow(m,2))/(1+Math.pow(v,2))),n=Math.asin(e),a<0&&(n=-n),i=0===v&&0===m?0:cu(Math.atan2(v,m)+this.long0)}return t.x=i,t.y=n,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function vh(t){var e=Math.exp(t);return(e-1/e)/2}function _h(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),n=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))}function mh(t,e){for(var r,n=2*Math.cos(2*e),i=t.length-1,o=t[i],a=0;--i>=0;)r=n*o-a+t[i],a=o,o=r;return e+r*Math.sin(2*e)}function bh(t,e,r){for(var n,i,o=Math.sin(e),a=Math.cos(e),s=vh(r),l=function(t){var e=Math.exp(t);return(e+1/e)/2}(r),u=2*a*l,h=-2*o*s,c=t.length-1,f=t[c],p=0,d=0,y=0;--c>=0;)n=d,i=p,f=u*(d=f)-n-h*(p=y)+t[c],y=h*d-i+u*p;return[(u=o*l)*f-(h=a*s)*y,u*y+h*f]}var xh={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(gh.init.apply(this),this.forward=gh.forward,this.inverse=gh.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),r*=e,this.cgb[1]=r*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r*=e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),r*=e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),r*=e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r*=e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),r*=e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r*=e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r*=e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r*=e,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=mh(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(t,e){for(var r,n=2*Math.cos(e),i=t.length-1,o=t[i],a=0;--i>=0;)r=n*o-a+t[i],a=o,o=r;return Math.sin(e)*r}(this.gtu,2*n))},forward:function(t){var e=cu(t.x-this.long0),r=t.y;r=mh(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),o=Math.sin(e),a=Math.cos(e);r=Math.atan2(n,a*i),e=Math.atan2(o*i,_h(n,i*a)),e=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}(e*(1+e/(_h(1,e)+1))),t<0?-e:e}(Math.tan(e));var s,l,u=bh(this.gtu,2*r,2*e);return r+=u[0],e+=u[1],Math.abs(e)<=2.623395162778?(s=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,l=1/0),t.x=s,t.y=l,t},inverse:function(t){var e,r,n=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var o=bh(this.utg,2*i,2*n);i+=o[0],n+=o[1],n=Math.atan(vh(n));var a=Math.sin(i),s=Math.cos(i),l=Math.sin(n),u=Math.cos(n);i=Math.atan2(a*u,_h(l,u*s)),e=cu((n=Math.atan2(l,u*s))+this.long0),r=mh(this.cgb,i)}else e=1/0,r=1/0;return t.x=e,t.y=r,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]},wh={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(cu(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Bl,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,xh.init.apply(this),this.forward=xh.forward,this.inverse=xh.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Mh(t,e){return Math.pow((1-t)/(1+t),e)}var Sh={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+zl)/(Math.pow(Math.tan(.5*this.lat0+zl),this.C)*Mh(this.e*t,this.ratexp))},forward:function(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+zl),this.C)*Mh(this.e*Math.sin(r),this.ratexp))-Cl,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,r=t.y,n=Math.pow(Math.tan(.5*r+zl)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*Mh(this.e*Math.sin(t.y),-.5*this.e))-Cl,!(Math.abs(r-t.y)<1e-14));--i)t.y=r;return i?(t.x=e,t.y=r,t):null},names:["gauss"]},Ph={init:function(){Sh.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,r,n,i;return t.x=cu(t.x-this.long0),Sh.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),n=Math.cos(t.x),i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*n),t.x=i*r*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*r*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,r,n,i,o;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,o=Math.sqrt(t.x*t.x+t.y*t.y)){var a=2*Math.atan2(o,this.R2);e=Math.sin(a),r=Math.cos(a),i=Math.asin(r*this.sinc0+t.y*e*this.cosc0/o),n=Math.atan2(t.x*e,o*this.cosc0*r-t.y*this.sinc0*e)}else i=this.phic0,n=0;return t.x=n,t.y=i,Sh.inverse.apply(this,[t]),t.x=cu(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},Th={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Fl&&(this.k0=.5*(1+hu(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Fl&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Fl&&(this.k0=.5*this.cons*uu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/fu(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=uu(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Cl,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,r,n,i,o,a,s=t.x,l=t.y,u=Math.sin(l),h=Math.cos(l),c=cu(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=Fl&&Math.abs(l+this.lat0)<=Fl?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*u+this.coslat0*h*Math.cos(c)),t.x=this.a*e*h*Math.sin(c)+this.x0,t.y=this.a*e*(this.coslat0*u-this.sinlat0*h*Math.cos(c))+this.y0,t):(r=2*Math.atan(this.ssfn_(l,u,this.e))-Cl,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=Fl?(o=fu(this.e,l*this.con,this.con*u),a=2*this.a*this.k0*o/this.cons,t.x=this.x0+a*Math.sin(s-this.long0),t.y=this.y0-this.con*a*Math.cos(s-this.long0),t):(Math.abs(this.sinlat0)<Fl?(e=2*this.a*this.k0/(1+i*Math.cos(c)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(c))),t.y=e*(this.cosX0*n-this.sinX0*i*Math.cos(c))+this.y0),t.x=e*i*Math.sin(c)+this.x0,t))},inverse:function(t){var e,r,n,i,o;t.x-=this.x0,t.y-=this.y0;var a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var s=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=Fl?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(s)*this.sinlat0+t.y*Math.sin(s)*this.coslat0/a),e=Math.abs(this.coslat0)<Fl?this.lat0>0?cu(this.long0+Math.atan2(t.x,-1*t.y)):cu(this.long0+Math.atan2(t.x,t.y)):cu(this.long0+Math.atan2(t.x*Math.sin(s),a*this.coslat0*Math.cos(s)-t.y*this.sinlat0*Math.sin(s))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=Fl){if(a<=Fl)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,n=a*this.cons/(2*this.a*this.k0),r=this.con*pu(this.e,n),e=this.con*cu(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=Fl?o=this.X0:(o=Math.asin(Math.cos(i)*this.sinX0+t.y*Math.sin(i)*this.cosX0/a),e=cu(this.long0+Math.atan2(t.x*Math.sin(i),a*this.cosX0*Math.cos(i)-t.y*this.sinX0*Math.sin(i)))),r=-1*pu(this.e,Math.tan(.5*(Cl+o)));return t.x=e,t.y=r,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,r){return e*=r,Math.tan(.5*(Cl+t))*Math.pow((1-e)/(1+e),.5*r)}},Eh={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),o=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+o*e)/(1-o*e));this.K=a-this.alpha*s+this.alpha*o/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*a+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,r=t.y-this.y0,n=e/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+a/this.alpha,l=0,u=o,h=-1e3,c=0;Math.abs(u-h)>1e-7;){if(++c>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),h=u,u=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=s,t.y=u,t},names:["somerc"]},Lh=1e-7,kh={init:function(){var t,e,r,n,i,o,a,s,l,u,h,c,f,p=0,d=0,y=0,g=0,v=0,_=0,m=0;this.no_off=(f="object"==typeof(c=this).PROJECTION?Object.keys(c.PROJECTION)[0]:c.PROJECTION,"no_uoff"in c||"no_off"in c||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(f)),this.no_rot="no_rot"in this;var b=!1;"alpha"in this&&(b=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),b&&(m=this.alpha),x&&(p=this.rectified_grid_angle*Bl),b||x)d=this.longc;else if(y=this.long1,v=this.lat1,g=this.long2,_=this.lat2,Math.abs(v-_)<=Lh||(t=Math.abs(v))<=Lh||Math.abs(t-Cl)<=Lh||Math.abs(Math.abs(this.lat0)-Cl)<=Lh||Math.abs(Math.abs(_)-Cl)<=Lh)throw new Error;var w=1-this.es;e=Math.sqrt(w),Math.abs(this.lat0)>Fl?(s=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*s*s,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/w),this.A=this.B*this.k0*e/t,(i=(n=this.B*e/(r*Math.sqrt(t)))*n-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(fu(this.e,this.lat0,s),this.B)):(this.B=1/e,this.A=this.k0,this.E=n=i=1),b||x?(b?(h=Math.asin(Math.sin(m)/n),x||(p=m)):(h=p,m=Math.asin(n*Math.sin(h))),this.lam0=d-Math.asin(.5*(i-1/i)*Math.tan(h))/this.B):(o=Math.pow(fu(this.e,v,Math.sin(v)),this.B),a=Math.pow(fu(this.e,_,Math.sin(_)),this.B),i=this.E/o,l=(a-o)/(a+o),u=((u=this.E*this.E)-a*o)/(u+a*o),(t=y-g)<-Math.pi?g-=Ul:t>Math.pi&&(g+=Ul),this.lam0=cu(.5*(y+g)-Math.atan(u*Math.tan(.5*this.B*(y-g))/l)/this.B),h=Math.atan(2*Math.sin(this.B*cu(y-this.lam0))/(i-1/i)),p=m=Math.asin(n*Math.sin(h))),this.singam=Math.sin(h),this.cosgam=Math.cos(h),this.sinrot=Math.sin(p),this.cosrot=Math.cos(p),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(m))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*h,this.v_pole_n=this.ArB*Math.log(Math.tan(zl-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(zl+i))},forward:function(t){var e,r,n,i,o,a,s,l,u={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Cl)>Fl){if(e=.5*((o=this.E/Math.pow(fu(this.e,t.y,Math.sin(t.y)),this.B))-(a=1/o)),r=.5*(o+a),i=Math.sin(this.B*t.x),n=(e*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<Fl)throw new Error;l=.5*this.ArB*Math.log((1-n)/(1+n)),a=Math.cos(this.B*t.x),s=Math.abs(a)<Lh?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+i*this.singam,a)}else l=t.y>0?this.v_pole_n:this.v_pole_s,s=this.ArB*t.y;return this.no_rot?(u.x=s,u.y=l):(s-=this.u_0,u.x=l*this.cosrot+s*this.sinrot,u.y=s*this.cosrot-l*this.sinrot),u.x=this.a*u.x+this.x0,u.y=this.a*u.y+this.y0,u},inverse:function(t){var e,r,n,i,o,a,s,l={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=.5*((n=Math.exp(-this.BrA*r))-1/n),o=.5*(n+1/n),s=((a=Math.sin(this.BrA*e))*this.cosgam+i*this.singam)/o,Math.abs(Math.abs(s)-1)<Fl)l.x=0,l.y=s<0?-Cl:Cl;else{if(l.y=this.E/Math.sqrt((1+s)/(1-s)),l.y=pu(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(i*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},Ih={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Fl)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),n=uu(this.e,e,r),i=fu(this.e,this.lat1,e),o=Math.sin(this.lat2),a=Math.cos(this.lat2),s=uu(this.e,o,a),l=fu(this.e,this.lat2,o),u=fu(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Fl?this.ns=Math.log(n/s)/Math.log(i/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=Fl&&(r=hu(r)*(Cl-2*Fl));var n,i,o=Math.abs(Math.abs(r)-Cl);if(o>Fl)n=fu(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((o=r*this.ns)<=0)return null;i=0}var a=this.ns*cu(e-this.long0);return t.x=this.k0*(i*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,t},inverse:function(t){var e,r,n,i,o,a=(t.x-this.x0)/this.k0,s=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+s*s),r=1):(e=-Math.sqrt(a*a+s*s),r=-1);var l=0;if(0!==e&&(l=Math.atan2(r*a,r*s)),0!==e||this.ns>0){if(r=1/this.ns,n=Math.pow(e/(this.a*this.f0),r),-9999===(i=pu(this.e,n)))return null}else i=-Cl;return o=cu(l/this.ns+this.long0),t.x=o,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},Ah={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,r,n,i,o,a,s,l=t.x,u=t.y,h=cu(l-this.long0);return e=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/e)-this.s45),n=-h*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),o=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),a=this.n*o,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=s*Math.cos(a)/1,t.x=s*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,r,n,i,o,a,s,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(e)),t.x=this.long0-r/this.alfa,a=e,s=0;var u=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(s=1),a=t.y,u+=1}while(0===s&&u<15);return u>=15?null:t},names:["Krovak","krovak"]};function Ch(t,e,r,n,i){return t*i-e*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)}function Oh(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Rh(t){return.375*t*(1+.25*t*(1+.46875*t))}function Dh(t){return.05859375*t*t*(1+.75*t)}function Fh(t){return t*t*t*(35/3072)}function Bh(t,e,r){var n=e*r;return t/Math.sqrt(1-n*n)}function Nh(t){return Math.abs(t)<Cl?t:t-hu(t)*Math.PI}function zh(t,e,r,n,i){var o,a;o=t/e;for(var s=0;s<15;s++)if(o+=a=(t-(e*o-r*Math.sin(2*o)+n*Math.sin(4*o)-i*Math.sin(6*o)))/(e-2*r*Math.cos(2*o)+4*n*Math.cos(4*o)-6*i*Math.cos(6*o)),Math.abs(a)<=1e-10)return o;return NaN}var Uh={init:function(){this.sphere||(this.e0=Oh(this.es),this.e1=Rh(this.es),this.e2=Dh(this.es),this.e3=Fh(this.es),this.ml0=this.a*Ch(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,r,n=t.x,i=t.y;if(n=cu(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var o=Math.sin(i),a=Math.cos(i),s=Bh(this.a,this.e,o),l=Math.tan(i)*Math.tan(i),u=n*Math.cos(i),h=u*u,c=this.es*a*a/(1-this.es);e=s*u*(1-h*l*(1/6-(8-l+8*c)*h/120)),r=this.a*Ch(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*o/a*h*(.5+(5-l+6*c)*h/24)}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n=t.x/this.a,i=t.y/this.a;if(this.sphere){var o=i+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(o))}else{var a=zh(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-Cl)<=Fl)return t.x=this.long0,t.y=Cl,i<0&&(t.y*=-1),t;var s=Bh(this.a,this.e,Math.sin(a)),l=s*s*s/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(a),2),h=n*this.a/s,c=h*h;e=a-s*Math.tan(a)/l*h*h*(.5-(1+3*u)*h*h/24),r=h*(1-c*(u/3+(1+3*u)*u*c/15))/Math.cos(a)}return t.x=cu(r+this.long0),t.y=Nh(e),t},names:["Cassini","Cassini_Soldner","cass"]};function jh(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e}var Vh={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-Cl)<Fl?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Fl?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=jh(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,r=[];return r[0]=.3333333333333333*t,e=t*t,r[0]+=.17222222222222222*e,r[1]=.06388888888888888*e,e*=t,r[0]+=.10257936507936508*e,r[1]+=.0664021164021164*e,r[2]=.016415012942191543*e,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=jh(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,r,n,i,o,a,s,l,u,h,c=t.x,f=t.y;if(c=cu(c-this.long0),this.sphere){if(o=Math.sin(f),h=Math.cos(f),n=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+h*n:1+this.sinph0*o+this.cosph0*h*n)<=Fl)return null;e=(r=Math.sqrt(2/r))*h*Math.sin(c),r*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*h*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(f+this.lat0)<Fl)return null;r=zl-.5*f,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(c),r*=n}}else{switch(s=0,l=0,u=0,n=Math.cos(c),i=Math.sin(c),o=Math.sin(f),a=jh(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=a/this.qp,l=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:u=1+this.sinb1*s+this.cosb1*l*n;break;case this.EQUIT:u=1+l*n;break;case this.N_POLE:u=Cl+f,a=this.qp-a;break;case this.S_POLE:u=f-Cl,a=this.qp+a}if(Math.abs(u)<Fl)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:u=Math.sqrt(2/u),r=this.mode===this.OBLIQ?this.ymf*u*(this.cosb1*s-this.sinb1*l*n):(u=Math.sqrt(2/(1+l*n)))*s*this.ymf,e=this.xmf*u*l*i;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(u=Math.sqrt(a))*i,r=n*(this.mode===this.S_POLE?u:-u)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,o,a,s,l,u,h,c=t.x/this.a,f=t.y/this.a;if(this.sphere){var p,d=0,y=0;if((r=.5*(p=Math.sqrt(c*c+f*f)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(y=Math.sin(r),d=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(p)<=Fl?0:Math.asin(f*y/p),c*=y,f=d*p;break;case this.OBLIQ:r=Math.abs(p)<=Fl?this.lat0:Math.asin(d*this.sinph0+f*y*this.cosph0/p),c*=y*this.cosph0,f=(d-Math.sin(r)*this.sinph0)*p;break;case this.N_POLE:f=-f,r=Cl-r;break;case this.S_POLE:r-=Cl}e=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,f):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,f*=this.dd,(a=Math.sqrt(c*c+f*f))<Fl)return t.x=this.long0,t.y=this.lat0,t;i=2*Math.asin(.5*a/this.rq),n=Math.cos(i),c*=i=Math.sin(i),this.mode===this.OBLIQ?(s=n*this.sinb1+f*i*this.cosb1/a,o=this.qp*s,f=a*this.cosb1*n-f*this.sinb1*i):(s=f*i/a,o=this.qp*s,f=a*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),!(o=c*c+f*f))return t.x=this.long0,t.y=this.lat0,t;s=1-o/this.qp,this.mode===this.S_POLE&&(s=-s)}e=Math.atan2(c,f),h=(l=Math.asin(s))+l,r=l+(u=this.apa)[0]*Math.sin(h)+u[1]*Math.sin(h+h)+u[2]*Math.sin(h+h+h)}return t.x=cu(this.long0+e),t.y=r,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Gh(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}var qh={init:function(){Math.abs(this.lat1+this.lat2)<Fl||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=uu(this.e3,this.sin_po,this.cos_po),this.qs1=jh(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=uu(this.e3,this.sin_po,this.cos_po),this.qs2=jh(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=jh(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Fl?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=jh(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,o=this.ns0*cu(e-this.long0),a=i*Math.sin(o)+this.x0,s=this.rh-i*Math.cos(o)+this.y0;return t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),i=0,0!==e&&(i=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,a=this.phi1z(this.e3,r)),o=cu(i/this.ns0+this.long0),t.x=o,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var r,n,i,o,a=Gh(.5*e);if(t<Fl)return a;for(var s=t*t,l=1;l<=25;l++)if(a+=o=.5*(i=1-(n=t*(r=Math.sin(a)))*n)*i/Math.cos(a)*(e/(1-s)-r/i+.5/t*Math.log((1-n)/(1+n))),Math.abs(o)<=1e-7)return a;return null}},Zh={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,r,n,i,o,a,s,l=t.x,u=t.y;return n=cu(l-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),(o=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(o)<=Fl?(a=this.x0+1*this.a*r*Math.sin(n)/o,s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)/o):(a=this.x0+this.infinity_dist*r*Math.sin(n),s=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),r=Math.sin(i),a=Gh((n=Math.cos(i))*this.sin_p14+t.y*r*this.cos_p14/e),o=Math.atan2(t.x*r,e*this.cos_p14*n-t.y*this.sin_p14*r),o=cu(this.long0+o)):(a=this.phic0,o=0),t.x=o,t.y=a,t},names:["gnom"]},Wh={init:function(){this.sphere||(this.k0=uu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,r,n=t.x,i=t.y,o=cu(n-this.long0);if(this.sphere)e=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=jh(this.e,Math.sin(i));e=this.x0+this.a*this.k0*o,r=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=r,t},inverse:function(t){var e,r;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=cu(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*Cl:Cl;for(var n,i,o,a,s=Math.asin(.5*e),l=0;l<30;l++)if(i=Math.sin(s),o=Math.cos(s),a=t*i,s+=n=Math.pow(1-a*a,2)/(2*o)*(e/(1-t*t)-i/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),Math.abs(n)<=1e-10)return s;return NaN}(this.e,2*t.y*this.k0/this.a),e=cu(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t},names:["cea"]},Hh={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,r=t.y,n=cu(e-this.long0),i=Nh(r-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*i,t},inverse:function(t){var e=t.x,r=t.y;return t.x=cu(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=Nh(this.lat0+(r-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},Yh={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Oh(this.es),this.e1=Rh(this.es),this.e2=Dh(this.es),this.e3=Fh(this.es),this.ml0=this.a*Ch(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,r,n,i=t.x,o=t.y,a=cu(i-this.long0);if(n=a*Math.sin(o),this.sphere)Math.abs(o)<=Fl?(e=this.a*a,r=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(o),r=this.a*(Nh(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=Fl)e=this.a*a,r=-1*this.ml0;else{var s=Bh(this.a,this.e,Math.sin(o))/Math.tan(o);e=s*Math.sin(n),r=this.a*Ch(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+s*(1-Math.cos(n))}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){var e,r,n,i,o,a,s,l,u;if(n=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=Fl)e=cu(n/this.a+this.long0),r=0;else{var h;for(a=this.lat0+i/this.a,s=n*n/this.a/this.a+a*a,l=a,o=20;o;--o)if(l+=u=-1*(a*(l*(h=Math.tan(l))+1)-l-.5*(l*l+s)*h)/((l-a)/h-1),Math.abs(u)<=Fl){r=l;break}e=cu(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=Fl)r=0,e=cu(this.long0+n/this.a);else{var c,f,p,d,y;for(a=(this.ml0+i)/this.a,s=n*n/this.a/this.a+a*a,l=a,o=20;o;--o)if(y=this.e*Math.sin(l),c=Math.sqrt(1-y*y)*Math.tan(l),f=this.a*Ch(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=u=(a*(c*(d=f/this.a)+1)-d-.5*c*(d*d+s))/(this.es*Math.sin(2*l)*(d*d+s-2*a*d)/(4*c)+(a-d)*(c*p-2/Math.sin(2*l))-p),Math.abs(u)<=Fl){r=l;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=cu(this.long0+Math.asin(n*c/this.a)/Math.sin(r))}return t.x=e,t.y=r,t},names:["Polyconic","poly"]},Xh={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,r=t.x,n=t.y-this.lat0,i=r-this.long0,o=n/Al*1e-5,a=i,s=1,l=0;for(e=1;e<=10;e++)s*=o,l+=this.A[e]*s;var u,h=l,c=a,f=1,p=0,d=0,y=0;for(e=1;e<=6;e++)u=p*h+f*c,f=f*h-p*c,p=u,d=d+this.B_re[e]*f-this.B_im[e]*p,y=y+this.B_im[e]*f+this.B_re[e]*p;return t.x=y*this.a+this.x0,t.y=d*this.a+this.y0,t},inverse:function(t){var e,r,n=t.x,i=t.y,o=n-this.x0,a=(i-this.y0)/this.a,s=o/this.a,l=1,u=0,h=0,c=0;for(e=1;e<=6;e++)r=u*a+l*s,l=l*a-u*s,u=r,h=h+this.C_re[e]*l-this.C_im[e]*u,c=c+this.C_im[e]*l+this.C_re[e]*u;for(var f=0;f<this.iterations;f++){var p,d=h,y=c,g=a,v=s;for(e=2;e<=6;e++)p=y*h+d*c,d=d*h-y*c,y=p,g+=(e-1)*(this.B_re[e]*d-this.B_im[e]*y),v+=(e-1)*(this.B_im[e]*d+this.B_re[e]*y);d=1,y=0;var _=this.B_re[1],m=this.B_im[1];for(e=2;e<=6;e++)p=y*h+d*c,d=d*h-y*c,y=p,_+=e*(this.B_re[e]*d-this.B_im[e]*y),m+=e*(this.B_im[e]*d+this.B_re[e]*y);var b=_*_+m*m;h=(g*_+v*m)/b,c=(v*_-g*m)/b}var x=h,w=c,M=1,S=0;for(e=1;e<=9;e++)M*=x,S+=this.D[e]*M;var P=this.lat0+S*Al*1e5,T=this.long0+w;return t.x=T,t.y=P,t},names:["New_Zealand_Map_Grid","nzmg"]},Kh={init:function(){},forward:function(t){var e=t.x,r=t.y,n=cu(e-this.long0),i=this.x0+this.a*n,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=i,t.y=o,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=cu(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t},names:["Miller_Cylindrical","mill"]},Qh={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=ph(this.es)},forward:function(t){var e,r,n=t.x,i=t.y;if(n=cu(n-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(i),a=20;a;--a){var s=(this.m*i+Math.sin(i)-o)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<Fl)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var l=Math.sin(i),u=Math.cos(i);r=this.a*dh(i,l,u,this.en),e=this.a*n*u/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,r/=this.C_x*(this.m+Math.cos(e)),this.m?e=Gh((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Gh(Math.sin(e)/this.n)),r=cu(r+this.long0),e=Nh(e)):(e=yh(t.y/this.a,this.es,this.en),(n=Math.abs(e))<Cl?(n=Math.sin(e),r=cu(this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)))):n-Fl<Cl&&(r=this.long0)),t.x=r,t.y=e,t},names:["Sinusoidal","sinu"]},Jh={init:function(){},forward:function(t){for(var e=t.x,r=t.y,n=cu(e-this.long0),i=r,o=Math.PI*Math.sin(r);;){var a=-(i+Math.sin(i)-o)/(1+Math.cos(i));if(i+=a,Math.abs(a)<Fl)break}i/=2,Math.PI/2-Math.abs(r)<Fl&&(n=0);var s=.900316316158*this.a*n*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return t.x=s,t.y=l,t},inverse:function(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var n=cu(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return t.x=n,t.y=i,t},names:["Mollweide","moll"]},$h={init:function(){Math.abs(this.lat1+this.lat2)<Fl||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Oh(this.es),this.e1=Rh(this.es),this.e2=Dh(this.es),this.e3=Fh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=uu(this.e,this.sinphi,this.cosphi),this.ml1=Ch(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Fl?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=uu(this.e,this.sinphi,this.cosphi),this.ml2=Ch(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ch(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,r=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var i=Ch(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-i)}var o=this.ns*cu(r-this.long0),a=this.x0+e*Math.sin(o),s=this.y0+this.rh-e*Math.cos(o);return t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;return 0!==r&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere?(i=cu(this.long0+o/this.ns),n=Nh(this.g-r/this.a),t.x=i,t.y=n,t):(n=zh(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=cu(this.long0+o/this.ns),t.x=i,t.y=n,t)},names:["Equidistant_Conic","eqdc"]},tc={init:function(){this.R=this.a},forward:function(t){var e,r,n=t.x,i=t.y,o=cu(n-this.long0);Math.abs(i)<=Fl&&(e=this.x0+this.R*o,r=this.y0);var a=Gh(2*Math.abs(i/Math.PI));(Math.abs(o)<=Fl||Math.abs(Math.abs(i)-Cl)<=Fl)&&(e=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var s=.5*Math.abs(Math.PI/o-o/Math.PI),l=s*s,u=Math.sin(a),h=Math.cos(a),c=h/(u+h-1),f=c*c,p=c*(2/u-1),d=p*p,y=Math.PI*this.R*(s*(c-d)+Math.sqrt(l*(c-d)*(c-d)-(d+l)*(f-d)))/(d+l);o<0&&(y=-y),e=this.x0+y;var g=l+c;return y=Math.PI*this.R*(p*g-s*Math.sqrt((d+l)*(l+1)-g*g))/(d+l),r=i>=0?this.y0+y:this.y0-y,t.x=e,t.y=r,t},inverse:function(t){var e,r,n,i,o,a,s,l,u,h,c,f;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,o=(n=t.x/c)*n+(i=t.y/c)*i,c=3*(i*i/(l=-2*(a=-Math.abs(i)*(1+o))+1+2*i*i+o*o)+(2*(s=a-2*i*i+n*n)*s*s/l/l/l-9*a*s/l/l)/27)/(u=(a-s*s/3/l)/l)/(h=2*Math.sqrt(-u/3)),Math.abs(c)>1&&(c=c>=0?1:-1),f=Math.acos(c)/3,r=t.y>=0?(-h*Math.cos(f+Math.PI/3)-s/3/l)*Math.PI:-(-h*Math.cos(f+Math.PI/3)-s/3/l)*Math.PI,e=Math.abs(n)<Fl?this.long0:cu(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(n*n-i*i)+o*o))/2/n),t.x=e,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},ec={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b,x,w,M=t.x,S=t.y,P=Math.sin(t.y),T=Math.cos(t.y),E=cu(M-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Fl?(t.x=this.x0+this.a*(Cl-S)*Math.sin(E),t.y=this.y0-this.a*(Cl-S)*Math.cos(E),t):Math.abs(this.sin_p12+1)<=Fl?(t.x=this.x0+this.a*(Cl+S)*Math.sin(E),t.y=this.y0+this.a*(Cl+S)*Math.cos(E),t):(_=this.sin_p12*P+this.cos_p12*T*Math.cos(E),v=(g=Math.acos(_))?g/Math.sin(g):1,t.x=this.x0+this.a*v*T*Math.sin(E),t.y=this.y0+this.a*v*(this.cos_p12*P-this.sin_p12*T*Math.cos(E)),t):(e=Oh(this.es),r=Rh(this.es),n=Dh(this.es),i=Fh(this.es),Math.abs(this.sin_p12-1)<=Fl?(o=this.a*Ch(e,r,n,i,Cl),a=this.a*Ch(e,r,n,i,S),t.x=this.x0+(o-a)*Math.sin(E),t.y=this.y0-(o-a)*Math.cos(E),t):Math.abs(this.sin_p12+1)<=Fl?(o=this.a*Ch(e,r,n,i,Cl),a=this.a*Ch(e,r,n,i,S),t.x=this.x0+(o+a)*Math.sin(E),t.y=this.y0+(o+a)*Math.cos(E),t):(s=P/T,l=Bh(this.a,this.e,this.sin_p12),u=Bh(this.a,this.e,P),h=Math.atan((1-this.es)*s+this.es*l*this.sin_p12/(u*T)),m=0===(c=Math.atan2(Math.sin(E),this.cos_p12*Math.tan(h)-this.sin_p12*Math.cos(E)))?Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.abs(Math.abs(c)-Math.PI)<=Fl?-Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.asin(Math.sin(E)*Math.cos(h)/Math.sin(c)),f=this.e*this.sin_p12/Math.sqrt(1-this.es),g=l*m*(1-(b=m*m)*(y=(p=this.e*this.cos_p12*Math.cos(c)/Math.sqrt(1-this.es))*p)*(1-y)/6+(x=b*m)/8*(d=f*p)*(1-2*y)+(w=x*m)/120*(y*(4-7*y)-3*f*f*(1-7*y))-w*m/48*d),t.x=this.x0+g*Math.sin(c),t.y=this.y0+g*Math.cos(c),t))},inverse:function(t){var e,r,n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b,x,w,M;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*Cl*this.a)return;return r=e/this.a,n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(e)<=Fl?a=this.lat0:(a=Gh(i*this.sin_p12+t.y*n*this.cos_p12/e),s=Math.abs(this.lat0)-Cl,o=Math.abs(s)<=Fl?this.lat0>=0?cu(this.long0+Math.atan2(t.x,-t.y)):cu(this.long0-Math.atan2(-t.x,t.y)):cu(this.long0+Math.atan2(t.x*n,e*this.cos_p12*i-t.y*this.sin_p12*n))),t.x=o,t.y=a,t}return l=Oh(this.es),u=Rh(this.es),h=Dh(this.es),c=Fh(this.es),Math.abs(this.sin_p12-1)<=Fl?(a=zh(((f=this.a*Ch(l,u,h,c,Cl))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,l,u,h,c),o=cu(this.long0+Math.atan2(t.x,-1*t.y)),t.x=o,t.y=a,t):Math.abs(this.sin_p12+1)<=Fl?(f=this.a*Ch(l,u,h,c,Cl),a=zh(((e=Math.sqrt(t.x*t.x+t.y*t.y))-f)/this.a,l,u,h,c),o=cu(this.long0+Math.atan2(t.x,t.y)),t.x=o,t.y=a,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),y=Math.atan2(t.x,t.y),p=Bh(this.a,this.e,this.sin_p12),g=Math.cos(y),_=-(v=this.e*this.cos_p12*g)*v/(1-this.es),m=3*this.es*(1-_)*this.sin_p12*this.cos_p12*g/(1-this.es),w=1-_*(x=(b=e/p)-_*(1+_)*Math.pow(b,3)/6-m*(1+3*_)*Math.pow(b,4)/24)*x/2-b*x*x*x/6,d=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*g),o=cu(this.long0+Math.asin(Math.sin(y)*Math.sin(x)/Math.cos(d))),M=Math.sin(d),a=Math.atan2((M-this.es*w*this.sin_p12)*Math.tan(d),M*(1-this.es)),t.x=o,t.y=a,t)},names:["Azimuthal_Equidistant","aeqd"]},rc={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,o,a,s,l=t.x,u=t.y;return n=cu(l-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),((o=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(o)<=Fl)&&(a=1*this.a*r*Math.sin(n),s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a,s;return t.x-=this.x0,t.y-=this.y0,r=Gh((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),n=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(e)<=Fl?(s=this.lat0,t.x=a,t.y=s,t):(s=Gh(i*this.sin_p14+t.y*n*this.cos_p14/e),o=Math.abs(this.lat0)-Cl,Math.abs(o)<=Fl?(a=this.lat0>=0?cu(this.long0+Math.atan2(t.x,-t.y)):cu(this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=s,t):(a=cu(this.long0+Math.atan2(t.x*n,e*this.cos_p14*i-t.y*this.sin_p14*n)),t.x=a,t.y=s,t))},names:["ortho"]},nc=1,ic=2,oc=3,ac=4;function sc(t,e,r,n){var i;return t<Fl?(n.value=nc,i=0):(i=Math.atan2(e,r),Math.abs(i)<=zl?n.value=nc:i>zl&&i<=Cl+zl?(n.value=ic,i-=Cl):i>Cl+zl||i<=-(Cl+zl)?(n.value=oc,i=i>=0?i-jl:i+jl):(n.value=ac,i+=Cl)),i}function lc(t,e){var r=t+e;return r<-jl?r+=Ul:r>+jl&&(r-=Ul),r}var uc={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Cl-zl/2?this.face=5:this.lat0<=-(Cl-zl/2)?this.face=6:Math.abs(this.long0)<=zl?this.face=1:Math.abs(this.long0)<=Cl+zl?this.face=this.long0>0?2:4:this.face=3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,r,n,i,o,a,s={x:0,y:0},l={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,r=t.x,5===this.face)i=Cl-e,r>=zl&&r<=Cl+zl?(l.value=nc,n=r-Cl):r>Cl+zl||r<=-(Cl+zl)?(l.value=ic,n=r>0?r-jl:r+jl):r>-(Cl+zl)&&r<=-zl?(l.value=oc,n=r+Cl):(l.value=ac,n=r);else if(6===this.face)i=Cl+e,r>=zl&&r<=Cl+zl?(l.value=nc,n=-r+Cl):r<zl&&r>=-zl?(l.value=ic,n=-r):r<-zl&&r>=-(Cl+zl)?(l.value=oc,n=-r-Cl):(l.value=ac,n=r>0?-r+jl:-r-jl);else{var u,h,c,f,p,d;2===this.face?r=lc(r,+Cl):3===this.face?r=lc(r,+jl):4===this.face&&(r=lc(r,-Cl)),f=Math.sin(e),p=Math.cos(e),d=Math.sin(r),u=p*Math.cos(r),h=p*d,c=f,1===this.face?n=sc(i=Math.acos(u),c,h,l):2===this.face?n=sc(i=Math.acos(h),c,-u,l):3===this.face?n=sc(i=Math.acos(-u),c,-h,l):4===this.face?n=sc(i=Math.acos(-h),c,u,l):(i=n=0,l.value=nc)}return a=Math.atan(12/jl*(n+Math.acos(Math.sin(n)*Math.cos(zl))-Cl)),o=Math.sqrt((1-Math.cos(i))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===ic?a+=Cl:l.value===oc?a+=jl:l.value===ac&&(a+=1.5*jl),s.x=o*Math.cos(a),s.y=o*Math.sin(a),s.x=s.x*this.a+this.x0,s.y=s.y*this.a+this.y0,t.x=s.x,t.y=s.y,t},inverse:function(t){var e,r,n,i,o,a,s,l,u,h,c,f,p={lam:0,phi:0},d={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?d.value=nc:t.y>=0&&t.y>=Math.abs(t.x)?(d.value=ic,e-=Cl):t.x<0&&-t.x>=Math.abs(t.y)?(d.value=oc,e=e<0?e+jl:e-jl):(d.value=ac,e+=Cl),u=jl/12*Math.tan(e),o=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),a=Math.atan(o),(s=1-(n=Math.cos(e))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?s=-1:s>1&&(s=1),5===this.face)l=Math.acos(s),p.phi=Cl-l,d.value===nc?p.lam=a+Cl:d.value===ic?p.lam=a<0?a+jl:a-jl:d.value===oc?p.lam=a-Cl:p.lam=a;else if(6===this.face)l=Math.acos(s),p.phi=l-Cl,d.value===nc?p.lam=-a+Cl:d.value===ic?p.lam=-a:d.value===oc?p.lam=-a-Cl:p.lam=a<0?-a-jl:-a+jl;else{var y,g,v;u=(y=s)*y,g=(u+=(v=u>=1?0:Math.sqrt(1-u)*Math.sin(a))*v)>=1?0:Math.sqrt(1-u),d.value===ic?(u=g,g=-v,v=u):d.value===oc?(g=-g,v=-v):d.value===ac&&(u=g,g=v,v=-u),2===this.face?(u=y,y=-g,g=u):3===this.face?(y=-y,g=-g):4===this.face&&(u=y,y=g,g=-u),p.phi=Math.acos(-v)-Cl,p.lam=Math.atan2(g,y),2===this.face?p.lam=lc(p.lam,-Cl):3===this.face?p.lam=lc(p.lam,-jl):4===this.face&&(p.lam=lc(p.lam,+Cl))}return 0!==this.es&&(h=p.phi<0?1:0,c=Math.tan(p.phi),f=this.b/Math.sqrt(c*c+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),h&&(p.phi=-p.phi)),p.lam+=this.long0,t.x=p.lam,t.y=p.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},hc=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],cc=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],fc=.8487,pc=1.3523,dc=Nl/5,yc=1/dc,gc=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},vc={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=cu(t.x-this.long0),r=Math.abs(t.y),n=Math.floor(r*dc);n<0?n=0:n>=18&&(n=17);var i={x:gc(hc[n],r=Nl*(r-yc*n))*e,y:gc(cc[n],r)};return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*fc+this.x0,i.y=i.y*this.a*pc+this.y0,i},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*fc),y:Math.abs(t.y-this.y0)/(this.a*pc)};if(e.y>=1)e.x/=hc[18][0],e.y=t.y<0?-Cl:Cl;else{var r=Math.floor(18*e.y);for(r<0?r=0:r>=18&&(r=17);;)if(cc[r][0]>e.y)--r;else{if(!(cc[r+1][0]<=e.y))break;++r}var n=cc[r],i=5*(e.y-n[0])/(cc[r+1][0]-n[0]);i=function(t,e,r,n){for(var i=e;n;--n){var o=t(i);if(i-=o,Math.abs(o)<r)break}return i}((function(t){return(gc(n,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(n,t)}),i,Fl,100),e.x/=gc(hc[r],i),e.y=(5*r+i)*Bl,t.y<0&&(e.y=-e.y)}return e.x=cu(e.x+this.long0),e},names:["Robinson","robin"]},_c={init:function(){this.name="geocent"},forward:function(t){return Au(t,this.es,this.a)},inverse:function(t){return Cu(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},mc={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}},bc={init:function(){if(Object.keys(mc).forEach(function(t){if(void 0===this[t])this[t]=mc[t].def;else{if(mc[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);mc[t].num&&(this[t]=parseFloat(this[t]))}mc[t].degrees&&(this[t]=this[t]*Bl)}.bind(this)),Math.abs(Math.abs(this.lat0)-Cl)<Fl?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<Fl?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,r,n,i,o=Math.sin(t.y),a=Math.cos(t.y),s=Math.cos(t.x);switch(this.mode){case 3:r=this.sinph0*o+this.cosph0*a*s;break;case 2:r=a*s;break;case 1:r=-o;break;case 0:r=o}switch(e=(r=this.pn1/(this.p-r))*a*Math.sin(t.x),this.mode){case 3:r*=this.cosph0*o-this.sinph0*a*s;break;case 2:r*=o;break;case 0:r*=-a*s;break;case 1:r*=a*s}return i=1/((n=r*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-r*this.sg)*this.cw*i,r=n*i,t.x=e*this.a,t.y=r*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,r,n,i={x:t.x,y:t.y};n=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*n,r=this.pn1*t.y*this.cw*n,t.x=e*this.cg+r*this.sg,t.y=r*this.cg-e*this.sg;var o=_h(t.x,t.y);if(Math.abs(o)<Fl)i.x=0,i.y=t.y;else{var a,s;switch(s=1-o*o*this.pfact,s=(this.p-Math.sqrt(s))/(this.pn1/o+o/this.pn1),a=Math.sqrt(1-s*s),this.mode){case 3:i.y=Math.asin(a*this.sinph0+t.y*s*this.cosph0/o),t.y=(a-this.sinph0*Math.sin(i.y))*o,t.x*=s*this.cosph0;break;case 2:i.y=Math.asin(t.y*s/o),t.y=a*o,t.x*=s;break;case 0:i.y=Math.asin(a),t.y=-t.y;break;case 1:i.y=-Math.asin(a)}i.x=Math.atan2(t.x,t.y)}return t.x=i.x+this.long0,t.y=i.y,t},names:["Tilted_Perspective","tpers"]},xc={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,r,n,i,o=t.x,a=t.y;if(o-=this.long0,"ellipse"===this.shape){a=Math.atan(this.radius_p2*Math.tan(a));var s=this.radius_p/_h(this.radius_p*Math.cos(a),Math.sin(a));if(r=s*Math.cos(o)*Math.cos(a),n=s*Math.sin(o)*Math.cos(a),i=s*Math.sin(a),(this.radius_g-r)*r-n*n-i*i*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/_h(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/_h(n,e)))}else"sphere"===this.shape&&(e=Math.cos(a),r=Math.cos(o)*e,n=Math.sin(o)*e,i=Math.sin(a),e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/_h(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/_h(n,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,r,n,i,o=-1,a=0,s=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*_h(1,s)):(a=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*_h(1,a));var l=s/this.radius_p;if(e=a*a+l*l+o*o,(n=(r=2*this.radius_g*o)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),o=this.radius_g+i*o,a*=i,s*=i,t.x=Math.atan2(a,o),t.y=Math.atan(s*Math.cos(t.x)/o),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+s*s)):(a=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+a*a)),e=a*a+s*s+o*o,(n=(r=2*this.radius_g*o)*r-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),o=this.radius_g+i*o,a*=i,s*=i,t.x=Math.atan2(a,o),t.y=Math.atan(s*Math.cos(t.x)/o)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};function wc(t,e,r){if(void 0===r&&(r=!1),!r&&Mc(t))return!0;try{return qu.defs(t,e),!0}catch(t){return!1}}function Mc(t){try{return qu.Proj(t),!0}catch(t){return!1}}function Sc(t,e){var r=qu.Proj(t),n=qu.Proj(e);return function(t){var e=qu.transform(r,n,[t.x,t.y]);return{x:e.x,y:e.y}}}qu.defaultDatum="WGS84",qu.Proj=Iu,qu.WGS84=new qu.Proj("WGS84"),qu.Point=uh,qu.toPoint=Nu,qu.defs=ou,qu.nadgrid=function(t,e){var r=new DataView(e),n=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(r),i=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:Tu(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(r,n);i.nSubgrids;var o=function(t,e,r){for(var n=[],i=0;i<e.nSubgrids;i++){var o=Lu(t,176,r),a=ku(t,176,o,r),s=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),l=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);n.push({ll:[Pu(o.lowerLongitude),Pu(o.lowerLatitude)],del:[Pu(o.longitudeInterval),Pu(o.latitudeInterval)],lim:[s,l],count:o.gridNodeCount,cvs:Eu(a)})}return n}(r,i,n),a={header:i,subgrids:o};return Mu[t]=a,a},qu.transform=Uu,qu.mgrs=$u,qu.version="__VERSION__",function(t){t.Proj.projections.add(gh),t.Proj.projections.add(xh),t.Proj.projections.add(wh),t.Proj.projections.add(Ph),t.Proj.projections.add(Th),t.Proj.projections.add(Eh),t.Proj.projections.add(kh),t.Proj.projections.add(Ih),t.Proj.projections.add(Ah),t.Proj.projections.add(Uh),t.Proj.projections.add(Vh),t.Proj.projections.add(qh),t.Proj.projections.add(Zh),t.Proj.projections.add(Wh),t.Proj.projections.add(Hh),t.Proj.projections.add(Yh),t.Proj.projections.add(Xh),t.Proj.projections.add(Kh),t.Proj.projections.add(Qh),t.Proj.projections.add(Jh),t.Proj.projections.add($h),t.Proj.projections.add(tc),t.Proj.projections.add(ec),t.Proj.projections.add(rc),t.Proj.projections.add(uc),t.Proj.projections.add(vc),t.Proj.projections.add(_c),t.Proj.projections.add(bc),t.Proj.projections.add(xc)}(qu),wc("EPSG:4162",'GEOGCS["Korean 1985",\n        DATUM["Korean_Datum_1985",\n            SPHEROID["Bessel 1841",6377397.155,299.1528128,\n                AUTHORITY["EPSG","7004"]],\n            TOWGS84[-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43],\n            AUTHORITY["EPSG","6162"]],\n        PRIMEM["Greenwich",0,\n            AUTHORITY["EPSG","8901"]],\n        UNIT["degree",0.0174532925199433,\n            AUTHORITY["EPSG","9122"]],\n        AUTHORITY["EPSG","4162"]]');var Pc,Tc=Sc("EPSG:4326","EPSG:3857"),Ec=Sc("EPSG:3857","EPSG:4326"),Lc=Sc("EPSG:4326","EPSG:4162"),kc=Sc("EPSG:4162","EPSG:4326"),Ic=Sc("EPSG:3857","EPSG:4162"),Ac=Sc("EPSG:4162","EPSG:3857"),Cc=Kr(el.BOUNDS),Oc=function(){function t(){this._projectTransform=Tc,this._unprojectTransform=Ec}return t.prototype.project=function(t){var e=t.lng,r=t.lat;return this.normalize(this._projectTransform({x:e,y:r}))},t.prototype.unproject=function(t){var e=this._unprojectTransform(this.toOfficial(t)),r=e.x,n=e.y;return new wl(r,n)},t.prototype.normalize=function(t){return{x:t.x/Cc+.5,y:-t.y/Cc+.5}},t.prototype.toOfficial=function(t){return{x:(t.x-.5)*Cc,y:-(t.y-.5)*Cc}},t}(),Rc=Oc,Dc=function(){function t(){this._projectTransform=Lc,this._unprojectTransform=kc}return t.prototype.project=function(t){var e=t.lng,r=t.lat;return this.normalize(this._projectTransform({x:e,y:r}))},t.prototype.unproject=function(t){var e=this._unprojectTransform(this.toOfficial(t)),r=e.x,n=e.y;return new wl(r,n)},t.prototype.normalize=function(t){return{x:t.x/360+.5,y:-t.y/180+.5}},t.prototype.toOfficial=function(t){return{x:360*(t.x-.5),y:180*-((t.y%1+1)%1-.5)}},t}(),Fc=Dc,Bc=new Rc,Nc=new Fc,zc=function(){function t(t,e){this._tileService=t,this._tileExtent=e,this._worldExtent=Kr(el.BOUNDS)}return t.prototype.convert=function(t,e,r,n){var i=n.base,o=n.width,a=n.height,s=this._tileService.toEpsg3857(t,e,r);return{x:Math.round((s.x-i.x)/o*this.getTileExtent()),y:Math.round((s.y-i.y)/a*this.getTileExtent())}},t.prototype.getTileEnvelope=function(t){var e=this._tileService.toEpsg3857(t),r=this._tileService.toEpsg3857(new Ks(t.z,t.x+1,t.y+1));return{base:e,width:Math.abs(r.x-e.x),height:Math.abs(r.y-e.y)}},t.prototype.getTransformParams=function(t){var e=this.getTileEnvelope(t),r=e.base,n=e.width,i=e.height;return{scale:{x:this._worldExtent/n,y:this._worldExtent/i},translate:Bc.normalize(r)}},t.prototype.getTileExtent=function(){return this._tileExtent},t.prototype.getTileSize=function(){return this._tileService.getMapDefine().getTileSize()},t.prototype.getTileService=function(){return this._tileService},t.prototype.toRelativePoint=function(t,e){var r=this.getTransformParams(t),n=r.scale,i=dn(e,r.translate);return{x:i.x*n.x*this._tileExtent,y:-i.y*n.y*this._tileExtent}},t.prototype.toLngLat=function(t,e){var r=this._tileService.toEpsg4326(t,this._tileExtent,e),n=r.x,i=r.y;return new wl(n,i)},t}(),Uc=zc,jc=function(){function t(t,e){this._tileService=t,this._tileExtent=e}return t.prototype.convert=function(t,e,r,n){var i=n.base,o=n.width,a=n.height,s=this._tileService.toEpsg4162(t,e,r);return{x:Math.round((s.x-i.x)/o*this.getTileExtent()),y:Math.round((s.y-i.y)/a*this.getTileExtent())}},t.prototype.getTileEnvelope=function(t){var e=this._tileService.toEpsg4162(t),r=this._tileService.toEpsg4162(new Ks(t.z,t.x+1,t.y+1));return{base:e,width:Math.abs(r.x-e.x),height:Math.abs(r.y-e.y)}},t.prototype.getTransformParams=function(t){var e=this.getTileEnvelope(t),r=e.base;return{scale:{x:360/e.width,y:180/e.height},translate:Nc.normalize(r)}},t.prototype.getTileExtent=function(){return this._tileExtent},t.prototype.getTileSize=function(){return this._tileService.getMapDefine().getTileSize()},t.prototype.getTileService=function(){return this._tileService},t.prototype.toRelativePoint=function(t,e){var r=this.getTransformParams(t),n=r.scale,i=dn(e,r.translate);return{x:i.x*n.x*this._tileExtent,y:-i.y*n.y*this._tileExtent}},t.prototype.toLngLat=function(t,e){var r=this._tileService.toEpsg4326(t,this._tileExtent,e),n=r.x,i=r.y;return new wl(n,i)},t}(),Vc=jc;t.TileServiceName=void 0,(Pc=t.TileServiceName||(t.TileServiceName={})).GoogleMapVector="GoogleMapVector",Pc.GoogleMapRaster="GoogleMapRaster",Pc.VsmVector="VsmVector",Pc.VsmRaster="VsmRaster",Pc.VsmLegacyVector="VsmLegacyVector",Pc.VsmLegacyRaster="VsmLegacyRaster";var Gc,qc,Zc=function(){function t(t){this._mapDefine=t}return t.prototype.isValidLevel=function(t){return t>=this._mapDefine.getMinLevel()&&t<=this._mapDefine.getMaxLevel()},t.prototype.getTileWidth=function(t){return this._mapDefine.getResolution(t)*this._mapDefine.getTileSize()},t.prototype.getMapDefine=function(){return this._mapDefine},t}(),Wc=function(t){function e(e){var r=t.call(this,sl)||this;return r._raster=e,r}return r(e,t),e.prototype.toEpsg4162=function(t,e,r){return void 0===e&&(e=this.getMapDefine().getTileSize()),void 0===r&&(r=an),Ic(this.toEpsg3857(t,e,r))},e.prototype.toEpsg3857=function(t,e,r){void 0===e&&(e=this.getMapDefine().getTileSize()),void 0===r&&(r=an);var n=this.getTileWidth(t.z);return{x:el.BOUNDS.minX+(t.x+r.x/e)*n,y:el.BOUNDS.maxY-(t.y+1-r.y/e)*n}},e.prototype.toEpsg4326=function(t,e,r){return void 0===e&&(e=this.getMapDefine().getTileSize()),void 0===r&&(r=an),Ec(this.toEpsg3857(t,e,r))},e.prototype.getTileIndex=function(t,e){if(!this.isValidLevel(t))return null;var r=Tc({x:Yt(e.lng,-179.9,179.9),y:e.lat}),n=r.x,i=r.y,o=this.getTileWidth(t);return new Ks(t,Math.floor((n-el.BOUNDS.minX)/o),Math.floor((el.BOUNDS.maxY-i)/o))},e.prototype.getTileIndexBounds=function(t){if(!this.isValidLevel(t))return{minX:0,maxX:-1,minY:0,maxY:-1};var e=Math.pow(2,t)-1;return{minX:0,minY:0,maxX:e,maxY:e}},e.prototype.getLevel=function(t){return Math.trunc(t)},e.prototype.isRaster=function(){return this._raster},e}(Zc),Hc=Wc,Yc=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype.toEpsg4162=function(t,e,r){void 0===e&&(e=this.getMapDefine().getTileSize()),void 0===r&&(r=an);var n=this.getTileWidth(t.z);return{x:(t.x+r.x/e)*n,y:(t.y+r.y/e)*n}},e.prototype.toEpsg3857=function(t,e,r){return void 0===e&&(e=this.getMapDefine().getTileSize()),void 0===r&&(r=an),Ac(this.toEpsg4162(t,e,r))},e.prototype.toEpsg4326=function(t,e,r){return void 0===e&&(e=this.getMapDefine().getTileSize()),void 0===r&&(r=an),kc(this.toEpsg4162(t,e,r))},e.prototype.getTileIndex=function(t,e){if(!this.isValidLevel(t))return null;var r=Lc({x:Yt(e.lng,-179.9,179.9),y:e.lat}),n=r.x,i=r.y,o=this.getTileWidth(t);return new Ks(t,Math.floor(n/o),Math.floor(i/o))},e.prototype.getTileIndexBounds=function(t){if(!this.isValidLevel(t))return{minX:0,maxX:-1,minY:0,maxY:-1};var e=this.getMapDefine().getBounds(),r=this.getTileWidth(t);return{minX:e.minX/r,minY:e.minY/r,maxX:e.maxX/r-1,maxY:e.maxY/r-1}},e}(Zc),Xc=Yc,Kc=function(t){function e(){return t.call(this,ul)||this}return r(e,t),e.prototype.getLevel=function(t){return Xt(Math.trunc(t)-6,this.getMapDefine().getMinLevel(),this.getMapDefine().getMaxLevel())},e.prototype.isRaster=function(){return!0},e}(Xc),Qc=function(t){function e(){return t.call(this,ll)||this}return r(e,t),e.prototype.getLevel=function(t){return Xt(Math.trunc((t-6+1)/2),this.getMapDefine().getMinLevel(),this.getMapDefine().getMaxLevel())},e.prototype.isRaster=function(){return!1},e}(Xc),Jc=function(t){function e(){return t.call(this,!0)||this}return r(e,t),e.prototype.getLevel=function(t){return t<19?Math.trunc(t):19},e}(Hc),$c=function(t){function e(){return t.call(this,!1)||this}return r(e,t),e.prototype.getLevel=function(t){return t<7?5:t<9?7:t<11?9:t<13?11:t<15?13:15},e}(Hc),tf=new Hc(!1),ef=new Hc(!0),rf=new $c,nf=new Jc,of=new Qc,af=new Kc,sf=((Gc={})[t.TileServiceName.GoogleMapVector]=new Uc(tf,Dn),Gc[t.TileServiceName.GoogleMapRaster]=new Uc(ef,Dn),Gc[t.TileServiceName.VsmVector]=new Uc(rf,20480),Gc[t.TileServiceName.VsmRaster]=new Uc(nf,Dn),Gc[t.TileServiceName.VsmLegacyVector]=new Uc(of,20480),Gc[t.TileServiceName.VsmLegacyRaster]=new Uc(af,Dn),Gc);(qc={})[t.TileServiceName.GoogleMapVector]=new Vc(tf,Dn),qc[t.TileServiceName.GoogleMapRaster]=new Vc(ef,Dn),qc[t.TileServiceName.VsmVector]=new Vc(rf,20480),qc[t.TileServiceName.VsmRaster]=new Vc(nf,Dn),qc[t.TileServiceName.VsmLegacyVector]=new Vc(of,20480),qc[t.TileServiceName.VsmLegacyRaster]=new Vc(af,Dn);var lf=sf,uf=function(){function e(t){this._parsed=null,this._vertexParser=null,this._rawVectorTile=t,this._byteBuffer=Et.wrap(t.data,"binary",!0),this._tileAdapter=lf[t.tileServiceName]}return e.prototype.parse=function(){if(this._parsed)return this._parsed;var t=this._byteBuffer;t.readInt32();var e=t.readInt8();t.readInt32();var r=t.readInt16();this._setupVertexParser(e);for(var n=[],i=0;i<r;i++){var o=this._parseStack();o&&n.push(o)}return this._parsed=new vf(this._rawVectorTile,n),this._parsed},e.prototype._getVertexParser=function(){return this._vertexParser||this._setupVertexParser(),this._vertexParser},e.prototype._setupVertexParser=function(t){this._vertexParser=vl.create(t||this._byteBuffer.readInt8(4),this._rawVectorTile.tileId,this._tileAdapter)},e.prototype._parseStack=function(){var t=this._byteBuffer,e=t.readInt32();t.readInt32();for(var r=t.readInt8(),n=t.readInt16(),i=[],o=0;o<n;o++){var a=this._parseFeature(r);a&&i.push(a)}return 0===i.length?null:new gl(e,r,i)},e.prototype._parseFeature=function(t){this._byteBuffer.readInt32();var e=this._parseGeometry(t),r=this._parseProperties();if(!e)return null;var n=e.geometryOffset;return new yl(t,n,r)},e.prototype._parseGeometry=function(e){for(var r,n,i=this._byteBuffer,o=i.offset,s=i.readInt16(),l=[],u=0;u<s;u++)l.push(i.readInt16());var h=this._getVertexParser();try{for(var c=a(l),f=c.next();!f.done;f=c.next()){var p=f.value,d=h.estimateByteLength(p);i.skip(d)}}catch(t){r={error:t}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}var y=i.readInt16();switch(i.skip(2*y),e){case t.VectorTileStackDataType.Point:case t.VectorTileStackDataType.Polyline:case t.VectorTileStackDataType.Polygon:return{geometryOffset:o};default:return null}},e.prototype._parseProperties=function(){var t=this._byteBuffer,e=t.readInt16(),r=t.readBytes(e).toUTF8();return dl.from(r)},e.prototype.loadGeometry=function(e){var r,n,i=this._getVertexParser(),o=e.geometryType,u=e.geometryOffset,h=this._byteBuffer;h.offset=u;for(var c=h.readInt16(),f=[],p=[],d=[],y=0;y<c;y++)d.push(h.readInt16());try{for(var g=a(d),v=g.next();!v.done;v=g.next()){var _=v.value,m=i.parse(h,_);p.push({start:f.length,end:f.length+m.length}),f.push.apply(f,l([],s(m),!1))}}catch(t){r={error:t}}finally{try{v&&!v.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}var b=h.readInt16();switch(h.skip(2*b),o){case t.VectorTileStackDataType.Point:return new Wr(f);case t.VectorTileStackDataType.Polyline:return new Hr(f,p);case t.VectorTileStackDataType.Polygon:return new Yr(f,[p]);default:throw new At}},e}(),hf=uf;function cf(t){for(var e=t.length,r=0,n=0;n<e;n++){var i=t[n],o=t[(n+1)%e];r+=(o.x-i.x)*(i.y+o.y)}return r}function ff(t){return t<0}var pf=function(){function e(t){this._parsed=null,this._rawVectorTile=t,this._pbf=new Ye(this._rawVectorTile.data)}return e.prototype.parse=function(){var t=this;if(this._parsed)return this._parsed;var e=this._pbf.readFields((function(e,r){if(3===e){var n=t._parseStack();n&&(null==r||r.push(n))}}),[],this._pbf.length);return this._parsed=new vf(this._rawVectorTile,e),this._parsed},e.prototype._parseStack=function(){var t,e,r=this,n=this._pbf,i=n.readVarint()+n.pos,o=n.readFields((function(t,e){1===t?e.stackId=n.readString():2===t?e.featurePositions.push(n.pos):3===t?e.keys.push(n.readString()):4===t?e.values.push(r._readValue(n)):5===t?e.tileExtent=n.readVarint():15===t&&(e.version=n.readVarint())}),{featurePositions:[],keys:[],values:[]},i),s=o.stackId,l=o.featurePositions,u=o.keys,h=o.values,c=o.tileExtent,f={keys:u,values:h},p=n.pos,d=[];try{for(var y=a(l),g=y.next();!g.done;g=y.next()){var v=g.value;n.pos=v;var _=this._parseFeature(f,c);_&&d.push(_)}}catch(e){t={error:e}}finally{try{g&&!g.done&&(e=y.return)&&e.call(y)}finally{if(t)throw t.error}}return n.pos=p,new gl(s,d[0].geometryType,d)},e.prototype._readValue=function(t){var e=t.readVarint()+t.pos;if(t.pos<e)switch(t.readVarint()>>3){case 1:return t.readString();case 2:return t.readFloat();case 3:return t.readDouble();case 4:return t.readVarint64();case 5:return t.readVarint();case 6:return t.readSVarint();case 7:t.readBoolean();default:return null}},e.prototype._parseFeature=function(t,e){var r=this,n=this._pbf,i=n.readVarint()+n.pos,o=n.readFields((function(e,i){1===e?i.id=n.readVarint():2===e?i.properties=r._parseProperties(t):3===e?i.geometryType=n.readVarint():4===e&&(i.geometryOffset=n.pos)}),{},i),a=o.geometryType,s=o.geometryOffset,l=o.properties;return new yl(a,s,l,e)},e.prototype._parseProperties=function(t){for(var e=this._pbf,r=e.readVarint()+e.pos,n={};e.pos<r;){var i=t.keys[e.readVarint()],o=t.values[e.readVarint()];i&&(n[i]=o)}return new dl(n)},e.prototype.loadGeometry=function(r){var n,i,o=r.geometryType,u=r.geometryOffset,h=r.tileExtent,c=this._pbf;c.pos=u;for(var f=c.readVarint()+c.pos,p=1,d=0,y=0,g=0,v=null,_=[];c.pos<f;){if(d<=0){var m=c.readVarint();p=7&m,d=m>>3}if(d--,1===p||2===p)y+=c.readSVarint(),g+=c.readSVarint(),1===p&&(v&&_.push(v),v=[]),null==v||v.push({x:y,y:g});else{if(7!==p)throw new Error("Unknown command ".concat(p));v&&v.push(t.__assign({},v[0]))}}switch(v&&_.push(v),o){case t.VectorTileStackDataType.Point:var b=e._concat(_,h).vertices;return new Wr(b);case t.VectorTileStackDataType.Polyline:var x=e._concat(_,h),w=(b=x.vertices,x.partRanges);return new Hr(b,w);case t.VectorTileStackDataType.Polygon:var M=[],S=[],P=function(t){t.forEach((function(t){return t.reverse()}));var r=M.length,n=e._concat(t,h),i=n.vertices,o=n.partRanges;M.push.apply(M,l([],s(i),!1)),S.push(o.map((function(t){return{start:t.start+r,end:t.end+r}})))};try{for(var T=a(function(t){var e,r;if(t.length<=1)return[t];var n,i,o=[];try{for(var s=a(t),l=s.next();!l.done;l=s.next()){var u=l.value,h=cf(u);if(0!==h){var c=ff(h);void 0===i&&(i=c),c===i?(n&&o.push(n),n=[u]):null==n||n.push(u)}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return n&&o.push(n),o}(_)),E=T.next();!E.done;E=T.next())P(E.value)}catch(t){n={error:t}}finally{try{E&&!E.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}return new Yr(M,S);default:return console.warn({message:"No valid geometryType found",lines:_}),new Xr}},e._concat=function(t,e){var r,n,i,o,s=[],l=[];try{for(var u=a(t),h=u.next();!h.done;h=u.next()){var c=h.value;l.push({start:s.length,end:s.length+c.length});try{for(var f=(i=void 0,a(c)),p=f.next();!p.done;p=f.next()){var d=p.value;s.push(this._convertVertex(d,e))}}catch(t){i={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return{vertices:s,partRanges:l}},e._convertVertex=function(t,e){var r=t.x,n=t.y;return{x:r/e*Dn,y:(1-n/e)*Dn}},e}(),df=pf,yf=function(){function e(t){this._parsed=null,this._vertexParser=null,this._rawVectorTile=t,this._byteBuffer=Et.wrap(t.data,"binary",!0),this._tileAdapter=lf[t.tileServiceName]}return e.prototype.parse=function(){if(this._parsed)return this._parsed;var t=this._byteBuffer;t.readInt32();var e=t.readInt8();t.readInt32();var r=this._parseIndexedProperties(),n=t.readInt16();this._setupVertexParser(e);for(var i=[],o=0;o<n;o++){var a=this._parseStack(r);a&&i.push(a)}return this._parsed=new vf(this._rawVectorTile,i),this._parsed},e.prototype._getVertexParser=function(){return this._vertexParser||this._setupVertexParser(),this._vertexParser},e.prototype._setupVertexParser=function(t){this._vertexParser=vl.create(t||this._byteBuffer.readInt8(4),this._rawVectorTile.tileId,this._tileAdapter)},e.prototype._parseIndexedProperties=function(){var t=this._byteBuffer;t.readInt32();for(var e=t.readUint8(),r=[],n=0;n<e;n++){var i=t.readUint8(),o=t.readBytes(i).toUTF8();r.push(o)}var a=t.readUint16(),s=[];for(n=0;n<a;n++){i=t.readUint8();var l=t.readBytes(i).toUTF8();s.push(l)}return{keys:r,values:s}},e.prototype._parseStack=function(t){var e=this._byteBuffer,r=e.readInt32();e.readInt32();for(var n=e.readInt8(),i=e.readInt16(),o=[],a=0;a<i;a++){var s=this._parseFeature(n,t);s&&o.push(s)}return 0===o.length?null:new gl(r,n,o)},e.prototype._parseFeature=function(t,e){this._byteBuffer.readInt32();var r=this._parseGeometry(t),n=this._parseProperties(e);if(!r)return null;var i=r.geometryOffset;return new yl(t,i,n)},e.prototype._parseGeometry=function(e){for(var r,n,i=this._byteBuffer,o=i.offset,s=i.readInt16(),l=[],u=0;u<s;u++)l.push(i.readInt16());var h=this._getVertexParser();try{for(var c=a(l),f=c.next();!f.done;f=c.next()){var p=f.value,d=h.estimateByteLength(p);i.skip(d)}}catch(t){r={error:t}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}switch(e){case t.VectorTileStackDataType.Point:case t.VectorTileStackDataType.Polyline:case t.VectorTileStackDataType.Polygon:return{geometryOffset:o};default:return null}},e.prototype._parseProperties=function(t){var e=this._byteBuffer;e.readInt16();for(var r=e.readUint8(),n={},i=0;i<r;i++){var o=e.readUint8(),a=e.readUint16(),s=t.keys[o],l=t.values[a];s&&(n[s]=l)}return new dl(n)},e.prototype.loadGeometry=function(e){var r,n,i=this._getVertexParser(),o=e.geometryType,u=e.geometryOffset,h=this._byteBuffer;h.offset=u;for(var c=h.readInt16(),f=[],p=[],d=[],y=0;y<c;y++)d.push(h.readInt16());try{for(var g=a(d),v=g.next();!v.done;v=g.next()){var _=v.value,m=i.parse(h,_);p.push({start:f.length,end:f.length+m.length}),f.push.apply(f,l([],s(m),!1))}}catch(t){r={error:t}}finally{try{v&&!v.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}switch(o){case t.VectorTileStackDataType.Point:return new Wr(f);case t.VectorTileStackDataType.Polyline:return new Hr(f,p);case t.VectorTileStackDataType.Polygon:return new Yr(f,[p]);default:throw new At("No valid geometryType found")}},e}(),gf=yf,vf=function(t){function e(e,r){var n=t.call(this)||this;return n._parser=null,n._rawVectorTile=e,n._stacks=r.reduce((function(t,e){return t[e.getStackId()]=e,t}),{}),n}return r(e,t),e.parse=function(t){var e=this._createParser(t);if(!e)throw new It;return e.parse()},e._createParser=function(t){switch(t.format){case"vsm2":case"vsm4":return new hf(t);case"vsm8":return new gf(t);case"mvt":case"geojson":case"ld1":return new df(t);default:return null}},Object.defineProperty(e.prototype,"rawVectorTile",{get:function(){return this._rawVectorTile},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileId",{get:function(){return this._rawVectorTile.tileId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stacks",{get:function(){return Object.values(this._stacks)},enumerable:!1,configurable:!0}),e.prototype.getStack=function(t){return this._stacks[t]},e.prototype.loadGeometry=function(t){return this._getParser().loadGeometry(t)},e.prototype._getParser=function(){if(!this._parser&&(this._parser=e._createParser(this._rawVectorTile),!this._parser))throw new It;return this._parser},e.prototype.getSerializeName=function(){return e.SERIALIZE_NAME},e.serialize=function(t,e){var r=e.serialize(t._rawVectorTile),n=e.serialize(Object.values(t._stacks));return{data:{rawVectorTile:r.data,stacks:n.data},transferable:l([],s(r.transferable),!1)}},e.deserialize=function(t,r){return new e(r.deserialize(t.rawVectorTile),r.deserialize(t.stacks))},e.SERIALIZE_NAME="RefinedVectorTile",e}(mt),_f=function(){function t(){this._dictionary=[],this._index={},this._byteBuffer=Et.allocate(Et.DEFAULT_CAPACITY),this._size=0}return t.prototype.add=function(t,e,r){this._byteBuffer.writeUint16(this._computeIfAbsent(t)).writeUint16(e).writeUint16(this._computeIfAbsent(r)),this._size++},t.prototype._computeIfAbsent=function(t){var e=this._index[t];return e||(e=this._dictionary.length,this._dictionary.push(t),this._index[t]=e),e},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.build=function(){return this._byteBuffer.flip(),new Lt(Bn(this._byteBuffer),this._size,this._dictionary)},t}(),mf=xf,bf=3;function xf(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],e=i[1],r=i[2],this.d=e+2*r;for(var o=0;o<this.d*this.d;o++){var a=i[bf+o],s=i[bf+o+1];n.push(a===s?null:i.subarray(a,s))}var l=i[bf+n.length],u=i[bf+n.length+1];this.keys=i.subarray(l,u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var h=0;h<this.d*this.d;h++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}xf.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},xf.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xf.prototype._insertCell=function(t,e,r,n,i,o){this.cells[i].push(o)},xf.prototype.query=function(t,e,r,n,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,n,this._queryCell,s,{},i),s},xf.prototype._queryCell=function(t,e,r,n,i,o,a,s){var l=this.cells[i];if(null!==l)for(var u=this.keys,h=this.bboxes,c=0;c<l.length;c++){var f=l[c];if(void 0===a[f]){var p=4*f;(s?s(h[p+0],h[p+1],h[p+2],h[p+3]):t<=h[p+2]&&e<=h[p+3]&&r>=h[p+0]&&n>=h[p+1])?(a[f]=!0,o.push(u[f])):a[f]=!1}}},xf.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),h=this._convertToCellCoord(r),c=this._convertToCellCoord(n),f=l;f<=h;f++)for(var p=u;p<=c;p++){var d=this.d*p+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(p),this._convertFromCellCoord(f+1),this._convertFromCellCoord(p+1)))&&i.call(this,t,e,r,n,d,o,a,s))return}},xf.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},xf.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},xf.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=bf+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[bf+a]=o,i.set(s,o),o+=s.length}return i[bf+t.length]=o,i.set(this.keys,o),o+=this.keys.length,i[bf+t.length+1]=o,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var wf=c(mf),Mf=function(t){function e(e,r,n,i){var o=t.call(this)||this;o._extent=e,o._disabled=r;var a=r?0:Math.trunc((e-.01)/512)+1;return o._gridIndex=n||new wf(e,a,0),o._idCollectionBuilder=new _f,o._idCollection=i||new Lt(new ArrayBuffer(0),0,[]),o}return r(e,t),e.prototype.add=function(t,e,r,n){if(!this._disabled){var i=this._idCollectionBuilder.size;this._idCollectionBuilder.add(e,r,n),t.minX<=this._extent&&t.minY<=this._extent&&t.maxX>0&&t.maxY>0&&this._gridIndex.insert(i,t.minX,t.minY,t.maxX,t.maxY)}},e.prototype.build=function(){this._idCollection=this._idCollectionBuilder.build()},e.prototype.query=function(t,e){var r,n;if(this._disabled)return[];var i=this._gridIndex.query(t.minX,t.minY,t.maxX,t.maxY,e),o=[];try{for(var s=a(i.sort((function(t,e){return e-t}))),l=s.next();!l.done;l=s.next()){var u=l.value,h=this._idCollection.getFeatureId(u);o.push(h)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},e.prototype.getSerializeName=function(){return e.SERIALIZE_NAME},e.serialize=function(t,e){var r=t._gridIndex.toArrayBuffer(),n=e.serialize(t._idCollection);return{data:{extent:t._extent,disabled:t._disabled,gridIndex:r,idCollection:n.data},transferable:l([r],s(n.transferable),!1)}},e.deserialize=function(t,r){return new e(t.extent,t.disabled,new wf(t.gridIndex),r.deserialize(t.idCollection))},e.SERIALIZE_NAME="VectorTileFeatureIndex",e}(mt),Sf=Mf,Pf=function(){function t(e,r,n){void 0===n&&(n={}),this._width=0,this._height=0,this._filter=null,this._minFilter=null,this._wrap=null,this._context=e,this._texture=t._createTexture(e),r&&this.update(r,n)}return t.createEmptyBoundTexture=function(e,r,n,i,o){void 0===i&&(i=0),void 0===o&&(o=e.gl.RGBA);var a=new t(e,null),s=e.gl;return a.bind({filter:s.LINEAR,wrap:s.CLAMP_TO_EDGE,activeUnit:i}),s.texImage2D(s.TEXTURE_2D,0,o,r,n,0,o,s.UNSIGNED_BYTE,null),a},t._createTexture=function(t){var e=t.gl.createTexture();if(!e)throw new Ct("Could not create texture");return e},t.prototype.update=function(e,r,n){void 0===r&&(r={});var i=this._context.gl,o=t.getSize(e),a=o.width,s=o.height,l=!n&&(a!==this._width||s!==this.height);if(i.bindTexture(i.TEXTURE_2D,this._texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!(e instanceof xe&&e.getFormat(i)!==i.RGBA)),l)if(this._width=a,this._height=s,e instanceof xe){var u=e.getFormat(i);i.texImage2D(i.TEXTURE_2D,0,u,e.getWidth(),e.getHeight(),0,u,i.UNSIGNED_BYTE,e.getData())}else i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e);else{var h=n||{x:0,y:0},c=h.x,f=h.y;e instanceof xe?(u=e.getFormat(i),i.texSubImage2D(i.TEXTURE_2D,0,c,f,a,s,u,i.UNSIGNED_BYTE,e.getData())):i.texSubImage2D(i.TEXTURE_2D,0,c,f,i.RGBA,i.UNSIGNED_BYTE,e)}r.useMipmap&&t._isPowerOfTwo(this._width,this._height)&&i.generateMipmap(i.TEXTURE_2D)},t.getSize=function(t){return t instanceof xe?{width:t.getWidth(),height:t.getHeight()}:t},t._isPowerOfTwo=function(t,e){return t===e&&(r=t,Number.isInteger(Math.log(r)/Math.LN2));var r},t.prototype.getGLTexture=function(){return this._texture},t.prototype.bind=function(t){if(this._texture){var e=this._context.gl,r=t.filter,n=t.minFilter,i=void 0===n?r:n,o=t.wrap,a=t.activeUnit,s=void 0===a?0:a;e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,this._texture),r!==this._filter&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),this._filter=r),i!==this._minFilter&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),this._minFilter=i),o!==this._wrap&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o),this._wrap=o)}},t.prototype.destroy=function(){this._texture&&(this._context.gl.deleteTexture(this._texture),this._texture=null)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t}(),Tf=Pf,Ef=function(t){function e(e,r){var n=t.call(this)||this;return n._glyphAtlasTexture=null,n._iconAtlasTexture=null,n._patternAtlasTexture=null,n._vectorTile=e,n._featureIndex=r.featureIndex,n._queryPadding=r.queryPadding,n._glyphAtlasImage=r.glyphAtlasImage,n._iconAtlasImage=r.iconAtlasImage,n._patternAtlasImage=r.patternAtlasImage,n._responseBodySize=r.responseBodySize,n}return r(e,t),Object.defineProperty(e.prototype,"vectorTile",{get:function(){return this._vectorTile},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"featureIndex",{get:function(){return this._featureIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"queryPadding",{get:function(){return this._queryPadding},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"glyphAtlasImage",{get:function(){return this._glyphAtlasImage},enumerable:!1,configurable:!0}),e.prototype.getGlyphAtlasTexture=function(t){return this._glyphAtlasTexture},Object.defineProperty(e.prototype,"iconAtlasImage",{get:function(){return this._iconAtlasImage},enumerable:!1,configurable:!0}),e.prototype.getIconAtlasTexture=function(t){return this._iconAtlasTexture},Object.defineProperty(e.prototype,"patternAtlasImage",{get:function(){return this._patternAtlasImage},enumerable:!1,configurable:!0}),e.prototype.getPatternAtlasTexture=function(t){return this._patternAtlasTexture},e.prototype.prepare=function(t){this._loadGlyphAtlasTexture(t),this._loadIconAtlasTexture(t),this._loadPatternAtlasTexture(t)},e.prototype._loadGlyphAtlasTexture=function(t){!this._glyphAtlasTexture&&this._glyphAtlasImage&&(this._glyphAtlasTexture=new Tf(t,this._glyphAtlasImage),this._glyphAtlasImage=null)},e.prototype._loadIconAtlasTexture=function(t){!this._iconAtlasTexture&&this._iconAtlasImage&&(this._iconAtlasTexture=new Tf(t,this._iconAtlasImage),this._iconAtlasImage=null)},e.prototype._loadPatternAtlasTexture=function(t){!this._patternAtlasTexture&&this._patternAtlasImage&&(this._patternAtlasTexture=new Tf(t,this._patternAtlasImage),this._patternAtlasImage=null)},e.prototype.getTileInfo=function(){return{responseBodySize:this._responseBodySize,rawData:this._vectorTile.rawVectorTile.data}},e.prototype.destroy=function(){this._glyphAtlasTexture&&(this._glyphAtlasTexture.destroy(),this._glyphAtlasTexture=null),this._iconAtlasTexture&&(this._iconAtlasTexture.destroy(),this._iconAtlasTexture=null),this._patternAtlasTexture&&(this._patternAtlasTexture.destroy(),this._patternAtlasTexture=null)},e.prototype.getSerializeName=function(){return"VectorTileCompositeData"},e}(mt),Lf=function(t){function e(e,r,n){return t.call(this,e,r,4,n)||this}return r(e,t),e.prototype.clone=function(){return new e(this.getWidth(),this.getHeight(),new Uint8Array(this.getData()))},e.prototype.getFormat=function(t){return t.RGBA},e.prototype.getSerializeName=function(){return"RgbaImage"},e}(xe),kf=new Mt;kf.registerPrototype(te.prototype),kf.registerPrototype(Bt.prototype),kf.registerPrototype(Zs.prototype),kf.registerPrototype(Gs.prototype),kf.registerPrototype(js.prototype),kf.registerPrototype(zs.prototype),kf.registerPrototype(Ks.prototype),kf.registerPrototype(Ys.prototype),kf.registerPrototype(Qe.prototype),kf.registerPrototype(Ns.prototype),kf.registerPrototype(ci.prototype),kf.registerPrototype(Mo.prototype),kf.registerPrototype(ko.prototype),kf.registerPrototype(Ro.prototype),kf.registerPrototype(re.prototype),kf.registerPrototype(Fo.prototype),kf.registerPrototype(ts.prototype),kf.registerPrototype(as.prototype),kf.registerPrototype(fe.prototype),kf.registerPrototype(Cs.prototype),kf.registerPrototype(Je.prototype),kf.registerPrototype(Ws.prototype),kf.registerPrototype(Ef.prototype),kf.registerPrototype(bi.prototype),kf.registerPrototype(wi.prototype),kf.registerPrototype(Ga.prototype),kf.registerPrototype(oi.prototype),kf.registerPrototype(Da.prototype),kf.registerPrototype(Ha.prototype),kf.registerPrototype(is.prototype),kf.registerPrototype(he.prototype),kf.registerPrototype(Es.prototype),kf.registerPrototype(ii.prototype),kf.registerTypeAdapter(Aa.SERIALIZE_NAME,{serialize:Aa.serialize,deserialize:Aa.deserialize}),kf.registerTypeAdapter(ws.SERIALIZAE_NAME,{serialize:ws.serialize,deserialize:ws.deserialize}),kf.registerPrototype(dl.prototype),kf.registerPrototype(Wr.prototype),kf.registerPrototype(Hr.prototype),kf.registerPrototype(Yr.prototype),kf.registerPrototype(yl.prototype),kf.registerPrototype(gl.prototype),kf.registerPrototype(Qs.prototype),kf.registerTypeAdapter(vf.SERIALIZE_NAME,{serialize:vf.serialize,deserialize:vf.deserialize}),kf.registerTypeAdapter(Sf.SERIALIZE_NAME,{serialize:Sf.serialize,deserialize:Sf.deserialize}),kf.registerTypeAdapter(Lt.SERIALIZE_NAME,{serialize:Lt.serialize,deserialize:Lt.deserialize}),kf.registerPrototype(Fn.prototype),kf.registerPrototype(ei.prototype),kf.registerPrototype(Jn.prototype),kf.registerPrototype(ye.prototype),kf.registerPrototype(we.prototype),kf.registerPrototype(Lf.prototype),kf.registerPrototype(ne.prototype),kf.registerPrototype(ie.prototype),kf.registerPrototype(oe.prototype),kf.registerPrototype(de.prototype),kf.registerPrototype(Ke.prototype);var If,Af=new Error("request for lock canceled"),Cf=function(){function t(t,e){void 0===e&&(e=Af),this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}return t.prototype.acquire=function(t){var e=this;if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(r,n){e._weightedQueues[t-1]||(e._weightedQueues[t-1]=[]),e._weightedQueues[t-1].push({resolve:r,reject:n}),e._dispatch()}))},t.prototype.runExclusive=function(t,e){return void 0===e&&(e=1),i(this,void 0,void 0,(function(){var r,n,i;return o(this,(function(o){switch(o.label){case 0:return[4,this.acquire(e)];case 1:r=o.sent(),n=r[0],i=r[1],o.label=2;case 2:return o.trys.push([2,,4,5]),[4,t(n)];case 3:return[2,o.sent()];case 4:return i(),[7];case 5:return[2]}}))}))},t.prototype.waitForUnlock=function(t){var e=this;if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(r){e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),e._weightedWaiters[t-1].push(r),e._dispatch()}))},t.prototype.isLocked=function(){return this._value<=0},t.prototype.getValue=function(){return this._value},t.prototype.setValue=function(t){this._value=t,this._dispatch()},t.prototype.release=function(t){if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));this._value+=t,this._dispatch()},t.prototype.cancel=function(){var t=this;this._weightedQueues.forEach((function(e){return e.forEach((function(e){return e.reject(t._cancelError)}))})),this._weightedQueues=[]},t.prototype._dispatch=function(){for(var t,e=this._value;e>0;e--){var r=null===(t=this._weightedQueues[e-1])||void 0===t?void 0:t.shift();if(r){var n=this._value,i=e;this._value-=e,e=this._value+1,r.resolve([n,this._newReleaser(i)])}}this._drainUnlockWaiters()},t.prototype._newReleaser=function(t){var e=this,r=!1;return function(){r||(r=!0,e.release(t))}},t.prototype._drainUnlockWaiters=function(){for(var t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach((function(t){return t()})),this._weightedWaiters[t-1]=[])},t}(),Of=Cf,Rf=function(){function t(t){this._semaphore=new Of(1,t)}return t.prototype.acquire=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._semaphore.acquire()];case 1:return[2,t.sent()[1]]}}))}))},t.prototype.runExclusive=function(t){return this._semaphore.runExclusive((function(){return t()}))},t.prototype.isLocked=function(){return this._semaphore.isLocked()},t.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},t.prototype.release=function(){this._semaphore.isLocked()&&this._semaphore.release()},t.prototype.cancel=function(){return this._semaphore.cancel()},t}(),Df=Rf;!function(t){t.ScheduledTaskCancelled="ScheduledTaskCancelled"}(If||(If={}));var Ff=If;let Bf;const Nf=new Uint8Array(16);function zf(){if(!Bf&&(Bf="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Bf))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Bf(Nf)}const Uf=[];for(let t=0;t<256;++t)Uf.push((t+256).toString(16).slice(1));var jf={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},Vf=function(){function t(){this._aborted=!1}return t.prototype.setCommand=function(t){this._command=t},t.prototype.abort=function(){var t;null===(t=this._command)||void 0===t||t.execute(),this._aborted=!0},t.prototype.isAborted=function(){return this._aborted},t}(),Gf=Vf;function qf(t,e){var r,n,i,o,s,l,u,h,c,f=[],p=function(t){return e&&(t=e(t)),[t.x,t.y]};if(t instanceof Wr){c="Point";try{for(var d=a(t.getVertices()),y=d.next();!y.done;y=d.next()){var g=p(y.value);f.push(g)}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}else if(t instanceof Hr){c="LineString";try{for(var v=a(t.getPartRanges()),_=v.next();!_.done;_=v.next()){var m=_.value,b=t.getVertices().slice(m.start,m.end).map(p);f.push(b)}}catch(t){i={error:t}}finally{try{_&&!_.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}}else{if(!(t instanceof Yr))throw new Error("Invalid geometry");c="Polygon";try{for(var x=a(t.getMultiPartRanges()),w=x.next();!w.done;w=x.next()){var M=w.value,S=[];try{for(var P=(u=void 0,a(M)),T=P.next();!T.done;T=P.next()){m=T.value;var E=t.getVertices().slice(m.start,m.end).map(p);S.push(E)}}catch(t){u={error:t}}finally{try{T&&!T.done&&(h=P.return)&&h.call(P)}finally{if(u)throw u.error}}f.push(S)}}catch(t){s={error:t}}finally{try{w&&!w.done&&(l=x.return)&&l.call(x)}finally{if(s)throw s.error}}}return f.length>1?c="Multi".concat(c):f=f[0],{type:c,coordinates:f}}t.AbstractStructArrayBuilder=jn,t.AlphaImage=we,t.BASE_FOV=.6435011087932844,t.BufferedLineStackStyleData=ci,t.BuildingStackStyleData=Mo,t.CircleStackStyleData=ko,t.ConfigError=It,t.CrosswalkStackStyleData=Ro,t.DEFAULT_ALIGN_X=ar,t.DEFAULT_ALIGN_Y="mid",t.DEFAULT_BUFFER=0,t.DEFAULT_FILL_COLOR=nr,t.DEFAULT_FILL_OPACITY=1,t.DEFAULT_FONT_LINE_HEIGHT=30,t.DEFAULT_FONT_SIZE=10,t.DEFAULT_FONT_STACK=$o,t.DEFAULT_FONT_WEIGHT=400,t.DEFAULT_GLOBAL_VARIABLES={fontScale:1,iconScale:1,enlargeScaleFactor:2,customStyleProperties:{}},t.DEFAULT_LABEL_STROKE_COLOR=or,t.DEFAULT_LABEL_STROKE_OPACITY=1,t.DEFAULT_LABEL_STROKE_WIDTH=0,t.DEFAULT_MAX_PREPARATION_TIME_PER_FRAME=18,t.DEFAULT_OFFSET=0,t.DEFAULT_SDF_SIZE=24,t.DEFAULT_STROKE_COLOR=ir,t.DEFAULT_STROKE_OPACITY=1,t.DEFAULT_STROKE_WIDTH=0,t.DEFAULT_TILE_EXTENT=Dn,t.DEFAULT_TILE_SIZE=256,t.DEFAULT_WALL_COLOR=[128/255,128/255,128/255,1],t.DEFAULT_WALL_OPACITY=.5,t.DUMMY=sn,t.DUMMY_STACKS_SPEC=[{id:-1,name:"empty_stack",priority:1}],t.DefaultAbortInvoker=Gf,t.DefaultGlyphPathFactory=de,t.EARTH_RADIUS_APPROXIMATION=6371e3,t.EmptyTileCompositeData=Ws,t.Event=et,t.EventEmitter=rt,t.GeometryConversionType=sr,t.GoogleMap=el,t.IconId=ye,t.InitializeError=Ct,t.Layer=te,t.LineStackStyleData=Fo,t.LinesIndexArrayBuilder=gi,t.LngLat=wl,t.MAX_PLACEMENT_TIME_PER_FRAME=3,t.MapError=kt,t.MapWorkerErrorMessage=Ff,t.MappedGlyphPathFactory=Ke,t.Mutex=Df,t.PlacementOpacityArrayBuilder=ra,t.PoiOffsetArrayBuilder=ca,t.PoiStackStyleData=ts,t.PolygonStackStyleData=as,t.PositionArrayBuilder=Co,t.PositionLayout=Io,t.PreparedTileData=Ys,t.RasterStyleData=fe,t.RawVectorTile=Qs,t.RefinedVectorTile=vf,t.RgbaImage=Lf,t.RoadNameStackStyleData=Cs,t.SegmentArray=ei,t.Serializable=mt,t.SingleStyleDataMap=Qe,t.SourceError=At,t.Stack=Bt,t.StackStyle=js,t.StackStyleDataMap=Ns,t.StaticTypes=Vn,t.Style=Zs,t.TRANSPARENT_COLOR=[0,0,0,0],t.Texture=Tf,t.TileId=Ks,t.TrianglesIndexArrayBuilder=Yn,t.VSM_LEGACY_TILE_LEVEL_GAP=6,t.VectorRenderable=ri,t.VectorTileCompositeData=Ef,t.VectorTileFeatureIndex=Sf,t.VectorTileProperties=dl,t.__awaiter=i,t.__extends=r,t.__generator=o,t.__read=s,t.__rest=n,t.__spreadArray=l,t.__values=a,t.add=pn,t.add$1=un,t.ajax=ut,t.angle=function(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)},t.angleWithX=function(t){return Math.atan2(t.y,t.x)},t.browser=dr,t.calcStandardDeviation=function(t){return Math.sqrt(function(t){var e=Kt(t);return Kt(t.map((function(t){return(r=t-e)*r;var r})))}(t))},t.clamp=Xt,t.comparePoi=Bo,t.computeIfAbsent=function(t,e,r){var n=t[e];if(n)return n;var i=r(e);return i&&(t[e]=i),i},t.computeIfAbsent$1=tt,t.createLayout=Gn,t.cubicBezier=function(t,e,r,n){var i=Wt(t,e,r,n);return function(t){return i(t)}},t.define=wc,t.deserialize=function(t){return kf.deserialize(t)},t.distance=cn,t.divide=gn,t.dot=vn,t.epsg3857ToEpsg4326=Ec,t.epsg4326ToEpsg3857=Tc,t.equals=ln,t.expandBy=function(t,e,r){return void 0===r&&(r=e),{minX:t.minX-e,minY:t.minY-r,maxX:t.maxX+e,maxY:t.maxY+r}},t.expandToInclude=tn,t.fetchLayer=function(e,r){return i(this,void 0,void 0,(function(){var n,i,a,s,l,u;return o(this,(function(o){switch(o.label){case 0:return e.uri?(i=Dt(e),[4,ut.callJson(i,r)]):[3,3];case 1:if(!nt(a=o.sent()))throw new It("Failed loading layer : ".concat(i));return s=a.body,l=[t.__assign({},e)],u={},[4,Rt(s,r)];case 2:return delete(n=t.__assign.apply(void 0,l.concat([(u.config=o.sent(),u)]))).uri,[3,4];case 3:if(!Ot(e,"config"))throw new It("Invalid layer format : ".concat(e.id));n=e,o.label=4;case 4:return[2,n]}}))}))},t.fetchResourcePackage=function(e,r){return i(this,void 0,void 0,(function(){var n,i,a;return o(this,(function(o){switch(o.label){case 0:return e.uri?(i=Dt(e),[4,ut.callJson(i,r)]):[3,2];case 1:if(!nt(a=o.sent()))throw new It("Failed loading style : ".concat(i));return delete(n=t.__assign(t.__assign({},e),{config:a.body})).uri,[3,3];case 2:if(!Ot(e,"config"))throw new It("Invalid resource package format : ".concat(e.id));n=e,o.label=3;case 3:return[2,n]}}))}))},t.fetchSetting=function(e,r){return i(this,void 0,void 0,(function(){var n,i,a;return o(this,(function(o){switch(o.label){case 0:return e.uri?(i=Dt(e),[4,ut.callJson(i,r)]):[3,2];case 1:if(!nt(a=o.sent()))throw new It("Failed loading style : ".concat(i));return delete(n=t.__assign(t.__assign({},e),{config:a.body})).uri,[3,3];case 2:if(!Ot(e,"config"))throw new It("Invalid setting format : ".concat(e.id));n=e,o.label=3;case 3:return[2,n]}}))}))},t.fetchStyleBundle=function(e,r){return i(this,void 0,void 0,(function(){var n,i,a;return o(this,(function(o){switch(o.label){case 0:return e.uri?(i=Dt(e),[4,ut.callJson(i,r)]):[3,2];case 1:if(!nt(a=o.sent()))throw new It("Failed loading style : ".concat(i));return delete(n=t.__assign(t.__assign({},e),{config:a.body})).uri,[3,3];case 2:if(!Ot(e,"config"))throw new It("Invalid style format : ".concat(e.id));n=e,o.label=3;case 3:return[2,n]}}))}))},t.flatMap=$,t.genGradient=function(t,e,r){for(var n=hr(t).map((function(t){return 255*t})),i=hr(e).map((function(t){return 255*t})),o=[],a=1/(r-1),s=0;s<r;s++){var l=1-a*s,u=[(n[0]*l+(1-l)*i[0])/255,(n[1]*l+(1-l)*i[1])/255,(n[2]*l+(1-l)*i[2])/255,(n[3]*l+(1-l)*i[3])/255];o.push(u)}return o},t.getBounds=on,t.getCenter=function(t){return{x:(t.minX+t.maxX)/2,y:(t.minY+t.maxY)/2}},t.getColorAndOpacity=function(t,e){var r=s(hr(t),4);return{color:[r[0],r[1],r[2],1],opacity:r[3]*gr(e)}},t.getDefaultExportFromCjs=c,t.getDensity=_r,t.getDiagonalLength=function(t){var e=Kr(t),r=Qr(t);return Math.sqrt(e*e+r*r)},t.getFontWeight=function(t,e){return void 0===e&&(e=400),(Xt(yr(t,e),100,900)-400)/100},t.getGeometryConversionType=function(t,e){if("jpeg"===e.getSourceSpec().format)return He.TileBackground;if("image"===e.getSourceSpec().format)return He.Image;if(!t||!t.getGeometryType())return He.Invalid;var r=t.getGeometryType(),n=t.getProperties();if(n.visibility&&"string"==typeof n.visibility&&"true"!==n.visibility.toLowerCase())return He.Invalid;switch(r.toUpperCase()){case"POLYGON":return n.bda?He.Building:He.Polygon;case"LINE":return n.trafficLine?He.TrafficLine:n.buffer?He.BufferedLine:n.poi?He.RoadName:n.crosswalk?He.Crosswalk:He.Line;case"POINT":if(n.poi===Jt.Background||n.uturn||n.oneway)return He.BackgroundPoi;if(n.poi)return He.Poi;if(n.circle)return He.Circle;if(n.heatmap)return He.Heatmap;default:return He.Invalid}},t.getHeight=Qr,t.getIntDigitLength=function(t){return"".concat(Math.floor(t)).length},t.getLineDensity=function(){return 1},t.getOrDefault=function(t,e,r){if(!Ot(t,e))return r;var n=t[e];return null!=n?n:r},t.getPoiQuadBBox=na,t.getRotationAlignment=Ur,t.getVersionedUrl=Dt,t.getVsmLegacyStyleLevel=function(t){return Xt(Math.trunc(t)-6,0,12)},t.getVsmStyleLevel=function(t){return Xt(Math.trunc(t),6,18)},t.getWidth=Kr,t.googleMap=sl,t.googleMapProjector=Bc,t.hasProperty=Ot,t.interpolate=function(t,e,r){return(1-r)*t+r*e},t.intersection=function(t,e){return en(t,e)?{minX:Math.max(t.minX,e.minX),maxX:Math.min(t.maxX,e.maxX),minY:Math.max(t.minY,e.minY),maxY:Math.min(t.maxY,e.maxY)}:Jr()},t.intersects=en,t.isCounterClockWise=function(t){return ff(cf(t))},t.isDefined=Mc,t.isDisplayOff=br,t.isNum=function(t){return"number"==typeof t},t.isPoiConversionType=function(t){return t===He.Poi||t===He.BackgroundPoi},t.isValidStatus=nt,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.magnitude=_n,t.merge=function(t,e){var r,n,i,o;void 0===e&&(e=!1);var l={};try{for(var u=a(t),h=u.next();!h.done;h=u.next()){var c=h.value;try{for(var f=(i=void 0,a(Object.entries(c))),p=f.next();!p.done;p=f.next()){var d=s(p.value,2),y=d[0],g=d[1];!e&&y in l||(void 0!==g?l[y]=g:delete l[y])}}catch(t){i={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return l},t.multiply=yn,t.newEmpty=Jr,t.normalize=mn,t.notEmpty=function(t){return null!=t},t.now=pr,t.parseSdf=function(t){var e,r,n,i,o=_e.read(new Ye(t)),s={};try{for(var l=a(o.stacks),u=l.next();!u.done;u=l.next()){var h=u.value;try{for(var c=(n=void 0,a(h.glyphs)),f=c.next();!f.done;f=c.next()){var p=f.value,d=p.id,y=p.bitmap,g=p.left,v=p.top,_=p.width,m=p.height,b=p.advance;s[d]={id:d,bitmap:new we(_+6,m+6,y),metrics:{left:g,top:v,width:_,height:m,advance:b}}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return s},t.pbf=Se,t.performanceNowExports=fr,t.perpendicular=xn,t.polygonIntersectsBBox=function(t,e){var r,n,i,o;try{for(var s=a(t),l=s.next();!l.done;l=s.next())if(rn(e,l.value))return!0}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}var u=nn(e);try{for(var h=a(u),c=h.next();!c.done;c=h.next())if(Mn(t,c.value))return!0}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}for(var f=1;f<t.length;f++)if(Pn(t[f-1],t[f],u))return!0;return!1},t.prepareArrayTransform=function(t,e){var r=qu.Proj(t),n=qu.Proj(e);return function(t){var e=qu.transform(r,n,t);return[e.x,e.y]}},t.prepareTransform=Sc,t.rotate=bn,t.serialize=function(t){return kf.serialize(t)},t.sigmoid=function(t){return 1/(1+Math.exp(-t))},t.subtract=dn,t.tileAdapters=lf,t.toArray=vr,t.toBBox=function(t,e){return{minX:t.x,maxX:e.x,minY:t.y,maxY:e.y}},t.toDegree=function(t){return t/Math.PI*180},t.toFloat=gr,t.toGLColor=hr,t.toGeoJsonFeature=function(t,e,r){var n,i,o={};try{for(var l=a(t.properties.entries()),u=l.next();!u.done;u=l.next()){var h=s(u.value,2),c=h[0],f=h[1];o[c]=f}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return{type:"Feature",geometry:qf(e,r),properties:o}},t.toGeoJsonFeatureCollection=function(t){return{type:"FeatureCollection",features:t}},t.toInt=yr,t.toInt32=function(t){return 0|t},t.toPoints=nn,t.toPolygon=function(t){var e=nn(t);return e.push(e[0]),e},t.toRadian=Ht,t.transformGeoJsonGeometry=function e(r,n){switch(r.type){case"Point":return t.__assign(t.__assign({},r),{coordinates:n(r.coordinates)});case"MultiPoint":case"LineString":return t.__assign(t.__assign({},r),{coordinates:r.coordinates.map(n)});case"MultiLineString":case"Polygon":return t.__assign(t.__assign({},r),{coordinates:r.coordinates.map((function(t){return t.map(n)}))});case"MultiPolygon":return t.__assign(t.__assign({},r),{coordinates:r.coordinates.map((function(t){return t.map((function(t){return t.map(n)}))}))});case"GeometryCollection":return t.__assign(t.__assign({},r),{geometries:r.geometries.map((function(t){return e(t,n)}))})}},t.unique=function(t){return Array.from(new Set(t))},t.uniqueKey=function(t,e){for(var r=new Map,n=0;n<t.length;n++){var i=t[n];r.set(e(i,n,t),i)}return Array.from(r.values())},t.v4=function(t,e,r){if(jf.randomUUID&&!e&&!t)return jf.randomUUID();const n=(t=t||{}).random||(t.rng||zf)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=n[t];return e}return function(t,e=0){return(Uf[t[e+0]]+Uf[t[e+1]]+Uf[t[e+2]]+Uf[t[e+3]]+"-"+Uf[t[e+4]]+Uf[t[e+5]]+"-"+Uf[t[e+6]]+Uf[t[e+7]]+"-"+Uf[t[e+8]]+Uf[t[e+9]]+"-"+Uf[t[e+10]]+Uf[t[e+11]]+Uf[t[e+12]]+Uf[t[e+13]]+Uf[t[e+14]]+Uf[t[e+15]]).toLowerCase()}(n)},t.valueOf=function(t){return Array.isArray(t)?{x:t[0],y:t[1]}:t},t.wrap=Yt})),t.type="deps";t.type,t.name,t.dependencies;const e=t.factory;let r;!function(t,e){r={dependencies:t,factory:e}}(["./CommonModule"],(function(t){var e=function(){function t(){}return t.prototype.onAdd=function(t){},t.prototype.onRemove=function(t){},t}();function n(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null);var n=window.document.createElement(t);return e&&(n.className=e),r&&r.appendChild(n),n}function i(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null);var n=(new DOMParser).parseFromString(t,"image/svg+xml").querySelector("svg");return n?(e&&n.setAttribute("class",e),r&&r.appendChild(n),n):null}function o(t,e,r){return void 0===e&&(e=400),void 0===r&&(r=300),t?{width:t.clientWidth||e,height:t.clientHeight||r}:{width:0,height:0}}function a(t,e,r){var n=window.devicePixelRatio;t.width=n*e,t.height=n*r,t.style.width="".concat(e,"px"),t.style.height="".concat(r,"px")}function s(t,e,r,n){t.addEventListener(e,r,n)}function l(t,e,r,n){t.removeEventListener(e,r,n)}function u(t){s(t.target,t.type,t.handler,t.options)}function h(t){l(t.target,t.type,t.handler,t.options)}function c(t,e){var r=e.clientX,n=e.clientY,i=t.getBoundingClientRect();return{x:r-i.left-t.clientLeft,y:n-i.top-t.clientTop}}function f(t,e){return c(t,e)}function p(t,e){return c(t,e)}function d(t,e){return c(t,e.touches[0])}function y(t){return window.TouchEvent&&t instanceof window.TouchEvent}function g(t){return t.parentNode?t.parentNode.removeChild(t):null}function v(t,e){return window.getComputedStyle(t).getPropertyValue(e)}function _(e,r){var n,i;if(r)try{for(var o=t.__values(Object.entries(r)),a=o.next();!a.done;a=o.next()){var s=t.__read(a.value,2),l=s[0],u=s[1];e.style[l]=u}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}function m(t){var e,r,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(r=m(t[e]))&&(n&&(n+=" "),n+=r);else for(e in t)t[e]&&(n&&(n+=" "),n+=e);return n}function b(){for(var t,e,r=0,n="";r<arguments.length;)(t=arguments[r++])&&(e=m(t))&&(n&&(n+=" "),n+=e);return n}var x,w=function(e){function r(t){void 0===t&&(t={});var r=e.call(this)||this;return r._container=n("div",b("vsm-control",{"vsm-interactive":t.interactive})),r}return t.__extends(r,e),r.prototype.createDom=function(t){return this._container},r.prototype.getContainer=function(){return this._container},r}(e),M=function(e){function r(t){var r=e.call(this,{interactive:!0})||this;r._onClick=function(){};var i=t.onClick,o=t.style,a=t.className,s=t.disabled,l=t.innerText,u=t.innerHTML,h=n("div","vsm-contents-wrap",r.getContainer()),c=n("div","vsm-button-frame",h),f=n("button",b("vsm-button",a),c);return _(f,o),f.type="button",f.disabled=Boolean(s),f.innerText=l||"",u&&(f.innerHTML=u),r._button=f,r._clickHandler=i,r._defaultDisabled=f.disabled,r}return t.__extends(r,e),r.prototype.onAdd=function(t){var e=this;this._onClick=function(r){return e._clickHandler&&e._clickHandler(r,t)},s(this._button,"click",this._onClick)},r.prototype.onRemove=function(t){l(this._button,"click",this._onClick),this._onClick=function(){}},r.prototype.getButton=function(){return this._button},r.prototype.isDefaultDisabled=function(){return this._defaultDisabled},r}(w),S={size:"30px"},P=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this,o=t.merge([t.__assign({},r),S],!1),a=o.className,s=o.style,l=o.svgProps,u=void 0===l?{}:l,h=o.size,c=u.svgText,f=void 0===c?'<svg version="1.1" viewBox="0 0 20 20" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">\n<g transform="scale(.042728)">\n\t<g>\n\t\t<polygon points="104.22 0 0 0 0 104.22 32.514 104.22 32.514 32.514 104.22 32.514"/>\n\t\t<polygon points="363.86 32.514 435.56 32.514 435.56 104.22 468.08 104.22 468.08 0 363.86 0"/>\n\t\t<polygon points="104.22 435.56 32.514 435.56 32.514 363.86 0 363.86 0 468.08 104.22 468.08"/>\n\t\t<polygon points="363.86 468.08 468.08 468.08 468.08 363.86 435.56 363.86 435.56 435.56 363.86 435.56"/>\n\t\t<circle cx="234.04" cy="234.04" r="20.809"/>\n\t</g>\n</g>\n</svg>':c,p=u.className,d=u.style,y=n.getContainer();a&&y.classList.add(a),_(y,s),y.style.position="absolute",y.style.top="50%",y.style.left="50%",y.style.transform="translate(-50%, -50%)",y.style.width=h,y.style.height=h;var g=i(f,b("vsm-icon","vsm-center-pointer",p),y);return g&&_(g,d),n}return t.__extends(r,e),r}(w),T=P,E=function(e){function r(r){var n=this,o=r.svgProps,a=void 0===o?{}:o,s=t.__rest(r,["svgProps"]);n=e.call(this,s)||this;var l=a.svgText,u=a.className,h=a.style;return n._svg=l?i(l,u,n.getButton()):null,n._svg&&_(n._svg,h),n}return t.__extends(r,e),r.prototype.getSvg=function(){return this._svg},r}(M),L=E;!function(t){t.Click="Click",t.DoubleClick="DoubleClick",t.MouseDown="MouseDown",t.MouseUp="MouseUp",t.MouseMove="MouseMove",t.MouseOver="MouseOver",t.MouseOut="MouseOut",t.ContextMenu="ContextMenu",t.Wheel="Wheel",t.TouchStart="TouchStart",t.TouchMove="TouchMove",t.TouchEnd="TouchEnd",t.TouchCancel="TouchCancel",t.LongTap="LongTap",t.MoveStart="MoveStart",t.Move="Move",t.MoveEnd="MoveEnd",t.DragStart="DragStart",t.Drag="Drag",t.DragEnd="DragEnd",t.ZoomStart="ZoomStart",t.Zoom="Zoom",t.ZoomEnd="ZoomEnd",t.RotateStart="RotateStart",t.Rotate="Rotate",t.RotateEnd="RotateEnd",t.PitchStart="PitchStart",t.Pitch="Pitch",t.PitchEnd="PitchEnd",t.Resize="Resize",t.Render="Render",t.Idle="Idle",t.FirstPaint="FirstPaint",t.RenderComplete="RenderComplete",t.Data="Data",t.SourceLoad="SourceLoad",t.ConfigLoad="ConfigLoad",t.StyleLoad="StyleLoad",t.Destroy="Destroy",t.Error="Error",t.ContextLost="ContextLost",t.LimitOptionsChanged="LimitOptionsChanged"}(x||(x={}));var k=new Set([x.TouchStart,x.TouchMove,x.MoveStart,x.Move,x.DragStart,x.Drag,x.ZoomStart,x.Zoom,x.RotateStart,x.Rotate,x.PitchStart,x.Pitch]),I=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this;n._onRotate=function(){};var i=r.svgProps,o=void 0===i?{}:i,a=t.__rest(r,["svgProps"]),s=o.svgText,l=void 0===s?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <polygon transform="matrix(.84211 0 0 .98489 1.5789 1.0151)" points="14 9 6 9 10 1"/>\n <g transform="matrix(.84211 0 0 .80808 1.5789 2)">\n  <polygon transform="matrix(0 -.375 .375 0 .125 13.75)" points="14 9 6 9 10 1"/>\n  <polygon transform="matrix(0 .375 -.375 0 19.875 6.25)" points="10 1 14 9 6 9"/>\n  <path d="m10 3c-3.85 0-7 3.15-7 7s3.15 7 7 7 7-3.15 7-7-3.15-7-7-7zm0 12.687c-3.15 0-5.6875-2.5375-5.6875-5.6875s2.5375-5.6875 5.6875-5.6875 5.6875 2.5375 5.6875 5.6875-2.5375 5.6875-5.6875 5.6875z" stroke-width="0"/>\n  <polygon transform="matrix(-.375 0 0 -.375 13.75 20.175)" points="14 9 6 9 10 1"/>\n </g>\n</svg>':s,u=o.className,h=t.__rest(o,["svgText","className"]);return n._buttonControl=new L(t.__assign({onClick:function(t,e){e.getCamera().resetNorth({duration:500})},svgProps:t.__assign({className:b("vsm-icon","vsm-compass",u),svgText:l},h)},a)),n}return t.__extends(r,e),r.prototype.createDom=function(t){return this._buttonControl.createDom(t)},r.prototype.onAdd=function(t){var e=this;this._buttonControl.onAdd(t);var r=function(){var r=e._buttonControl.getSvg();r&&(r.style.transform="rotateZ(".concat(-t.getCamera().getBearing(),"deg)"))};r(),this._onRotate=r,t.on(x.Rotate,this._onRotate)},r.prototype.onRemove=function(t){this._buttonControl.onRemove(t),t.off(x.Rotate,this._onRotate),this._onRotate=function(){}},r}(e),A=I,C=function(e){function r(r){var n,o;void 0===r&&(r={});var a=this,s=r.svgPropsMap,l=void 0===s?{}:s,u=r.selectedName,h=void 0===u?null:u,c=t.__rest(r,["svgPropsMap","selectedName"]);(a=e.call(this,c)||this)._svgMap={};try{for(var f=t.__values(Object.entries(l)),p=f.next();!p.done;p=f.next()){var d=t.__read(p.value,2),y=d[0],g=d[1],v=g.svgText,m=g.className,b=g.style;if(v){var x=i(v,m);x&&_(x,b),a._svgMap[y]=x}else a._svgMap[y]=null}}catch(t){n={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}return a._selectedName=h,a.select(h),a}return t.__extends(r,e),r.prototype.select=function(t){if(this.deselect(),t){var e=this._svgMap[t];e&&this.getButton().appendChild(e),this._selectedName=t}},r.prototype.deselect=function(){var t=this.getSelectedSvg();t&&g(t),this._selectedName=null},r.prototype.getSelectedName=function(){return this._selectedName},r.prototype.getSvgMap=function(){return this._svgMap},r.prototype.getSelectedSvg=function(){return this._selectedName?this._svgMap[this._selectedName]:null},r}(M),O=C,R={exports:{}};
/*!
        * screenfull
        * v5.2.0 - 2021-11-03
        * (c) Sindre Sorhus; MIT License
        */!function(t){!function(){var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},r=t.exports,n=function(){for(var t,r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,i=r.length,o={};n<i;n++)if((t=r[n])&&t[1]in e){for(n=0;n<t.length;n++)o[r[0][n]]=t[n];return o}return!1}(),i={change:n.fullscreenchange,error:n.fullscreenerror},o={request:function(t,r){return new Promise(function(i,o){var a=function(){this.off("change",a),i()}.bind(this);this.on("change",a);var s=(t=t||e.documentElement)[n.requestFullscreen](r);s instanceof Promise&&s.then(a).catch(o)}.bind(this))},exit:function(){return new Promise(function(t,r){if(this.isFullscreen){var i=function(){this.off("change",i),t()}.bind(this);this.on("change",i);var o=e[n.exitFullscreen]();o instanceof Promise&&o.then(i).catch(r)}else t()}.bind(this))},toggle:function(t,e){return this.isFullscreen?this.exit():this.request(t,e)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,r){var n=i[t];n&&e.addEventListener(n,r,!1)},off:function(t,r){var n=i[t];n&&e.removeEventListener(n,r,!1)},raw:n};n?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(e[n.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[n.fullscreenEnabled])}}}),r?t.exports=o:window.screenfull=o):r?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()}(R);var D=R.exports,F=t.getDefaultExportFromCjs(D),B=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this;n._onChange=function(){};var i=r.enterSvgProps,o=void 0===i?{}:i,a=r.exitSvgProps,s=void 0===a?{}:a,l=t.__rest(r,["enterSvgProps","exitSvgProps"]),u=o.svgText,h=void 0===u?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <path d="m5.7143 11.714h-1.7142v4.2857h4.2857v-1.7142h-2.5714zm-1.7142-3.4285h1.7142v-2.5714h2.5714v-1.7142h-4.2857zm10.286 5.9999h-2.5714v1.7142h4.2857v-4.2857h-1.7142zm-2.5714-10.286v1.7142h2.5714v2.5714h1.7142v-4.2857z" stroke-width="0"/>\n</svg>':u,c=o.className,f=t.__rest(o,["svgText","className"]),p=s.svgText,d=void 0===p?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <path d="m4.0001 13.429h2.5714v2.5714h1.7143v-4.2856h-4.2857zm2.5714-6.8572h-2.5714v1.7142h4.2857v-4.2856h-1.7143zm5.1428 9.4282h1.7143v-2.5714h2.5714v-1.7142h-4.2857zm1.7143-9.4282v-2.5714h-1.7143v4.2856h4.2857v-1.7142z" stroke-width="0"/>\n</svg>':p,y=s.className,g=t.__rest(s,["svgText","className"]);return n._buttonControl=new O(t.__assign({onClick:function(t,e){F.isEnabled&&F.toggle(e.getContainer())},svgPropsMap:{Enter:t.__assign({svgText:h,className:b("vsm-icon","vsm-full-screen-enter",c)},f),Exit:t.__assign({svgText:d,className:b("vsm-icon","vsm-full-screen-exit",y)},g)}},l)),n._buttonControl.getButton().disabled=n._buttonControl.isDefaultDisabled()||!F.isEnabled,n}return t.__extends(r,e),r.prototype.createDom=function(t){return this._buttonControl.createDom(t)},r.prototype.onAdd=function(t){var e=this;if(this._buttonControl.onAdd(t),F.isEnabled){var r=function(){F.isEnabled&&F.isFullscreen?e._buttonControl.select("Exit"):e._buttonControl.select("Enter")};r(),this._onChange=r,F.on("change",this._onChange)}},r.prototype.onRemove=function(t){this._buttonControl.onRemove(t),F.isEnabled&&(F.off("change",this._onChange),this._onChange=function(){})},r.prototype.isFullScreen=function(){return F.isEnabled&&F.isFullscreen},r}(e),N=B;function z(t,e,r){var i=void 0===t?{}:t,o=i.style;void 0===e&&(e=null),void 0===r&&(r=!1);var a=n("div",b("vsm-control-dock",i.className,{"vsm-nested":r}),e);return _(a,o),a}function U(t){return!!t&&(t instanceof e||t.createDom&&"function"==typeof t.createDom&&t.onAdd&&"function"==typeof t.onAdd&&t.onRemove&&"function"==typeof t.onRemove)}var j=function(e){function r(t){var r=e.call(this)||this,i=t.controls,o=t.className,a=t.style;r._controls=i.filter(U);var s=r.getContainer();s.classList.add("vsm-group");var l=n("div","vsm-contents-wrap",s),u=n("div",o,l);return _(u,a),r._contents=u,r}return t.__extends(r,e),r.prototype.createDom=function(e){var r,n;try{for(var i=t.__values(this._controls),o=i.next();!o.done;o=i.next()){var a=o.value.createDom(e);this._contents.appendChild(a)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return this.getContainer()},r.prototype.onAdd=function(e){var r,n;try{for(var i=t.__values(this._controls),o=i.next();!o.done;o=i.next())o.value.onAdd(e)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},r.prototype.onRemove=function(e){var r,n;try{for(var i=t.__values(this._controls),o=i.next();!o.done;o=i.next())o.value.onRemove(e)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},r.prototype.getControls=function(){return this._controls},r}(w),V=j,G=function(e){function r(t){var r=e.call(this,t)||this;return n("div","vsm-contents-wrap",r.getContainer()).appendChild(t.contents),r._contents=t.contents,r}return t.__extends(r,e),r.prototype.getContents=function(){return this._contents},r}(w),q=function(e){function r(t){var r=e.call(this)||this,i=t.control,o=t.className,a=t.style,s=n("div",o,r.getContainer());return _(s,a),r._contentsWrap=s,r._control=i,r}return t.__extends(r,e),r.from=function(e,n){return new r(t.__assign({control:e},n))},r.fromStyle=function(t,e){return r.from(t,{style:e})},r.fromClass=function(t,e){return r.from(t,{className:e})},r.prototype.createDom=function(t){var e=this._control.createDom(t);return this._contentsWrap.appendChild(e),this.getContainer()},r.prototype.onAdd=function(t){this._control.onAdd(t)},r.prototype.onRemove=function(t){this._control.onRemove(t)},r.prototype.getControl=function(){return this._control},r}(w);function Z(t,e){var r=t.x,n=t.y;return"".concat(r.toFixed(e),", ").concat(n.toFixed(e))}var W=function(t){return Z(t,7)},H=W,Y=function(t){return Z(t,2)},X=function(e){function r(r){var i,o,a=e.call(this,{interactive:!0})||this;a._transformedCoordinates={},a._onChangeCheckbox=function(){},a._onMouseMove=function(){},a._onMouseDown=function(){};var s=r||{},l=s.className,u=s.style,h=s.lngLatFormat,c=void 0===h?H:h,f=s.epsg3857Format,p=void 0===f?Y:f,d=s.crsList,y=void 0===d?[]:d,g=s.titleProps,v=void 0===g?{}:g,m=s.propertyContainerProps,x=void 0===m?{}:m,w=s.propertyNameProps,M=void 0===w?{}:w,S=s.propertyValueProps,P=void 0===S?{}:S,T=v.text,E=void 0===T?"Mouse Point":T,L=n("div","vsm-contents-wrap",a.getContainer()),k=n("div",b("vsm-info-frame",l),L);_(k,u);var I=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=n("div","vsm-info-row",k);t.forEach((function(t){return r.appendChild(t)}))},A=n("div",b("vsm-info-title",v.className));_(A,v.style),A.innerText=E;var C=n("input","vsm-mouse-point-checkbox");C.id="capture-on-right-click",C.type="checkbox",C.checked=!1,a._checkbox=C;var O=n("label");O.htmlFor="capture-on-right-click",O.innerText="Capture on right click",I(A,C,O);var R=function(t){var e=n("div",b("vsm-info-property",x.className));_(e,x.style),I(e);var r=n("div",b("vsm-info-property-name",M.className),e);_(r,M.style),r.innerText=t;var i=n("div",b("vsm-info-property-value",P.className),e);return _(i,P.style),i};a._transformedCoordinates.LngLat={element:R("LngLat"),transform:function(t){return t},format:c},a._transformedCoordinates["EPSG:3857"]={element:R("EPSG:3857"),transform:t.epsg4326ToEpsg3857,format:p};try{for(var D=t.__values(y),F=D.next();!F.done;F=D.next()){var B=F.value,N=B.code,z=B.wkt,U=B.format;(!z||t.isDefined(N)||t.define(N,z))&&(a._transformedCoordinates[N]={element:R(N),transform:t.prepareTransform("EPSG:4326",N),format:U||W})}}catch(t){i={error:t}}finally{try{F&&!F.done&&(o=D.return)&&o.call(D)}finally{if(i)throw i.error}}return a}return t.__extends(r,e),r.prototype.onAdd=function(e){var r=this,n=function(e){var n,i,o=e.lng,a=e.lat;try{for(var s=t.__values(Object.values(r._transformedCoordinates)),l=s.next();!l.done;l=s.next()){var u=l.value,h=u.transform,c=u.element,f=u.format;c.innerText=f(h({x:o,y:a}))}}catch(t){n={error:t}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}};this._onMouseMove=function(t){var e=t.data;return n(e.lngLat)},this._onMouseDown=function(t){var e=t.data;return 2===e.domEvent.button&&n(e.lngLat)};var i=function(t){t?(e.off(x.MouseMove,r._onMouseMove),e.on(x.MouseDown,r._onMouseDown)):(e.off(x.MouseDown,r._onMouseDown),e.on(x.MouseMove,r._onMouseMove))};i(this._checkbox.checked),this._onChangeCheckbox=function(t){return i(t.target.checked)},s(this._checkbox,"change",this._onChangeCheckbox)},r.prototype.onRemove=function(t){l(this._checkbox,"change",this._onChangeCheckbox),t.off(x.MouseMove,this._onMouseMove),t.off(x.MouseDown,this._onMouseDown),this._onChangeCheckbox=function(){},this._onMouseMove=function(){},this._onMouseDown=function(){}},r}(w),K=X,Q={disableOnMapMove:!0,positionOptions:{enableHighAccuracy:!1,timeout:2e4,maximumAge:0},animationOptions:{}},J=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this;n._watchId=null,n._state="Off",n._onDeviceOrientation=function(){};var i=t.merge([t.__assign({},r),Q],!1),o=i.disableOnMapMove,a=i.positionOptions,s=i.animationOptions,l=i.offSvgProps,u=void 0===l?{}:l,h=i.watchPositionSvgProps,c=void 0===h?{}:h,f=i.watchPositionAndHeadingSvgProps,p=void 0===f?{}:f,d=t.__rest(i,["disableOnMapMove","positionOptions","animationOptions","offSvgProps","watchPositionSvgProps","watchPositionAndHeadingSvgProps"]),y=u.svgText,g=void 0===y?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <g>\n  <path d="m14.876 9.4545c-0.2509-2.2745-2.0564-4.0799-4.3309-4.3309v-1.1236h-1.0909v1.1236c-2.2745 0.25091-4.0799 2.0564-4.3309 4.3309h-1.1236v1.0909h1.1236c0.25091 2.2745 2.0564 4.0799 4.3309 4.3309v1.1236h1.0909v-1.1236c2.2745-0.25091 4.0799-2.0564 4.3309-4.3309h1.1236v-1.0909zm-4.8763 4.3636c-2.1081 0-3.8181-1.71-3.8181-3.8181 0-2.1081 1.71-3.8181 3.8181-3.8181 2.1081 0 3.8181 1.71 3.8181 3.8181 0 2.1081-1.71 3.8181-3.8181 3.8181z" stroke-width="0"/>\n  <path d="m11.066 10.024c1.7038 0.40714 0.85188 0.20357 0 0zm1.2433-0.25167c-0.11577-1.0495-0.94883-1.8825-1.9983-1.9983h-0.50336c-1.0495 0.11577-1.8825 0.94883-1.9983 1.9983v0.50336c0.11577 1.0495 0.94883 1.8825 1.9983 1.9983h0.50336c1.0495-0.11577 1.8825-0.94883 1.9983-1.9983zm-2.25 2.0134c-0.97272 0-1.7617-0.789-1.7617-1.7617 0-0.97272 0.78901-1.7617 1.7617-1.7617 0.97272 0 1.7617 0.789 1.7617 1.7617 0 0.97272-0.789 1.7617-1.7617 1.7617z" stroke-width="0"/>\n </g>\n</svg>':y,v=u.className,_=t.__rest(u,["svgText","className"]),m=c.svgText,x=void 0===m?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <g>\n  <path d="m10 7.8182c-1.2055 0-2.1818 0.97638-2.1818 2.1818 0 1.2055 0.97638 2.1818 2.1818 2.1818 1.2055 0 2.1818-0.97638 2.1818-2.1818 0-1.2055-0.97638-2.1818-2.1818-2.1818zm4.8763 1.6363c-0.2509-2.2745-2.0564-4.0799-4.3309-4.3309v-1.1236h-1.0909v1.1236c-2.2745 0.25091-4.0799 2.0564-4.3309 4.3309h-1.1236v1.0909h1.1236c0.25091 2.2745 2.0564 4.0799 4.3309 4.3309v1.1236h1.0909v-1.1236c2.2745-0.25091 4.0799-2.0564 4.3309-4.3309h1.1236v-1.0909zm-4.8763 4.3636c-2.1081 0-3.8181-1.71-3.8181-3.8181 0-2.1081 1.71-3.8181 3.8181-3.8181s3.8181 1.71 3.8181 3.8181c0 2.1081-1.71 3.8181-3.8181 3.8181z" stroke-width="0"/>\n  <rect transform="rotate(-90)" x="-17.5" y="5" width="1" height="10" opacity=".969" stroke-width="0"/>\n </g>\n</svg>':m,w=c.className,M=t.__rest(c,["svgText","className"]),S=p.svgText,P=void 0===S?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <g>\n  <path d="m10 10 5-8h-10z" stroke-width="0"/>\n  <path d="m10 7.8182c-1.2055 0-2.1818 0.97638-2.1818 2.1818 0 1.2055 0.97638 2.1818 2.1818 2.1818 1.2055 0 2.1818-0.97638 2.1818-2.1818 0-1.2055-0.97638-2.1818-2.1818-2.1818zm4.8763 1.6363c-0.2509-2.2745-2.0564-4.0799-4.3309-4.3309v-1.1236h-1.0909v1.1236c-2.2745 0.25091-4.0799 2.0564-4.3309 4.3309h-1.1236v1.0909h1.1236c0.25091 2.2745 2.0564 4.0799 4.3309 4.3309v1.1236h1.0909v-1.1236c2.2745-0.25091 4.0799-2.0564 4.3309-4.3309h1.1236v-1.0909zm-4.8763 4.3636c-2.1081 0-3.8181-1.71-3.8181-3.8181 0-2.1081 1.71-3.8181 3.8181-3.8181s3.8181 1.71 3.8181 3.8181c0 2.1081-1.71 3.8181-3.8181 3.8181z" stroke-width="0"/>\n </g>\n</svg>':S,T=p.className,E=t.__rest(p,["svgText","className"]);return n._buttonControl=new O(t.__assign({onClick:function(t,e){return n._toggle(e)},svgPropsMap:{Off:t.__assign({svgText:g,className:b("vsm-icon","vsm-my-location-off",v)},_),WatchPosition:t.__assign({svgText:x,className:b("vsm-icon","vsm-my-location-watch-position",w)},M),WatchPositionAndHeading:t.__assign({svgText:P,className:b("vsm-icon","vsm-my-location-watch-position-and-heading",T)},E)}},d)),n._onMapMove=function(t){t.data.byGeolocation||"Off"===n._state||n._setState("Off",t.target)},n._disableOnMapMove=o,n._positionOptions=a,n._animationOptions=s,n}return t.__extends(r,e),r.prototype.createDom=function(t){return this._buttonControl.createDom(t)},r.prototype.onAdd=function(t){this._buttonControl.onAdd(t),this._disableOnMapMove&&t.on(x.Move,this._onMapMove),this._setState("Off",t)},r.prototype.onRemove=function(t){this._buttonControl.onRemove(t),this._disableOnMapMove&&t.off(x.Move,this._onMapMove),this._setState("Off",t)},r.prototype._setState=function(t,e){switch(this._buttonControl.select(t),this._state=t,t){case"Off":this._unwatchPosition(),this._unbindOrientationEvent();break;case"WatchPosition":this._watchPosition(e);break;case"WatchPositionAndHeading":this._bindOrientationEvent(e)}},r.prototype._toggle=function(t){switch(this._state){case"Off":this._setState("WatchPosition",t);break;case"WatchPosition":window.DeviceOrientationEvent?this._setState("WatchPositionAndHeading",t):this._setState("Off",t);break;case"WatchPositionAndHeading":this._setState("Off",t)}},r.prototype._watchPosition=function(t){var e=this;this._watchId||(this._watchId=navigator.geolocation.watchPosition((function(r){var n=r.coords;t.isInteracting()||t.getCamera().easeTo({center:[n.longitude,n.latitude]},e._animationOptions,{byGeolocation:!0})}),(function(r){alert("Failed to get current position"),e._setState("Off",t)}),this._positionOptions))},r.prototype._unwatchPosition=function(){this._watchId&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=null)},r.prototype._bindOrientationEvent=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return this._onDeviceOrientation=function(t){var r=t.alpha;e.isInteracting()||(e.getTransform().setBearing(-(r||0)),e.requestRenderFrame())},"function"!=typeof window.DeviceMotionEvent.requestPermission?[3,2]:[4,window.DeviceOrientationEvent.requestPermission()];case 1:return"granted"===t.sent()?s(window,"deviceorientation",this._onDeviceOrientation):console.info("permission denied"),[3,3];case 2:s(window,"deviceorientation",this._onDeviceOrientation),t.label=3;case 3:return[2]}}))}))},r.prototype._unbindOrientationEvent=function(){l(window,"deviceorientation",this._onDeviceOrientation),this._onDeviceOrientation=function(){}},r}(e),$=J,tt=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this;n._onPitch=function(){};var i=r.svgProps,o=void 0===i?{}:i,a=t.__rest(r,["svgProps"]),s=o.svgText,l=void 0===s?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <g transform="matrix(.79999 0 0 .85714 1.9997 1.4286)">\n  <path d="m18.572 9h-17.143c-0.78884 0-1.4286 0.29854-1.4286 0.66667v0.66667c0 0.36813 0.63973 0.66667 1.4286 0.66667h17.143c0.78884 0 1.4286-0.29854 1.4286-0.66667v-0.66667c0-0.36813-0.63973-0.66667-1.4286-0.66667z" stroke-width="0"/>\n  <path d="m16 3h-12c-0.55219 0-1 0.29854-1 0.66667v0.66667c0 0.36813 0.44781 0.66667 1 0.66667h12c0.55219 0 1-0.29854 1-0.66667v-0.66667c0-0.36813-0.44781-0.66667-1-0.66667z" stroke-width="0"/>\n  <path d="m16 15h-12c-0.55219 0-1 0.29854-1 0.66667v0.66667c0 0.36813 0.44781 0.66667 1 0.66667h12c0.55219 0 1-0.29854 1-0.66667v-0.66667c0-0.36813-0.44781-0.66667-1-0.66667z" stroke-width="0"/>\n  <path d="m5 16v-12c0-0.55219-0.29854-1-0.66667-1h-0.66667c-0.36813 0-0.66667 0.44781-0.66667 1v12c0 0.55219 0.29854 1 0.66667 1h0.66667c0.36813 0 0.66667-0.44781 0.66667-1z" stroke-width="0"/>\n  <path d="m17 16v-12c0-0.55219-0.29854-1-0.66667-1h-0.66667c-0.36813 0-0.66667 0.44781-0.66667 1v12c0 0.55219 0.29854 1 0.66667 1h0.66667c0.36813 0 0.66667-0.44781 0.66667-1z" stroke-width="0"/>\n </g>\n</svg>':s,u=o.className,h=t.__rest(o,["svgText","className"]);return n._buttonControl=new L(t.__assign({onClick:function(t,e){e.getCamera().resetPitch({duration:500})},svgProps:t.__assign({className:b("vsm-icon","vsm-pitch-aligner",u),svgText:l},h)},a)),n}return t.__extends(r,e),r.prototype.createDom=function(t){return this._buttonControl.createDom(t)},r.prototype.onAdd=function(t){var e=this;this._buttonControl.onAdd(t);var r=function(){var r=e._buttonControl.getButton(),n=e._buttonControl.getSvg();if(n){var i=r.getBoundingClientRect().height;n.style.transform="perspective(".concat(i,"px) rotateX(").concat(t.getCamera().getPitch(),"deg)")}};r(),this._onPitch=r,t.on(x.Pitch,this._onPitch)},r.prototype.onRemove=function(t){this._buttonControl.onRemove(t),t.off(x.Pitch,this._onPitch),this._onPitch=function(){}},r}(e),et=tt,rt=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this;n._update=function(){};var i=r.svgProps,o=void 0===i?{}:i,a=t.__rest(r,["svgProps"]),s=o.svgText,l=void 0===s?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <path d="m14.286 8.9286h-3.2143v-3.2143c0-0.39442-0.31986-0.71429-0.71429-0.71429h-0.71429c-0.39442 0-0.71429 0.31986-0.71429 0.71429v3.2143h-3.2143c-0.39442 0-0.71429 0.31986-0.71429 0.71429v0.71429c0 0.39442 0.31986 0.71429 0.71429 0.71429h3.2143v3.2143c0 0.39442 0.31986 0.71429 0.71429 0.71429h0.71429c0.39442 0 0.71429-0.31986 0.71429-0.71429v-3.2143h3.2143c0.39442 0 0.71429-0.31986 0.71429-0.71429v-0.71429c0-0.39442-0.31986-0.71429-0.71429-0.71429z" stroke-width="0"/>\n</svg>':s,u=o.className,h=t.__rest(o,["svgText","className"]);return n._buttonControl=new L(t.__assign({onClick:function(t,e){e.getCamera().zoomIn()},svgProps:t.__assign({className:b("vsm-icon","vsm-zoom-in",u),svgText:l},h)},a)),n}return t.__extends(r,e),r.prototype.createDom=function(t){return this._buttonControl.createDom(t)},r.prototype.onAdd=function(t){var e=this;this._buttonControl.onAdd(t);var r=function(){var r=e._buttonControl.getButton(),n=t.getTransform();r.disabled=e._buttonControl.isDefaultDisabled()||n.getMaxZoom()===n.getZoom()};r(),this._update=r,t.on(x.Zoom,this._update),t.on(x.LimitOptionsChanged,this._update)},r.prototype.onRemove=function(t){this._buttonControl.onRemove(t),t.off(x.Zoom,this._update),t.off(x.LimitOptionsChanged,this._update),this._update=function(){}},r}(e),nt=rt,it=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this;n._update=function(){};var i=r.svgProps,o=void 0===i?{}:i,a=t.__rest(r,["svgProps"]),s=o.svgText,l=void 0===s?'<svg version="1.1" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n <path d="m14.286 8.93h-8.5714c-0.39442 0-0.71429 0.31943-0.71429 0.71333v0.71333c0 0.39389 0.31986 0.71333 0.71429 0.71333h8.5714c0.39442 0 0.71429-0.31943 0.71429-0.71333v-0.71333c0-0.39389-0.31986-0.71333-0.71429-0.71333z" stroke-width="0"/>\n</svg>':s,u=o.className,h=t.__rest(o,["svgText","className"]);return n._buttonControl=new L(t.__assign({onClick:function(t,e){e.getCamera().zoomOut()},svgProps:t.__assign({className:b("vsm-icon","vsm-zoom-out",u),svgText:l},h)},a)),n}return t.__extends(r,e),r.prototype.createDom=function(t){return this._buttonControl.createDom(t)},r.prototype.onAdd=function(t){var e=this;this._buttonControl.onAdd(t);var r=function(){var r=e._buttonControl.getButton(),n=t.getTransform();r.disabled=e._buttonControl.isDefaultDisabled()||n.getMinZoom()===n.getZoom()};r(),this._update=r,t.on(x.Zoom,this._update),t.on(x.LimitOptionsChanged,this._update)},r.prototype.onRemove=function(t){this._buttonControl.onRemove(t),t.off(x.Zoom,this._update),t.off(x.LimitOptionsChanged,this._update),this._update=function(){}},r}(e),ot=it,at={direction:"column",buttonSize:"30px",showZoom:!0,showRotate:!0,showPitch:!0},st=function(e){function r(r){void 0===r&&(r={});var n=e.call(this)||this,i=t.merge([t.__assign({},r),at],!1),o=i.className,a=i.buttonSize,s=i.buttonStyle,l=i.buttonClassName,u=i.direction,h=i.showZoom,c=i.showRotate,f=i.showPitch,p=i.disabled,d={style:t.__assign(t.__assign({},s),{width:a,height:a}),className:l,disabled:p},y=[h&&new nt(d),h&&new ot(d),c&&new A(d),f&&new et(d)].filter((function(t){return t}));return n._groupControl=new V(t.__assign(t.__assign({controls:y},i),{className:b("vsm-flex-".concat(u),o)})),n}return t.__extends(r,e),r.prototype.createDom=function(t){return this._groupControl.createDom(t)},r.prototype.onAdd=function(t){this._groupControl.onAdd(t)},r.prototype.onRemove=function(t){this._groupControl.onRemove(t)},r.prototype.getControls=function(){return this._groupControl.getControls()},r}(e),lt=new t.LngLat(0,0);function ut(e){var r=e.lng,n=e.lat;return{x:(180+r)/360,y:(180-t.toDegree(Math.log(Math.tan((Math.PI/2+t.toRadian(n))/2))))/360}}var ht={maxPixelWidth:100},ct=function(e){function r(r){void 0===r&&(r={});var i=e.call(this,{interactive:!0})||this;i._onMove=function(){};var o=t.merge([t.__assign({},r),ht],!1),a=o.className,s=o.style,l=o.maxPixelWidth,u=n("div","vsm-contents-wrap",i.getContainer()),h=n("div",b("vsm-scale-bar-frame",a),u);return _(h,s),i._scaleLabel=n("label","vsm-scale-label",h),i._scaleBar=n("div","vsm-scale-bar",h),i._scaleBarCanvas=n("canvas","vsm-scale-bar-canvas",i._scaleBar),i._unitLength=l,i}return t.__extends(r,e),r.prototype.onAdd=function(e){var r=this,n=function(){var n,i,o,a,s,l,u=e.getTransform().getHeight()/2,h=(n=e.unproject({x:0,y:u}),i=e.unproject({x:r._unitLength,y:u}),o=t.toRadian(n.lat),a=t.toRadian(i.lat),s=t.toRadian(i.lng-n.lng),l=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(s),Math.acos(l)*t.EARTH_RADIUS_APPROXIMATION);r._updateScale(h)};n(),this._onMove=n,e.on(x.Move,this._onMove),e.on(x.Resize,this._onMove)},r.prototype.onRemove=function(t){t.off(x.Move,this._onMove),t.off(x.Resize,this._onMove)},r.prototype._updateScale=function(t){var e=r._getNearestRoundNumber(t),n=e/t;this._scaleLabel.innerText=e>=1e3?"".concat(e/1e3,"km"):"".concat(e,"m"),this._scaleBar.style.width="".concat(Math.round(this._unitLength*n),"px"),this._drawScaleBar()},r._getNearestRoundNumber=function(e){var r=t.getIntDigitLength(e),n=Math.pow(10,r-1),i=e/n;return i>=5?5*n:i>=2?2*n:n},r.prototype._drawScaleBar=function(){var e=o(this._scaleBar),r=e.width,n=e.height,i=this._scaleBarCanvas;a(i,r,n);var s=i.getContext("2d");if(null!==s){s.strokeStyle=v(i,"color"),s.lineWidth=2*t.browser.devicePixelRatio;var l=s.lineWidth/2,u=i.width-1,h=i.height-1;s.beginPath(),s.moveTo(l,l),s.lineTo(l,h-l),s.lineTo(u-l,h-l),s.lineTo(u-l,l),s.stroke()}},r}(w),ft=ct,pt=["Width","Height","Zoom","Tile Count","Bearing","Pitch","Center"],dt=function(e){function r(r){var i,o,a=e.call(this,{interactive:!0})||this;a._properties={},a._onRender=function(){};var s=r||{},l=s.className,u=s.style,h=s.lngLatFormat,c=void 0===h?H:h,f=s.titleProps,p=void 0===f?{}:f,d=s.propertyContainerProps,y=void 0===d?{}:d,g=s.propertyNameProps,v=void 0===g?{}:g,m=s.propertyValueProps,x=void 0===m?{}:m,w=p.text,M=void 0===w?"Transform View":w,S=n("div","vsm-contents-wrap",a.getContainer()),P=n("div",b("vsm-info-frame",l),S);_(P,u);var T=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=n("div","vsm-info-row",P);t.forEach((function(t){return r.appendChild(t)}))},E=n("div",b("vsm-info-title",p.className));_(E,p.style),E.innerText=M;try{for(var L=t.__values(pt),k=L.next();!k.done;k=L.next()){var I=k.value,A=n("div",b("vsm-info-property",y.className));_(A,y.style);var C=n("div",b("vsm-info-property-name",v.className),A);_(C,v.style),C.innerText=I;var O=n("div",b("vsm-info-property-value",x.className),A);_(O,x.style),a._properties[I]={container:A,value:O}}}catch(t){i={error:t}}finally{try{k&&!k.done&&(o=L.return)&&o.call(L)}finally{if(i)throw i.error}}return T(E),T(a._properties.Width.container,a._properties.Height.container),T(a._properties.Zoom.container,a._properties["Tile Count"].container),T(a._properties.Bearing.container,a._properties.Pitch.container),T(a._properties.Center.container),a._lngLatFormat=c,a}return t.__extends(r,e),r.prototype.onAdd=function(t){var e=this,r=function(){var r=t.getTransform();e._properties.Width.value.innerText="".concat(r.getWidth()),e._properties.Height.value.innerText="".concat(r.getHeight()),e._properties.Zoom.value.innerText="".concat(r.getZoom().toFixed(3)),e._properties["Tile Count"].value.innerText="".concat(r.getVisibleTiles().length),e._properties.Bearing.value.innerText="".concat(r.getBearing().toFixed(2)),e._properties.Pitch.value.innerText="".concat(r.getPitch().toFixed(2));var n=r.getCenter(),i=n.lng,o=n.lat;e._properties.Center.value.innerText=e._lngLatFormat({x:i,y:o})};r(),this._onRender=r,t.on(x.Render,this._onRender)},r.prototype.onRemove=function(t){t.off(x.Render,this._onRender),this._onRender=function(){}},r}(w),yt=dt,gt={lineWidth:3},vt=function(e){function r(r){void 0===r&&(r={});var i=e.call(this)||this;i._onMove=function(){};var o=t.merge([t.__assign({},r),gt],!1),a=o.className,s=o.style,l=o.lineWidth,u=i.getContainer();a&&u.classList.add(a),_(u,s),u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.bottom="0",u.style.right="0";var h=n("canvas","",u);return h.style.position="absolute",h.style.left="0",h.style.top="0",i._canvas=h,i._lineWidth=l,i}return t.__extends(r,e),r.prototype.onAdd=function(t){var e=this,r=function(){e._draw(t)};r(),this._onMove=r,t.on(x.Move,this._onMove),t.on(x.Resize,this._onMove)},r.prototype.onRemove=function(t){t.off(x.Move,this._onMove),t.off(x.Resize,this._onMove)},r.prototype._draw=function(t){var e=this._canvas,n=t.getTransform();a(this._canvas,n.getWidth(),n.getHeight());var i=e.getContext("2d");if(null!==i){var o=v(e,"color");i.strokeStyle=o,i.fillStyle=o,i.lineWidth=mt(this._lineWidth),r._drawCenter(i,n,30),r._drawBoundary(i,n,75,this._lineWidth),r._drawEyes(i,n.getNearestPointFromEye())}},r._drawCenter=function(t,e,r){var n=mt(e.getWidth())/2,i=mt(e.getHeight())/2,o=mt(r)/2;t.beginPath(),t.moveTo(n-o,i),t.lineTo(n+o,i),t.moveTo(n,i-o),t.lineTo(n,i+o),t.stroke()},r._drawBoundary=function(t,e,r,n){var i=mt(e.getWidth()),o=mt(e.getHeight());r=mt(r),n=mt(n),t.beginPath(),t.moveTo(0,0),t.lineTo(0,r),t.lineTo(n,r),t.lineTo(n,n),t.lineTo(r,n),t.lineTo(r,0),t.lineTo(0,0),t.moveTo(0,o),t.lineTo(0,o-r),t.lineTo(n,o-r),t.lineTo(n,o-n),t.lineTo(r,o-n),t.lineTo(r,o),t.lineTo(0,o),t.moveTo(i,0),t.lineTo(i,r),t.lineTo(i-n,r),t.lineTo(i-n,n),t.lineTo(i-r,n),t.lineTo(i-r,0),t.lineTo(i,0),t.moveTo(i,o),t.lineTo(i,o-r),t.lineTo(i-n,o-r),t.lineTo(i-n,o-n),t.lineTo(i-r,o-n),t.lineTo(i-r,o),t.lineTo(i,o),t.fill()},r._drawEyes=function(t,e){var r=mt(e.x),n=mt(e.y);t.beginPath(),t.arc(r,n,mt(10),0,2*Math.PI,!1),t.arc(r,n,mt(6),0,2*Math.PI,!0),t.arc(r,n,mt(4),0,2*Math.PI,!1),t.fill()},r}(w),_t=vt;function mt(e){return e*t.browser.devicePixelRatio}function bt(e,r){var n=e.lng-r.lng;return n>=-180&&n<=180?e:new t.LngLat(e.lng-360*Math.sign(n),e.lat)}function xt(e,r){var n=t.wrap(e,-180,180),i=Math.abs(n-r);return Math.abs(n-360-r)<i&&(n-=360),Math.abs(n+360-r)<i&&(n+=360),n}var wt={Linear:t.cubicBezier(0,0,1,1),Ease:t.cubicBezier(.25,.1,.25,1),EaseIn:t.cubicBezier(.42,0,1,1),EaseOut:t.cubicBezier(0,0,.58,1),EaseInOut:t.cubicBezier(.42,0,.58,1),EaseInBack:t.cubicBezier(.6,-.28,.735,.045),EaseOutBack:t.cubicBezier(.175,.885,.32,1.275),EaseInOutBack:t.cubicBezier(.68,-.55,.265,1.55)};function Mt(e,r){return void 0===r&&(r={}),t.__assign({domEvent:e},r)}var St,Pt=function(e){function r(t,r,n){void 0===n&&(n={});var i=e.call(this,t,n)||this;return i._target=r,i._defaultPrevented=!1,i}return t.__extends(r,e),r.fromDomEvent=function(t,e,n,i){return void 0===i&&(i={}),new r(t,e,Mt(n,i))},Object.defineProperty(r.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),r.prototype.preventDefault=function(){this._defaultPrevented=!0},Object.defineProperty(r.prototype,"defaultPrevented",{get:function(){return this._defaultPrevented},enumerable:!1,configurable:!0}),r}(t.Event),Tt=function(e){function r(t,r){void 0===r&&(r={});var n=e.call(this,x.Error,r)||this;return n._error=t,n}return t.__extends(r,e),r.valueOf=function(e){return e instanceof t.MapError?new r(e):new r(new t.MapError("Undefined",e))},Object.defineProperty(r.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),r}(t.Event),Et=function(e){function r(r,n,i,o){void 0===o&&(o={});var a=f(n.getCanvasContainer(),i),s={screenPoint:a,lngLat:n.unproject(a)};return e.call(this,r,n,Mt(i,t.__assign(t.__assign({},s),o)))||this}return t.__extends(r,e),r}(Pt),Lt=function(e){function r(r,n,i,o){void 0===o&&(o={});var a,s,l,u,h=(a=n.getCanvasContainer(),s=i,l=a.getBoundingClientRect(),u="touchend"===s.type?s.changedTouches:s.touches,Array.from(u).map((function(t){return{x:t.clientX-l.left-a.clientLeft,y:t.clientY-l.top-a.clientTop}}))),c=h.reduce((function(e,r){return t.add(e,t.divide(r,h.length))}),{x:0,y:0}),f={screenPoints:h,lngLats:h.map((function(t){return n.unproject(t)})),screenPoint:c,lngLat:n.unproject(c)};return e.call(this,r,n,Mt(i,t.__assign(t.__assign({},f),o)))||this}return t.__extends(r,e),r}(Pt),kt=function(){function e(e,r){this._ne=new t.LngLat(0,0),this._sw=new t.LngLat(0,0),this._ne=r,this._sw=e}return e.valueOf=function(r){var n,i,o,a,s;if(r instanceof e)return r;if(s=r,Array.isArray(s)&&2===s.length){var l=t.LngLat.valueOf(r[0]),u=t.LngLat.valueOf(r[1]);n=l.lng,o=l.lat,i=u.lng,a=u.lat}else!function(t){return Array.isArray(t)&&4===t.length}(r)?(n=r.west,o=r.south,i=r.east,a=r.north):(n=r[0],o=r[1],i=r[2],a=r[3]);return new e(new t.LngLat(Math.min(n,i),Math.min(o,a)),new t.LngLat(Math.max(n,i),Math.max(o,a)))},Object.defineProperty(e.prototype,"southWest",{get:function(){return this._sw},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"northEast",{get:function(){return this._ne},enumerable:!1,configurable:!0}),e.prototype.getCenter=function(){return new t.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},e.prototype.extend=function(r){var n,i;if(function(e){return e instanceof t.LngLat||("lng"in e&&"lat"in e||!(!Array.isArray(e)||2!==e.length||"number"!=typeof e[0]||"number"!=typeof e[1]))}(r)){var o=t.LngLat.valueOf(r);n=o,i=o}else{var a=e.valueOf(r);n=a.southWest,i=a.northEast}return this._sw=new t.LngLat(Math.min(n.lng,this._sw.lng),Math.min(n.lat,this._sw.lat)),this._ne=new t.LngLat(Math.max(i.lng,this._ne.lng),Math.max(i.lat,this._ne.lat)),this},e.prototype.contains=function(e){var r=t.LngLat.valueOf(e),n=r.lng,i=r.lat,o=this._sw.lat<=i&&i<=this._ne.lat,a=this._sw.lng<=n&&n<=this._ne.lng;return o&&a},e.prototype.toString=function(){return"[".concat(this._sw.toString(),", ").concat(this._ne.toString(),"]")},e.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},e.prototype.clone=function(){return new e(this._sw.clone(),this._ne.clone())},e}(),It=kt,At={now:t.now},Ct=function(){function t(t){void 0===t&&(t=At),this._timer=t,this._state="Stopped",this._firstTimeStamp=0,this._secondTimeStamp=0}return t.newInstanceWithStart=function(e){var r=new t(e);return r.start(),r},t.prototype.start=function(){switch(this._state){case"Stopped":this.restart();break;case"Paused":this._state="Running",this._firstTimeStamp+=this._timer.now()-this._secondTimeStamp}},t.prototype.restart=function(){this._state="Running",this._firstTimeStamp=this._timer.now()},t.prototype.pause=function(){"Running"===this._state&&(this._secondTimeStamp=this._timer.now(),this._state="Paused")},t.prototype.stop=function(){switch(this._state){case"Stopped":return;case"Paused":var t=this._timer.now();this._firstTimeStamp+=t-this._secondTimeStamp,this._secondTimeStamp=t;break;case"Running":this._secondTimeStamp=this._timer.now()}this._state="Stopped"},t.prototype.getElapsedTime=function(){return"Running"===this._state?this._timer.now()-this._firstTimeStamp:this._secondTimeStamp-this._firstTimeStamp},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(),Ot=function(){function e(t){this._functions=t}return e.prototype.start=function(e,r){var n=this._functions,i=n.frame,o=n.finish,a=n.requestRenderFrame,s=Ct.newInstanceWithStart(t.browser),l=function(){var t=Math.min(s.getElapsedTime()/e,1),n=r(t);i(n),n<1?a(l):o()};a(l)},e.prototype.renderAtOneTime=function(){var t=this._functions,e=t.frame,r=t.finish;e(1),r()},e}(),Rt=function(){function e(t){this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._requestedTask=null,this._onEaseEnd=null,this._easeEndTimeoutId=null,this._map=t}return e.prototype.easeTo=function(e,r,n){var i=this;void 0===r&&(r={}),void 0===n&&(n={}),this.stop();var o=r.offset||{x:0,y:0},a=t.getOrDefault(r,"duration",500),s=r.easing||wt.Ease,l=this._map.getTransform(),u=l.getMapDefine(),h=l.getZoom(),c=l.getBearing(),f=l.getPitch(),p=t.getOrDefault(e,"zoom",h),d=t.hasProperty(e,"bearing")?xt(e.bearing,c):c,y=t.getOrDefault(e,"pitch",f),g=t.add$1(l.getCenterPoint(),o),v=l.screenPointToLngLat(g),_=bt(t.LngLat.valueOf(e.center||v),l.getCenter()),m=l.project(v),b=l.project(_),x=t.subtract(b,m),w=u.toScale(p-h),M=p>h?Math.min(2,w):Math.max(.5,w),S=e.pivot&&t.LngLat.valueOf(e.pivot),P=S&&l.lngLatToScreenPoint(S);this._zooming=p!==h,this._rotating=d!==c,this._pitching=y!==f,this._prepareEase(n,r.noMoveStart),this._easeEndTimeoutId&&clearTimeout(this._easeEndTimeoutId),this._onEaseEnd=function(){r.endDelay?i._easeEndTimeoutId=setTimeout((function(){return i._afterEase(n)}),r.endDelay):i._afterEase(n)};var T=new Ot({frame:function(e){if(i._zooming&&l.setZoom(t.interpolate(h,p,e)),i._rotating&&l.setBearing(t.interpolate(c,d,e)),i._pitching&&l.setPitch(t.interpolate(f,y,e)),S&&P)l.setLocationAtPoint(S,P);else{var r=u.toScale(l.getZoom()-h),o=Math.pow(M,1-e),a=t.multiply(t.add(m,t.multiply(x,e*o)),r),s=l.unproject(a);l.setLocationAtPoint(s,g)}i._emitMoveEvents(n)},finish:function(){i.stop()},requestRenderFrame:function(t){i._requestedTask=i._map.requestRenderFrame(t)}});0!==a&&t.getOrDefault(r,"animate",!0)?T.start(a,s):T.renderAtOneTime()},e.prototype._prepareEase=function(t,e){this._moving=!0,e||(this._emitEvent(x.MoveStart,t),this._zooming&&this._emitEvent(x.ZoomStart,t),this._rotating&&this._emitEvent(x.RotateStart,t),this._pitching&&this._emitEvent(x.PitchStart,t))},e.prototype._emitMoveEvents=function(t){this._emitEvent(x.Move,t),this._zooming&&this._emitEvent(x.Zoom,t),this._rotating&&this._emitEvent(x.Rotate,t),this._pitching&&this._emitEvent(x.Pitch,t)},e.prototype._afterEase=function(e){var r,n;this._moving=!1;var i=[];this._zooming&&(this._zooming=!1,i.push(x.ZoomEnd)),this._rotating&&(this._rotating=!1,i.push(x.RotateEnd)),this._pitching&&(this._pitching=!1,i.push(x.PitchEnd));try{for(var o=t.__values(i),a=o.next();!a.done;a=o.next()){var s=a.value;this._emitEvent(s,e)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}this._emitEvent(x.MoveEnd,e)},e.prototype._emitEvent=function(t,e){this._map.emit(new Pt(t,this._map,e))},e.prototype.panTo=function(t,e,r){this.easeTo({center:t},e,r)},e.prototype.panBy=function(e,r,n){this.panTo(this.getCenter(),t.__assign({offset:t.multiply(e,-1)},r),n)},e.prototype.zoomTo=function(t,e,r){this.easeTo({zoom:t},e,r)},e.prototype.zoomIn=function(t,e){this.zoomTo(this.getZoom()+1,t,e)},e.prototype.zoomOut=function(t,e){this.zoomTo(this.getZoom()-1,t,e)},e.prototype.rotateTo=function(t,e,r){this.easeTo({bearing:t},e,r)},e.prototype.resetNorth=function(e,r){this.rotateTo(0,t.__assign({duration:1e3},e),r)},e.prototype.resetPitch=function(e,r){this.easeTo({pitch:0},t.__assign({duration:1e3},e),r)},e.prototype.jumpTo=function(e,r){var n=this;void 0===r&&(r={}),this.stop();var i=this._map.getTransform(),o=[],a=[];this._emitEvent(x.MoveStart,r),o.push(x.Move),e.center&&i.setCenter(e.center),t.hasProperty(e,"zoom")&&e.zoom!==i.getZoom()&&(this._emitEvent(x.ZoomStart,r),i.setZoom(e.zoom),o.push(x.Zoom),a.push(x.ZoomEnd)),t.hasProperty(e,"bearing")&&e.bearing!==i.getBearing()&&(this._emitEvent(x.RotateStart,r),i.setBearing(e.bearing),o.push(x.Rotate),a.push(x.RotateEnd)),t.hasProperty(e,"pitch")&&e.pitch!==i.getPitch()&&(this._emitEvent(x.PitchStart,r),i.setPitch(e.pitch),o.push(x.Pitch),a.push(x.PitchEnd)),a.push(x.MoveEnd),o.forEach((function(t){n._emitEvent(t,r)})),a.forEach((function(t){n._emitEvent(t,r)}))},e.prototype.flyTo=function(e,r,n){var i=this;void 0===r&&(r={}),void 0===n&&(n={}),this.stop();var o=r.offset||{x:0,y:0},a=r.speed||1.2,s=r.curve||1.42,l=r.easing||wt.Ease,u=this._map.getTransform(),h=u.getMapDefine(),c=u.getZoom(),f=u.getBearing(),p=u.getPitch(),d=t.hasProperty(e,"zoom")?t.clamp(e.zoom,u.getMinZoom(),u.getMaxZoom()):c,y=t.hasProperty(e,"bearing")?xt(e.bearing,f):f,g=t.getOrDefault(e,"pitch",p),v=h.toScale(d-c),_=t.add$1(u.getCenterPoint(),o),m=u.screenPointToLngLat(_),b=bt(t.LngLat.valueOf(e.center||m),u.getCenter()),x=u.project(m),w=u.project(b),M=t.subtract(w,x),S=s,P=Math.max(u.getWidth(),u.getHeight()),T=P/v,E=t.magnitude(M);if(t.hasProperty(r,"minZoom")){var L=t.clamp(Math.min(r.minZoom,c,d),u.getMinZoom(),u.getMaxZoom()),k=P/h.toScale(L-c);S=Math.sqrt(k/E*2)}var I,A=function(t){return t*t},C=A(S),O=A(T)-A(P),R=A(C)*A(E),D=2*C*E,F=function(t){var e=0===t?(O+R)/(D*P):(O-R)/(D*T);return Math.log(Math.sqrt(A(e)+1)-e)},B=F(0),N=F(1),z=function(t){return(Math.exp(t)-Math.exp(-t))/2},U=function(t){return(Math.exp(t)+Math.exp(-t))/2},j=function(t){return U(B)/U(B+S*t)},V=function(t){return P*((U(B)*(z(e=B+S*t)/U(e))-z(B))/C)/E;var e},G=(N-B)/S;if(Math.abs(E)<1e-6||!isFinite(G)){if(Math.abs(P-T)<1e-6)return void this.easeTo(e,r,n);var q=T<P?-1:1;G=Math.abs(Math.log(T/P))/S,V=function(t){return 0},j=function(t){return Math.exp(q*S*t)}}I=t.hasProperty(r,"duration")?r.duration:1e3*G/a,r.maxDuration&&I>r.maxDuration&&(I=0),this._zooming=!0,this._rotating=y!==f,this._pitching=g!==p,this._prepareEase(n,!1),this._onEaseEnd=function(){return i._afterEase(n)};var Z=new Ot({frame:function(e){var r=e*G,o=1/j(r);u.setZoom(1===e?d:c+h.toLevel(o)),i._rotating&&u.setBearing(t.interpolate(f,y,e)),i._pitching&&u.setPitch(t.interpolate(p,g,e));var a=t.multiply(t.add(x,t.multiply(M,V(r))),o),s=1===e?b:u.unproject(a);u.setLocationAtPoint(s,_),i._emitMoveEvents(n)},finish:function(){i.stop()},requestRenderFrame:function(t){i._requestedTask=i._map.requestRenderFrame(t)}});0!==I&&t.getOrDefault(r,"animate",!0)?Z.start(I,l):Z.renderAtOneTime()},e.prototype.stop=function(){if(this._requestedTask&&(this._requestedTask.cancel(),this._requestedTask=null),this._onEaseEnd){var t=this._onEaseEnd;this._onEaseEnd=null,t()}},e.prototype.getZoom=function(){return this._map.getTransform().getZoom()},e.prototype.setZoom=function(t,e){void 0===e&&(e={}),this.jumpTo({zoom:t},e)},e.prototype.getMinZoom=function(){return this._map.getTransform().getMinZoom()},e.prototype.setMinZoom=function(t,e){void 0===e&&(e={});var r=this._map.getTransform();r.setMinZoom(t),this.getZoom()<r.getMinZoom()&&this.jumpTo({zoom:r.getMinZoom()},e),this._emitEvent(x.LimitOptionsChanged)},e.prototype.getMaxZoom=function(){return this._map.getTransform().getMaxZoom()},e.prototype.setMaxZoom=function(t,e){void 0===e&&(e={});var r=this._map.getTransform();r.setMaxZoom(t),this.getZoom()>r.getMaxZoom()&&this.jumpTo({zoom:r.getMaxZoom()},e),this._emitEvent(x.LimitOptionsChanged)},e.prototype.getCenter=function(){var e=this._map.getTransform().getCenter(),r=e.lng,n=e.lat;return new t.LngLat(r,n)},e.prototype.setCenter=function(t,e){void 0===e&&(e={}),this.jumpTo({center:t},e)},e.prototype.getBearing=function(){return this._map.getTransform().getBearing()},e.prototype.setBearing=function(t,e){void 0===e&&(e={}),this.jumpTo({bearing:t},e)},e.prototype.getPitch=function(){return this._map.getTransform().getPitch()},e.prototype.setPitch=function(t,e){void 0===e&&(e={}),this.jumpTo({pitch:t},e)},e.prototype.getMinPitch=function(){return this._map.getTransform().getMinPitch()},e.prototype.setMinPitch=function(t,e){void 0===e&&(e={});var r=this._map.getTransform();r.setMinPitch(t),this.getPitch()<r.getMinPitch()&&this.jumpTo({pitch:r.getMinPitch()},e),this._emitEvent(x.LimitOptionsChanged)},e.prototype.getMaxPitch=function(){return this._map.getTransform().getMaxPitch()},e.prototype.setMaxPitch=function(t,e){void 0===e&&(e={});var r=this._map.getTransform();r.setMaxPitch(t),this.getPitch()>r.getMaxPitch()&&this.jumpTo({pitch:r.getMaxPitch()},e),this._emitEvent(x.LimitOptionsChanged)},e.prototype.getBounds=function(){var t=this._map.getTransform(),e=t.getWidth(),r=t.getHeight(),n=t.screenPointToLngLat({x:0,y:r}),i=t.screenPointToLngLat({x:e,y:0}),o=t.screenPointToLngLat({x:e,y:r}),a=t.screenPointToLngLat({x:0,y:0});return new It(n,i).extend(o).extend(a)},e.prototype.setBounds=function(e,r,n){if(void 0===r&&(r={}),e){var i=r.padding,o=void 0===i?0:i,a=r.bearing,s=void 0===a?0:a,l=r.pitch,u=void 0===l?0:l,h=t.__rest(r,["padding","bearing","pitch"]),c=It.valueOf(e),f=this._getCameraForBoxAndBearing(c.northEast,c.southWest,function(t){return void 0===t&&(t=0),"number"==typeof t?{top:t,right:t,bottom:t,left:t}:t}(o),s);this.flyTo(t.__assign({bearing:s,pitch:u},f),h,n)}},e.prototype.getMaxBounds=function(){return this._map.getTransform().getMaxBounds()},e.prototype.setMaxBounds=function(t,e,r){void 0===e&&(e={duration:0}),void 0===r&&(r={});var n=this._map.getTransform();if(t){var i=It.valueOf(t),o=this.getMaxBounds();if(n.setMaxBounds(i),!o)return void this.setBounds(i,e,r);var a=i.contains(o.southWest),s=i.contains(o.northEast);a||s?a?s||this.setBounds([o.southWest,i.northEast],e,r):this.setBounds([i.southWest,o.northEast],e,r):this.setBounds(i,e,r)}else n.setMaxBounds(t);this._emitEvent(x.LimitOptionsChanged)},e.prototype._getCameraForBoxAndBearing=function(e,r,n,i){var o=this._map.getTransform(),a=n.top,s=n.left,l=n.bottom,u=n.right,h=o.project(e),c=o.project(r),f=o.project([e.lng,r.lat]),p=o.project([r.lng,e.lat]),d=t.rotate(h,-t.toRadian(i)),y=t.rotate(c,-t.toRadian(i)),g=t.rotate(f,-t.toRadian(i)),v=t.rotate(p,-t.toRadian(i)),_={x:Math.max(d.x,y.x,g.x,v.x),y:Math.max(d.y,y.y,g.y,v.y)},m={x:Math.min(d.x,y.x,g.x,v.x),y:Math.min(d.y,y.y,g.y,v.y)},b=t.subtract(_,m),x=(o.getWidth()-s-u)/b.x,w=(o.getHeight()-a-l)/b.y;if(x<0||w<0)return{};var M=o.getScale()*Math.min(x,w),S=o.getMapDefine().toLevel(M),P=(n.left-n.right)/2,T=(n.top-n.bottom)/2,E=t.rotate({x:P,y:T},t.toRadian(i)),L=t.multiply(E,o.getScale()/M);return{zoom:S,center:o.unproject(t.subtract(t.divide(t.add(h,c),2),L)),bearing:i}},e.prototype.isMoving=function(){return this._moving},e.prototype.isZooming=function(){return this._zooming},e.prototype.isRotating=function(){return this._rotating},e.prototype.isPitching=function(){return this._pitching},e}(),Dt=Rt;!function(t){t.Default="Default",t.TopLeft="TopLeft",t.TopRight="TopRight",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight"}(St||(St={}));for(var Ft={Default:"vsm-pos-default",TopLeft:"vsm-pos-top-left",TopRight:"vsm-pos-top-right",BottomLeft:"vsm-pos-bottom-left",BottomRight:"vsm-pos-bottom-right"},Bt=function(){function t(t){var e=this;this._controlContainer=t,this._dockContainers={},Object.keys(St).forEach((function(r){var n=z({className:Ft[r]},t);e.setDock(r,n)}))}return t.prototype.addControl=function(t,e){var r=this._dockContainers[t];r&&r.appendChild(e)},t.prototype.replaceControl=function(t,e,r){var n=this._dockContainers[t];n&&n.replaceChild(e,r)},t.prototype.setDock=function(t,e){e&&!e.parentNode&&this._controlContainer.appendChild(e);var r=this._dockContainers[t]||null;if(r){var n=function(t){var e=Array.from(t.childNodes).map((function(e){return t.removeChild(e)}));return t.innerHTML="",e}(r);e?(n.forEach((function(t){return e.appendChild(t)})),this._dockContainers[t]=e):delete this._dockContainers[t]}else e&&(this._dockContainers[t]=e);return r},t.prototype.getDock=function(t){return this._dockContainers[t]||null},t}(),Nt=function(){function e(){this._bundles=[]}return e.prototype.has=function(t){return this.find(t)>-1},e.prototype.find=function(t){return this._bundles.map((function(t){return t.control})).indexOf(t)},e.prototype.add=function(t){this._bundles.push(t)},e.prototype.remove=function(e){return t.__read(this._bundles.splice(e,1),1)[0]},e.prototype.replace=function(t,e){var r=this._bundles[t];return this._bundles[t]=e,r},e.prototype.get=function(t){return this._bundles[t]},e.prototype.size=function(){return this._bundles.length},Object.defineProperty(e.prototype,"bundles",{get:function(){return this._bundles},enumerable:!1,configurable:!0}),e}(),zt=t.cubicBezier(0,0,.3,1),Ut=function(){function e(){this._points=[]}return e.prototype.reset=function(e){var r=t.browser.now();this._points=[{timeStamp:r,point:e}]},e.prototype.add=function(e){var r=t.browser.now();this._expire(r),this._points.push({timeStamp:r,point:e})},e.prototype._expire=function(t){for(var e=this._points;e.length>0&&t-e[0].timeStamp>160;)e.shift()},e.prototype.calcAnimation=function(){this._expire(t.browser.now());var e=this._points;if(e.length<2)return null;var r=e[0],n=e[e.length-1];if(r.timeStamp===n.timeStamp||t.equals(r.point,n.point))return null;var i=t.subtract(n.point,r.point),o=(n.timeStamp-r.timeStamp)/1e3,a=t.multiply(i,.3/o),s=t.magnitude(a);s>1400&&(s=1400,a=t.multiply(t.normalize(a),s));var l=s/750;return{offset:t.multiply(a,-l/2),duration:1e3*l}},e}(),jt=function(){function e(e){var r=this;this._timeoutId=null,this._requestedTask=null,this._tappedPoint=null,this._tappedEventType=null,this._startPoint=t.DUMMY,this._lastPoint=t.DUMMY,this._pivotLocation=lt,this._startZoom=0,this._active=!1,this._enabled=!1,this._zooming=!1,this._map=e,this._element=e.getCanvasContainer(),this._mouseEventRegistrations=[{target:window.document,type:"mouseup",handler:function(t){return r._onMouseUp(t)}},{target:window.document,type:"mousemove",handler:function(t){return r._onMove(t)},options:{capture:!0,passive:!1}}],this._touchEventRegistrations=[{target:window.document,type:"touchend",handler:function(t){return r._onTouchEnd(t)}},{target:window.document,type:"touchmove",handler:function(t){return r._onMove(t)},options:{capture:!0,passive:!1}}],this._inertia=new Ut}return e.prototype._bindMouseEvents=function(){t.__spreadArray([],t.__read(this._mouseEventRegistrations),!1).forEach(u)},e.prototype._bindTouchEvents=function(){t.__spreadArray([],t.__read(this._touchEventRegistrations),!1).forEach(u)},e.prototype._unbind=function(){t.__spreadArray(t.__spreadArray([],t.__read(this._mouseEventRegistrations),!1),t.__read(this._touchEventRegistrations),!1).forEach(h)},e.prototype.onMouseDown=function(t){this._enabled&&!this._active&&0===t.button&&"Touch"!==this._tappedEventType&&(this._map.getCamera().stop(),this._start(t))},e.prototype.onTouchStart=function(t){!this._enabled||this._active||t.touches.length>1||"Mouse"===this._tappedEventType||(this._map.getCamera().stop(),this._start(t))},e.prototype._start=function(e){var r=this,n=y(e)?"Touch":"Mouse",i=this._getEventPoint(e);if(!this._timeoutId)return this._resetTimer(),this._tappedPoint=i,this._tappedEventType=n,void(this._timeoutId=setTimeout((function(){r._timeoutId=null,r._tappedPoint=null,r._tappedEventType=null}),300));var o=this._tappedPoint;if(o&&t.distance(o,i)<=30&&!this._map.getCamera().isMoving()){"Touch"===n?this._bindTouchEvents():this._bindMouseEvents(),this._active=!0,this._element.classList.add("double-click");var a=this._map.getTransform();this._startPoint=i,this._lastPoint=i,this._pivotLocation=a.screenPointToLngLat(i),this._startZoom=a.getZoom(),this._zooming=!1,this._inertia.reset({x:0,y:i.y})}this._resetTimer()},e.prototype._getEventPoint=function(t){return y(t)?d(this._element,t):f(this._element,t)},e.prototype._resetTimer=function(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),this._tappedPoint=null,this._tappedEventType=null},e.prototype.reset=function(){this._resetTimer()},e.prototype._onMove=function(r){var n=this;if("touches"in r&&r.touches.length>1)this._onTouchEnd(r);else{r.cancelable&&r.preventDefault();var i=this._getEventPoint(r);if(this._zooming){if(t.equals(this._lastPoint,i))return}else if(t.distance(this._lastPoint,i)<=15)return;this._lastPoint=i,this._inertia.add({x:0,y:i.y});var o=this._map.getTransform();this._zooming||(this._zooming=!0,this._emitEvent(x.MoveStart,r),this._emitEvent(x.ZoomStart,r)),this._requestedTask&&this._requestedTask.isReady()||(this._requestedTask=this._map.requestRenderFrame((function(){var i=t.subtract(n._startPoint,n._lastPoint).y,a=t.clamp(n._startZoom+e._zoomOf(i),o.getMinZoom(),o.getMaxZoom());o.setZoom(a),o.setLocationAtPoint(n._pivotLocation,n._startPoint),n._emitEvent(x.Move,r),n._emitEvent(x.Zoom,r)})))}},e._zoomOf=function(e){return.05*-e/t.browser.devicePixelRatio},e.prototype._onMouseUp=function(t){0===t.button&&this._end(t)},e.prototype._onTouchEnd=function(t){this._end(t)},e.prototype._end=function(t){var e=this;this._element.classList.remove("double-click"),this._unbind(),this._deactivate(),this._zooming?this._zoomByInertia(t):this._stepZoom(t),setTimeout((function(){e._active=!1}),10)},e.prototype._deactivate=function(){this._requestedTask&&(this._requestedTask.cancel(),this._requestedTask=null),this._startPoint=t.DUMMY,this._lastPoint=t.DUMMY},e.prototype._zoomByInertia=function(r){var n=this._inertia.calcAnimation();if(!n)return this._emitEvent(x.ZoomEnd,r),void this._emitEvent(x.MoveEnd,r);var i=this._map.getTransform(),o=t.clamp(i.getZoom()+e._zoomOf(n.offset.y),i.getMinZoom(),i.getMaxZoom());this._map.getCamera().easeTo({zoom:o,pivot:this._pivotLocation},{duration:n.duration,easing:zt,noMoveStart:!0},Mt(r))},e.prototype._stepZoom=function(t){var e=this._map.getCamera();e.easeTo({zoom:e.getZoom()+(t.shiftKey?-1:1),pivot:this._pivotLocation},{},Mt(t))},e.prototype._emitEvent=function(t,e){void 0===e&&(e=null),this._map.emit(Pt.fromDomEvent(t,this._map,e))},e.prototype.isActive=function(){return this._active},e.prototype.setInteractive=function(e){this._enabled=function(){switch(typeof e){case"boolean":return e;case"object":return t.getOrDefault(e,"zoom",!1)&&(t.getOrDefault(e,"doubleClick",!1)||t.getOrDefault(e,"touch",!1));default:return!1}}()},e}(),Vt=jt,Gt=t.cubicBezier(.33,1,.9,1),qt=function(){function e(){this._points=[]}return e.prototype.reset=function(e){var r=t.browser.now();this._points=[{timeStamp:r,point:e}]},e.prototype.add=function(e){var r=t.browser.now();this._expire(r),this._points.push({timeStamp:r,point:e})},e.prototype._expire=function(t){for(var e=this._points;e.length>0&&t-e[0].timeStamp>160;)e.shift()},e.prototype.calcAnimation=function(){this._expire(t.browser.now());var e=this._points;if(e.length<2)return null;var r=e[0],n=e[e.length-1];if(r.timeStamp===n.timeStamp||t.equals(r.point,n.point))return null;var i=t.subtract(n.point,r.point),o=(n.timeStamp-r.timeStamp)/1e3,a=t.multiply(i,.9/o),s=t.magnitude(a);s>3200&&(s=3200,a=t.multiply(t.normalize(a),s));var l=s/4500;return{offset:t.multiply(a,-l/2),duration:1e3*l}},e}(),Zt=function(){function e(e){var r=this;this._requestedTask=null,this._state="Ready",this._startPoint=t.DUMMY,this._lastPoint=t.DUMMY,this._prevPoint=t.DUMMY,this._mouseEnabled=!1,this._touchEnabled=!1,this._map=e,this._element=e.getCanvasContainer(),this._mouseEventRegistrations=[{target:window.document,type:"mousemove",handler:function(t){return r._onMove(t)},options:{capture:!0,passive:!1}},{target:window.document,type:"mouseup",handler:function(t){return r._onMouseUp(t)}}],this._touchEventRegistrations=[{target:window.document,type:"touchmove",handler:function(t){return r._onMove(t)},options:{capture:!0,passive:!1}},{target:window.document,type:"touchend",handler:function(t){return r._onTouchEnd(t)}}],this._blurEventRegistration={target:window,type:"blur",handler:function(t){return r._onBlur(t)}},this._inertia=new qt}return e.prototype._bindMouseEvents=function(){t.__spreadArray(t.__spreadArray([],t.__read(this._mouseEventRegistrations),!1),[this._blurEventRegistration],!1).forEach(u)},e.prototype._bindTouchEvents=function(){t.__spreadArray(t.__spreadArray([],t.__read(this._touchEventRegistrations),!1),[this._blurEventRegistration],!1).forEach(u)},e.prototype._unbind=function(){t.__spreadArray(t.__spreadArray(t.__spreadArray([],t.__read(this._mouseEventRegistrations),!1),t.__read(this._touchEventRegistrations),!1),[this._blurEventRegistration],!1).forEach(h)},e.prototype._emitEvent=function(t,e){void 0===e&&(e=null),this._map.emit(Pt.fromDomEvent(t,this._map,e))},e.prototype.onMouseDown=function(t){this._mouseEnabled&&"Ready"===this._state&&!t.shiftKey&&0===t.button&&(this._map.getCamera().stop(),this._bindMouseEvents(),this._start(t))},e.prototype.onTouchStart=function(t){!this._touchEnabled||"Ready"!==this._state||t.touches.length>1||(this._map.getCamera().stop(),this._bindTouchEvents(),this._start(t))},e.prototype._start=function(t){this._state="Pending",this._element.classList.add("left-click");var e=this._getEventPoint(t);this._startPoint=e,this._lastPoint=e,this._prevPoint=e,this._inertia.reset(e)},e.prototype._getEventPoint=function(t){return window.TouchEvent&&t instanceof window.TouchEvent?d(this._element,t):f(this._element,t)},e.prototype._onMove=function(e){var r=this;if("touches"in e&&e.touches.length>1)this._onTouchEnd(e);else{e.cancelable&&e.preventDefault();var n=this._getEventPoint(e);t.equals(this._lastPoint,n)||(this._lastPoint=n,this._inertia.add(n),"Pending"===this._state&&(this._state="Active",this._emitEvent(x.MoveStart,e),this._emitEvent(x.DragStart,e)),this._requestedTask&&this._requestedTask.isReady()||(this._requestedTask=this._map.requestRenderFrame((function(){var t=r._map.getTransform(),n=t.screenPointToLngLat(r._prevPoint);t.setLocationAtPoint(n,r._lastPoint),r._emitEvent(x.Move,e),r._emitEvent(x.Drag,e),r._prevPoint=r._lastPoint}))))}},e.prototype._onMouseUp=function(t){0===t.button&&this._end(t)},e.prototype._onTouchEnd=function(t){this._end(t)},e.prototype._end=function(t){switch(this._state){case"Pending":this._state="Ready",this._element.classList.remove("left-click"),this._unbind();break;case"Active":this._state="Ready",this._element.classList.remove("left-click"),this._unbind(),this._deactivate(),this._panByInertia(t)}},e.prototype._onBlur=function(t){switch(this._state){case"Pending":this._state="Ready",this._element.classList.remove("left-click"),this._unbind();break;case"Active":this._state="Ready",this._element.classList.remove("left-click"),this._unbind(),this._deactivate(),this._emitEvent(x.DragEnd,t),this._emitEvent(x.MoveEnd,t)}},e.prototype._deactivate=function(){this._requestedTask&&(this._requestedTask.cancel(),this._requestedTask=null),this._startPoint=t.DUMMY,this._lastPoint=t.DUMMY,this._prevPoint=t.DUMMY},e.prototype._panByInertia=function(t){this._emitEvent(x.DragEnd,t);var e=this._inertia.calcAnimation();e?this._map.getCamera().panBy(e.offset,{duration:e.duration,easing:Gt,noMoveStart:!0},Mt(t)):this._emitEvent(x.MoveEnd,t)},e.prototype.isActive=function(){return"Active"===this._state},e.prototype.setInteractive=function(e){this._mouseEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"pan",!1)&&t.getOrDefault(e,"drag",!1),this._touchEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"pan",!1)&&t.getOrDefault(e,"touch",!1)},e}(),Wt=Zt,Ht=t.cubicBezier(0,0,.25,1),Yt=function(){function e(){this._points=[]}return e.prototype.reset=function(e){var r=t.browser.now();this._points=[{timeStamp:r,value:e}]},e.prototype.add=function(e){var r=t.browser.now();this._expire(r),this._points.push({timeStamp:r,value:e})},e.prototype._expire=function(t){for(var e=this._points;e.length>0&&t-e[0].timeStamp>160;)e.shift()},e.prototype.getLast=function(){return this._points[this._points.length-1]},e.prototype.calcAnimation=function(){this._expire(t.browser.now());var e=this._points;if(e.length<2)return null;var r=e[0],n=e[e.length-1],i=n.value-r.value,o=(n.timeStamp-r.timeStamp)/1e3;if(0===i||0===o)return null;var a=Math.abs(.25*i/o);a>60&&(a=60);var s=a/180;return{offset:Math.sign(i)*a*s/2,duration:1e3*s}},e}(),Xt=function(){function e(e){var r=this;this._requestedTask=null,this._state="Ready",this._mouseButton=0,this._startPoint=t.DUMMY,this._lastPoint=t.DUMMY,this._prevPoint=t.DUMMY,this._rotateEnabled=!1,this._pitchEnabled=!1,this._map=e,this._element=e.getCanvasContainer(),this._domEventRegistrations=[{target:window.document,type:"mousemove",handler:function(t){return r._onMouseMove(t)},options:{capture:!0}},{target:window.document,type:"mouseup",handler:function(t){return r._onMouseUp(t)}},{target:window,type:"blur",handler:function(t){return r._onBlur(t)}}],this._inertia=new Yt}return e.prototype._bind=function(){this._domEventRegistrations.forEach(u)},e.prototype._unbind=function(){this._domEventRegistrations.forEach(h)},e.prototype._emitEvent=function(t,e){void 0===e&&(e=null),this._map.emit(Pt.fromDomEvent(t,this._map,e))},e.prototype.onMouseDown=function(t){if((this._rotateEnabled||this._pitchEnabled)&&"Ready"===this._state&&(2===t.button||t.shiftKey&&0===t.button)){this._map.getCamera().stop(),this._bind(),this._state="Pending",this._element.classList.add("right-click"),this._mouseButton=t.button;var e=f(this._element,t);this._startPoint=e,this._lastPoint=e,this._prevPoint=e,this._inertia.reset(this._map.getCamera().getBearing()),t.cancelable&&t.preventDefault()}},e.prototype._onMouseMove=function(e){var r=this,n=f(this._element,e);t.equals(this._lastPoint,n)||(this._lastPoint=n,"Pending"===this._state&&(this._state="Active",this._emitEvent(x.MoveStart,e),this._rotateEnabled&&this._emitEvent(x.RotateStart,e),this._pitchEnabled&&this._emitEvent(x.PitchStart,e)),this._requestedTask&&this._requestedTask.isReady()||(this._requestedTask=this._map.requestRenderFrame((function(){var n,i,o=r._map.getTransform(),a=t.subtract(r._prevPoint,r._lastPoint),s=[x.Move];if(r._rotateEnabled){var l=Math.sign(r._lastPoint.y-r._map.getContainer().offsetHeight/2),u=o.getBearing()-l*a.x*.7;o.setBearing(u),r._inertia.add(xt(u,r._inertia.getLast().value)),s.push(x.Rotate)}if(r._pitchEnabled){var h=o.getPitch()+.4*a.y;o.setPitch(h),s.push(x.Pitch)}try{for(var c=t.__values(s),f=c.next();!f.done;f=c.next()){var p=f.value;r._emitEvent(p,e)}}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}r._prevPoint=r._lastPoint}))))},e.prototype._onMouseUp=function(t){if(t.button===this._mouseButton)switch(this._state){case"Pending":this._state="Ready",this._element.classList.remove("right-click"),this._unbind();break;case"Active":this._state="Ready",this._element.classList.remove("right-click"),this._unbind(),this._deactivate(),this._rotateByInertia(t)}},e.prototype._onBlur=function(t){switch(this._state){case"Pending":this._state="Ready",this._element.classList.remove("right-click"),this._unbind();break;case"Active":this._state="Ready",this._element.classList.remove("right-click"),this._unbind(),this._deactivate(),this._rotateEnabled&&this._emitEvent(x.RotateEnd,t),this._pitchEnabled&&this._emitEvent(x.PitchEnd,t),this._emitEvent(x.MoveEnd,t)}},e.prototype._deactivate=function(){this._requestedTask&&(this._requestedTask.cancel(),this._requestedTask=null),this._startPoint=t.DUMMY,this._lastPoint=t.DUMMY,this._prevPoint=t.DUMMY},e.prototype._rotateByInertia=function(t){this._pitchEnabled&&this._emitEvent(x.PitchEnd,t);var e=this._map.getCamera(),r=e.getBearing(),n=this._inertia.calcAnimation();if(!n)return this._rotateEnabled&&this._emitEvent(x.RotateEnd,t),void this._emitEvent(x.MoveEnd,t);e.rotateTo(xt(r+n.offset,r),{duration:n.duration,easing:Ht,noMoveStart:!0},Mt(t))},e.prototype.isActive=function(){return"Active"===this._state},e.prototype.setInteractive=function(e){this._rotateEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"rotate",!1)&&t.getOrDefault(e,"drag",!1),this._pitchEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"pitch",!1)&&t.getOrDefault(e,"drag",!1)},e}(),Kt=Xt,Qt=function(){function e(t){var e=this;this._panEnabled=!1,this._zoomEnabled=!1,this._rotateEnabled=!1,this._pitchEnabled=!1,this._map=t,this._element=t.getCanvasContainer(),this._domEventRegistration={target:this._element,type:"keydown",handler:function(t){return e._onKeyDown(t)}},this._bind()}return e.prototype._bind=function(){u(this._domEventRegistration)},e.prototype._unbind=function(){h(this._domEventRegistration)},e.prototype._onKeyDown=function(t){if(!t.altKey&&!t.ctrlKey){var e=this._map.getCamera(),r={center:e.getCenter(),zoom:e.getZoom()},n={duration:200,endDelay:500,easing:wt.EaseOut,noMoveStart:t.repeat||e.isMoving()};switch(t.code){case"ArrowLeft":if(t.shiftKey){if(!this._rotateEnabled)return;r.bearing=e.getBearing()+10}else{if(!this._panEnabled)return;n.offset={x:100,y:0}}break;case"ArrowRight":if(t.shiftKey){if(!this._rotateEnabled)return;r.bearing=e.getBearing()-10}else{if(!this._panEnabled)return;n.offset={x:-100,y:0}}break;case"ArrowUp":if(t.shiftKey){if(!this._pitchEnabled)return;r.pitch=e.getPitch()+5}else{if(!this._panEnabled)return;n.offset={x:0,y:100}}break;case"ArrowDown":if(t.shiftKey){if(!this._pitchEnabled)return;r.pitch=e.getPitch()-5}else{if(!this._panEnabled)return;n.offset={x:0,y:-100}}break;case"Minus":case"NumpadSubtract":if(!this._zoomEnabled)return;r.zoom=e.getZoom()-1;break;case"Equal":case"NumpadAdd":if(!this._zoomEnabled)return;r.zoom=e.getZoom()+1;break;default:return}e.easeTo(r,n,Mt(t))}},e.prototype.setInteractive=function(e){this._panEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"pan",!1)&&t.getOrDefault(e,"keyInput",!1),this._zoomEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"zoom",!1)&&t.getOrDefault(e,"keyInput",!1),this._rotateEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"rotate",!1)&&t.getOrDefault(e,"keyInput",!1),this._pitchEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"pitch",!1)&&t.getOrDefault(e,"keyInput",!1)},e}(),Jt=function(){function e(t){var e=this;this._timeoutId=null,this._enabled=!1,this._pressed=!1,this._lastActivatedTime=null,this._map=t,this._element=t.getCanvasContainer(),this._touchEventRegistrations=[{target:window.document,type:"touchend",handler:function(t){e._cancel(),e._unbind()}},{target:window.document,type:"touchmove",handler:function(t){e._cancel(),e._unbind()}}]}return e.prototype._bindTouchEvents=function(){t.__spreadArray([],t.__read(this._touchEventRegistrations),!1).forEach(u)},e.prototype._unbind=function(){this._touchEventRegistrations.forEach(h)},e.prototype.onTouchStart=function(t){!this._enabled||t.touches.length>1||!y(t)||(this._bindTouchEvents(),this._start(t))},e.prototype._start=function(t){var e=this,r=Date.now();this._pressed=!0,this._lastActivatedTime&&r<this._lastActivatedTime+300?this._cancel():(this._timeoutId=setTimeout((function(){e._map.emit(new Lt(x.LongTap,e._map,t)),e._pressed=!1}),400),this._lastActivatedTime=r)},e.prototype._cancel=function(){this._pressed=!1,this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},e.prototype.isActive=function(){return this._pressed},e.prototype.setInteractive=function(e){this._enabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"longTap",!1)&&t.getOrDefault(e,"touch",!1)},e}(),$t=Jt,te=t.cubicBezier(0,0,.15,1),ee=function(){function e(){this._points=[]}return e.prototype.reset=function(e,r){var n=t.browser.now();this._points=[{timeStamp:n,scale:e,center:r}]},e.prototype.add=function(e,r){var n=t.browser.now();this._expire(n),this._points.push({timeStamp:n,scale:e,center:r})},e.prototype._expire=function(t){for(var e=this._points;e.length>2&&t-e[0].timeStamp>50;)e.shift()},e.prototype.calcAnimation=function(e,r){this._expire(t.browser.now());var n=this._points;if(n.length<2)return null;var i=n[0],o=n[n.length-1],a=r.getMapDefine(),s=a.toLevel(e*i.scale),l=a.toLevel(e*o.scale);if(i.timeStamp===o.timeStamp||s===l)return null;var u=.15*(l-s)/((o.timeStamp-i.timeStamp)/1e3);Math.abs(u)>3&&(u=3*(u>0?1:-1));var h=Math.abs(u/2.25),c=l+u*h/2;return{targetZoom:c<0?0:c,pivot:r.screenPointToLngLat(o.center),duration:1e3*h}},e}(),re=function(){function e(e){var r=this;this._requestedTask=null,this._active=!1,this._gesture=null,this._startVector=t.DUMMY,this._startCenter=t.DUMMY,this._startScale=0,this._startBearing=0,this._startPitch=0,this._pivotLocation=lt,this._zoomEnabled=!1,this._rotateEnabled=!1,this._pitchEnabled=!1,this._map=e,this._element=e.getCanvasContainer(),this._domEventRegistrations=[{target:window.document,type:"touchmove",handler:function(t){return r._onMove(t)},options:{passive:!1}},{target:window.document,type:"touchend",handler:function(t){return r._onEnd(t)}}],this._inertia=new ee}return e.prototype._bind=function(){this._domEventRegistrations.forEach(u)},e.prototype._unbind=function(){this._domEventRegistrations.forEach(h)},e.prototype.onTouchStart=function(e){if((this._zoomEnabled||this._rotateEnabled||this._pitchEnabled)&&2===e.touches.length){this._map.getCamera().stop(),this._bind();var r=p(this._element,e.touches[0]),n=p(this._element,e.touches[1]),i=this._map.getTransform();this._startVector=t.subtract(r,n),this._startCenter=t.divide(t.add(r,n),2),this._startScale=i.getScale(),this._startBearing=i.getBearing(),this._startPitch=i.getPitch(),this._pivotLocation=i.screenPointToLngLat(this._startCenter),this._inertia.reset(this._startScale,this._startCenter)}},e.prototype._onMove=function(t){var e=this;if(2===t.touches.length){t.cancelable&&t.preventDefault(),this._requestedTask&&this._requestedTask.cancel();var r=this._calcMovement(t),n=r.center,i=r.scale,o=r.bearing,a=r.pitch;if(!this._gesture){if(Math.abs(o)>6&&this._rotateEnabled?this._gesture="Rotate":Math.abs(a)>4&&this._pitchEnabled?this._gesture="Pitch":Math.abs(1-i)>.05&&this._zoomEnabled&&(this._gesture="Zoom"),!this._gesture)return;this._emitEvent(x["".concat(this._gesture,"Start")],t),this._emitEvent(x.MoveStart,t),this._active=!0}this._requestedTask&&this._requestedTask.isReady()||(this._requestedTask=this._map.requestRenderFrame((function(){var r=e._gesture;if(r){var s=e._map.getTransform(),l=s.getMapDefine();"Rotate"===r?s.setBearing(e._startBearing+o):"Pitch"===r?s.setPitch(e._startPitch+a):(s.setZoom(l.toLevel(e._startScale*i)),s.setLocationAtPoint(e._pivotLocation,n)),e._emitEvent(x.Move,t),e._emitEvent(r,t),e._inertia.add(i,n)}})))}},e.prototype._calcMovement=function(e){var r=p(this._element,e.touches[0]),n=p(this._element,e.touches[1]),i=t.subtract(r,n),o=t.divide(t.add(r,n),2);return{vector:i,center:o,scale:t.magnitude(i)/t.magnitude(this._startVector),bearing:t.toDegree(t.angle(i,this._startVector)),pitch:.4*t.subtract(this._startCenter,o).y}},e.prototype._onEnd=function(t){if(!(t.touches.length>0)){var e=this._gesture,r=this._startScale;switch(this._active=!1,this._unbind(),this._deactivate(),e){case"Pitch":case"Rotate":this._emitEvent(x["".concat(e,"End")],t),this._emitEvent(x.MoveEnd);break;case"Zoom":this._zoomByInertia(t,r);break;default:this._zoomEnabled&&this._stepZoom(t)}}},e.prototype._zoomByInertia=function(t,e){var r=this._inertia.calcAnimation(e,this._map.getTransform());if(!r)return this._emitEvent(x.ZoomEnd,t),void this._emitEvent(x.MoveEnd,t);this._map.getCamera().easeTo({zoom:r.targetZoom,pivot:r.pivot},{duration:r.duration,easing:te,noMoveStart:!0},Mt(t))},e.prototype._stepZoom=function(t){var e=this._map.getCamera();e.easeTo({zoom:e.getZoom()-1,pivot:this._pivotLocation},{},Mt(t))},e.prototype._deactivate=function(){this._requestedTask&&(this._requestedTask.cancel(),this._requestedTask=null),this._gesture=null},e.prototype._emitEvent=function(t,e){void 0===e&&(e=null),this._map.emit(Pt.fromDomEvent(t,this._map,e))},e.prototype.isActive=function(){return this._active},e.prototype.setInteractive=function(e){this._zoomEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"zoom",!1)&&t.getOrDefault(e,"touch",!1),this._rotateEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"rotate",!1)&&t.getOrDefault(e,"touch",!1),this._pitchEnabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"pitch",!1)&&t.getOrDefault(e,"touch",!1)},e}(),ne=re,ie=function(){function e(e){this._stopWatch=new Ct(t.browser),this._duration=e,this._easing=wt.Ease}return e.prototype.apply=function(t){return this._easing(t)},e.prototype.next=function(){var e=this._stopWatch,r=this._easing;if("Stopped"!==e.state){e.stop();var n=e.getElapsedTime()/this._duration,i=r(n+.01)-r(n),o=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-o*o);this._easing=t.cubicBezier(o,a,.25,1),e.start()}else e.start()},e}(),oe=4.000244140625,ae=function(){function e(e){this._requestedTask=null,this._pivotPoint=t.DUMMY,this._pivotLocation=lt,this._type="Unknown",this._unknownTypeFirstState=null,this._needAnimation=!1,this._finishTimeoutId=null,this._enabled=!1,this._map=e,this._element=e.getCanvasContainer(),this._stopWatch=Ct.newInstanceWithStart(t.browser),this._delta=0,this._active=!1,this._zooming=!1,this._startZoom=0,this._targetZoom=0,this._easingFunc=new ie(200)}return e.prototype.onWheel=function(t){var e=this;if(this._enabled){this._map.getCamera().stop();var r=this._stopWatch.getElapsedTime();this._stopWatch.restart();var n=function(r){if("Unknown"!==e._type){var n=e._map.getTransform();(r>0&&n.getZoom()>n.getMinZoom()||r<0&&n.getZoom()<n.getMaxZoom())&&(t.shiftKey&&r&&(r/=4),e._delta-=r),e._active||0===e._delta||e._startAnimation(t)}},i=function(t){var e=t.deltaMode,r=t.deltaX,n=t.deltaY;switch(e){case 0:default:return{deltaX:r,deltaY:n};case 1:return{deltaX:40*r,deltaY:40*n};case 2:return{deltaX:800*r,deltaY:800*n}}}(t).deltaY;if(i%oe==0)this._type="Mouse";else if(Math.abs(i)<oe)this._type="Trackpad";else if(r>400)this._type="Unknown",this._unknownTypeFirstState={singleActionTimeoutId:setTimeout((function(){e._unknownTypeFirstState=null,e._type="Mouse",n(i)}),40),timeDelta:r,value:i};else if("Unknown"===this._type){if(this._unknownTypeFirstState){var o=this._unknownTypeFirstState,a=o.singleActionTimeoutId,s=o.timeDelta,l=o.value;this._unknownTypeFirstState=null,clearTimeout(a),r+=s,i+=l}this._type=Math.abs(r*i)<200?"Trackpad":"Mouse"}n(i),t.cancelable&&t.preventDefault()}},e.prototype._startAnimation=function(e){var r=this;this._requestedTask&&(this._requestedTask.cancel(),this._requestedTask=null),this._active=!0,this._element.classList.add("wheel");var n=this._map.getTransform();this._zooming||(this._zooming=!0,this._emitEvent(x.MoveStart,e),this._emitEvent(x.ZoomStart,e)),this._finishTimeoutId&&clearTimeout(this._finishTimeoutId),this._pivotPoint=f(this._element,e),this._pivotLocation=n.screenPointToLngLat(this._pivotPoint);var i=function(){if(r._requestedTask=null,r._active){r._handleContinuousWheel();var o=!1;if(r._needAnimation){var a=Math.min(r._stopWatch.getElapsedTime()/200,1),s=t.interpolate(r._startZoom,r._targetZoom,r._easingFunc.apply(a));n.setZoom(s),a<1?r._requestRenderFrame(i):o=!0}else n.setZoom(r._targetZoom),o=!0;n.setLocationAtPoint(r._pivotLocation,r._pivotPoint),r._emitEvent(x.Move,e),r._emitEvent(x.Zoom,e),o&&(r._active=!1,r._element.classList.remove("wheel"),r._finishTimeoutId=setTimeout((function(){r._requestedTask=null,r._zooming=!1,r._emitEvent(x.ZoomEnd,e),r._emitEvent(x.MoveEnd,e)}),200))}};this._requestRenderFrame(i)},e.prototype._requestRenderFrame=function(t){this._requestedTask&&this._requestedTask.isReady()||(this._requestedTask=this._map.requestRenderFrame(t))},e.prototype._emitEvent=function(t,e){this._map.emit(Pt.fromDomEvent(t,this._map,e))},e.prototype._handleContinuousWheel=function(){var e=this._map.getTransform();if(0!==this._delta){var r=this._delta;this._delta=0,this._needAnimation="Mouse"===this._type;var n=2*t.sigmoid(Math.abs(.01*r));n=r<0?1/n:n;var i=e.getMapDefine();this._startZoom=e.getZoom(),this._targetZoom=t.clamp(i.toLevel(e.getScale()*n),e.getMinZoom(),e.getMaxZoom()),this._easingFunc.next()}},e.prototype.isActive=function(){return this._active},e.prototype.isZooming=function(){return this._zooming},e.prototype.setInteractive=function(e){this._enabled=!0===e||"object"==typeof e&&t.getOrDefault(e,"zoom",!1)&&t.getOrDefault(e,"wheel",!1)},e}(),se=ae,le={exports:{}},ue=t.performanceNowExports,he="undefined"==typeof window?global:window,ce=["moz","webkit"],fe="AnimationFrame",pe=he["request"+fe],de=he["cancel"+fe]||he["cancelRequest"+fe],ye=0;!pe&&ye<ce.length;ye++)pe=he[ce[ye]+"Request"+fe],de=he[ce[ye]+"Cancel"+fe]||he[ce[ye]+"CancelRequest"+fe];if(!pe||!de){var ge=0,ve=0,_e=[];pe=function(t){if(0===_e.length){var e=ue(),r=Math.max(0,16.666666666666668-(e-ge));ge=r+e,setTimeout((function(){var t=_e.slice(0);_e.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(ge)}catch(t){setTimeout((function(){throw t}),0)}}),Math.round(r))}return _e.push({handle:++ve,callback:t,cancelled:!1}),ve},de=function(t){for(var e=0;e<_e.length;e++)_e[e].handle===t&&(_e[e].cancelled=!0)}}le.exports=function(t){return pe.call(he,t)},le.exports.cancel=function(){de.apply(he,arguments)},le.exports.polyfill=function(t){t||(t=he),t.requestAnimationFrame=pe,t.cancelAnimationFrame=de};var me=le.exports,be=t.getDefaultExportFromCjs(me),xe={exports:{}};!function(t,e){!function(r,n){var i="function",o="undefined",a="object",s="string",l="major",u="model",h="name",c="type",f="vendor",p="version",d="architecture",y="console",g="mobile",v="tablet",_="smarttv",m="wearable",b="embedded",x="Amazon",w="Apple",M="ASUS",S="BlackBerry",P="Browser",T="Chrome",E="Firefox",L="Google",k="Huawei",I="LG",A="Microsoft",C="Motorola",O="Opera",R="Samsung",D="Sharp",F="Sony",B="Xiaomi",N="Zebra",z="Facebook",U="Chromium OS",j="Mac OS",V=function(t){for(var e={},r=0;r<t.length;r++)e[t[r].toUpperCase()]=t[r];return e},G=function(t,e){return typeof t===s&&-1!==q(e).indexOf(q(t))},q=function(t){return t.toLowerCase()},Z=function(t,e){if(typeof t===s)return t=t.replace(/^\s\s*/,""),typeof e===o?t:t.substring(0,350)},W=function(t,e){for(var r,o,s,l,u,h,c=0;c<e.length&&!u;){var f=e[c],p=e[c+1];for(r=o=0;r<f.length&&!u&&f[r];)if(u=f[r++].exec(t))for(s=0;s<p.length;s++)h=u[++o],typeof(l=p[s])===a&&l.length>0?2===l.length?typeof l[1]==i?this[l[0]]=l[1].call(this,h):this[l[0]]=l[1]:3===l.length?typeof l[1]!==i||l[1].exec&&l[1].test?this[l[0]]=h?h.replace(l[1],l[2]):n:this[l[0]]=h?l[1].call(this,h,l[2]):n:4===l.length&&(this[l[0]]=h?l[3].call(this,h.replace(l[1],l[2])):n):this[l]=h||n;c+=2}},H=function(t,e){for(var r in e)if(typeof e[r]===a&&e[r].length>0){for(var i=0;i<e[r].length;i++)if(G(e[r][i],t))return"?"===r?n:r}else if(G(e[r],t))return"?"===r?n:r;return t},Y={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,p],[/opios[\/ ]+([\w\.]+)/i],[p,[h,O+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[h,O]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[h,"UC"+P]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+P],p],[/\bfocus\/([\w\.]+)/i],[p,[h,E+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[h,O+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[h,O+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[h,"MIUI "+P]],[/fxios\/([-\w\.]+)/i],[p,[h,E]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+P]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+P],p],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,z],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[h,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,T+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[h,"Android "+P]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[p,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[h,E+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,p],[/(cobalt)\/([\w\.]+)/i],[h,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[d,"amd64"]],[/(ia32(?=;))/i],[[d,q]],[/((?:i[346]|x)86)[;\)]/i],[[d,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[d,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[d,"armhf"]],[/windows (ce|mobile); ppc;/i],[[d,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[d,/ower/,"",q]],[/(sun4\w)[;\)]/i],[[d,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[d,q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[f,R],[c,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[f,R],[c,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[f,w],[c,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[f,w],[c,v]],[/(macintosh);/i],[u,[f,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[f,D],[c,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[f,k],[c,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[f,k],[c,g]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[f,B],[c,g]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[f,B],[c,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[f,"OPPO"],[c,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[f,"Vivo"],[c,g]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[f,"Realme"],[c,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[f,C],[c,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[f,C],[c,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[f,I],[c,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[f,I],[c,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[f,"Lenovo"],[c,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[f,"Nokia"],[c,g]],[/(pixel c)\b/i],[u,[f,L],[c,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[f,L],[c,g]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[f,F],[c,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[f,F],[c,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[f,"OnePlus"],[c,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[f,x],[c,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[f,x],[c,g]],[/(playbook);[-\w\),; ]+(rim)/i],[u,f,[c,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[f,S],[c,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[f,M],[c,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[f,M],[c,g]],[/(nexus 9)/i],[u,[f,"HTC"],[c,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[u,/_/g," "],[c,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[f,"Acer"],[c,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[f,"Meizu"],[c,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,u,[c,g]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,u,[c,v]],[/(surface duo)/i],[u,[f,A],[c,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[f,"Fairphone"],[c,g]],[/(u304aa)/i],[u,[f,"AT&T"],[c,g]],[/\bsie-(\w*)/i],[u,[f,"Siemens"],[c,g]],[/\b(rct\w+) b/i],[u,[f,"RCA"],[c,v]],[/\b(venue[\d ]{2,7}) b/i],[u,[f,"Dell"],[c,v]],[/\b(q(?:mv|ta)\w+) b/i],[u,[f,"Verizon"],[c,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[f,"Barnes & Noble"],[c,v]],[/\b(tm\d{3}\w+) b/i],[u,[f,"NuVision"],[c,v]],[/\b(k88) b/i],[u,[f,"ZTE"],[c,v]],[/\b(nx\d{3}j) b/i],[u,[f,"ZTE"],[c,g]],[/\b(gen\d{3}) b.+49h/i],[u,[f,"Swiss"],[c,g]],[/\b(zur\d{3}) b/i],[u,[f,"Swiss"],[c,v]],[/\b((zeki)?tb.*\b) b/i],[u,[f,"Zeki"],[c,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],u,[c,v]],[/\b(ns-?\w{0,9}) b/i],[u,[f,"Insignia"],[c,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[f,"NextBook"],[c,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],u,[c,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],u,[c,g]],[/\b(ph-1) /i],[u,[f,"Essential"],[c,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[f,"Envizen"],[c,v]],[/\b(trio[-\w\. ]+) b/i],[u,[f,"MachSpeed"],[c,v]],[/\btu_(1491) b/i],[u,[f,"Rotor"],[c,v]],[/(shield[\w ]+) b/i],[u,[f,"Nvidia"],[c,v]],[/(sprint) (\w+)/i],[f,u,[c,g]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[f,A],[c,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[f,N],[c,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[f,N],[c,g]],[/smart-tv.+(samsung)/i],[f,[c,_]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[f,R],[c,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,I],[c,_]],[/(apple) ?tv/i],[f,[u,w+" TV"],[c,_]],[/crkey/i],[[u,T+"cast"],[f,L],[c,_]],[/droid.+aft(\w)( bui|\))/i],[u,[f,x],[c,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[f,D],[c,_]],[/(bravia[\w ]+)( bui|\))/i],[u,[f,F],[c,_]],[/(mitv-\w{5}) bui/i],[u,[f,B],[c,_]],[/Hbbtv.*(technisat) (.*);/i],[f,u,[c,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,Z],[u,Z],[c,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[c,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,u,[c,y]],[/droid.+; (shield) bui/i],[u,[f,"Nvidia"],[c,y]],[/(playstation [345portablevi]+)/i],[u,[f,F],[c,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[f,A],[c,y]],[/((pebble))app/i],[f,u,[c,m]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[f,w],[c,m]],[/droid.+; (glass) \d/i],[u,[f,L],[c,m]],[/droid.+; (wt63?0{2,3})\)/i],[u,[f,N],[c,m]],[/(quest( 2| pro)?)/i],[u,[f,z],[c,m]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[c,b]],[/(aeobc)\b/i],[u,[f,x],[c,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[c,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[c,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[c,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[c,g]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[p,H,Y]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[p,H,Y]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,j],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,p],[/\(bb(10);/i],[p,[h,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[h,E+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[h,T+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,U],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,p],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,p]]},K=function(t,e){if(typeof t===a&&(e=t,t=n),!(this instanceof K))return new K(t,e).getResult();var y=typeof r!==o&&r.navigator?r.navigator:n,_=t||(y&&y.userAgent?y.userAgent:""),m=y&&y.userAgentData?y.userAgentData:n,b=e?function(t,e){var r={};for(var n in t)e[n]&&e[n].length%2==0?r[n]=e[n].concat(t[n]):r[n]=t[n];return r}(X,e):X,x=y&&y.userAgent==_;return this.getBrowser=function(){var t,e={};return e[h]=n,e[p]=n,W.call(e,_,b.browser),e[l]=typeof(t=e[p])===s?t.replace(/[^\d\.]/g,"").split(".")[0]:n,x&&y&&y.brave&&typeof y.brave.isBrave==i&&(e[h]="Brave"),e},this.getCPU=function(){var t={};return t[d]=n,W.call(t,_,b.cpu),t},this.getDevice=function(){var t={};return t[f]=n,t[u]=n,t[c]=n,W.call(t,_,b.device),x&&!t[c]&&m&&m.mobile&&(t[c]=g),x&&"Macintosh"==t[u]&&y&&typeof y.standalone!==o&&y.maxTouchPoints&&y.maxTouchPoints>2&&(t[u]="iPad",t[c]=v),t},this.getEngine=function(){var t={};return t[h]=n,t[p]=n,W.call(t,_,b.engine),t},this.getOS=function(){var t={};return t[h]=n,t[p]=n,W.call(t,_,b.os),x&&!t[h]&&m&&"Unknown"!=m.platform&&(t[h]=m.platform.replace(/chrome os/i,U).replace(/macos/i,j)),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return _},this.setUA=function(t){return _=typeof t===s&&t.length>350?Z(t,350):t,this},this.setUA(_),this};K.VERSION="1.0.35",K.BROWSER=V([h,p,l]),K.CPU=V([d]),K.DEVICE=V([u,f,c,y,g,_,v,m,b]),K.ENGINE=K.OS=V([h,p]),t.exports&&(e=t.exports=K),e.UAParser=K;var Q=typeof r!==o&&(r.jQuery||r.Zepto);if(Q&&!Q.ua){var J=new K;Q.ua=J.getResult(),Q.ua.get=function(){return J.getUA()},Q.ua.set=function(t){J.setUA(t);var e=J.getResult();for(var r in e)Q.ua[r]=e[r]}}}("object"==typeof window?window:this)}(xe,xe.exports);var we=xe.exports,Me=t.getDefaultExportFromCjs(we)(),Se={pan:!0,zoom:!0,rotate:!0,pitch:!0,drag:!0,wheel:!0,doubleClick:!0,touch:!0,keyInput:!0},Pe=function(){function e(e,r){var n=this;this._mouseDownPoint=null,this._mouseMoveAtDown=!1,this._contextMenuEvent=null,this._lastTouchStartTime=null,this._interactive=!1,this._map=e,this._dragPanHandler=new Wt(e),this._wheelZoomHandler=new se(e),this._dragRotatePitchHandler=new Kt(e),this._touchZoomRotatePitchHandler=new ne(e),this._doubleClickZoomHandler=new Vt(e),this._keyInputHandler=new Qt(e),this._longTapHandler=new $t(e),this.setInteractive(r);var i=this._map.getCanvasContainer();this._domEventRegistrations=[{target:i,type:"click",handler:function(e){(function(){var t=Date.now();return Boolean(!n._mouseDownPoint&&n._lastTouchStartTime&&t<n._lastTouchStartTime+400)}()||function(e,r){var i=f(e,r);return Boolean(!n._mouseMoveAtDown&&n._mouseDownPoint&&t.distance(i,n._mouseDownPoint)<3)}(i,e))&&n._emitMouseEvent(x.Click,e),n._mouseMoveAtDown=!1,n._mouseDownPoint=null}},{target:i,type:"dblclick",handler:function(t){n._emitMouseEvent(x.DoubleClick,t)}},{target:i,type:"mousedown",handler:function(t){"iOS"!==Me.os.name&&(n._mouseMoveAtDown=!1,n._mouseDownPoint=f(i,t)),n._emitMouseEvent(x.MouseDown,t).defaultPrevented||(n._doubleClickZoomHandler.onMouseDown(t),n.isEnabled()&&!n._doubleClickZoomHandler.isActive()&&(n._map.getCamera().stop(),n._dragPanHandler.isActive()||n._dragRotatePitchHandler.onMouseDown(t),n._dragRotatePitchHandler.isActive()||n._dragPanHandler.onMouseDown(t)))}},{target:i,type:"mouseup",handler:function(t){n._contextMenuEvent&&(n._emitMouseEvent(x.ContextMenu,n._contextMenuEvent),n._contextMenuEvent=null),n._emitMouseEvent(x.MouseUp,t)}},{target:i,type:"mousemove",handler:function(t){n._mouseDownPoint&&(n._mouseMoveAtDown=!0),(n._dragPanHandler.isActive()||n._dragRotatePitchHandler.isActive())&&n._doubleClickZoomHandler.reset(),n._emitMouseEvent(x.MouseMove,t)}},{target:i,type:"mouseover",handler:function(t){n._emitMouseEvent(x.MouseOver,t)}},{target:i,type:"mouseout",handler:function(t){n._emitMouseEvent(x.MouseOut,t)}},{target:i,type:"contextmenu",handler:function(t){n._dragRotatePitchHandler.isActive()||n._longTapHandler.isActive()||(n._contextMenuEvent=t),t.cancelable&&t.preventDefault()}},{target:i,type:"wheel",handler:function(t){n._emitMouseEvent(x.Wheel,t).defaultPrevented||(n.isEnabled()&&n._map.getCamera().stop(),n._wheelZoomHandler.onWheel(t))},options:{passive:!1}},{target:i,type:"touchstart",handler:function(t){n._emitTouchEvent(x.TouchStart,t).defaultPrevented||(n._lastTouchStartTime=Date.now(),n._doubleClickZoomHandler.onTouchStart(t),n._longTapHandler.onTouchStart(t),n.isEnabled()&&!n._doubleClickZoomHandler.isActive()&&(n._map.getCamera().stop(),n._dragPanHandler.onTouchStart(t),n._touchZoomRotatePitchHandler.onTouchStart(t)))},options:{passive:!1}},{target:i,type:"touchmove",handler:function(t){(n._dragPanHandler.isActive()||n._touchZoomRotatePitchHandler.isActive())&&n._doubleClickZoomHandler.reset(),n._emitTouchEvent(x.TouchMove,t)},options:{passive:!1}},{target:i,type:"touchend",handler:function(t){n._lastTouchStartTime=null,n._emitTouchEvent(x.TouchEnd,t)}},{target:i,type:"touchcancel",handler:function(t){n._emitTouchEvent(x.TouchCancel,t)}}]}return e.prototype._emitMouseEvent=function(t,e){var r=new Et(t,this._map,e);return this._map.emit(r),r},e.prototype._emitTouchEvent=function(t,e){var r=new Lt(t,this._map,e);return this._map.emit(r),r},e.prototype.bind=function(){this._domEventRegistrations.forEach(u)},e.prototype.unbind=function(){this._domEventRegistrations.forEach(h)},e.prototype.isActive=function(){return this._dragPanHandler.isActive()||this._dragRotatePitchHandler.isActive()||this._wheelZoomHandler.isActive()||this._doubleClickZoomHandler.isActive()||this._touchZoomRotatePitchHandler.isActive()},e.prototype.setInteractive=function(e){e="object"==typeof e?t.__assign(t.__assign({},Se),e):e,this._interactive=e,this._dragPanHandler.setInteractive(e),this._wheelZoomHandler.setInteractive(e),this._dragRotatePitchHandler.setInteractive(e),this._touchZoomRotatePitchHandler.setInteractive(e),this._doubleClickZoomHandler.setInteractive(e),this._keyInputHandler.setInteractive(e),this._longTapHandler.setInteractive(e)},e.prototype.getInteractive=function(){return this._interactive},e.prototype.isEnabled=function(){var e,r,n=this._interactive;if("boolean"==typeof n)return n;try{for(var i=t.__values(Object.values(n)),o=i.next();!o.done;o=i.next())if(o.value)return!0}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return!1},e}(),Te=Pe,Ee="object"==typeof global&&global&&global.Object===Object&&global,Le="object"==typeof self&&self&&self.Object===Object&&self,ke=Ee||Le||Function("return this")(),Ie=ke.Symbol,Ae=Object.prototype,Ce=Ae.hasOwnProperty,Oe=Ae.toString,Re=Ie?Ie.toStringTag:void 0,De=Object.prototype.toString,Fe="[object Null]",Be="[object Undefined]",Ne=Ie?Ie.toStringTag:void 0;function ze(t){return null==t?void 0===t?Be:Fe:Ne&&Ne in Object(t)?function(t){var e=Ce.call(t,Re),r=t[Re];try{t[Re]=void 0;var n=!0}catch(t){}var i=Oe.call(t);return n&&(e?t[Re]=r:delete t[Re]),i}(t):function(t){return De.call(t)}(t)}function Ue(t){return null!=t&&"object"==typeof t}var je="[object Symbol]",Ve=Array.isArray,Ge=/\s/,qe=/^\s+/;function Ze(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var We=NaN,He=/^[-+]0x[0-9a-f]+$/i,Ye=/^0b[01]+$/i,Xe=/^0o[0-7]+$/i,Ke=parseInt;function Qe(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||Ue(t)&&ze(t)==je}(t))return We;if(Ze(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ze(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=function(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Ge.test(t.charAt(e)););return e}(t)+1).replace(qe,""):t}(t);var r=Ye.test(t);return r||Xe.test(t)?Ke(t.slice(2),r?2:8):He.test(t)?We:+t}var Je="[object AsyncFunction]",$e="[object Function]",tr="[object GeneratorFunction]",er="[object Proxy]";function rr(t){if(!Ze(t))return!1;var e=ze(t);return e==$e||e==tr||e==Je||e==er}var nr,ir=ke["__core-js_shared__"],or=(nr=/[^.]+$/.exec(ir&&ir.keys&&ir.keys.IE_PROTO||""))?"Symbol(src)_1."+nr:"",ar=Function.prototype.toString;function sr(t){if(null!=t){try{return ar.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var lr=/^\[object .+?Constructor\]$/,ur=Function.prototype,hr=Object.prototype,cr=ur.toString,fr=hr.hasOwnProperty,pr=RegExp("^"+cr.call(fr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function dr(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Ze(t)||(e=t,or&&or in e))&&(rr(t)?pr:lr).test(sr(t));var e}(r)?r:void 0}var yr=dr(ke,"WeakMap"),gr=Object.create,vr=function(){function t(){}return function(e){if(!Ze(e))return{};if(gr)return gr(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),_r=function(){try{var t=dr(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),mr=9007199254740991,br=/^(?:0|[1-9]\d*)$/;function xr(t,e){var r=typeof t;return!!(e=null==e?mr:e)&&("number"==r||"symbol"!=r&&br.test(t))&&t>-1&&t%1==0&&t<e}function wr(t,e,r){"__proto__"==e&&_r?_r(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function Mr(t,e){return t===e||t!=t&&e!=e}var Sr=Object.prototype.hasOwnProperty;function Pr(t,e,r){var n=t[e];Sr.call(t,e)&&Mr(n,r)&&(void 0!==r||e in t)||wr(t,e,r)}function Tr(t,e,r,n){var i=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var s=e[o],l=n?n(r[s],t[s],s,r,t):void 0;void 0===l&&(l=t[s]),i?wr(r,s,l):Pr(r,s,l)}return r}var Er=9007199254740991;function Lr(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Er}function kr(t){return null!=t&&Lr(t.length)&&!rr(t)}var Ir=Object.prototype;function Ar(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ir)}function Cr(t){return Ue(t)&&"[object Arguments]"==ze(t)}var Or=Object.prototype,Rr=Or.hasOwnProperty,Dr=Or.propertyIsEnumerable,Fr=Cr(function(){return arguments}())?Cr:function(t){return Ue(t)&&Rr.call(t,"callee")&&!Dr.call(t,"callee")},Br=Fr,Nr="object"==typeof exports&&exports&&!exports.nodeType&&exports,zr=Nr&&"object"==typeof r&&r&&!r.nodeType&&r,Ur=zr&&zr.exports===Nr?ke.Buffer:void 0,jr=(Ur?Ur.isBuffer:void 0)||function(){return!1},Vr={};function Gr(t){return function(e){return t(e)}}Vr["[object Float32Array]"]=Vr["[object Float64Array]"]=Vr["[object Int8Array]"]=Vr["[object Int16Array]"]=Vr["[object Int32Array]"]=Vr["[object Uint8Array]"]=Vr["[object Uint8ClampedArray]"]=Vr["[object Uint16Array]"]=Vr["[object Uint32Array]"]=!0,Vr["[object Arguments]"]=Vr["[object Array]"]=Vr["[object ArrayBuffer]"]=Vr["[object Boolean]"]=Vr["[object DataView]"]=Vr["[object Date]"]=Vr["[object Error]"]=Vr["[object Function]"]=Vr["[object Map]"]=Vr["[object Number]"]=Vr["[object Object]"]=Vr["[object RegExp]"]=Vr["[object Set]"]=Vr["[object String]"]=Vr["[object WeakMap]"]=!1;var qr="object"==typeof exports&&exports&&!exports.nodeType&&exports,Zr=qr&&"object"==typeof r&&r&&!r.nodeType&&r,Wr=Zr&&Zr.exports===qr&&Ee.process,Hr=function(){try{return Zr&&Zr.require&&Zr.require("util").types||Wr&&Wr.binding&&Wr.binding("util")}catch(t){}}(),Yr=Hr&&Hr.isTypedArray,Xr=Yr?Gr(Yr):function(t){return Ue(t)&&Lr(t.length)&&!!Vr[ze(t)]},Kr=Object.prototype.hasOwnProperty;function Qr(t,e){var r=Ve(t),n=!r&&Br(t),i=!r&&!n&&jr(t),o=!r&&!n&&!i&&Xr(t),a=r||n||i||o,s=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],l=s.length;for(var u in t)!e&&!Kr.call(t,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||xr(u,l))||s.push(u);return s}function Jr(t,e){return function(r){return t(e(r))}}var $r=Jr(Object.keys,Object),tn=Object.prototype.hasOwnProperty;function en(t){return kr(t)?Qr(t):function(t){if(!Ar(t))return $r(t);var e=[];for(var r in Object(t))tn.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}var rn=Object.prototype.hasOwnProperty;function nn(t){return kr(t)?Qr(t,!0):function(t){if(!Ze(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=Ar(t),r=[];for(var n in t)("constructor"!=n||!e&&rn.call(t,n))&&r.push(n);return r}(t)}var on=dr(Object,"create"),an=Object.prototype.hasOwnProperty,sn=Object.prototype.hasOwnProperty;function ln(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function un(t,e){for(var r=t.length;r--;)if(Mr(t[r][0],e))return r;return-1}ln.prototype.clear=function(){this.__data__=on?on(null):{},this.size=0},ln.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ln.prototype.get=function(t){var e=this.__data__;if(on){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return an.call(e,t)?e[t]:void 0},ln.prototype.has=function(t){var e=this.__data__;return on?void 0!==e[t]:sn.call(e,t)},ln.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=on&&void 0===e?"__lodash_hash_undefined__":e,this};var hn=Array.prototype.splice;function cn(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}cn.prototype.clear=function(){this.__data__=[],this.size=0},cn.prototype.delete=function(t){var e=this.__data__,r=un(e,t);return!(r<0||(r==e.length-1?e.pop():hn.call(e,r,1),--this.size,0))},cn.prototype.get=function(t){var e=this.__data__,r=un(e,t);return r<0?void 0:e[r][1]},cn.prototype.has=function(t){return un(this.__data__,t)>-1},cn.prototype.set=function(t,e){var r=this.__data__,n=un(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var fn=dr(ke,"Map");function pn(t,e){var r,n,i=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function dn(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function yn(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}dn.prototype.clear=function(){this.size=0,this.__data__={hash:new ln,map:new(fn||cn),string:new ln}},dn.prototype.delete=function(t){var e=pn(this,t).delete(t);return this.size-=e?1:0,e},dn.prototype.get=function(t){return pn(this,t).get(t)},dn.prototype.has=function(t){return pn(this,t).has(t)},dn.prototype.set=function(t,e){var r=pn(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var gn=Jr(Object.getPrototypeOf,Object);function vn(t){var e=this.__data__=new cn(t);this.size=e.size}vn.prototype.clear=function(){this.__data__=new cn,this.size=0},vn.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},vn.prototype.get=function(t){return this.__data__.get(t)},vn.prototype.has=function(t){return this.__data__.has(t)},vn.prototype.set=function(t,e){var r=this.__data__;if(r instanceof cn){var n=r.__data__;if(!fn||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new dn(n)}return r.set(t,e),this.size=r.size,this};var _n="object"==typeof exports&&exports&&!exports.nodeType&&exports,mn=_n&&"object"==typeof r&&r&&!r.nodeType&&r,bn=mn&&mn.exports===_n?ke.Buffer:void 0,xn=bn?bn.allocUnsafe:void 0;function wn(){return[]}var Mn=Object.prototype.propertyIsEnumerable,Sn=Object.getOwnPropertySymbols,Pn=Sn?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,i=0,o=[];++r<n;){var a=t[r];e(a)&&(o[i++]=a)}return o}(Sn(t),(function(e){return Mn.call(t,e)})))}:wn,Tn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)yn(e,Pn(t)),t=gn(t);return e}:wn;function En(t,e,r){var n=e(t);return Ve(t)?n:yn(n,r(t))}function Ln(t){return En(t,en,Pn)}function kn(t){return En(t,nn,Tn)}var In=dr(ke,"DataView"),An=dr(ke,"Promise"),Cn=dr(ke,"Set"),On="[object Map]",Rn="[object Promise]",Dn="[object Set]",Fn="[object WeakMap]",Bn="[object DataView]",Nn=sr(In),zn=sr(fn),Un=sr(An),jn=sr(Cn),Vn=sr(yr),Gn=ze;(In&&Gn(new In(new ArrayBuffer(1)))!=Bn||fn&&Gn(new fn)!=On||An&&Gn(An.resolve())!=Rn||Cn&&Gn(new Cn)!=Dn||yr&&Gn(new yr)!=Fn)&&(Gn=function(t){var e=ze(t),r="[object Object]"==e?t.constructor:void 0,n=r?sr(r):"";if(n)switch(n){case Nn:return Bn;case zn:return On;case Un:return Rn;case jn:return Dn;case Vn:return Fn}return e});var qn=Gn,Zn=Object.prototype.hasOwnProperty,Wn=ke.Uint8Array;function Hn(t){var e=new t.constructor(t.byteLength);return new Wn(e).set(new Wn(t)),e}var Yn=/\w*$/,Xn=Ie?Ie.prototype:void 0,Kn=Xn?Xn.valueOf:void 0,Qn="[object Boolean]",Jn="[object Date]",$n="[object Map]",ti="[object Number]",ei="[object RegExp]",ri="[object Set]",ni="[object String]",ii="[object Symbol]",oi="[object ArrayBuffer]",ai="[object DataView]",si="[object Float32Array]",li="[object Float64Array]",ui="[object Int8Array]",hi="[object Int16Array]",ci="[object Int32Array]",fi="[object Uint8Array]",pi="[object Uint8ClampedArray]",di="[object Uint16Array]",yi="[object Uint32Array]";var gi=Hr&&Hr.isMap,vi=gi?Gr(gi):function(t){return Ue(t)&&"[object Map]"==qn(t)},_i=Hr&&Hr.isSet,mi=_i?Gr(_i):function(t){return Ue(t)&&"[object Set]"==qn(t)},bi=1,xi=2,wi=4,Mi="[object Arguments]",Si="[object Function]",Pi="[object GeneratorFunction]",Ti="[object Object]",Ei={};function Li(t,e,r,n,i,o){var a,s=e&bi,l=e&xi,u=e&wi;if(r&&(a=i?r(t,n,i,o):r(t)),void 0!==a)return a;if(!Ze(t))return t;var h=Ve(t);if(h){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Zn.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!s)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,a)}else{var c=qn(t),f=c==Si||c==Pi;if(jr(t))return function(t,e){if(e)return t.slice();var r=t.length,n=xn?xn(r):new t.constructor(r);return t.copy(n),n}(t,s);if(c==Ti||c==Mi||f&&!i){if(a=l||f?{}:function(t){return"function"!=typeof t.constructor||Ar(t)?{}:vr(gn(t))}(t),!s)return l?function(t,e){return Tr(t,Tn(t),e)}(t,function(t,e){return t&&Tr(e,nn(e),t)}(a,t)):function(t,e){return Tr(t,Pn(t),e)}(t,function(t,e){return t&&Tr(e,en(e),t)}(a,t))}else{if(!Ei[c])return i?t:{};a=function(t,e,r){var n,i,o,a=t.constructor;switch(e){case oi:return Hn(t);case Qn:case Jn:return new a(+t);case ai:return function(t,e){var r=e?Hn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case si:case li:case ui:case hi:case ci:case fi:case pi:case di:case yi:return function(t,e){var r=e?Hn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case $n:return new a;case ti:case ni:return new a(t);case ei:return(o=new(i=t).constructor(i.source,Yn.exec(i))).lastIndex=i.lastIndex,o;case ri:return new a;case ii:return n=t,Kn?Object(Kn.call(n)):{}}}(t,c,s)}}o||(o=new vn);var p=o.get(t);if(p)return p;o.set(t,a),mi(t)?t.forEach((function(n){a.add(Li(n,e,r,n,t,o))})):vi(t)&&t.forEach((function(n,i){a.set(i,Li(n,e,r,i,t,o))}));var d=h?void 0:(u?l?kn:Ln:l?nn:en)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r););}(d||t,(function(n,i){d&&(n=t[i=n]),Pr(a,i,Li(n,e,r,i,t,o))})),a}function ki(t){return Li(t,5)}function Ii(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new dn;++e<r;)this.add(t[e])}function Ai(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}Ei[Mi]=Ei["[object Array]"]=Ei["[object ArrayBuffer]"]=Ei["[object DataView]"]=Ei["[object Boolean]"]=Ei["[object Date]"]=Ei["[object Float32Array]"]=Ei["[object Float64Array]"]=Ei["[object Int8Array]"]=Ei["[object Int16Array]"]=Ei["[object Int32Array]"]=Ei["[object Map]"]=Ei["[object Number]"]=Ei[Ti]=Ei["[object RegExp]"]=Ei["[object Set]"]=Ei["[object String]"]=Ei["[object Symbol]"]=Ei["[object Uint8Array]"]=Ei["[object Uint8ClampedArray]"]=Ei["[object Uint16Array]"]=Ei["[object Uint32Array]"]=!0,Ei["[object Error]"]=Ei[Si]=Ei["[object WeakMap]"]=!1,Ii.prototype.add=Ii.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ii.prototype.has=function(t){return this.__data__.has(t)};var Ci=1,Oi=2;function Ri(t,e,r,n,i,o){var a=r&Ci,s=t.length,l=e.length;if(s!=l&&!(a&&l>s))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var c=-1,f=!0,p=r&Oi?new Ii:void 0;for(o.set(t,e),o.set(e,t);++c<s;){var d=t[c],y=e[c];if(n)var g=a?n(y,d,c,e,t,o):n(d,y,c,t,e,o);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!Ai(e,(function(t,e){if(a=e,!p.has(a)&&(d===t||i(d,t,r,n,o)))return p.push(e);var a}))){f=!1;break}}else if(d!==y&&!i(d,y,r,n,o)){f=!1;break}}return o.delete(t),o.delete(e),f}function Di(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function Fi(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var Bi=1,Ni=2,zi="[object Boolean]",Ui="[object Date]",ji="[object Error]",Vi="[object Map]",Gi="[object Number]",qi="[object RegExp]",Zi="[object Set]",Wi="[object String]",Hi="[object Symbol]",Yi="[object ArrayBuffer]",Xi="[object DataView]",Ki=Ie?Ie.prototype:void 0,Qi=Ki?Ki.valueOf:void 0,Ji=1,$i=Object.prototype.hasOwnProperty,to=1,eo="[object Arguments]",ro="[object Array]",no="[object Object]",io=Object.prototype.hasOwnProperty;function oo(t,e,r,n,i){return t===e||(null==t||null==e||!Ue(t)&&!Ue(e)?t!=t&&e!=e:function(t,e,r,n,i,o){var a=Ve(t),s=Ve(e),l=a?ro:qn(t),u=s?ro:qn(e),h=(l=l==eo?no:l)==no,c=(u=u==eo?no:u)==no,f=l==u;if(f&&jr(t)){if(!jr(e))return!1;a=!0,h=!1}if(f&&!h)return o||(o=new vn),a||Xr(t)?Ri(t,e,r,n,i,o):function(t,e,r,n,i,o,a){switch(r){case Xi:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Yi:return!(t.byteLength!=e.byteLength||!o(new Wn(t),new Wn(e)));case zi:case Ui:case Gi:return Mr(+t,+e);case ji:return t.name==e.name&&t.message==e.message;case qi:case Wi:return t==e+"";case Vi:var s=Di;case Zi:var l=n&Bi;if(s||(s=Fi),t.size!=e.size&&!l)return!1;var u=a.get(t);if(u)return u==e;n|=Ni,a.set(t,e);var h=Ri(s(t),s(e),n,i,o,a);return a.delete(t),h;case Hi:if(Qi)return Qi.call(t)==Qi.call(e)}return!1}(t,e,l,r,n,i,o);if(!(r&to)){var p=h&&io.call(t,"__wrapped__"),d=c&&io.call(e,"__wrapped__");if(p||d){var y=p?t.value():t,g=d?e.value():e;return o||(o=new vn),i(y,g,r,n,o)}}return!!f&&(o||(o=new vn),function(t,e,r,n,i,o){var a=r&Ji,s=Ln(t),l=s.length;if(l!=Ln(e).length&&!a)return!1;for(var u=l;u--;){var h=s[u];if(!(a?h in e:$i.call(e,h)))return!1}var c=o.get(t),f=o.get(e);if(c&&f)return c==e&&f==t;var p=!0;o.set(t,e),o.set(e,t);for(var d=a;++u<l;){var y=t[h=s[u]],g=e[h];if(n)var v=a?n(g,y,h,e,t,o):n(y,g,h,t,e,o);if(!(void 0===v?y===g||i(y,g,r,n,o):v)){p=!1;break}d||(d="constructor"==h)}if(p&&!d){var _=t.constructor,m=e.constructor;_==m||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof m&&m instanceof m||(p=!1)}return o.delete(t),o.delete(e),p}(t,e,r,n,i,o))}(t,e,r,n,oo,i))}var ao=function(){return ke.Date.now()},so=Math.max,lo=Math.min;var uo=function(e){function r(t){var r=e.call(this)||this;return r._startBearing=0,r._startPitch=0,r._startZoom=0,r._onMoveStartHandler=r._onMoveStart.bind(r),r._onMoveHandler=r._onMove.bind(r),r._onResizeHandler=r._onResize.bind(r),r._resetHandler=function(t,e,r){var n,i,o,a,s,l,u=0,h=!1,c=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var r=n,o=i;return n=i=void 0,u=e,a=t.apply(o,r)}function d(t){var r=t-l;return void 0===l||r>=e||r<0||c&&t-u>=o}function y(){var t=ao();if(d(t))return g(t);s=setTimeout(y,function(t){var r=e-(t-l);return c?lo(r,o-(t-u)):r}(t))}function g(t){return s=void 0,f&&n?p(t):(n=i=void 0,a)}function v(){var t=ao(),r=d(t);if(n=arguments,i=this,l=t,r){if(void 0===s)return function(t){return u=t,s=setTimeout(y,e),h?p(t):a}(l);if(c)return clearTimeout(s),s=setTimeout(y,e),p(l)}return void 0===s&&(s=setTimeout(y,e)),a}return e=Qe(e)||0,Ze(r)&&(h=!!r.leading,o=(c="maxWait"in r)?so(Qe(r.maxWait)||0,e):o,f="trailing"in r?!!r.trailing:f),v.cancel=function(){void 0!==s&&clearTimeout(s),u=0,n=l=i=s=void 0},v.flush=function(){return void 0===s?a:g(ao())},v}(r._reset,50).bind(r),r._container=t.container,r._map=t.map,r._transform=r._map.getTransform(),r._center=r._transform.getCenter(),r._visible=!0,r._currentTranslate={x:0,y:0},r._map.on(x.MoveStart,r._onMoveStartHandler),r._map.on(x.Move,r._onMoveHandler),r._map.on(x.Resize,r._onResizeHandler),r}return t.__extends(r,e),Object.defineProperty(r.prototype,"translate",{get:function(){return this._currentTranslate},enumerable:!1,configurable:!0}),r.prototype._onMoveStart=function(){this._startBearing=this._transform.getBearing(),this._startPitch=this._transform.getPitch(),this._startZoom=this._transform.getZoom()},r.prototype._onMove=function(){0===this._transform.getPitch()&&this._transform.getPitch()===this._startPitch&&this._transform.getBearing()===this._startBearing&&this._transform.getZoom()===this._startZoom?this._translate():(this._hide(),this._map.once(x.MoveEnd,this._resetHandler))},r.prototype._translate=function(){if(this._visible){var t=this._transform.lngLatToScreenPoint(this._center),e=this._transform.lngLatToScreenPoint(this._transform.getCenter());this._currentTranslate={x:t.x-e.x,y:t.y-e.y},this._container.style.left="".concat(this._currentTranslate.x,"px"),this._container.style.top="".concat(this._currentTranslate.y,"px")}},r.prototype._hide=function(){this._visible&&(this._container.style.display="none",this._visible=!1)},r.prototype._reset=function(){this._visible||(this._currentTranslate={x:0,y:0},this.emit(new t.Event("update")),this._container.style.top="0px",this._container.style.left="0px",this._container.style.display="block",this._center=this._transform.getCenter(),this._visible=!0)},r.prototype._onResize=function(){this._hide(),this._reset()},r.prototype.destroy=function(){this._map.off(x.MoveStart,this._onMoveStartHandler),this._map.off(x.Move,this._onMoveHandler),this._map.off(x.Resize,this._onResizeHandler)},r}(t.EventEmitter),ho={antialias:!0,alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1};function co(t,e){return e||(e=document.createElement("canvas")),e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}var fo="TILE_PROXY",po="MAP_LEVEL_CONFIG",yo=new Set([fo,po]),go=[["http://farm41.ids.onestore.co.kr:8012","https://farm41.ids.onestore.co.kr"],["http://farm81.ids.onestore.co.kr:8012","https://farm81.ids.onestore.co.kr"],["http://farm68.ids.onestore.co.kr:8012","https://farm68.ids.onestore.co.kr"],["http://farm82.ids.onestore.co.kr:8012","https://farm82.ids.onestore.co.kr"],["http://farm43.ids.onestore.co.kr:8012","https://farm43.ids.onestore.co.kr"],["http://farm42.ids.onestore.co.kr:8012","https://farm42.ids.onestore.co.kr"],["http://vsm-tile.dev.tmapmp.com","https://vsm-tile.dev.tmapmp.com"],["http://vsm-tile.tmapmp.com","https://vsm-tile.tmapmp.com"],["http://config.vsm.tmap.co.kr/api/sam/getUrl?ver=1","https://vsm-tile.tmapmp.com/hub/vsm/sam/uri.json"],["http://tile3.tmap.co.kr","https://tile3.tmap.co.kr"]].map((function(e){var r=t.__read(e,2);return{from:r[0],to:r[1]}})),vo=function(){},_o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function mo(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,xo(e,"image/png")]}))}))}function bo(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,wo((function(){return URL.createObjectURL(new window.Blob([e],{type:"image/svg+xml"}))}))]}))}))}function xo(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n;return t.__generator(this,(function(t){return"function"==typeof window.createImageBitmap?(n=new window.Blob([new Uint8Array(e)],{type:r}),[2,window.createImageBitmap(n)]):[2,wo((function(){var t=new window.Blob([e],{type:r});return e.byteLength>0?URL.createObjectURL(t):_o}))]}))}))}function wo(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,new Promise((function(t,r){var n=new window.Image;n.onload=function(){t(n),URL.revokeObjectURL(n.src)},n.onerror=r,n.src=e()}))]}))}))}function Mo(t){var e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error;return e.width=t.width,e.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,e.width,e.height)}var So={pixelRatio:1},Po=function(e){function r(r,n,i,o){void 0===o&&(o={});var a=e.call(this)||this;return a._dataCache={status:"Init"},a._loadingEventEmitter=new t.EventEmitter,a._code=r,a._dummyUrl="vsm://".concat(i,"/").concat(t.v4()),a._images=n,a._options=t.merge([o,So],!1),a}return t.__extends(r,e),r.prototype.getCode=function(){return this._code},r.prototype.getName=function(){return""},r.prototype.getData=function(e){var r=this,n=this._dataCache;return new Promise((function(i){"Init"===n.status?(r._dataCache={status:"Loading"},r._prepareImages().then((function(n){r._dataCache=n,r._loadingEventEmitter.emit(new t.Event("Loaded")),i(r._getImage(e))}))):"Loading"===n.status?r._loadingEventEmitter.once("Loaded",(function(){return i(r._getImage(e))})):i(r._getImage(e))}))},r.prototype._prepareImages=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b,x,w,M,S,P,T,E;return t.__generator(this,(function(L){switch(L.label){case 0:if(L.trys.push([0,12,,13]),e={},!this._images)return[3,11];L.label=1;case 1:L.trys.push([1,8,9,10]),r=t.__values(this._images),n=r.next(),L.label=2;case 2:if(n.done)return[3,7];i=n.value,o=i.id,a=i.image,L.label=3;case 3:return L.trys.push([3,5,,6]),[4,Eo(a)];case 4:if(s=L.sent(),l=s.width,u=s.height,h=s.data,c=s.spriteIndex,f=new t.RgbaImage(l,u,h),c)try{for(T=void 0,p=t.__values(Object.entries(c)),d=p.next();!d.done;d=p.next())y=t.__read(d.value,2),g=y[0],v=y[1],_=v.x,m=v.y,b=v.width,x=v.height,(w=new t.RgbaImage(b,x)).drawImage(f,{x:_,y:m},{x:0,y:0},b,x),e[g]=w}catch(t){T={error:t}}finally{try{d&&!d.done&&(E=p.return)&&E.call(p)}finally{if(T)throw T.error}}else e[o]=f;return[3,6];case 5:return L.sent(),console.warn("Couldn't prepare image '".concat(o,"'")),[3,6];case 6:return n=r.next(),[3,2];case 7:return[3,10];case 8:return M=L.sent(),S={error:M},[3,10];case 9:try{n&&!n.done&&(P=r.return)&&P.call(r)}finally{if(S)throw S.error}return[7];case 10:this._images=null,L.label=11;case 11:return[2,{status:"Ready",result:e}];case 12:return L.sent(),[2,{status:"NotFound"}];case 13:return[2]}}))}))},r.prototype._getImage=function(t){return"Ready"===this._dataCache.status?this._dataCache.result&&this._dataCache.result[t]?{status:"Ready",result:this._dataCache.result&&this._dataCache.result[t]}:{status:"NotFound"}:{status:this._dataCache.status}},r.prototype.getVersionedUrl=function(){return this._dummyUrl},r.prototype.getProperties=function(){return{}},r.prototype.getOptions=function(){return this._options},r}(vo),To=Po;function Eo(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l;return t.__generator(this,(function(t){switch(t.label){case 0:return e instanceof ImageData?(o=e.width,a=e.height,s=e.data,[2,{width:o,height:a,data:new Uint8Array(s)}]):[3,1];case 1:return e instanceof HTMLImageElement||ImageBitmap&&e instanceof ImageBitmap?[2,Mo(e)]:[3,2];case 2:if("object"!=typeof e||!("type"in e))return[3,9];switch(e.type){case"svg":return[3,3];case"png":return[3,5];case"sprite":return[3,7]}return[3,9];case 3:return r=Mo,[4,bo(e.data)];case 4:return[2,r.apply(void 0,[t.sent()])];case 5:return n=Mo,[4,mo(e.data)];case 6:return[2,n.apply(void 0,[t.sent()])];case 7:return l=Mo,[4,mo(e.data)];case 8:return i=l.apply(void 0,[t.sent()]),o=i.width,a=i.height,s=i.data,[2,{width:o,height:a,data:s,spriteIndex:e.index}];case 9:throw new Error("Unknown image type")}}))}))}var Lo,ko=function(){function t(){this._first=null,this._last=null,this._size=0}return t.prototype.addLast=function(t,e){return this.insertLast({key:t,value:e,next:null,prev:null})},t.prototype.insertLast=function(t){var e=this._last;return t.prev=e,t.next=null,this._last=t,null===e?this._first=t:e.next=t,this._size++,t},t.prototype.removeFirst=function(){if(null===this._first)return null;var t=this._first,e=t.next;return t.next=null,this._first=e,null===e?this._last=null:e.prev=null,this._size--,t},t.prototype.remove=function(t){var e=t.next,r=t.prev;return null===r?this._first=e:(r.next=e,t.prev=null),null===e?this._last=r:(e.prev=r,t.next=null),this._size--,t},t.prototype.clear=function(){for(var t=this._first;null!==t;){var e=t.next;t.next=null,t.prev=null,t=e}this._first=null,this._last=null,this._size=0},Object.defineProperty(t.prototype,"first",{get:function(){return this._first},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t}(),Io=function(){function t(t,e){void 0===e&&(e=null),this._map=new Map,this._queue=new ko,this._maxSize=t,this._onEvict=e}return t.prototype.get=function(t){var e=this._map.get(t);if(void 0!==e)return this._queue.insertLast(this._queue.remove(e)),e.value},t.prototype.has=function(t,e){return void 0===e&&(e=!1),e?void 0!==this._map.get(t):void 0!==this.get(t)},t.prototype.set=function(t,e){if(void 0!==e){var r=this._queue.addLast(t,e),n=this._map.get(t);this._map.set(t,r),n&&(this._queue.remove(n),this._onEvict&&this._onEvict(n.key,n.value,"Duplicate")),this._evict()}else this._map.delete(t)},t.prototype._evict=function(){for(;this.getSize()>this.getMaxSize();){var t=this._queue.removeFirst();t&&(this._map.delete(t.key),this._onEvict&&this._onEvict(t.key,t.value,"Default"))}},t.prototype.delete=function(t,e){void 0===e&&(e=!0);var r=this._map.get(t);return r?(this._map.delete(t),this._queue.remove(r),e&&this._onEvict&&this._onEvict(r.key,r.value,"Delete"),r):void 0},t.prototype.clear=function(t){if(void 0===t&&(t=!0),t&&this._onEvict)for(var e=this._queue.first;null!==e;e=e.next)this._onEvict(e.key,e.value,"Clear");this._queue.clear(),this._map.clear()},t.prototype.getMaxSize=function(){return this._maxSize},t.prototype.setMaxSize=function(t){this._maxSize=t,this._evict()},t.prototype.getSize=function(){return this._queue.size},t.prototype.toArray=function(){for(var t=[],e=this._queue.first;null!==e;e=e.next)t.push({key:e.key,value:e.value});return t},t}(),Ao=function(){function e(e,r){var n=this;this._sdfUrlPrefix="https://vsm-tile.tmapmp.com/resources/font/k-sdf",this._timeoutId=null,this._dataCache=new Io(128,(function(t,e,r){"Default"===r&&delete n._dataTimeStamp[t]})),this._glyphMapping={status:"Init"},this._loadingEventEmitter=new t.EventEmitter,this._dataTimeStamp={},this._glyphPathFactory=null,this._code=e.config.code,this._name=e.config.name,this._versionedUrl=t.getVersionedUrl(e)||t.getVersionedUrl(e.config),this._networkOptions=r}return e.prototype.getCode=function(){return this._code},e.prototype.getName=function(){return this._name},e.prototype.getData=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n=this;return t.__generator(this,(function(i){return r=this._getCachedValue(e),[2,new Promise((function(i){"Init"===r.status?(n._dataCache.set(e,{status:"Loading"}),n._requestGlyphs(e).then((function(r){n._dataCache.set(e,r),n._dataTimeStamp[e]=t.browser.now(),n._reserveGC(),n._loadingEventEmitter.emit(new t.Event(e,{value:r})),i(r)}))):"Loading"===r.status?n._loadingEventEmitter.once(e,(function(t){return i(t.data.value)})):i(r)}))]}))}))},e.prototype._getCachedValue=function(t){var e=this._dataCache.get(t);if(e)return e;var r={status:"Init"};return this._dataCache.set(t,r),r},e.prototype._requestGlyphs=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n;return t.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r="".concat(this._sdfUrlPrefix,"/").concat(e,".pbf"),[4,t.ajax.callBinary(r,this._networkOptions)];case 1:return n=i.sent(),t.isValidStatus(n)?[2,{status:"Ready",result:n.body}]:[2,{status:"NotFound"}];case 2:return i.sent(),[2,{status:"NotFound"}];case 3:return[2]}}))}))},e.prototype._reserveGC=function(){var t=this;this._timeoutId||0===this._dataCache.getSize()||(this._timeoutId=setTimeout((function(){t._timeoutId=null,t._gc(),t._reserveGC()}),1e3))},e.prototype._gc=function(){var e,r,n,i,o=t.browser.now(),a=[];try{for(var s=t.__values(Object.entries(this._dataTimeStamp)),l=s.next();!l.done;l=s.next()){var u=t.__read(l.value,2),h=u[0];o-u[1]>1e4&&a.push(h)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}try{for(var c=t.__values(a),f=c.next();!f.done;f=c.next())h=f.value,delete this._dataTimeStamp[h],this._dataCache.delete(h)}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}},e.prototype.getVersionedUrl=function(){return this._versionedUrl},e.prototype.getProperties=function(){return{}},e.prototype.getGlyphPathFactory=function(){return t.__awaiter(this,void 0,void 0,(function(){var e;return t.__generator(this,(function(r){switch(r.label){case 0:return this._glyphPathFactory?[3,2]:[4,this._getGlyphMapping()];case 1:e=r.sent(),this._glyphPathFactory||("Ready"===e.status?this._glyphPathFactory=new t.MappedGlyphPathFactory(e.result):this._glyphPathFactory=new t.DefaultGlyphPathFactory),r.label=2;case 2:return[2,this._glyphPathFactory]}}))}))},e.prototype._getGlyphMapping=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r=this;return t.__generator(this,(function(n){return e=this._glyphMapping,[2,new Promise((function(n){"Init"===e.status?(r._glyphMapping={status:"Loading"},r._requestMapping().then((function(e){r._glyphMapping=e,r._loadingEventEmitter.emit(new t.Event("MappingLoaded",{value:e})),n(e)}))):"Loading"===e.status?r._loadingEventEmitter.once("MappingLoaded",(function(t){n(t.data.value)})):n(e)}))]}))}))},e.prototype._requestMapping=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r;return t.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e="".concat(this._sdfUrlPrefix,"/mapping.pbf"),[4,t.ajax.callBinary(e,this._networkOptions)];case 1:return r=n.sent(),t.isValidStatus(r)?[2,{status:"Ready",result:r.body}]:[2,{status:"NotFound"}];case 2:return n.sent(),[2,{status:"NotFound"}];case 3:return[2]}}))}))},e}(),Co=Ao,Oo=function(e){function r(r){var n=e.call(this)||this;return n._code=r.config.code,n._name=r.config.name,n._versionedUrl=t.getVersionedUrl(r)||t.getVersionedUrl(r.config),n}return t.__extends(r,e),r.prototype.getCode=function(){return this._code},r.prototype.getName=function(){return this._name},r.prototype.getData=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,{status:"NotFound",result:null}]}))}))},r.prototype.getVersionedUrl=function(){return this._versionedUrl},r.prototype.getProperties=function(){return{}},r.prototype.getOptions=function(){return{}},r}(vo),Ro=function(e){function r(r,n){var i=e.call(this)||this;return i._dataCache={status:"Init"},i._loadingEventEmitter=new t.EventEmitter,i._code=r.config.code,i._name=r.config.name,i._versionedUrl=t.getVersionedUrl(r)||t.getVersionedUrl(r.config),i._bundleUri=r.config.bundleUri,i._resources=r.config.resources,i._options={pixelRatio:r.config.pixelRatio},i._networkOptions=n,i}return t.__extends(r,e),r.prototype.getCode=function(){return this._code},r.prototype.getName=function(){return this._name},r.prototype.getData=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n=this;return t.__generator(this,(function(i){return r=this._dataCache,[2,new Promise((function(i){"Init"===r.status?(n._dataCache={status:"Loading"},n._requestRawBundle().then((function(r){n._dataCache=r,n._loadingEventEmitter.emit(new t.Event("Loaded")),i(n._getImage(e))}))):"Loading"===r.status?n._loadingEventEmitter.once("Loaded",(function(){return i(n._getImage(e))})):i(n._getImage(e))}))]}))}))},r.prototype._requestRawBundle=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,l,u,h,c,f,p,d,y,g;return t.__generator(this,(function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),e=this._getBundleImageUrl(),[4,t.ajax.callBinary(e,this._networkOptions)];case 1:if(r=v.sent(),!t.isValidStatus(r))return[2,{status:"NotFound"}];n=r.body,i={};try{for(o=t.__values(Object.entries(this._getImagePropertiesMap())),a=o.next();!a.done;a=o.next())s=t.__read(a.value,2),l=s[0],u=s[1],h=u.offset,c=u.size,f=u.width,p=u.height,d=n.slice(h,h+c),i[l]=new t.RgbaImage(f,p,new Uint8Array(d))}catch(t){y={error:t}}finally{try{a&&!a.done&&(g=o.return)&&g.call(o)}finally{if(y)throw y.error}}return[2,{status:"Ready",result:i}];case 2:return v.sent(),[2,{status:"NotFound"}];case 3:return[2]}}))}))},r.prototype._getBundleImageUrl=function(){return this._bundleUri},r.prototype._getImagePropertiesMap=function(){var e,r,n={};try{for(var i=t.__values(this._resources),o=i.next();!o.done;o=i.next()){var a=o.value,s=a.code,l=a.properties;n[s]=l}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},r.prototype._getImage=function(t){return"Ready"===this._dataCache.status?this._dataCache.result&&this._dataCache.result[t]?{status:"Ready",result:this._dataCache.result&&this._dataCache.result[t]}:{status:"NotFound"}:{status:this._dataCache.status}},r.prototype.getVersionedUrl=function(){return this._versionedUrl},r.prototype.getProperties=function(){return{}},r.prototype.getOptions=function(){return this._options},r}(vo),Do=Ro,Fo=function(){function t(t){var e=t.config,r=e.code,n=e.name,i=e.body;this._code=r,this._name=n,this._body=i}return t.prototype.getCode=function(){return this._code},t.prototype.getName=function(){return this._name},t.prototype.getBody=function(){return this._body},t}();function Bo(t,e){e.state="Error"}!function(t){t[t.Vector=1]="Vector",t[t.Raster=2]="Raster"}(Lo||(Lo={}));var No=function(){function e(e,r,n,i){if(this._tileUrl=e,this._config=r,this._options=i,i.discreteZooms){var o=i.discreteZooms;this._getTileLevelByInfo=function(t){for(var e=Math.trunc(t),r=o[0],n=0;n<o.length;n++){var i=o[n];if(e>i)r=i;else{if(e===i){r=i;break}if(e<i)break}}return r}}else if(t.isNum(i.minZoom)&&t.isNum(i.maxZoom)){var a=i.minZoom,s=i.maxZoom;this._getTileLevelByInfo=function(t){return t<a?a:t>s?s:Math.trunc(t)}}if(t.isNum(i.minViewLevel)&&t.isNum(i.maxViewLevel)){var l=i.minViewLevel,u=i.maxViewLevel;this._getStyleLevelByInfo=function(e){return t.clamp(Math.trunc(e),l,u)}}this._dispatcher=n}return e.prototype.update=function(){},e.prototype.isReady=function(){return!0},e.prototype.setData=function(t){throw new Error("Unsupported method")},e.prototype.toDataTiles=function(e,r){var n=this;return t.uniqueKey(t.flatMap(e,(function(t){return r.toDataTiles(t,n._options.tileServiceName,n._getTileLevelByInfo)})),(function(t){return t.toString()}))},e.prototype.isValidTile=function(t,e){return!(this._options.minZoom&&t.z<this._options.minZoom||this._options.maxZoom&&t.z>this._options.maxZoom)&&e.isVisibleDataTile(t,this._options.tileServiceName)},e.prototype.loadTile=function(e,r,n,i){var o,a,s,l,u=this;if("Partial"===n.type){var h=n.prevTile,c=h.tileData,f=h.branch;s=n.prevTile.tileParams,a=this._getActor(s.actorId),l={state:"PartialAndLoading",tileParams:t.__assign(t.__assign({},s),{uniqueId:f?t.v4():s.uniqueId}),tileData:c}}else{var p="Reload"===n.type;a=this._getActor(),s={uniqueId:t.v4(),tileId:e,url:this._getTileUrl(e),sourceType:this.getType(),options:{format:this._options.format,tileServiceName:this._options.tileServiceName,layerId:this._options.layerId},actorId:a.getId(),loadCount:0,reload:p,optimize:n.optimize},p?(null===(o=n.prevTile.tileData)||void 0===o||o.markWillReplace(),l={state:"Reloading",tileParams:s,tileData:n.prevTile.tileData}):l={state:"Loading",tileParams:s}}return a.send("LoadTile",s,{weightAmplifier:function(t){return u._amplifyLoadTileWeight(t)}}).then((function(t){var e;if(l.orphan)null===(e=t.tileData)||void 0===e||e.destroy(),l.state="Cancelled","Partial"===t.state&&u.clearTile(s);else switch(l.tileParams.reload&&(l.tileData&&delete l.tileData,l.tileParams.reload=!1),t.state){case"Partial":l.tileParams.loadCount++,l.tileData=t.tileData,l.state="Partial";break;case"Done":l.tileData?l.tileData.pushLink(t.tileData):l.tileData=t.tileData,l.state="Ready";break;case"Empty":l.state="Empty";break;case"Aborted":l.state="Cancelled"}})).catch((function(t){Bo(0,l)})).finally((function(){i&&i(l)})),l},e.prototype._getTileUrl=function(t){return this._formatTileUrl(t)},e.prototype._formatTileUrl=function(t){return"".concat(this._tileUrl).concat(t.toString(),".tile")},e.prototype._amplifyLoadTileWeight=function(t){return t},e.prototype.abortTile=function(t){this._getActor(t.actorId).send("AbortTile",t).then((function(t){})).catch((function(t){})).finally((function(){}))},e.prototype.clearTile=function(t){this._getActor(t.actorId).send("ClearTile",t).then((function(t){})).catch((function(t){})).finally((function(){}))},e.prototype.getPositionMatrix=function(t,e){return t.getDataTilePositionMatrix(e,this._options.tileServiceName)},e.prototype.getTileUnitsPerPixel=function(t,e){return t.getDataTileUnitsPerPixel(e,this._options.tileServiceName)},e.prototype.destroy=function(){},Object.defineProperty(e.prototype,"tileUrl",{get:function(){return this._tileUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dispatcher",{get:function(){return this._dispatcher},enumerable:!1,configurable:!0}),e.prototype._broadcast=function(t,e,r){return this._dispatcher.broadcast(t,e,r)},e.prototype._getActor=function(t){return this._dispatcher.getActor(t)},e.prototype._getTileAdapter=function(){return t.tileAdapters[this._options.tileServiceName]},e.prototype.getTileLevel=function(t){return this._getTileLevelByInfo?this._getTileLevelByInfo(t):this._getTileAdapter().getTileService().getLevel(t)},e.prototype.getStyleLevel=function(e){if(this._getStyleLevelByInfo)return this._getStyleLevelByInfo(e);switch(this._options.tileServiceName){case t.TileServiceName.VsmVector:case t.TileServiceName.GoogleMapVector:return t.getVsmStyleLevel(e);case t.TileServiceName.VsmLegacyVector:return t.getVsmLegacyStyleLevel(e);default:throw new t.SourceError}},e.prototype.getType=function(){return"Vector"},e.prototype.getRenderType=function(){return Lo.Vector},e.prototype.getTileSizeFactor=function(){switch(this._options.tileServiceName){case t.TileServiceName.VsmLegacyVector:return 1.5;case t.TileServiceName.VsmVector:return.5;default:return 1}},e.prototype.toTileRelativePoint=function(t,e){return this._getTileAdapter().toRelativePoint(e,t)},e.prototype.toLngLat=function(t,e){return this._getTileAdapter().toLngLat(t,e)},e.prototype.getTileExtent=function(){return this._getTileAdapter().getTileExtent()},e.prototype.getTileSize=function(){return this._getTileAdapter().getTileSize()},e.prototype.isPreventedFromOverlapping=function(){return Boolean(this._options.preventOverlap)},e.prototype.setMapEventEmitter=function(t){this._eventEmitter=t},e.prototype.emit=function(t,e){var r;null===(r=this._eventEmitter)||void 0===r||r.emit(t,e)},e.prototype._getNetworkOptions=function(){return this._config.getNetworkOptions()},e}(),zo=No;function Uo(e){if(e!==t.MapWorkerErrorMessage.ScheduledTaskCancelled)throw e}var jo=function(e){function r(t,r,n,i){var o=e.call(this,"",t,r,n)||this;if(o._initState="Uninitialized",i){var a=r.assignExclusiveActor();o._targetActorId=a.getId()}return o}return t.__extends(r,e),r.prototype.update=function(){"Uninitialized"===this._initState&&this._initAndLoadData()},r.prototype.isReady=function(){return"Initialized"===this._initState},r.prototype._initAndLoadData=function(){var t=this;return this._initState="Initializing",this._createLoadDataParams().then((function(e){return t._broadcast("LoadData",e)})).then((function(){t._initState="Initialized",t.emit(x.SourceLoad,{layerId:t.options.layerId})})).catch((function(){t._initState="Failed",console.warn("Couldn't load data - layer id : ".concat(t.options.layerId))}))},r.prototype.getType=function(){return"GeoJson"},r.prototype.destroy=function(){var t={sourceType:this.getType(),options:this.options};this._broadcast("ClearData",t,!0),this._targetActorId&&this.dispatcher.releaseExclusiveActor(this._targetActorId)},r.prototype._broadcast=function(t,r,n){return this._targetActorId?this.dispatcher.getActor(this._targetActorId).send(t,r,{instant:n}).catch(Uo):e.prototype._broadcast.call(this,t,r,n)},r.prototype._getActor=function(t){return this.dispatcher.getActor(this._targetActorId||t)},r.prototype._amplifyLoadTileWeight=function(t){return this._targetActorId?.25*t:t},r}(zo),Vo=function(e){function r(t,r,n,i){var o=e.call(this,r,n,i,!0)||this;return o._data=t,o}return t.__extends(r,e),r.prototype._createLoadDataParams=function(){return t.__awaiter(this,void 0,void 0,(function(){var e;return t.__generator(this,(function(t){switch(t.label){case 0:return e={sourceType:this.getType(),options:this.options},[4,this._fetchGeoJsonData()];case 1:return[2,(e.data=t.sent(),e.crsCode="EPSG:4326",e)]}}))}))},r.prototype._fetchGeoJsonData=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r;return t.__generator(this,(function(n){switch(n.label){case 0:return"string"!=typeof(e=this._data)?[3,2]:[4,t.ajax.callJson(t.browser.resolveURL(e),this._getNetworkOptions())];case 1:if(r=n.sent(),!t.isValidStatus(r))throw r;return[2,JSON.stringify(r.body)];case 2:return[2,JSON.stringify(e)]}}))}))},r.prototype.setData=function(t){return this._data=t,this._initAndLoadData()},r}(jo),Go=Vo,qo=function(){function e(t,e,r){this._texture=null,this._image=t,this._textureOptions=e,this._responseBodySize=r}return e.prototype.prepare=function(e){!this._texture&&this._image&&(this._texture=new t.Texture(e,this._image,this._textureOptions),this._image=null)},e.prototype.getTileInfo=function(){return{responseBodySize:this._responseBodySize,rawData:this._image}},Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textureOptions",{get:function(){return this._textureOptions},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._texture&&(this._texture.destroy(),this._texture=null)},e}(),Zo=function(e){function r(r,n,i,o,a){var s=e.call(this,i,o,a,!0)||this,l=i.getMap().getTransform(),u=It.valueOf(n),h=l.lngLatToPrjCoord(u.southWest),c=l.lngLatToPrjCoord(u.northEast);return s._uri=r,s._bbox=t.toBBox(h,c),s._tileId=function(e){var r=ut(t.LngLat.valueOf(e.southWest)),n=ut(t.LngLat.valueOf(e.northEast)),i=Math.min(r.x,n.x),o=Math.min(r.y,n.y),a=Math.max(r.x,n.x),s=Math.max(r.y,n.y),l=a-i,u=s-o,h=Math.max(l,u),c=Math.max(0,Math.floor(-Math.log(h)/Math.LN2)),f=1<<c;return new t.TileId(c,Math.floor((i+a)/2*f),Math.floor((o+s)/2*f))}(u),s}return t.__extends(r,e),r.prototype._initAndLoadData=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r;return t.__generator(this,(function(n){switch(n.label){case 0:return"Initializing"===this._initState?[2]:(this._initState="Initializing",[4,t.ajax.callBinary(this._uri,this._getNetworkOptions())]);case 1:return e=n.sent(),t.isValidStatus(e)?(r=this,[4,mo(e.body)]):(this._initState="Failed",console.warn(e),[2]);case 2:return r._image=n.sent(),this._responseBodySize=e.body.byteLength,this._initState="Initialized",this.emit(x.SourceLoad,{layerId:this.options.layerId}),[2]}}))}))},r.prototype.loadTile=function(e,r,n,i){var o="Reload"===n.type,a={uniqueId:t.v4(),tileId:e,sourceType:this.getType()};if(!this._image)return o?{state:"Reloading",tileParams:a,tileData:n.prevTile.tileData}:{state:"Loading",tileParams:a};var s=this.getTileExtent(),l=t.__read(t.toPoints(this._bbox),3),u=l[0],h=l[2],c=Ho(u,s,this._tileId),f=Ho(h,s,this._tileId),p={minX:c.x,maxX:f.x,minY:s-f.y,maxY:s-c.y};return{state:"Ready",tileParams:a,tileData:new t.PreparedTileData(e,t.SingleStyleDataMap.valueOf(new t.RasterStyleData({origin:{x:p.minX,y:p.minY},scale:{x:t.getWidth(p),y:t.getHeight(p)}})),new qo(this._image,{useMipmap:!1},this._responseBodySize||0))}},r.prototype.toDataTiles=function(t,e){return[this._tileId]},r.prototype.isValidTile=function(t,e){return e.isVisible(this._bbox)},r.prototype.getType=function(){return"Image"},r.prototype._createLoadDataParams=function(){throw new Error("Method not implemented.")},r.prototype.destroy=function(){delete this._image},r}(jo),Wo=Zo;function Ho(t,e,r){var n=1<<r.z;return{x:Math.round(e*(t.x*n-r.x)),y:Math.round(e*(t.y*n-r.y))}}var Yo={exports:{}};Yo.exports=Jo;var Xo=Yo.exports.parse=Jo;Yo.exports.stringify=function t(e){function r(t){return t.join(" ")}function n(t){return t.map(r).join(", ")}function i(t){return t.map(n).map(o).join(", ")}function o(t){return"("+t+")"}switch("Feature"===e.type&&(e=e.geometry),e.type){case"Point":return"POINT ("+r(e.coordinates)+")";case"LineString":return"LINESTRING ("+n(e.coordinates)+")";case"Polygon":return"POLYGON ("+i(e.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+n(e.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+function(t){return t.map(i).map(o).join(", ")}(e.coordinates)+")";case"MultiLineString":return"MULTILINESTRING ("+i(e.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+e.geometries.map(t).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}};var Ko=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,Qo=new RegExp("^"+Ko.source+"(\\s"+Ko.source+"){1,}");function Jo(t){var e,r=t.split(";"),n=r.pop(),i=(r.shift()||"").split("=").pop(),o=0;function a(t){var e=n.substring(o).match(t);return e?(o+=e[0].length,e[0]):null}function s(){a(/^\s*/)}function l(){s();for(var t,e=0,r=[],n=[r],i=r;t=a(/^(\()/)||a(/^(\))/)||a(/^(,)/)||a(Qo);){if("("===t)n.push(i),i=[],n[n.length-1].push(i),e++;else if(")"===t){if(0===i.length)return null;if(!(i=n.pop()))return null;if(0==--e)break}else if(","===t)i=[],n[n.length-1].push(i);else{if(t.split(/\s/g).some(isNaN))return null;Array.prototype.push.apply(i,t.split(/\s/g).map(parseFloat))}s()}return 0!==e?null:r}function u(){for(var t,e,r=[];e=a(Qo)||a(/^(,)/);)","===e?(r.push(t),t=[]):e.split(/\s/g).some(isNaN)||(t||(t=[]),Array.prototype.push.apply(t,e.split(/\s/g).map(parseFloat))),s();return t?(r.push(t),r.length?r:null):null}return(e=function t(){return function(){if(!a(/^(point(\sz)?)/i))return null;if(s(),!a(/^(\()/))return null;var t=u();return t?(s(),a(/^(\))/)?{type:"Point",coordinates:t[0]}:null):null}()||function(){if(!a(/^(linestring(\sz)?)/i))return null;if(s(),!a(/^(\()/))return null;var t=u();return t&&a(/^(\))/)?{type:"LineString",coordinates:t}:null}()||function(){if(!a(/^(polygon(\sz)?)/i))return null;s();var t=l();return t?{type:"Polygon",coordinates:t}:null}()||function(){if(!a(/^(multipoint)/i))return null;s();var t=n.substring(n.indexOf("(")+1,n.length-1).replace(/\(/g,"").replace(/\)/g,"");n="MULTIPOINT ("+t+")";var e=l();return e?(s(),{type:"MultiPoint",coordinates:e}):null}()||function(){if(!a(/^(multilinestring)/i))return null;s();var t=l();return t?(s(),{type:"MultiLineString",coordinates:t}):null}()||function(){if(!a(/^(multipolygon)/i))return null;s();var t=l();return t?{type:"MultiPolygon",coordinates:t}:null}()||function(){var e,r=[];if(!a(/^(geometrycollection)/i))return null;if(s(),!a(/^(\()/))return null;for(;e=t();)r.push(e),s(),a(/^(,)/),s();return a(/^(\))/)?{type:"GeometryCollection",geometries:r}:null}()}())&&i.match(/\d+/)&&(e.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+i}}),e}function $o(t){return Xo(t)}var ta={exports:{}};
/* @license
        Papa Parse
        v5.4.1
        https://github.com/mholt/PapaParse
        License: MIT
        */!function(t,e){t.exports=function t(){var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{},r=!e.document&&!!e.postMessage,n=e.IS_PAPA_WORKER||!1,i={},o=0,a={parse:function(r,n){var s=(n=n||{}).dynamicTyping||!1;if(x(s)&&(n.dynamicTypingFunction=s,s={}),n.dynamicTyping=s,n.transform=!!x(n.transform)&&n.transform,n.worker&&a.WORKERS_SUPPORTED){var l=function(){if(!a.WORKERS_SUPPORTED)return!1;var r,n,s=(r=e.URL||e.webkitURL||null,n=t.toString(),a.BLOB_URL||(a.BLOB_URL=r.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",n,")();"],{type:"text/javascript"})))),l=new e.Worker(s);return l.onmessage=g,l.id=o++,i[l.id]=l}();return l.userStep=n.step,l.userChunk=n.chunk,l.userComplete=n.complete,l.userError=n.error,n.step=x(n.step),n.chunk=x(n.chunk),n.complete=x(n.complete),n.error=x(n.error),delete n.worker,void l.postMessage({input:r,config:n,workerId:l.id})}var p=null;return"string"==typeof r?(r=function(t){return 65279===t.charCodeAt(0)?t.slice(1):t}(r),p=n.download?new u(n):new c(n)):!0===r.readable&&x(r.read)&&x(r.on)?p=new f(n):(e.File&&r instanceof File||r instanceof Object)&&(p=new h(n)),p.stream(r)},unparse:function(t,e){var r=!1,n=!0,i=",",o="\r\n",s='"',l=s+s,u=!1,h=null,c=!1;!function(){if("object"==typeof e){if("string"!=typeof e.delimiter||a.BAD_DELIMITERS.filter((function(t){return-1!==e.delimiter.indexOf(t)})).length||(i=e.delimiter),("boolean"==typeof e.quotes||"function"==typeof e.quotes||Array.isArray(e.quotes))&&(r=e.quotes),"boolean"!=typeof e.skipEmptyLines&&"string"!=typeof e.skipEmptyLines||(u=e.skipEmptyLines),"string"==typeof e.newline&&(o=e.newline),"string"==typeof e.quoteChar&&(s=e.quoteChar),"boolean"==typeof e.header&&(n=e.header),Array.isArray(e.columns)){if(0===e.columns.length)throw new Error("Option columns is empty");h=e.columns}void 0!==e.escapeChar&&(l=e.escapeChar+s),("boolean"==typeof e.escapeFormulae||e.escapeFormulae instanceof RegExp)&&(c=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}}();var f=new RegExp(d(s),"g");if("string"==typeof t&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return p(null,t,u);if("object"==typeof t[0])return p(h||Object.keys(t[0]),t,u)}else if("object"==typeof t)return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||h),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:"object"==typeof t.data[0]?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||"object"==typeof t.data[0]||(t.data=[t.data])),p(t.fields||[],t.data||[],u);throw new Error("Unable to serialize unrecognized input");function p(t,e,r){var a="";"string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e));var s=Array.isArray(t)&&0<t.length,l=!Array.isArray(e[0]);if(s&&n){for(var u=0;u<t.length;u++)0<u&&(a+=i),a+=y(t[u],u);0<e.length&&(a+=o)}for(var h=0;h<e.length;h++){var c=s?t.length:e[h].length,f=!1,p=s?0===Object.keys(e[h]).length:0===e[h].length;if(r&&!s&&(f="greedy"===r?""===e[h].join("").trim():1===e[h].length&&0===e[h][0].length),"greedy"===r&&s){for(var d=[],g=0;g<c;g++){var v=l?t[g]:g;d.push(e[h][v])}f=""===d.join("").trim()}if(!f){for(var _=0;_<c;_++){0<_&&!p&&(a+=i);var m=s&&l?t[_]:_;a+=y(e[h][m],_)}h<e.length-1&&(!r||0<c&&!p)&&(a+=o)}}return a}function y(t,e){if(null==t)return"";if(t.constructor===Date)return JSON.stringify(t).slice(1,25);var n=!1;c&&"string"==typeof t&&c.test(t)&&(t="'"+t,n=!0);var o=t.toString().replace(f,l);return(n=n||!0===r||"function"==typeof r&&r(t,e)||Array.isArray(r)&&r[e]||function(t,e){for(var r=0;r<e.length;r++)if(-1<t.indexOf(e[r]))return!0;return!1}(o,a.BAD_DELIMITERS)||-1<o.indexOf(i)||" "===o.charAt(0)||" "===o.charAt(o.length-1))?s+o+s:o}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!r&&!!e.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=y,a.ParserHandle=p,a.NetworkStreamer=u,a.FileStreamer=h,a.StringStreamer=c,a.ReadableStreamStreamer=f,e.jQuery){var s=e.jQuery;s.fn.parse=function(t){var r=t.config||{},n=[];return this.each((function(t){if("INPUT"!==s(this).prop("tagName").toUpperCase()||"file"!==s(this).attr("type").toLowerCase()||!e.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)n.push({file:this.files[i],inputElem:this,instanceConfig:s.extend({},r)})})),i(),this;function i(){if(0!==n.length){var e,r,i,l=n[0];if(x(t.before)){var u=t.before(l.file,l.inputElem);if("object"==typeof u){if("abort"===u.action)return"AbortError",e=l.file,r=l.inputElem,i=u.reason,void(x(t.error)&&t.error({name:"AbortError"},e,r,i));if("skip"===u.action)return void o();"object"==typeof u.config&&(l.instanceConfig=s.extend(l.instanceConfig,u.config))}else if("skip"===u)return void o()}var h=l.instanceConfig.complete;l.instanceConfig.complete=function(t){x(h)&&h(t,l.file,l.inputElem),o()},a.parse(l.file,l.instanceConfig)}else x(t.complete)&&t.complete()}function o(){n.splice(0,1),i()}}}function l(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var e=m(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null),this._handle=new p(e),(this._handle.streamer=this)._config=e}.call(this,t),this.parseChunk=function(t,r){if(this.isFirstChunk&&x(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(t);void 0!==i&&(t=i)}this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+t;this._partialLine="";var s=this._handle.parse(o,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var l=s.meta.cursor;this._finished||(this._partialLine=o.substring(l-this._baseIndex),this._baseIndex=l),s&&s.data&&(this._rowCount+=s.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)e.postMessage({results:s,workerId:a.WORKER_ID,finished:u});else if(x(this._config.chunk)&&!r){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);s=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!u||!x(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(t){x(this._config.error)?this._config.error(t):n&&this._config.error&&e.postMessage({workerId:a.WORKER_ID,error:t,finished:!1})}}function u(t){var e;(t=t||{}).chunkSize||(t.chunkSize=a.RemoteChunkSize),l.call(this,t),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(t){this._input=t,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),r||(e.onload=b(this._chunkLoaded,this),e.onerror=b(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var t=this._config.downloadRequestHeaders;for(var n in t)e.setRequestHeader(n,t[n])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+i)}try{e.send(this._config.downloadRequestBody)}catch(t){this._chunkError(t.message)}r&&0===e.status&&this._chunkError()}},this._chunkLoaded=function(){4===e.readyState&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(t){var e=t.getResponseHeader("Content-Range");return null===e?-1:parseInt(e.substring(e.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(t){var r=e.statusText||t;this._sendError(new Error(r))}}function h(t){var e,r;(t=t||{}).chunkSize||(t.chunkSize=a.LocalChunkSize),l.call(this,t);var n="undefined"!=typeof FileReader;this.stream=function(t){this._input=t,r=t.slice||t.webkitSlice||t.mozSlice,n?((e=new FileReader).onload=b(this._chunkLoaded,this),e.onerror=b(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var t=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);t=r.call(t,this._start,i)}var o=e.readAsText(t,this._config.encoding);n||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(t.target.result)},this._chunkError=function(){this._sendError(e.error)}}function c(t){var e;l.call(this,t=t||{}),this.stream=function(t){return e=t,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var t,r=this._config.chunkSize;return r?(t=e.substring(0,r),e=e.substring(r)):(t=e,e=""),this._finished=!e,this.parseChunk(t)}}}function f(t){l.call(this,t=t||{});var e=[],r=!0,n=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(t){this._input=t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===e.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):r=!0},this._streamData=b((function(t){try{e.push("string"==typeof t?t:t.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(t){this._streamError(t)}}),this),this._streamError=b((function(t){this._streamCleanUp(),this._sendError(t)}),this),this._streamEnd=b((function(){this._streamCleanUp(),n=!0,this._streamData("")}),this),this._streamCleanUp=b((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function p(t){var e,r,n,i=Math.pow(2,53),o=-i,s=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,l=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,u=this,h=0,c=0,f=!1,p=!1,g=[],v={data:[],errors:[],meta:{}};if(x(t.step)){var _=t.step;t.step=function(e){if(v=e,M())w();else{if(w(),0===v.data.length)return;h+=e.data.length,t.preview&&h>t.preview?r.abort():(v.data=v.data[0],_(v,u))}}}function b(e){return"greedy"===t.skipEmptyLines?""===e.join("").trim():1===e.length&&0===e[0].length}function w(){return v&&n&&(P("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),n=!1),t.skipEmptyLines&&(v.data=v.data.filter((function(t){return!b(t)}))),M()&&function(){if(v)if(Array.isArray(v.data[0])){for(var e=0;M()&&e<v.data.length;e++)v.data[e].forEach(r);v.data.splice(0,1)}else v.data.forEach(r);function r(e,r){x(t.transformHeader)&&(e=t.transformHeader(e,r)),g.push(e)}}(),function(){if(!v||!t.header&&!t.dynamicTyping&&!t.transform)return v;function e(e,r){var n,i=t.header?{}:[];for(n=0;n<e.length;n++){var o=n,a=e[n];t.header&&(o=n>=g.length?"__parsed_extra":g[n]),t.transform&&(a=t.transform(a,o)),a=S(o,a),"__parsed_extra"===o?(i[o]=i[o]||[],i[o].push(a)):i[o]=a}return t.header&&(n>g.length?P("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+n,c+r):n<g.length&&P("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+n,c+r)),i}var r=1;return!v.data.length||Array.isArray(v.data[0])?(v.data=v.data.map(e),r=v.data.length):v.data=e(v.data,0),t.header&&v.meta&&(v.meta.fields=g),c+=r,v}()}function M(){return t.header&&0===g.length}function S(e,r){return n=e,t.dynamicTypingFunction&&void 0===t.dynamicTyping[n]&&(t.dynamicTyping[n]=t.dynamicTypingFunction(n)),!0===(t.dynamicTyping[n]||t.dynamicTyping)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(function(t){if(s.test(t)){var e=parseFloat(t);if(o<e&&e<i)return!0}return!1}(r)?parseFloat(r):l.test(r)?new Date(r):""===r?null:r):r;var n}function P(t,e,r,n){var i={type:t,code:e,message:r};void 0!==n&&(i.row=n),v.errors.push(i)}this.parse=function(i,o,s){var l=t.quoteChar||'"';if(t.newline||(t.newline=function(t,e){t=t.substring(0,1048576);var r=new RegExp(d(e)+"([^]*?)"+d(e),"gm"),n=(t=t.replace(r,"")).split("\r"),i=t.split("\n"),o=1<i.length&&i[0].length<n[0].length;if(1===n.length||o)return"\n";for(var a=0,s=0;s<n.length;s++)"\n"===n[s][0]&&a++;return a>=n.length/2?"\r\n":"\r"}(i,l)),n=!1,t.delimiter)x(t.delimiter)&&(t.delimiter=t.delimiter(i),v.meta.delimiter=t.delimiter);else{var u=function(e,r,n,i,o){var s,l,u,h;o=o||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var c=0;c<o.length;c++){var f=o[c],p=0,d=0,g=0;u=void 0;for(var v=new y({comments:i,delimiter:f,newline:r,preview:10}).parse(e),_=0;_<v.data.length;_++)if(n&&b(v.data[_]))g++;else{var m=v.data[_].length;d+=m,void 0!==u?0<m&&(p+=Math.abs(m-u),u=m):u=m}0<v.data.length&&(d/=v.data.length-g),(void 0===l||p<=l)&&(void 0===h||h<d)&&1.99<d&&(l=p,s=f,h=d)}return{successful:!!(t.delimiter=s),bestDelimiter:s}}(i,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);u.successful?t.delimiter=u.bestDelimiter:(n=!0,t.delimiter=a.DefaultDelimiter),v.meta.delimiter=t.delimiter}var h=m(t);return t.preview&&t.header&&h.preview++,e=i,r=new y(h),v=r.parse(e,o,s),w(),f?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,r.abort(),e=x(t.chunk)?"":e.substring(r.getCharIndex())},this.resume=function(){u.streamer._halted?(f=!1,u.streamer.parseChunk(e,!0)):setTimeout(u.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,r.abort(),v.meta.aborted=!0,x(t.complete)&&t.complete(v),e=""}}function d(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(t){var e,r=(t=t||{}).delimiter,n=t.newline,i=t.comments,o=t.step,s=t.preview,l=t.fastMode,u=e=void 0===t.quoteChar||null===t.quoteChar?'"':t.quoteChar;if(void 0!==t.escapeChar&&(u=t.escapeChar),("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=","),i===r)throw new Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<a.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var h=0,c=!1;this.parse=function(a,f,p){if("string"!=typeof a)throw new Error("Input must be a string");var y=a.length,g=r.length,v=n.length,_=i.length,m=x(o),b=[],w=[],M=[],S=h=0;if(!a)return W();if(t.header&&!f){var P=a.split(n)[0].split(r),T=[],E={},L=!1;for(var k in P){var I=P[k];x(t.transformHeader)&&(I=t.transformHeader(I,k));var A=I,C=E[I]||0;for(0<C&&(L=!0,A=I+"_"+C),E[I]=C+1;T.includes(A);)A=A+"_"+C;T.push(A)}if(L){var O=a.split(n);O[0]=T.join(r),a=O.join(n)}}if(l||!1!==l&&-1===a.indexOf(e)){for(var R=a.split(n),D=0;D<R.length;D++){if(M=R[D],h+=M.length,D!==R.length-1)h+=n.length;else if(p)return W();if(!i||M.substring(0,_)!==i){if(m){if(b=[],V(M.split(r)),H(),c)return W()}else V(M.split(r));if(s&&s<=D)return b=b.slice(0,s),W(!0)}}return W()}for(var F=a.indexOf(r,h),B=a.indexOf(n,h),N=new RegExp(d(u)+d(e),"g"),z=a.indexOf(e,h);;)if(a[h]!==e)if(i&&0===M.length&&a.substring(h,h+_)===i){if(-1===B)return W();h=B+v,B=a.indexOf(n,h),F=a.indexOf(r,h)}else if(-1!==F&&(F<B||-1===B))M.push(a.substring(h,F)),h=F+g,F=a.indexOf(r,h);else{if(-1===B)break;if(M.push(a.substring(h,B)),Z(B+v),m&&(H(),c))return W();if(s&&b.length>=s)return W(!0)}else for(z=h,h++;;){if(-1===(z=a.indexOf(e,z+1)))return p||w.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:b.length,index:h}),q();if(z===y-1)return q(a.substring(h,z).replace(N,e));if(e!==u||a[z+1]!==u){if(e===u||0===z||a[z-1]!==u){-1!==F&&F<z+1&&(F=a.indexOf(r,z+1)),-1!==B&&B<z+1&&(B=a.indexOf(n,z+1));var U=G(-1===B?F:Math.min(F,B));if(a.substr(z+1+U,g)===r){M.push(a.substring(h,z).replace(N,e)),a[h=z+1+U+g]!==e&&(z=a.indexOf(e,h)),F=a.indexOf(r,h),B=a.indexOf(n,h);break}var j=G(B);if(a.substring(z+1+j,z+1+j+v)===n){if(M.push(a.substring(h,z).replace(N,e)),Z(z+1+j+v),F=a.indexOf(r,h),z=a.indexOf(e,h),m&&(H(),c))return W();if(s&&b.length>=s)return W(!0);break}w.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:b.length,index:h}),z++}}else z++}return q();function V(t){b.push(t),S=h}function G(t){var e=0;if(-1!==t){var r=a.substring(z+1,t);r&&""===r.trim()&&(e=r.length)}return e}function q(t){return p||(void 0===t&&(t=a.substring(h)),M.push(t),h=y,V(M),m&&H()),W()}function Z(t){h=t,V(M),M=[],B=a.indexOf(n,h)}function W(t){return{data:b,errors:w,meta:{delimiter:r,linebreak:n,aborted:c,truncated:!!t,cursor:S+(f||0)}}}function H(){o(W()),b=[],w=[]}},this.abort=function(){c=!0},this.getCharIndex=function(){return h}}function g(t){var e=t.data,r=i[e.workerId],n=!1;if(e.error)r.userError(e.error,e.file);else if(e.results&&e.results.data){var o={abort:function(){n=!0,v(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_,resume:_};if(x(r.userStep)){for(var a=0;a<e.results.data.length&&(r.userStep({data:e.results.data[a],errors:e.results.errors,meta:e.results.meta},o),!n);a++);delete e.results}else x(r.userChunk)&&(r.userChunk(e.results,o,e.file),delete e.results)}e.finished&&!n&&v(e.workerId,e.results)}function v(t,e){var r=i[t];x(r.userComplete)&&r.userComplete(e),r.terminate(),delete i[t]}function _(){throw new Error("Not implemented.")}function m(t){if("object"!=typeof t||null===t)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=m(t[r]);return e}function b(t,e){return function(){t.apply(e,arguments)}}function x(t){return"function"==typeof t}return n&&(e.onmessage=function(t){var r=t.data;if(void 0===a.WORKER_ID&&r&&(a.WORKER_ID=r.workerId),"string"==typeof r.input)e.postMessage({workerId:a.WORKER_ID,results:a.parse(r.input,r.config),finished:!0});else if(e.File&&r.input instanceof File||r.input instanceof Object){var n=a.parse(r.input,r.config);n&&e.postMessage({workerId:a.WORKER_ID,results:n,finished:!0})}}),(u.prototype=Object.create(l.prototype)).constructor=u,(h.prototype=Object.create(l.prototype)).constructor=h,(c.prototype=Object.create(c.prototype)).constructor=c,(f.prototype=Object.create(l.prototype)).constructor=f,a}()}(ta);var ea=ta.exports,ra=function(e){function r(t,r,n,i,o){var a=e.call(this,n,i,o,!0)||this;return a._url=t,a._crsCode=r,a}return t.__extends(r,e),r.prototype._createLoadDataParams=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r,n;return t.__generator(this,(function(i){switch(i.label){case 0:return[4,t.ajax.callText(this._url,this._getNetworkOptions())];case 1:if(e=i.sent(),!t.isValidStatus(e))throw e;return r=e.body,n=function(e){var r,n,i=ea.parse(e,{delimiter:"\t"}).data;if(i.length<1)throw new t.SourceError;var o=i[0].map((function(e){return t.VectorTileProperties.convertKey(e)})),a=o.indexOf("geometry"),s=o.indexOf("stack"),l=o.indexOf("poi_view"),u=o.indexOf("grade"),h=i.slice(1),c={type:"FeatureCollection",features:[]};try{for(var f=t.__values(h),p=f.next();!p.done;p=f.next()){var d=p.value;if(o.length===d.length){for(var y={type:"Feature",properties:{}},g=0;g<d.length;g++){var v=d[g];if(g===a)y.geometry=$o(v);else if(g===s)y.properties.stackId=v;else if(g===l){var _=v.indexOf("1"),m=v.lastIndexOf("1");y.properties.minLevel=String(_+t.VSM_LEGACY_TILE_LEVEL_GAP),y.properties.maxLevel=String(m+t.VSM_LEGACY_TILE_LEVEL_GAP)}else if(g===u)y.properties.grade=String(v);else{var b=o[g];y.properties[b]=v}}"grade"in y.properties||(y.properties.grade="0"),c.features.push(y)}}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return c}(r),[2,{sourceType:this.getType(),options:this.options,data:JSON.stringify(n),crsCode:this._crsCode}]}}))}))},r}(jo),na=ra,ia=function(e){function r(t,r,n,i){return e.call(this,t,r,n,i)||this}return t.__extends(r,e),r.prototype._formatTileUrl=function(t){return this.tileUrl.replace("{z}","".concat(t.z)).replace("{x}","".concat(t.x)).replace("{y}","".concat(t.y))},r}(zo),oa={tileServiceName:t.TileServiceName.GoogleMapRaster},aa=function(){function e(e,r,n){void 0===n&&(n={}),this._tileUrl=e,this._config=r,this._options=t.merge([n,oa],!1),this._tms=e.indexOf("{-y}")>=0,this._loadingStates={},this._requestAbortInvokers={}}return e.prototype.update=function(){},e.prototype.isReady=function(){return!0},e.prototype.setMap=function(t){},e.prototype.setData=function(t){throw new Error("Unsupported method")},e.prototype.toDataTiles=function(e,r){var n=this;return t.uniqueKey(t.flatMap(e,(function(t){return r.toDataTiles(t,n._getTileServiceName())})),(function(t){return t.toString()}))},e.prototype._getTileServiceName=function(){return this._options.tileServiceName||t.TileServiceName.GoogleMapRaster},e.prototype.isValidTile=function(t,e){return!(this._options.minZoom&&t.z<this._options.minZoom||this._options.maxZoom&&t.z>this._options.maxZoom)&&e.isVisibleDataTile(t,this._getTileServiceName())},e.prototype.loadTile=function(e,r,n,i){var o="Reload"===n.type,a={uniqueId:t.v4(),tileId:e,url:this._getTileUrl(e),sourceType:this.getType(),options:this._options,reload:o},s=o?{state:"Reloading",tileParams:a,tileData:n.prevTile.tileData}:{state:"Loading",tileParams:a};return this._loadingStates[a.uniqueId]="Loading",this._requestTile(a,{onSuccess:function(r,n){s.orphan||(s.tileParams.reload&&(s.tileData&&(s.tileData.destroy(),delete s.tileData),s.tileParams.reload=!1),s.tileData=new t.PreparedTileData(e,t.SingleStyleDataMap.valueOf(new t.RasterStyleData),new qo(r,{useMipmap:!0},n)),s.state="Ready")},onCancel:function(){s.state="Cancelled"},onFail:function(t){Bo(0,s)},onError:function(t){s.state="Error"},onFinal:function(){i&&i(s)}}).then((function(){})),s},e.prototype._requestTile=function(e,r){var n=e.uniqueId,i=e.url,o=r.onSuccess,a=r.onCancel,s=r.onFail,l=r.onError,u=r.onFinal;return t.__awaiter(this,void 0,void 0,(function(){var e,r,h,c,f=this;return t.__generator(this,(function(p){switch(p.label){case 0:e=function(){if("Aborted"===f._loadingStates[n])throw"Aborted"},p.label=1;case 1:return p.trys.push([1,6,7,8]),e(),[4,this._requestTileBinary(i,n)];case 2:return r=p.sent(),t.isValidStatus(r)?(e(),[4,mo(r.body)]):[3,4];case 3:return h=p.sent(),o(h,r.body.byteLength),[3,5];case 4:s(r),p.label=5;case 5:return[3,8];case 6:return"Aborted"===(c=p.sent())?a():l(c),[3,8];case 7:return delete this._loadingStates[n],u(),[7];case 8:return[2]}}))}))},e.prototype._requestTileBinary=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i;return t.__generator(this,(function(o){switch(o.label){case 0:n=new t.DefaultAbortInvoker,this._requestAbortInvokers[r]=n,o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,t.ajax.callBinary(e,t.__assign(t.__assign({},this._getNetworkOptions()),{abortInvoker:n}))];case 2:return[2,o.sent()];case 3:throw i=o.sent(),n.isAborted()?"Aborted":i;case 4:return delete this._requestAbortInvokers[r],[7];case 5:return[2]}}))}))},e.prototype._getTileBBox=function(t,e){return e.getDataTileBBox(t,this._getTileServiceName())},e.prototype._getTileUrl=function(t){return this._formatTileUrl(t)},e.prototype._formatTileUrl=function(t){var e=this._tileUrl.replace("{z}","".concat(t.z)).replace("{x}","".concat(t.x));return this._tms?e.replace("{-y}","".concat(Math.pow(2,t.z)-1-t.y)):e.replace("{y}","".concat(t.y))},e.prototype.abortTile=function(t){var e,r=t.uniqueId;"Loading"===this._loadingStates[r]&&(this._loadingStates[r]="Aborted"),null===(e=this._requestAbortInvokers[r])||void 0===e||e.abort()},e.prototype.clearTile=function(t){},e.prototype.getPositionMatrix=function(t,e){return t.getDataTilePositionMatrix(e,this._getTileServiceName())},e.prototype.getTileUnitsPerPixel=function(t,e){return t.getDataTileUnitsPerPixel(e,this._getTileServiceName())},e.prototype.destroy=function(){var e,r;try{for(var n=t.__values(Object.values(this._requestAbortInvokers)),i=n.next();!i.done;i=n.next())i.value.abort()}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},e.prototype._getId=function(){return this._tileUrl},Object.defineProperty(e.prototype,"tileUrl",{get:function(){return this._tileUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),e.prototype.getTileLevel=function(t){return this._getTileAdapter().getTileService().getLevel(t)},e.prototype._getTileAdapter=function(){return t.tileAdapters[this._getTileServiceName()]},e.prototype.getStyleLevel=function(t){return Math.trunc(t)},e.prototype.getType=function(){return"Raster"},e.prototype.getRenderType=function(){return Lo.Raster},e.prototype.getTileSizeFactor=function(){return 1},e.prototype.toTileRelativePoint=function(t,e){return this._getTileAdapter().toRelativePoint(e,t)},e.prototype.toLngLat=function(t,e){return this._getTileAdapter().toLngLat(t,e)},e.prototype.getTileExtent=function(){return this._getTileAdapter().getTileExtent()},e.prototype.getTileSize=function(){return this._getTileAdapter().getTileSize()},e.prototype.isPreventedFromOverlapping=function(){return!1},e.prototype.setMapEventEmitter=function(t){this._eventEmitter=t},e.prototype.emit=function(t,e){var r;null===(r=this._eventEmitter)||void 0===r||r.emit(t,e)},e.prototype._getNetworkOptions=function(){return this._config.getNetworkOptions()},e}(),sa=aa,la=function(e){function r(t,r,n){return e.call(this,t,r,n)||this}return t.__extends(r,e),r.prototype._formatTileUrl=function(t){return"".concat(this.tileUrl,"/").concat(t.toString(),".jpg")},r.prototype.getStyleLevel=function(e){switch(this.options.tileServiceName){case t.TileServiceName.VsmRaster:return t.getVsmStyleLevel(e);case t.TileServiceName.VsmLegacyRaster:return t.getVsmLegacyStyleLevel(e);default:throw new t.SourceError}},r.prototype.getType=function(){return"Sam"},r.prototype.getTileSizeFactor=function(){return this.options.tileServiceName===t.TileServiceName.VsmLegacyVector?1.5:1},r}(sa);function ua(e,r,n){var i=function(e,r){var n,i,o=e.getSourceSpec(),a=r.getSetting(fo),s=r.getSetting(po),l=t.__assign({},o);if(a){var u=a.getBody().tileProxies,h=e.getId(),c=e.getVersionedUrl();try{for(var f=t.__values(u),p=f.next();!p.done;p=f.next()){var d=p.value,y=d.layers,g=d.format,v=d.uri;y.indexOf(h)>-1&&c&&(l=t.__assign(t.__assign({},l),{format:g,uri:v.replace("{layerUri}",c)}))}}catch(t){n={error:t}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}}if(s){var _=s.getBody(),m=_.minLevel,b=_.maxLevel,x=_.vector,w=new Set;x.levels.forEach((function(t){w.add(t.zoom)}));var M=Array.from(w).sort((function(t,e){return t-e}));l=t.__assign(t.__assign({},l),{minViewLevel:m,maxViewLevel:b,discreteZooms:M})}return l}(e,r),o=i.format,a=i.srid,s=void 0===a?4162:a,l=i.preventOverlap,u=i.minZoom,h=i.maxZoom,c=i.discreteZooms,f=i.minViewLevel,p=i.maxViewLevel,d=e.getId(),y=e.getType();switch(o){case"vsm2":case"vsm4":case"vsm8":return new zo(i.uri,r,n,4162===s?{format:o,tileServiceName:t.TileServiceName.VsmLegacyVector,layerId:d,preventOverlap:l}:{format:o,tileServiceName:t.TileServiceName.VsmVector,layerId:d,preventOverlap:l,discreteZooms:c,minViewLevel:f,maxViewLevel:p});case"mvt":var g=t.__read(function(e){var r,n,i=t.__spreadArray([],t.__read(e.getStacks()),!1),o=new Set;try{for(var a=t.__values(i),s=a.next();!s.done;s=a.next()){var l=s.value.getViewLevels();l&&l.forEach((function(t){o.add(t)}))}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}var u=Array.from(o).sort((function(t,e){return t-e}));return[u[0],u[u.length-1]]}(e),2),v=g[0],_=g[1],m=null!=f?f:v,b=null!=p?p:_;return new ia(i.uri,r,n,{format:o,tileServiceName:t.TileServiceName.GoogleMapVector,layerId:d,preventOverlap:l,minZoom:m,maxZoom:b,minViewLevel:m,maxViewLevel:b});case"jpeg":return"Sam"===y?new la(i.uri,r,4162===s?{tileServiceName:t.TileServiceName.VsmLegacyRaster}:{tileServiceName:t.TileServiceName.VsmRaster}):new sa(i.uri,r,{tileServiceName:t.TileServiceName.GoogleMapRaster,minZoom:u,maxZoom:h});case"geojson":return new Go(i.data,r,n,{format:o,tileServiceName:t.TileServiceName.GoogleMapVector,layerId:d,preventOverlap:l,buffer:i.buffer,minZoom:u,maxZoom:h});case"ld1":return new na(t.getVersionedUrl(i),function(t){return"EPSG:".concat(t)}(s),r,n,{format:o,tileServiceName:t.TileServiceName.GoogleMapVector,layerId:d,preventOverlap:l,minZoom:u,maxZoom:h});case"image":return new Wo(i.uri,i.bbox,r,n,{format:o,tileServiceName:t.TileServiceName.GoogleMapVector,layerId:d,preventOverlap:l});default:return null}}var ha=function(){function t(){var t=function(t,e){var r=e.tileData;r&&r.destroy()};this._cache=new Io(0,t),this._emptyCache=new Io(0,t)}return t.prototype.add=function(t,e){"Empty"!==e.state?this._cache.set(t.toString(),e):this._emptyCache.set(t.toString(),e)},t.prototype.detach=function(t){var e,r=t.toString();return this._cache.has(r,!0)?(e=this._cache.delete(r,!1)).value:null==(e=this._emptyCache.delete(r,!1))?void 0:e.value},t.prototype.has=function(t){var e=t.toString();return this._cache.has(e,!0)||this._emptyCache.has(e,!0)},t.prototype.clear=function(){this._cache.clear(),this._emptyCache.clear()},t.prototype.setMaxSize=function(t){this._cache.setMaxSize(t),this._emptyCache.setMaxSize(5*t)},t}(),ca=ha;function fa(t){t.timeoutId&&(clearTimeout(t.timeoutId),delete t.timeoutId)}var pa=function(){function e(t){this._schedules={},this._maxRequestCount=t}return e.prototype.request=function(t,e){var r=this._schedules[t]||{requestCount:1};if(this._schedules[t]=r,fa(r),r.requestCount<=this._maxRequestCount){var n=1e3*Math.pow(2,Math.min(r.requestCount-1,31));r.timeoutId=setTimeout((function(){e()}),n),r.requestCount++}else console.warn("Couldn't load tile ".concat(t))},e.prototype.cancel=function(t){var e=this._schedules[t];e&&(fa(e),delete this._schedules[t])},e.prototype.clear=function(){var e,r;try{for(var n=t.__values(Object.values(this._schedules)),i=n.next();!i.done;i=n.next())fa(i.value)}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},e}(),da=pa,ya=function(){function e(t,e,r){this._needReloading=!1,this._source=t,this._layerId=e,this._tiles={},this._tileRecycler=new ca,this._tileRetryer=new da(3),this._optimize=r.getOptimize(),this._source.setMapEventEmitter({emit:function(t,e){r.emit(new Pt(t,r,e))}})}return e.prototype.update=function(e,r){var n,i,o,a,s=this;this._source.update(),this._updateCacheSize(r);var l=this._source.toDataTiles(e,r).filter((function(t){return s._source.isValidTile(t,r)})).map((function(t){return{tileId:t,tileKey:t.toString()}})),u=l.length;this._restoreTiles(l),this._needReloading&&(this._expireTiles(l),this._needReloading=!1);try{for(var h=t.__values(l),c=h.next();!c.done;c=h.next()){var f=c.value,p=f.tileId,d=f.tileKey,y=this._tiles[d];Sa(y)&&this._source.isReady()&&this._loadTile(p,d,r,{type:Pa(y),prevTile:y,visibleTileCount:u})}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}var g=this._source.getTileLevel(r.getZoom()),v=this._updateRetainedTiles(l,g),_=t.keysDifference(this._tiles,v);try{for(var m=t.__values(_),b=m.next();!b.done;b=m.next()){var x=b.value;this._removeTile(x),this._tileRetryer.cancel(x)}}catch(t){o={error:t}}finally{try{b&&!b.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}},e.prototype._restoreTiles=function(e){var r,n;try{for(var i=t.__values(e),o=i.next();!o.done;o=i.next()){var a=o.value,s=a.tileId,l=a.tileKey;!this._tiles[l]&&this._tileRecycler.has(s)&&(this._tiles[l]=this._tileRecycler.detach(s))}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype._expireTiles=function(e){var r,n;try{for(var i=t.__values(e),o=i.next();!o.done;o=i.next()){var a=o.value.tileKey,s=this._tiles[a];if(s)switch(this._tiles[a]={state:"Expired",tileParams:t.__assign({},s.tileParams),tileData:s.tileData},delete s.tileData,s.state){case"Partial":this._source.clearTile(s.tileParams);break;case"PartialAndLoading":case"Loading":case"Reloading":this._source.abortTile(s.tileParams),s.orphan=!0}}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this._tileRecycler.clear(),this._tileRetryer.clear()},e.prototype._loadTile=function(t,e,r,n){var i,o=this,a=n.type,s=n.prevTile,l=n.visibleTileCount;i="Partial"===a&&Ma(s)||"Reload"===a&&ba(s)?{type:a,prevTile:s,optimize:this._optimize}:{type:"Default",optimize:this._optimize},this._tiles[e]=this._source.loadTile(t,r,i,(function(i){var a=i.state,s=i.orphan,u=i.tileData;if(!s)switch(a){case"Partial":case"Ready":case"Empty":var h=function(t){return t?t.hasLink()?t.rearLink():t:null}(u),c=(null==h?void 0:h.tileCompositeData.getTileInfo())||{},f=c.responseBodySize,p=void 0===f?0:f,d=c.rawData;o._tileRetryer.cancel(e),o._source.emit(x.Data,{layerId:o._layerId,tileId:t,state:a,visibleTileCount:l,responseBodySize:p,rawData:d});break;case"Error":o._tileRetryer.request(e,(function(){o._loadTile(t,e,r,n)}))}}))},e.prototype._updateRetainedTiles=function(e,r){var n,i,o={};if(0===e.length)return o;try{for(var a=t.__values(e),s=a.next();!s.done;s=a.next()){var l=s.value,u=l.tileId;o[l.tileKey]=u}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}var h=this._retainLoadedChildren(e,r),c=this._retainLoadedParent(e,r);return Object.assign(o,h,c)},e.prototype._retainLoadedChildren=function(e,r){var n,i,o=this,a={},s={},l=!1;if(e.forEach((function(t){var e=t.tileId,r=t.tileKey;xa(o._tiles[r])||(s[r]=e,l=!0)})),!l)return a;try{for(var u=t.__values(Object.keys(this._tiles)),h=u.next();!h.done;h=u.next()){var c=h.value,f=this._tiles[c];if(!(!xa(f)||f.tileParams.tileId.z<=r||f.tileParams.tileId.z>r+3)){for(var p=f.tileParams.tileId;xa(f)&&f.tileParams.tileId.z>r+1;){var d=f.tileParams.tileId.parent();f=this._tiles[d.toString()],xa(f)&&(p=d)}for(var y=p;y.z>r;)if(y=y.parent(),s[y.toString()]){a[p.toString()]=p;break}}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return a},e.prototype._retainLoadedParent=function(e,r){var n,i,o={};try{for(var a=t.__values(e),s=a.next();!s.done;s=a.next()){var l=s.value,u=l.tileId,h=l.tileKey,c=this._tiles[h];if(!(xa(c)||u.z>r))for(var f=u;f.z>0;){var p=(f=f.parent()).toString(),d=this._tiles[p];xa(d)&&(o[p]=f)}}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},e.prototype._updateCacheSize=function(e){var r=t.DEFAULT_TILE_SIZE*e.getEnlargeScaleFactor(),n=Math.ceil(e.getWidth()/r)+1,i=Math.ceil(e.getHeight()/r)+1,o=Math.round(n*i*5*this._source.getTileSizeFactor());this._tileRecycler.setMaxSize(o)},e.prototype._removeTile=function(e){var r,n,i=this,o=this._tiles[e];if(o){delete this._tiles[e];var a=function(t){var e;xa(t)&&(null===(e=t.tileData)||void 0===e||e.markDirty(),i._tileRecycler.add(t.tileParams.tileId,t))};switch(o.state){case"Ready":case"Empty":a(o);break;case"Partial":a(o),this._source.clearTile(o.tileParams);break;case"PartialAndLoading":a(t.__assign(t.__assign({},o),{state:"Partial",branch:!0})),delete o.tileData,this._source.abortTile(o.tileParams),o.orphan=!0;break;case"Loading":this._source.abortTile(o.tileParams),o.orphan=!0;break;case"Expired":null===(r=o.tileData)||void 0===r||r.destroy();break;case"Reloading":this._source.abortTile(o.tileParams),null===(n=o.tileData)||void 0===n||n.destroy(),o.orphan=!0}}},e.prototype._getOverlappedTileSet=function(t){var e={};t.forEach((function(t){var r=t.tileData.tileId.z;e[r]||(e[r]=[]),e[r].push(t.tileData.tileId)}));var r=Object.keys(e).map((function(t){return parseInt(t)})).sort((function(t,e){return e-t})),n=r[r.length-1];if(r.length>1){for(var i=new Set,o=0;o<r.length-1;o++)for(var a=e[r[o]],s=0;s<a.length;s++)for(var l=a[s],u=l,h=u.z,c=function(){var t=u.parent();e[t.z]&&e[t.z].find((function(e){return e.toString()===t.toString()}))&&i.add(l.toString()),u=t,h=t.z};h>n;)c();return i}return null},e.prototype.getCachedTiles=function(){var t=Object.values(this._tiles).filter(ba);if(this._source.isPreventedFromOverlapping()){var e=this._getOverlappedTileSet(t);return(e?t.filter((function(t){return!e.has(t.tileData.tileId.toString())})):t).map((function(t){return t.tileData}))}return t.map((function(t){return t.tileData}))},e.prototype.getPositionMatrix=function(t,e){return this._source.getPositionMatrix(t,e)},e.prototype.getTileUnitsPerPixel=function(t,e){return this._source.getTileUnitsPerPixel(t,e)},e.prototype.clear=function(){var e,r;try{for(var n=t.__values(Object.keys(this._tiles)),i=n.next();!i.done;i=n.next()){var o=i.value;this._removeTile(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}this._tileRecycler.clear(),this._tileRetryer.clear()},e.prototype.getTileLevel=function(t){return this._source.getTileLevel(t)},e.prototype.getStyleLevel=function(t){return this._source.getStyleLevel(t)},e.prototype.destroy=function(){this.clear(),this._source.destroy()},e.prototype.getType=function(){return this._source.getType()},e.prototype.getRenderType=function(){return this._source.getRenderType()},e.prototype.toTileRelativePoint=function(t,e){return this._source.toTileRelativePoint(t,e)},e.prototype.toLngLat=function(t,e){return this._source.toLngLat(t,e)},e.prototype.getTileExtent=function(){return this._source.getTileExtent()},e.prototype.hasUnfinishedTiles=function(){var e,r;try{for(var n=t.__values(Object.values(this._tiles)),i=n.next();!i.done;i=n.next()){var o=i.value;if(wa(o))return!0}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!1},e.prototype.updateData=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,this._source.setData(e)];case 1:return t.sent(),this.requestReloading(),[2]}}))}))},e.prototype.requestReloading=function(){this._needReloading=!0},e.prototype.getOrigin=function(){return this._source},e.prototype.getLayerId=function(){return this._layerId},e.prototype.getTileSize=function(){return this._source.getTileSize()},e}(),ga=ya,va=new Set(["Partial","Ready","PartialAndLoading","Expired","Reloading"]),_a=new Set(["Empty","Partial","Ready","PartialAndLoading","Expired","Reloading"]),ma=new Set(["Loading","PartialAndLoading","Partial","Error","Expired","Reloading"]),ba=function(t){return!!t&&!!t.tileData&&va.has(t.state)},xa=function(t){return!!t&&_a.has(t.state)},wa=function(t){return ma.has(t.state)},Ma=function(t){return!!t&&!!t.tileData&&"Partial"===t.state},Sa=function(t){return!t||"Partial"===t.state||"Cancelled"===t.state||"Expired"===t.state},Pa=function(t){return t?Ma(t)?"Partial":function(t){return!!t&&"Expired"===t.state}(t)&&ba(t)?"Reload":"Default":"Default"},Ta=function(){function e(e){var r,n;this._styles={},this._specs={};try{for(var i=t.__values(e.config),o=i.next();!o.done;o=i.next()){var a=o.value;a.layers=t.__spreadArray([],t.__read(e.layers),!1),this._styles[a.type]=new t.Style(a),this._specs[a.type]=a}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this._id=e.id,this._types=e.types}return e.prototype.getId=function(){return this._id},e.prototype.getTypes=function(){return this._types},e.prototype.getStyle=function(t){return this._styles[t]},e.prototype.getSpec=function(t){return this._specs[t]},e}(),Ea=Ta,La=function(){function e(t,e){void 0===e&&(e=0),this._bufferedGeometryCache={},this._bbox=t,this._bufferInPixel=e}return e.valueOf=function(r,n){if(t.hasProperty(r,"x")||Array.isArray(r)&&2===r.length&&"number"==typeof r[0]){var i=t.valueOf(r),o=i.x,a=i.y;return new e({minX:o,minY:a,maxX:o,maxY:a},n)}var s=function(e){if(Array.isArray(e)){if(2===e.length){var r=t.valueOf(e[0]),n=r.x,i=r.y,o=t.valueOf(e[1]);return{left:n,top:i,right:o.x,bottom:o.y}}return{left:e[0],top:e[1],right:e[2],bottom:e[3]}}return e}(r);return new e({minX:s.left,minY:s.top,maxX:s.right,maxY:s.bottom},n)},e.prototype.getScreenIntersection=function(e){var r=t.expandBy(this._bbox,this._bufferInPixel),n=t.toPolygon(r),i={minX:0,minY:0,maxX:e.getWidth(),maxY:e.getHeight()};return{bufferedGeometry:n,bufferedBBox:t.intersection(t.getBounds(n),i)}},e.prototype.getTileIntersection=function(e,r,n){var i=e.tileId,o=e.tileCompositeData,a=this._getBufferedPrjCoord(this._bufferInPixel,r).map((function(t){return n.toTileRelativePoint(t,i)})),s=this._getBufferedPrjCoord(this._bufferInPixel+o.queryPadding,r).map((function(t){return n.toTileRelativePoint(t,i)}));t.isCounterClockWise(a)||a.reverse(),t.isCounterClockWise(s)||s.reverse();var l=n.getTileExtent(),u={minX:0,minY:0,maxX:l,maxY:l};return t.polygonIntersectsBBox(s,u)?{geometry:a,bufferedGeometry:s,bufferedBBox:t.intersection(t.getBounds(s),u),tileData:e,tileUnitsPerPixel:n.getTileUnitsPerPixel(r,i)}:null},e.prototype._getBufferedPrjCoord=function(e,r){var n=this._cacheKey(e),i=this._bufferedGeometryCache[n];return i||(i=t.toPolygon(t.expandBy(this._bbox,e)).map((function(t){return r.screenPointToPrjCoord(t)})),this._bufferedGeometryCache[n]=i),i},e.prototype._cacheKey=function(t){return Math.trunc(100*t)},e}(),ka=La;function Ia(e,r,n,i,o){var a,s,l,u,h=[];try{for(var c=t.__values(r.getCachedTiles()),f=c.next();!f.done;f=c.next()){var p=f.value;if(p.prepared){var d=n.getTileIntersection(p,o,r);d&&h.push(d)}}}catch(t){a={error:t}}finally{try{f&&!f.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}var y=i.lookupFilter,g=i.filter,v=Ca(i,e),_={},m=function(n){var i,a,s=n.tileData,l=n.bufferedBBox,u=n.bufferedGeometry,h=s.tileId,c=s.styleDataMap,f=s.tileCompositeData,p=c;if(!(f instanceof t.VectorTileCompositeData))return"continue";var d=f,m=d.featureIndex,b=d.vectorTile,x=m.query(l,(function(e,r,n,i){return t.polygonIntersectsBBox(u,{minX:e,minY:r,maxX:n,maxY:i})})),w=function(t){var e=r.toLngLat(h,t);return{x:e.lng,y:e.lat}},M=function(r,i,a){var s=e.getStack(r),l=p.get(r,a);if(!s||!s.getVisibility()||!l||v&&!v.has(r))return"continue";var u=b.getStack(r).getFeature(i),c={layerId:e.getId(),stackId:r,styleId:a,tileId:h.toObject(),geometryType:Oa(u)};if(y&&!y(t.__assign(t.__assign({},c),{getFeatureProperty:function(t){return u.properties.get(t)}})))return"continue";var f=b.loadGeometry(u);if(!l.queryIntersectsFeature(n,i,u,f,o,s.getProperties()))return"continue";var d=t.toGeoJsonFeature(u,f,w);g&&!g(d,c)||t.computeIfAbsent(_,r,(function(){return[]})).push(Ra(d,c))};try{for(var S=(i=void 0,t.__values(x)),P=S.next();!P.done;P=S.next()){var T=P.value;M(T.stackId,T.featurePos,T.styleId)}}catch(t){i={error:t}}finally{try{P&&!P.done&&(a=S.return)&&a.call(S)}finally{if(i)throw i.error}}};try{for(var b=t.__values(h),x=b.next();!x.done;x=b.next())m(x.value)}catch(t){l={error:t}}finally{try{x&&!x.done&&(u=b.return)&&u.call(b)}finally{if(l)throw l.error}}return _}function Aa(e,r){var n,i,o,a,s=r.targets;if(!s)return!0;try{for(var l=t.__values(s),u=l.next();!u.done;u=l.next()){var h=u.value,c=h.layerId,f=h.stackIds;if(c===e.getId()){if(!f)return!0;try{for(var p=(o=void 0,t.__values(f)),d=p.next();!d.done;d=p.next()){var y=d.value;if(e.getStack(y))return!0}}catch(t){o={error:t}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}}}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return!1}function Ca(e,r){var n,i,o=e.targets;if(!o)return null;try{for(var a=t.__values(o),s=a.next();!s.done;s=a.next()){var l=s.value,u=l.layerId,h=l.stackIds;if(u===r.getId())return h?new Set(h):null}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return new Set}function Oa(e){switch(e.geometryType){case t.VectorTileStackDataType.Point:return"POINT";case t.VectorTileStackDataType.Polyline:return"LINE";case t.VectorTileStackDataType.Polygon:return"POLYGON";default:throw Error()}}function Ra(t,e){return t.properties||(t.properties={}),t.properties.combinedInfo=e,t}var Da=function(){function e(e,r,n,i){var o=this;this._id=e,this._mapId=r,this._worker=n,this._eventListener=function(e){return t.__awaiter(o,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,this._receive(e)]}))}))},this._callbacks={},this._workerCallback=i,this._connections=0,this._connectionWeights=0,this._latestRequestTime=-1,this._exclusiveTargets=0,n.addEventListener(this._eventListener)}return e.prototype.send=function(e,r,n){return void 0===n&&(n={}),t.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,u,h,c,f,p,d=this;return t.__generator(this,(function(y){return i=n.forceCopy,o=void 0!==i&&i,a=n.weightAmplifier,s=void 0===a?Ba:a,l=n.instant,u=s(function(t){switch(t){case"LoadTile":return 3;case"AbortTile":case"ClearTile":return.25;case"LoadData":return 5;default:return 1}}(e)),h=t.serialize(r),c=h.data,f=h.transferable,p={type:"Request",taskId:t.v4(),groupId:this._mapId,timeStamp:t.browser.now(),method:e,params:c,instant:l},this._worker.postMessage(p,o?[]:f),this._connections++,this._connectionWeights+=u,this._latestRequestTime=p.timeStamp,[2,new Promise((function(t,e){d._callbacks[p.taskId]={resolve:t,reject:e,weight:u}}))]}))}))},e.prototype._receive=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n;return t.__generator(this,(function(t){return r=e.data,"Request"===(n=r.type)?[2,this._handleRequest(r)]:"Response"===n?[2,this._handleResponse(r)]:[2]}))}))},e.prototype._handleRequest=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,u;return t.__generator(this,(function(h){switch(h.label){case 0:if(r=e.taskId,n=e.groupId,i=e.method,o=e.params,n!==this._mapId)return[2];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._call(i,t.deserialize(o))];case 2:return a=h.sent(),s=t.serialize(a),u={type:"Response",taskId:r,groupId:n,status:"Ok",result:s.data},this._worker.postMessage(u,s.transferable),[3,4];case 3:return l=h.sent(),u={type:"Response",taskId:r,groupId:n,status:"InternalError",result:l},this._worker.postMessage(u),[3,4];case 4:return[2]}}))}))},e.prototype._call=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(e){case"GetGlyphPathFactory":return[2,this._workerCallback.getGlyphPathFactory()];case"GetGlyphs":return[2,this._workerCallback.getGlyphs(r)];case"GetIcons":return[2,this._workerCallback.getIcons(r)];default:return[2,new Promise((function(t,r){return r("Unsupported method : ".concat(e))}))]}}))}))},e.prototype._handleResponse=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a;return t.__generator(this,(function(s){if(r=e.taskId,n=e.groupId,i=e.result,o=e.status,n!==this._mapId)return[2];a=this._callbacks[r];try{"Ok"===o?a.resolve(t.deserialize(i)):a.reject(i)}catch(t){a.reject(t)}finally{this._connections--,this._connectionWeights-=a.weight,delete this._callbacks[r]}return[2]}))}))},e.prototype.assignExclusive=function(){this._exclusiveTargets++},e.prototype.releaseExclusive=function(){this._exclusiveTargets--},e.prototype.destroy=function(){this._worker.removeEventListener(this._eventListener)},e.prototype.getId=function(){return this._id},e.prototype.getConnections=function(){return this._connections},e.prototype.getConnectionWeights=function(){return this._connectionWeights},e.prototype.getLatestRequestTime=function(){return this._latestRequestTime},e.prototype.getExclusiveTargets=function(){return this._exclusiveTargets},e}(),Fa=Da,Ba=function(t){return t},Na=function(){function t(t){this._actors=[],this._actors=t}return Object.defineProperty(t.prototype,"actors",{get:function(){return this._actors},enumerable:!1,configurable:!0}),t}(),za=function(e){function r(t){var r=e.call(this,t)||this;return r._current=0,r}return t.__extends(r,e),r.prototype.next=function(){var t=this.actors[this._current];return this._current=(this._current+1)%this.actors.length,t},r}(Na);!function(e){function r(t){return e.call(this,t)||this}t.__extends(r,e),r.prototype.next=function(){var t=Math.trunc(Math.random()*this.actors.length);return this.actors[t]}}(Na);var Ua=function(e){function r(t){return e.call(this,t)||this}return t.__extends(r,e),r.prototype.next=function(){var r,n,i=this.actors.map((function(t){return{connections:t.getConnections(),connectionWeights:t.getConnectionWeights(),latestRequestTime:t.getLatestRequestTime()}}));if(t.calcStandardDeviation(i.map((function(t){return t.connectionWeights})))<3)return e.prototype.next.call(this);for(var o=0,a=1;a<i.length;a++){var s=i[o],l=i[a],u=[l.connectionWeights-s.connectionWeights,l.connections-s.connections,l.latestRequestTime-s.latestRequestTime];try{for(var h=(r=void 0,t.__values(u)),c=h.next();!c.done;c=h.next()){var f=c.value;0!==f&&f<0&&(o=a)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}}return this.actors[o]},r}(za),ja=function(){function e(t){this._appConfig=t}return e.prototype.getGlyphPathFactory=function(){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,this._appConfig.getFontPackage().getGlyphPathFactory()];case 1:return[2,t.sent().clone()]}}))}))},e.prototype.getGlyphs=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,u,h,c,f;return t.__generator(this,(function(p){switch(p.label){case 0:r=this._appConfig.getFontPackage(),n={},i=[],o=function(e,o){var a,s,l=function(t){var o=r.getData(t).then((function(r){r.result&&(n[e]||(n[e]=[]),n[e].push({path:t,raw:r.result.slice(0)}))}));i.push(o)};try{for(var u=(a=void 0,t.__values(o)),h=u.next();!h.done;h=u.next())l(h.value)}catch(t){a={error:t}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(a)throw a.error}}};try{for(a=t.__values(e),s=a.next();!s.done;s=a.next())l=s.value,u=l.fontStack,h=l.paths,o(u,h)}catch(t){c={error:t}}finally{try{s&&!s.done&&(f=a.return)&&f.call(a)}finally{if(c)throw c.error}}return[4,Promise.all(i)];case 1:return p.sent(),[2,n]}}))}))},e.prototype.getIcons=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,u,h;return t.__generator(this,(function(c){switch(c.label){case 0:r={},n=[],i=function(t){var e=t.packageName,i=t.iconName,a=t.toString(),s=o._appConfig.getResourcePackage(e);if(!(s instanceof vo))return"continue";var l=s.getOptions().pixelRatio,u=s.getData(i).then((function(t){t.result&&(r[a]={id:a,image:t.result.clone(),pixelRatio:l})}));n.push(u)},o=this;try{for(a=t.__values(e),s=a.next();!s.done;s=a.next())l=s.value,i(l)}catch(t){u={error:t}}finally{try{s&&!s.done&&(h=a.return)&&h.call(a)}finally{if(u)throw u.error}}return[4,Promise.all(n)];case 1:return c.sent(),[2,r]}}))}))},e}(),Va=ja,Ga=function(){function e(e,r,n){var i,o;this._mapId=r,this._workerPool=e;for(var a=e.acquire(this._mapId),s=new Va(n),l=[],u={},h=0;h<a.length;h++)l.push(new Fa("actor#".concat(h),r,a[h],s));try{for(var c=t.__values(l),f=c.next();!f.done;f=c.next()){var p=f.value;u[p.getId()]=p}}catch(t){i={error:t}}finally{try{f&&!f.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}this._actors=l,this._actorMap=u,this._loadBalancer=new Ua(l)}return e.prototype.broadcast=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,u;return t.__generator(this,(function(h){i=[];try{for(o=t.__values(this._actors),a=o.next();!a.done;a=o.next())s=a.value,i.push(s.send(e,r,{forceCopy:!0,instant:n}).then((function(t){return t})).catch(Uo))}catch(t){l={error:t}}finally{try{a&&!a.done&&(u=o.return)&&u.call(o)}finally{if(l)throw l.error}}return[2,Promise.all(i)]}))}))},e.prototype.getActor=function(t){return t?this._actorMap[t]:this._loadBalancer.next()},e.prototype.assignExclusiveActor=function(){var t=this._actors.reduce((function(t,e){return e.getExclusiveTargets()<t.getExclusiveTargets()?e:t}),this._actors[0]);return t.assignExclusive(),t},e.prototype.releaseExclusiveActor=function(t){var e;null===(e=this._actorMap[t])||void 0===e||e.releaseExclusive()},e.prototype.destroy=function(){var e,r;try{for(var n=t.__values(this._actors),i=n.next();!i.done;i=n.next())i.value.destroy()}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}this._actors=[],this._actorMap={},this._workerPool.release(this._mapId)},e}(),qa=Ga,Za=new Map,Wa=function(){function t(){}return t.registerWorker=function(t,e){Za.set(t,e)},t.isRegistered=function(t){return Za.has(t)},t.getWorkerUrl=function(t){return Za.get(t)||""},t.newWorker=function(t,e){return new Worker(this.getWorkerUrl(t),e)},t.getWorkerFactory=function(t){var e=this;return function(r){return e.newWorker(t,r)}},t}(),Ha={connectionLimits:{maxConnectionsPerHost:6,maxConnections:8,maxConnectionsPerHostForEachWorker:4,maxConnectionsForEachWorker:4}};function Ya(){return("blob:"===window.location.protocol?window.parent:window).location.href}var Xa={init:function(){var e=Ha.connectionLimits,r=e.maxConnectionsPerHost,n=e.maxConnections;t.ajax.setConnectionLimits({maxConnectionsPerHost:r,maxConnections:n}),t.ajax.setReferrer(Ya())},get globalProperties(){return Ha},get referrer(){return Ya()}},Ka=function(){function e(e){var r=this;this._listeners=[],this._worker=e,e.onmessage=function(e){var n,i;try{for(var o=t.__values(r._listeners),a=o.next();!a.done;a=o.next()){var s=a.value;s&&s(e)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}}return e.prototype.addEventListener=function(t){-1===this._listeners.indexOf(t)&&this._listeners.push(t)},e.prototype.removeEventListener=function(t){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)},e.prototype.postMessage=function(t,e){e?this._worker.postMessage(t,e):this._worker.postMessage(t)},e.prototype.terminate=function(){this._worker.terminate()},e}(),Qa=Ka,Ja=function(){function e(e,r,n){void 0===n&&(n=[]),this._activeTargets=new Set,this._workers=null,this._initiator=function(){for(var i,o,a=[],s=0;s<r;s++){var l=new Qa(e({name:"vsm@".concat(t.v4())}));a.push(l);try{for(var u=(i=void 0,t.__values(n)),h=u.next();!h.done;h=u.next()){var c=h.value;l.postMessage(c())}}catch(t){i={error:t}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}}return a}}return e.prototype.acquire=function(t){return this._activeTargets.add(t),this._workers||(this._workers=this._initiator()),this._workers.slice()},e.prototype.release=function(e){var r,n;if(this._activeTargets.delete(e),0===this._activeTargets.size&&this._workers){try{for(var i=t.__values(this._workers),o=i.next();!o.done;o=i.next())o.value.terminate()}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this._workers=null}},e}(),$a=new Ja(Wa.getWorkerFactory("map"),2,[function(){return{type:"Global",method:"SetReferrer",params:Xa.referrer}},function(){return{type:"Global",method:"SetConnectionLimits",params:{maxConnectionsPerHost:Xa.globalProperties.connectionLimits.maxConnectionsPerHostForEachWorker,maxConnections:Xa.globalProperties.connectionLimits.maxConnectionsForEachWorker}}}]);function ts(){return $a}var es={"-1":[{id:0,condition:"",priority:1}]},rs={geometry:{layout:{"fill-pattern":{default:""},"stroke-width":{default:t.DEFAULT_STROKE_WIDTH},"stroke-pattern":{default:""},buffer:{default:t.DEFAULT_BUFFER},"stroke-dasharray":{},"geo-dasharray":{},"geo-bufferWidth":{default:t.DEFAULT_STROKE_WIDTH},"circle-radius":{}},paint:{fill:{default:t.DEFAULT_FILL_COLOR},"fill-opacity":{default:t.DEFAULT_FILL_OPACITY},stroke:{default:t.DEFAULT_STROKE_COLOR},"stroke-opacity":{default:t.DEFAULT_STROKE_OPACITY},"model-wall-opacity":{default:t.DEFAULT_WALL_OPACITY},"model-wall-color":{default:t.DEFAULT_WALL_COLOR},display:{default:"on"}}},label:{layout:{"font-size":{default:t.DEFAULT_FONT_SIZE},"label-optional":{default:!1},"label-allow-overlap":{default:!1},placement:{},justify:{default:"center"},"align-x":{default:"center"},"align-y":{default:"mid"},"offset-x":{},"offset-y":{},"gap-left":{},"gap-right":{},"gap-top":{},"gap-bottom":{},"margin-top":{},"margin-bottom":{},"margin-left":{},"margin-right":{},display:{default:"on"}},paint:{"font-weight":{default:t.DEFAULT_FONT_WEIGHT},fill:{default:t.DEFAULT_FILL_COLOR},"fill-opacity":{default:t.DEFAULT_FILL_OPACITY},stroke:{default:t.DEFAULT_LABEL_STROKE_COLOR},"stroke-opacity":{default:t.DEFAULT_LABEL_STROKE_OPACITY},"stroke-width":{default:t.DEFAULT_LABEL_STROKE_WIDTH}}},icon:{layout:{icon:{},"icon-size":{default:1},"align-x":{default:t.DEFAULT_ALIGN_X},"align-y":{default:t.DEFAULT_ALIGN_Y},"offset-x":{default:t.DEFAULT_OFFSET},"offset-y":{default:t.DEFAULT_OFFSET},"icon-optional":{default:!1},"icon-allow-overlap":{default:!1},display:{default:"on"}},paint:{}},poi:{layout:{"keep-upright":{default:"true"},"pitch-alignment":{},"rotation-alignment":{},"line-alignment":{},"line-alignment-min-spacing":{},"line-alignment-max-angle":{}},paint:{}}},ns={autoStyleLoad:!0,preloadStyle:!1},is=function(){function e(e,r,n){var i=this;this._spec=null,this._fetchedSpec=null,this._styleName="",this._styleType="",this._updateLocked=!1,this._reloadTargetSources=new Set,this._workerStyleChanges={},this._map=e,this._dispatcher=new qa(ts(),e.getId(),this),this._networkOptions={},this._layers={},this._sources={},this._styleBundles={},this._resourcePackages={},this._settings={};var o=t.merge([n,ns]);this._load(r,o).catch((function(t){i._map.emit(Tt.valueOf(t))}))}return e.prototype._load=function(r,n){return t.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,u,h;return t.__generator(this,(function(c){switch(c.label){case 0:return[4,e._getConfigSpec(r)];case 1:return i=c.sent(),this._spec=i,this._fetchedSpec=ki(i),[4,this._initNetworkOptions()];case 2:return c.sent(),[4,Promise.all([this._loadLayers(i.layers),this._loadResourcePackages(i.resourcePackages),this._loadSettings(i.settings)])];case 3:return c.sent(),this._initSources(),n.preloadStyle?[4,this._loadStyleBundles(i.styles)]:[3,5];case 4:c.sent(),c.label=5;case 5:return n.autoStyleLoad?(o=i.styles,a=i.properties,l=void 0,n.defaultStyle?(s=n.defaultStyle.name,l=n.defaultStyle.type):a.defaultStyle?(h=t.__read(a.defaultStyle.split(":"),2),s=h[0],l=h[1]):(s=o[0].id,l=o[0].types[0]),[4,this.loadStyle(s,l)]):[3,7];case 6:c.sent(),c.label=7;case 7:return u=new Pt(x.ConfigLoad,this._map,{availableStyles:this.getAvailableStyles()}),this._map.emit(u),[2]}}))}))},e._getConfigSpec=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r;return t.__generator(this,(function(n){switch(n.label){case 0:return"string"!=typeof e?[3,2]:[4,t.ajax.callJson(e)];case 1:if(r=n.sent(),!t.isValidStatus(r))throw new t.ConfigError("Failed loading config : ".concat(e));return[2,r.body];case 2:return[2,ki(e)]}}))}))},e._getUrlReplacements=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r;return t.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,t.ajax.callJson("https://vsm-tile.tmapmp.com/hub/vsm/urlSettings.json")];case 1:return e=n.sent(),[4,t.ajax.callJson(e.body.urlSettings)];case 2:return(r=n.sent()).body.urlReplaceRule?[2,r.body.urlReplaceRule.map((function(e){var r=t.__read(e,2);return{from:r[0],to:r[1]}}))]:[3,4];case 3:return n.sent(),[3,4];case 4:return[2,go]}}))}))},e.prototype._initNetworkOptions=function(){return t.__awaiter(this,void 0,void 0,(function(){var r,n;return t.__generator(this,(function(i){switch(i.label){case 0:return[4,e._getUrlReplacements()];case 1:return r=i.sent(),(n=this.getProperties()).urlReplaceRule&&"string"==typeof n.urlReplaceRule&&n.urlReplaceRule.split(";").forEach((function(e){var n=t.__read(e.split(","),2),i=n[0],o=n[1],a=r.findIndex((function(t){return t.from===i}));a>-1?r[a]={from:i,to:o}:r.push({from:i,to:o})})),this._networkOptions.urlReplacements=r,[4,this._dispatcher.broadcast("SetNetworkOptions",this._networkOptions)];case 2:return i.sent(),[2]}}))}))},e.prototype._loadLayers=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n=this;return t.__generator(this,(function(i){switch(i.label){case 0:return[4,Promise.all(e.map((function(e){return t.fetchLayer(e,n._networkOptions)})))];case 1:return(r=i.sent()).forEach((function(e,r){var i=new t.Layer(e,r);n._layers[i.getId()]=i})),this._fetchedSpec&&(this._fetchedSpec.layers=r),[4,this._dispatcher.broadcast("SetLayers",Object.values(this._layers))];case 2:return i.sent(),[2]}}))}))},e.prototype._initSources=function(){var e,r;try{for(var n=t.__values(Object.values(this._layers)),i=n.next();!i.done;i=n.next()){var o=i.value,a=this._createSource(o);a?this._sources[o.getId()]=a:delete this._layers[o.getId()]}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},e.prototype._createSource=function(t){var e=ua(t,this,this._dispatcher);return e?new ga(e,t.getId(),this._map):null},e.prototype._loadStyleBundles=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r=this;return t.__generator(this,(function(n){switch(n.label){case 0:return e?(Array.isArray(e)||(e=[e]),[4,Promise.all(e.map((function(e){return t.fetchStyleBundle(e,r._networkOptions)})))]):[2];case 1:return n.sent().forEach((function(t){var e=new Ea(t);if(r._styleBundles[e.getId()]=e,r._fetchedSpec){var n=r._fetchedSpec.styles.findIndex((function(e){return e.code===t.code}));r._fetchedSpec.styles[n]=t}})),[2]}}))}))},e.prototype._loadResourcePackages=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o=this;return t.__generator(this,(function(a){switch(a.label){case 0:return[4,Promise.all(e.map((function(e){return t.fetchResourcePackage(e,o._networkOptions)})))];case 1:return r=a.sent(),n=[],r.forEach((function(t){var e;"Image"===t.type?e=function(t,e){return t.config&&t.config.bundleType&&"RawImageBundle"===t.config.bundleType?new Do(t,e):new Oo(t)}(t,o._networkOptions):"Binary"===t.type&&"FONTS"===t.code&&t.config&&(e=new Co(t,o._networkOptions)),e&&(n.push(e),o._resourcePackages[e.getCode()]=e)})),this._fetchedSpec&&(this._fetchedSpec.resourcePackages=r),i=n.reduce((function(t,e){return t[e.getCode()]={code:e.getCode(),url:e.getVersionedUrl(),properties:e.getProperties()},t}),{}),[4,this._dispatcher.broadcast("RegisterResource",i)];case 2:return a.sent(),[2]}}))}))},e.prototype._loadSettings=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n=this;return t.__generator(this,(function(i){switch(i.label){case 0:return e?[4,Promise.all(e.filter((function(t){return yo.has(t.code)})).map((function(e){return t.fetchSetting(e,n._networkOptions)})))]:[2];case 1:return(r=i.sent()).forEach((function(t){var e=new Fo(t);n._settings[e.getCode()]=e})),this._fetchedSpec&&(this._fetchedSpec.settings=r),[2]}}))}))},e.prototype.reloadSources=function(e){var r=this;void 0===e&&(e=function(){return!0}),this.getActiveLayers().map((function(t){return r.getSource(t.getId())})).filter(t.notEmpty).filter(e).forEach((function(t){return t.requestReloading()}))},e.prototype.getMap=function(){return this._map},e.prototype.updateSources=function(e){var r,n,i=this.getStyle();if(i&&!this._updateLocked){var o=e.getVisibleTiles();try{for(var a=t.__values(this.getLayers()),s=a.next();!s.done;s=a.next()){var l=s.value,u=this.getSource(l.getId());u&&i.isTargetLayer(l.getId())&&u.update(o,e)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}},e.prototype.updateStyles=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r=this;return t.__generator(this,(function(t){switch(t.label){case 0:return[4,this._dispatcher.broadcast("UpdateStyleProperty",this._workerStyleChanges)];case 1:return t.sent(),0!==this._reloadTargetSources.size&&(this._reloadTargetSources.forEach((function(t){var e;null===(e=r.getSource(t))||void 0===e||e.requestReloading()})),this.updateSources(e)),this._reloadTargetSources.clear(),this._workerStyleChanges={},[2]}}))}))},e.prototype.destroy=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,r,n,i;return t.__generator(this,(function(o){switch(o.label){case 0:try{for(e=t.__values(this.getSources()),r=e.next();!r.done;r=e.next())r.value.destroy()}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(n)throw n.error}}return[4,this._dispatcher.broadcast("Destroy",void 0,!0)];case 1:return o.sent(),this._dispatcher.destroy(),[2]}}))}))},Object.defineProperty(e.prototype,"spec",{get:function(){return this._spec},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fetchedSpec",{get:function(){return this._fetchedSpec},enumerable:!1,configurable:!0}),e.prototype.getNetworkOptions=function(){return this._networkOptions},e.prototype.getLayers=function(){return Object.values(this._layers)},e.prototype.getLayer=function(t){return this._layers[t]},e.prototype.getSources=function(){return Object.values(this._sources)},e.prototype.getSource=function(t){return this._sources[t]},e.prototype.getStyle=function(t,e){void 0===t&&(t=this._styleName),void 0===e&&(e=this._styleType);var r=this._findStyleBundle(t,e);return(null==r?void 0:r.getStyle(e))||null},e.prototype.getStyleSpec=function(t,e){void 0===t&&(t=this._styleName),void 0===e&&(e=this._styleType);var r=this._findStyleBundle(t,e),n=null==r?void 0:r.getSpec(e);return n?ki(n):null},e.prototype.setGlobalVariables=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r=this;return t.__generator(this,(function(t){switch(t.label){case 0:return[4,this._dispatcher.broadcast("SetGlobalVariables",e)];case 1:return t.sent(),this.getSources().filter((function(t){return t.getRenderType()===Lo.Vector})).forEach((function(t){r._addReloadTargetSource(t.getLayerId())})),[2]}}))}))},e.prototype.getStyleProperties=function(e){var r,n,i=e.styleName,o=e.styleType,a=e.layerId,s=e.stackId,l=e.styleId,u=e.paintGroup,h=e.paintProp,c=this._findStyleBundle(i,o),f=null==c?void 0:c.getSpec(null!=o?o:this._styleType);if(!f)return null;var p={layerId:a,stackId:s,styleId:l,paintGroup:u,paintProp:h},d=f.styles,y=function(t,e){if(void 0===e)return"break";if("styleId"===t){var r=d.find((function(t){return t.id===e}));if(!r)return d=null,"break";d=r}else{if(!d[e])return d=null,"break";d=d[e]}};try{for(var g=t.__values(Object.entries(p)),v=g.next();!v.done;v=g.next()){var _=t.__read(v.value,2);if("break"===y(_[0],_[1]))break}}catch(t){r={error:t}}finally{try{v&&!v.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}return ki(d)},e.prototype.setStyleProperties=function(t){var e,r,n,i=this,o=t.styleName,a=t.styleType,s=t.layerId,l=t.stackId,u=t.styleId,h=null===(n=null===(r=null===(e=this.getStyle(o,a))||void 0===e?void 0:e.getLayerStyle(s))||void 0===r?void 0:r.getStackStyle(l))||void 0===n?void 0:n.getStyle(u);if(h)if(t.paintGroup){var c={paintGroup:t.paintGroup,paintProp:t.paintProp,paintValue:t.paintValue};this._setStyleProperty(h,s,l,u,c)}else t.paints.forEach((function(t){i._setStyleProperty(h,s,l,u,t)}))},e.prototype._setStyleProperty=function(t,e,r,n,i){if(this.getStyleProperties({layerId:e,stackId:r,styleId:n,paintGroup:i.paintGroup,paintProp:i.paintProp})!==i.paintValue){switch(i.paintGroup){case"geometry":t.setGeomPaint(i.paintProp,i.paintValue);break;case"label":t.setLabelPaint(i.paintProp,i.paintValue);break;case"icon":t.setIconPaint(i.paintProp,i.paintValue);break;case"poi":t.setPoiPaint(i.paintProp,i.paintValue)}var o,a,s;o=i.paintGroup,a=i.paintProp,s=rs[o].layout[a],Boolean(s)&&this._updateWorkerStyleChanges(e,r,n,i)}},e.prototype._updateWorkerStyleChanges=function(t,e,r,n){this._workerStyleChanges[t]||(this._workerStyleChanges[t]={}),this._workerStyleChanges[t][e]||(this._workerStyleChanges[t][e]={}),this._workerStyleChanges[t][e][r]?this._workerStyleChanges[t][e][r].push(n):this._workerStyleChanges[t][e][r]=[n],this._addReloadTargetSource(t)},e.prototype._addReloadTargetSource=function(t){var e=this.getSource(t);e&&!this._reloadTargetSources.has(t)&&e.getRenderType()!==Lo.Raster&&this._reloadTargetSources.add(t)},e.prototype._findStyleSpec=function(t,e){if(!this._spec)return null;var r=this._spec.styles.find((function(e){return e.code===t||e.id===t}));return r&&r.types.includes(e)?r:null},e.prototype._findStyleBundle=function(t,e){void 0===t&&(t=this._styleName),void 0===e&&(e=this._styleType);var r=this._findStyleSpec(t,e);return r?this._styleBundles[r.id]:null},e.prototype.loadStyle=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,u,h,c;return t.__generator(this,(function(f){switch(f.label){case 0:return this._spec?(n=this._findStyleSpec(e,r))?(i=this._styleBundles[n.id])?[3,2]:[4,this._loadStyleBundles(n)]:(console.warn("NO such style - name: ".concat(e,", type: ").concat(r)),[2]):[2];case 1:f.sent(),i=this._styleBundles[n.id],f.label=2;case 2:return(o=i.getStyle(r))?(a=i.getId(),s=r,this._styleName===a&&this._styleType===s?[2]:(this._styleName=a,this._styleType=s,this._updateLocked=!0,[4,this._dispatcher.broadcast("SetStyle",o)])):[2];case 3:f.sent();try{for(l=t.__values(this.getSources()),u=l.next();!u.done;u=l.next())u.value.clear()}catch(t){h={error:t}}finally{try{u&&!u.done&&(c=l.return)&&c.call(l)}finally{if(h)throw h.error}}return this._updateLocked=!1,this._map.emit(new Pt(x.StyleLoad,this._map,{name:this._styleName,type:this._styleType})),[2]}}))}))},e.prototype.getAvailableStyles=function(){return this._spec?this._spec.styles.reduce((function(t,e){var r;return t[null!==(r=e.code)&&void 0!==r?r:e.id]=e.types,t}),{}):{}},e.prototype.getResourcePackage=function(t){return this._resourcePackages[t]},e.prototype.getFontPackage=function(){return this._resourcePackages.FONTS},e.prototype.getTargetLayersAndSources=function(){var t=this,e=this.getLayers(),r=this.getStyle();return r?e.map((function(e){return{layer:e,source:t.getSource(e.getId())}})).filter((function(t){var e=t.layer;return t.source&&r.isTargetLayer(e.getId())})):[]},e.prototype.addStyle=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o;return t.__generator(this,(function(t){switch(t.label){case 0:if(n=this._findStyleBundle(),i=null==n?void 0:n.getStyle(this._styleType),o=null==n?void 0:n.getSpec(this._styleType),!n||!i||!o)throw new Error("No style loaded for this map");if(i.getLayerStyle(e))throw new Error('Layer with id "'.concat(e,'" already exist in the loaded style'));return i.addLayerStyle(e,r),[4,this._dispatcher.broadcast("UpdateStyle",i)];case 1:return t.sent(),o.layers&&o.layers.push(e),o.styles[e]=r,[2]}}))}))},e.prototype.removeStyle=function(e){var r;return t.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return t.__generator(this,(function(t){switch(t.label){case 0:if(n=this._findStyleBundle(),i=null==n?void 0:n.getStyle(this._styleType),o=null==n?void 0:n.getSpec(this._styleType),!n||!i||!o)throw new Error("No style loaded for this map");return i.removeLayerStyle(e),o.layers&&(a=o.layers.indexOf(e))>-1&&(null===(r=o.layers)||void 0===r||r.splice(a,1),delete o.styles[e]),[4,this._dispatcher.broadcast("UpdateStyle",i)];case 1:return t.sent(),[2]}}))}))},e.prototype.addLayer=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i;return t.__generator(this,(function(o){switch(o.label){case 0:if(this.getLayer(e.id))throw new Error('Layer with id "'.concat(e.id,'" already exists on this map'));return"image"!==e.map.format||e.stacks&&0!==e.stacks.length||(e.stacks=t.DUMMY_STACKS_SPEC,this.addStyle(e.id,es)),"geojson"===e.map.format&&e.stacks.every((function(t){return t.properties&&(!!t.properties.circle||!!t.properties.heatmap)}))&&(e.map.buffer=0),n=new t.Layer({config:e},r||this.getLayers().length+1),(i=this._createSource(n))&&(this._layers[n.getId()]=n,this._sources[n.getId()]=i),[4,this._dispatcher.broadcast("SetLayers",this.getLayers())];case 1:return o.sent(),[2]}}))}))},e.prototype.removeLayer=function(e){var r;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:if(!this.getLayer(e))throw new Error("The layer '".concat(e,"' does not exist in the map's style and cannot be removed."));return delete this._layers[e],null===(r=this.getSource(e))||void 0===r||r.destroy(),delete this._sources[e],[4,this._dispatcher.broadcast("SetLayers",this.getLayers())];case 1:return t.sent(),[2]}}))}))},e.prototype.addImageResources=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i;return t.__generator(this,(function(t){switch(t.label){case 0:if(i=new To(e,r,this._map.getId(),n),this._resourcePackages[i.getCode()])throw new Error('resource package with code "'.concat(e,'" already exists on this map'));return this._resourcePackages[i.getCode()]=i,[4,this._dispatcher.broadcast("AddResource",{code:i.getCode(),url:i.getVersionedUrl(),properties:i.getProperties()})];case 1:return t.sent(),[2]}}))}))},e.prototype.queryRenderedFeatures=function(e,r,n,i){var o,a,s,l,u,h,c=r.buffer,f=ka.valueOf(e,c),p=[];try{for(var d=t.__values(this.getTargetLayersAndSources()),y=d.next();!y.done;y=d.next()){var g=y.value,v=g.layer,_=g.source;if(_.getRenderType()===Lo.Vector&&Aa(v,r)){var m=Ia(v,_,f,r,n);try{for(var b=(s=void 0,t.__values(Object.values(m))),x=b.next();!x.done;x=b.next()){var w=x.value;p.push.apply(p,t.__spreadArray([],t.__read(w),!1))}}catch(t){s={error:t}}finally{try{x&&!x.done&&(l=b.return)&&l.call(b)}finally{if(s)throw s.error}}}}}catch(t){o={error:t}}finally{try{y&&!y.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}if(i){var M=function(e,r,n,i){var o,a,s=e.collisionDetector,l=r.getScreenIntersection(i).bufferedBBox,u=t.uniqueKey(s.query(l).map((function(t){return t.feature})),(function(t){return t.info.uniqueId})),h=n.lookupFilter,c=n.filter,f={},p=function(e,r,i,o,a,s){if(!Aa(e,n))return"continue";var l=Ca(n,e);if(l&&!l.has(i.getId()))return"continue";var u=a.tileId,p=a.tileCompositeData.vectorTile,d=p.getStack(i.getId()).getFeature(s.featurePos),y={layerId:e.getId(),stackId:i.getId(),styleId:o.getId(),tileId:u.toObject(),geometryType:Oa(d)};if(h&&!h(t.__assign(t.__assign({},y),{getFeatureProperty:function(t){return d.properties.get(t)}})))return"continue";var g=p.loadGeometry(d),v=t.toGeoJsonFeature(d,g,(function(t){var e=r.toLngLat(u,t);return{x:e.lng,y:e.lat}}));c&&!c(v,y)||t.computeIfAbsent(f,i.getId(),(function(){return[]})).push(Ra(v,y))};try{for(var d=t.__values(u),y=d.next();!y.done;y=d.next()){var g=y.value;p(g.layer,g.source,g.stack,g.style,g.tileData,g.info)}}catch(t){o={error:t}}finally{try{y&&!y.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}return f}(i,f,r,n);try{for(var S=t.__values(Object.values(M)),P=S.next();!P.done;P=S.next())w=P.value,p.push.apply(p,t.__spreadArray([],t.__read(w),!1))}catch(t){u={error:t}}finally{try{P&&!P.done&&(h=S.return)&&h.call(S)}finally{if(u)throw u.error}}}return t.toGeoJsonFeatureCollection(p)},e.prototype.hasLoadingSources=function(){var e,r;try{for(var n=t.__values(Object.values(this._sources)),i=n.next();!i.done;i=n.next())if(i.value.hasUnfinishedTiles())return!0}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!1},e.prototype.getActiveLayers=function(){var t=this.getStyle();return t?this.getLayers().filter((function(e){return t.isTargetLayer(e.getId())})):[]},e.prototype.getProperties=function(){var t;return(null===(t=this._spec)||void 0===t?void 0:t.properties)||{}},e.prototype.getSetting=function(t){return this._settings[t]},e}(),os=is,as=new Set(["PartialAndLoading","Partial","Ready"]),ss=function(){function e(){this._sources={},this._complete=!1}return e.prototype.reset=function(){this._sources={},this._complete=!1},e.prototype.addTile=function(t){var e=t.data,r=e.layerId,n=e.tileId,i=e.state,o=e.visibleTileCount;this._sources[r]||(this._sources[r]={visibleTileCount:o,tiles:{}}),this._sources[r].tiles[n.toString()]=i},e.prototype.check=function(){var e,r;try{for(var n=t.__values(Object.values(this._sources)),i=n.next();!i.done;i=n.next()){var o=i.value,a=o.visibleTileCount,s=o.tiles;if(Object.values(s).filter((function(t){return as.has(t)})).length===a){this._complete=!0;break}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return this._complete},e.prototype.isComplete=function(){return this._complete},e}(),ls=ss;function us(t){return{get x(){return t[0]},get y(){return t[1]},get z(){return t[2]},get w(){return t[3]},get array(){return t}}}var hs=function(){function t(t,e){void 0===e&&(e=2),this._mapDefine=t,this._enlargeScaleFactor=e}return t.prototype.getBounds=function(){return this._mapDefine.getBounds()},t.prototype.getMinLevel=function(){return this._mapDefine.getMinLevel()},t.prototype.getMaxLevel=function(){return this._mapDefine.getMaxLevel()},t.prototype.getTileSize=function(){return this._mapDefine.getTileSize()*this._enlargeScaleFactor},t.prototype.getResolution=function(t){return this._mapDefine.getResolution(t)/this._enlargeScaleFactor},t.prototype.toScale=function(t){return this._mapDefine.toScale(t)},t.prototype.toLevel=function(t){return this._mapDefine.toLevel(t)},t.prototype.getTileEnvelope=function(t,e,r){return this._mapDefine.getTileEnvelope(t,e,r)},t.prototype.getEnlargeScaleFactor=function(){return this._enlargeScaleFactor},t.prototype.setEnlargeScaleFactor=function(t){this._enlargeScaleFactor=t},t.prototype.getOrigin=function(){return this._mapDefine},t}(),cs=hs,fs="undefined"!=typeof Float32Array?Float32Array:Array;function ps(){var t=new fs(16);return fs!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ds(t){var e=new fs(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ys(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gs(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],p=e[10],d=e[11],y=e[12],g=e[13],v=e[14],_=e[15],m=r[0],b=r[1],x=r[2],w=r[3];return t[0]=m*n+b*s+x*c+w*y,t[1]=m*i+b*l+x*f+w*g,t[2]=m*o+b*u+x*p+w*v,t[3]=m*a+b*h+x*d+w*_,m=r[4],b=r[5],x=r[6],w=r[7],t[4]=m*n+b*s+x*c+w*y,t[5]=m*i+b*l+x*f+w*g,t[6]=m*o+b*u+x*p+w*v,t[7]=m*a+b*h+x*d+w*_,m=r[8],b=r[9],x=r[10],w=r[11],t[8]=m*n+b*s+x*c+w*y,t[9]=m*i+b*l+x*f+w*g,t[10]=m*o+b*u+x*p+w*v,t[11]=m*a+b*h+x*d+w*_,m=r[12],b=r[13],x=r[14],w=r[15],t[12]=m*n+b*s+x*c+w*y,t[13]=m*i+b*l+x*f+w*g,t[14]=m*o+b*u+x*p+w*v,t[15]=m*a+b*h+x*d+w*_,t}function vs(t,e,r){var n,i,o,a,s,l,u,h,c,f,p,d,y=r[0],g=r[1],v=r[2];return e===t?(t[12]=e[0]*y+e[4]*g+e[8]*v+e[12],t[13]=e[1]*y+e[5]*g+e[9]*v+e[13],t[14]=e[2]*y+e[6]*g+e[10]*v+e[14],t[15]=e[3]*y+e[7]*g+e[11]*v+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],p=e[10],d=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=h,t[8]=c,t[9]=f,t[10]=p,t[11]=d,t[12]=n*y+s*g+c*v+e[12],t[13]=i*y+l*g+f*v+e[13],t[14]=o*y+u*g+p*v+e[14],t[15]=a*y+h*g+d*v+e[15]),t}function _s(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function ms(){var t=new fs(3);return fs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bs(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function xs(t,e,r,n){var i=new fs(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function ws(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Ms(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}ms(),function(){var t;t=new fs(4),fs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Ss=function(){function e(e){var r,n,i,o,a,s,l,u,h,c,f=(i=e,{get e11(){return i[0]},get e12(){return i[4]},get e13(){return i[8]},get e14(){return i[12]},get e21(){return i[1]},get e22(){return i[5]},get e23(){return i[9]},get e24(){return i[13]},get e31(){return i[2]},get e32(){return i[6]},get e33(){return i[10]},get e34(){return i[14]},get e41(){return i[3]},get e42(){return i[7]},get e43(){return i[11]},get e44(){return i[15]},get matrix(){return i}}),p={left:xs(f.e41+f.e11,f.e42+f.e12,f.e43+f.e13,f.e44+f.e14),right:xs(f.e41-f.e11,f.e42-f.e12,f.e43-f.e13,f.e44-f.e14),top:xs(f.e41-f.e21,f.e42-f.e22,f.e43-f.e23,f.e44-f.e24),bottom:xs(f.e41+f.e21,f.e42+f.e22,f.e43+f.e23,f.e44+f.e24),near:xs(f.e41+f.e31,f.e42+f.e32,f.e43+f.e33,f.e44+f.e34),far:xs(f.e41-f.e31,f.e42-f.e32,f.e43-f.e33,f.e44-f.e34)};try{for(var d=t.__values(Object.entries(p)),y=d.next();!y.done;y=d.next()){var g=t.__read(y.value,2),v=g[0],_=g[1];p[v]=(o=_,void 0,void 0,void 0,void 0,c=void 0,(c=(s=(a=_)[0])*s+(l=a[1])*l+(u=a[2])*u+(h=a[3])*h)>0&&(c=1/Math.sqrt(c)),o[0]=s*c,o[1]=l*c,o[2]=u*c,o[3]=h*c,o)}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}this._planeVectors=p}return e.prototype.intersects=function(e){var r,n,i=e.minX,o=e.minY,a=e.maxX,s=e.maxY,l=[[i,o,0,1],[a,o,0,1],[i,s,0,1],[a,s,0,1]],u=function(e){var r,n,i,o;try{for(var a=t.__values(l),s=a.next();!s.done;s=a.next()){if(o=s.value,(i=e)[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]>0)return!0}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return!1};try{for(var h=t.__values(Object.values(this._planeVectors)),c=h.next();!c.done;c=h.next())if(!u(c.value))return!1}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}return!0},e}(),Ps=Ss;function Ts(){return new Float32Array(16)}function Es(){return new Float64Array(16)}function Ls(t){return t instanceof Float32Array?t:new Float32Array(t)}var ks,Is=[12].concat(Array.from(Array(16).keys()).filter((function(t){return 12!==t}))),As=t.GoogleMap.MAX_ZOOM,Cs={mapDefine:t.googleMap,mapProjector:t.googleMapProjector,enlargeScaleFactor:2},Os=function(){function e(e){var r;void 0===e&&(e={}),this._zoom=-1,this._scale=-1,this._cameraToCenterDistance=0,this._projectionMatrix=Es(),this._pixelMatrix=Es(),this._pixelInverseMatrix=Es(),this._labelPlaneMatrix=Es(),this._glCoordMatrix=Es(),this._matrixCache={},this._frustum=new Ps(ys(ps())),this._minZoom=0,this._maxZoom=As,this._minPitch=0,this._maxPitch=60,this._maxBounds=null,this._minZoomFromMaxBounds=null;var n=t.merge([e,Cs],!1);this._mapDefine=new cs(n.mapDefine,n.enlargeScaleFactor),this._mapProjector=n.mapProjector,this._width=0,this._height=0,this._center=new t.LngLat(0,0),this._angle=0,this._pitch=0,this._fov=t.BASE_FOV,this.setMinZoom(n.minZoom),this.setMaxZoom(n.maxZoom),this.setMinPitch(n.minPitch),this.setMaxPitch(n.maxPitch),this.setMaxBounds(null!==(r=n.maxBounds)&&void 0!==r?r:null),this.setZoom(0),this.setPitch(0)}return e.prototype.clone=function(){var t,r=new e({mapDefine:this._mapDefine.getOrigin(),enlargeScaleFactor:this._mapDefine.getEnlargeScaleFactor(),mapProjector:this._mapProjector});return r._width=this._width,r._height=this._height,r._center=this._center.clone(),r._angle=this._angle,r._pitch=this._pitch,r._fov=this._fov,r._minZoom=this._minZoom,r._maxZoom=this._maxZoom,r._minPitch=this._minPitch,r._maxPitch=this._maxPitch,r._maxBounds=(null===(t=this._maxBounds)||void 0===t?void 0:t.clone())||null,r._minZoomFromMaxBounds=this._minZoomFromMaxBounds,r.setZoom(this._zoom),r._calcMatrices(),r},e.prototype.resize=function(t,e){this._width=t,this._height=e,this._calcMatrices(),this._maxBounds&&(this._minZoomFromMaxBounds=this._getMinZoomForBounds(this._maxBounds))},e.prototype.getWidth=function(){return this._width},e.prototype.getHeight=function(){return this._height},e.prototype.getMapDefine=function(){return this._mapDefine},e.prototype.getMapProjector=function(){return this._mapProjector},e.prototype.getFov=function(){return t.toDegree(this._fov)},e.prototype.setFov=function(e){var r=t.toRadian(t.clamp(e,.01,45));r!==this._fov&&(this._fov=r,this._calcMatrices())},e.prototype.getEnlargeScaleFactor=function(){return this._mapDefine.getEnlargeScaleFactor()},e.prototype.setEnlargeScaleFactor=function(t){var e=this._mapDefine;e.setEnlargeScaleFactor(t),this._scale=e.toScale(this._zoom),this._calcMatrices()},e.prototype.getZoom=function(){return this._zoom},e.prototype.setZoom=function(e){var r=this._mapDefine,n=t.clamp(e,this.getMinZoom(),this.getMaxZoom());n!==this._zoom&&(this._zoom=n,this._scale=r.toScale(n),this._calcMatrices())},e.prototype.getMinZoom=function(){return this._minZoomFromMaxBounds?Math.max(this._minZoom,this._minZoomFromMaxBounds):this._minZoom},e.prototype.setMinZoom=function(t){void 0===t&&(t=0),this._minZoom=Math.max(this._mapDefine.getMinLevel(),t)},e.prototype.getMaxZoom=function(){return this._maxZoom},e.prototype.setMaxZoom=function(t){void 0===t&&(t=As),this._maxZoom=Math.min(this._mapDefine.getMaxLevel(),t)},e.prototype.getScale=function(){return this._scale},e.prototype.getAngle=function(){return this._angle},e.prototype.getBearing=function(){return-t.toDegree(this._angle)},e.prototype.setBearing=function(e){var r=-t.toRadian(t.wrap(e,-180,180));r!==this._angle&&(this._angle=r,this._calcMatrices())},e.prototype.getPitch=function(){return t.toDegree(this._pitch)},e.prototype.setPitch=function(e){var r=t.toRadian(t.clamp(e,this._minPitch,this._maxPitch));r!==this._pitch&&(this._pitch=r,this._calcMatrices())},e.prototype.getMinPitch=function(){return this._minPitch},e.prototype.setMinPitch=function(t){void 0===t&&(t=0),this._minPitch=Math.max(0,t)},e.prototype.getMaxPitch=function(){return this._maxPitch},e.prototype.setMaxPitch=function(t){void 0===t&&(t=60),this._maxPitch=Math.min(60,t)},e.prototype.getCenter=function(){return this._center},e.prototype.setCenter=function(e){var r=t.LngLat.valueOf(e);r.lng===this._center.lng&&r.lat===this._center.lat||(this._center=r,this._calcMatrices())},e.prototype.getMaxBounds=function(){return this._maxBounds},e.prototype.setMaxBounds=function(t){t?(this._maxBounds=It.valueOf(t),this._minZoomFromMaxBounds=this._getMinZoomForBounds(this._maxBounds)):(this._maxBounds=null,this._minZoomFromMaxBounds=null)},e.prototype.setLocationAtPoint=function(t,e){var r=this.screenPointToPrjCoord(this.getCenterPoint()),n=this.screenPointToPrjCoord(e),i=this.lngLatToPrjCoord(t),o={x:i.x-(n.x-r.x),y:i.y-(n.y-r.y)};this.setCenter(this.prjCoordToLngLat(o))},e.prototype.getWorldSize=function(){return this._mapDefine.getTileSize()*this._scale},e.prototype.getCenterPoint=function(){return{x:this._width/2,y:this._height/2}},e.prototype.getNearestPointFromEye=function(){return{x:this._width/2,y:this._height*(.5+this._pitch/Math.PI)}},e.prototype.getCameraToCenterDistance=function(){return this._cameraToCenterDistance},e.prototype.screenPointToPrjCoord=function(e){var r=t.valueOf(e),n=r.x,i=r.y,o=us([n,i,0,1]),a=us([n,i,1,1]);Ms(o.array,o.array,this._pixelInverseMatrix),Ms(a.array,a.array,this._pixelInverseMatrix),ws(o.array,o.array,1/o.w),ws(a.array,a.array,1/a.w);var s=o.z===a.z?0:-o.z/(a.z-o.z),l=this.getWorldSize();return{x:t.interpolate(o.x,a.x,s)/l,y:t.interpolate(o.y,a.y,s)/l}},e.prototype.prjCoordToLngLat=function(t){return this._mapProjector.unproject(t)},e.prototype.screenPointToLngLat=function(t){return this.prjCoordToLngLat(this.screenPointToPrjCoord(t))},e.prototype.lngLatToPrjCoord=function(e){return this._mapProjector.project(t.LngLat.valueOf(e))},e.prototype.prjCoordToScreenPoint=function(t){var e=this.getWorldSize(),r=us([t.x*e,t.y*e,0,1]);return Ms(r.array,r.array,this._pixelMatrix),{x:r.x/r.w,y:r.y/r.w}},e.prototype.lngLatToScreenPoint=function(t){return this.prjCoordToScreenPoint(this.lngLatToPrjCoord(t))},e.prototype.project=function(e){var r=t.LngLat.valueOf(e),n=r.lng,i=r.lat,o=this.getWorldSize(),a=new t.LngLat(n,t.clamp(i,-85.051129,85.051129)),s=this._mapProjector.project(a);return{x:s.x*o,y:s.y*o}},e.prototype.unproject=function(e){var r=t.valueOf(e),n=r.x,i=r.y,o=this.getWorldSize();return this._mapProjector.unproject({x:n/o,y:i/o})},e.prototype._getMinZoomForBounds=function(t){var e=this,r=function(t,r){return Math.log2(t/(e._mapDefine.getTileSize()*Math.abs(r[1]-r[0])))},n=this._mapProjector.project(t.southWest),i=n.x,o=n.y,a=this._mapProjector.project(t.northEast),s=a.x,l=a.y,u=r(this._width,[s,i]),h=r(this._height,[o,l]);return Math.max(u,h)},e.prototype._constrain=function(){if(this._maxBounds&&this._width&&this._height){var e=this.project(this._maxBounds.southWest),r=e.x,n=e.y,i=this.project(this._maxBounds.northEast),o=i.x,a=i.y,s=this.project(this._center),l=s.x,u=s.y,h=n-a,c=o-r,f=h<this._height?this._height/h:0,p=c<this._width?this._width/c:0,d=Math.max(p||0,f||0);if(d){var y=(o+r)/2,g=(n+a)/2;this._center=this.unproject({x:p?y:l,y:f?g:u}),this._zoom=t.clamp(this._zoom+this._mapDefine.toLevel(d),this._minZoom,this._maxZoom),this._scale=this._mapDefine.toScale(this._zoom)}else{y=null,g=null;var v=this._width/2,_=this._height/2;u-_<a?g=a+_:u+_>n&&(g=n-_),l-v<r?y=r+v:l+v>o&&(y=o-v),null===y&&null===g||(this._center=this.unproject({x:null!==y?y:l,y:null!==g?g:u}))}}},e.prototype._calcMatrices=function(){this._constrain();var t=this._calcDistances(),e=t.cameraToCenterDistance,r=t.furthestDistance;this._cameraToCenterDistance=e;var n,i,o,a,s,l,u,h,c,f,p,d,y,g=this.getWorldSize(),v=this.project(this._center),_=v.x,m=v.y,b=1/this._center.circumference,x=Es();(function(t,e,r,n,i){var o,a=1/Math.tan(e/2);t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n)})(x,this._fov,this._width/this._height,1,1.01*r),_s(x,x,[1,-1,1]),vs(x,x,[0,0,-e]),n=x,i=x,o=this._pitch,a=Math.sin(o),s=Math.cos(o),l=i[4],u=i[5],h=i[6],c=i[7],f=i[8],p=i[9],d=i[10],y=i[11],i!==n&&(n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15]),n[4]=l*s+f*a,n[5]=u*s+p*a,n[6]=h*s+d*a,n[7]=c*s+y*a,n[8]=f*s-l*a,n[9]=p*s-u*a,n[10]=d*s-h*a,n[11]=y*s-c*a,function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],h=e[5],c=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*n,t[1]=a*i+h*n,t[2]=s*i+c*n,t[3]=l*i+f*n,t[4]=u*i-o*n,t[5]=h*i-a*n,t[6]=c*i-s*n,t[7]=f*i-l*n}(x,x,this._angle),vs(x,x,[-_,-m,0]);var w=_s(Es(),x,[g,g,g]);this._projectionMatrix=_s(x,x,[1,1,b*g]);var M=Es();ys(M),_s(M,M,[this._width/2,-this._height/2,1]),vs(M,M,[1,-1,0]),this._labelPlaneMatrix=M;var S=Es();ys(S),_s(S,S,[1,-1,1]),vs(S,S,[-1,-1,0]),_s(S,S,[2/this._width,2/this._height,1]),this._glCoordMatrix=S,this._pixelMatrix=gs(Es(),M,this._projectionMatrix),this._pixelInverseMatrix=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],p=e[11],d=e[12],y=e[13],g=e[14],v=e[15],_=r*s-n*a,m=r*l-i*a,b=r*u-o*a,x=n*l-i*s,w=n*u-o*s,M=i*u-o*l,S=h*y-c*d,P=h*g-f*d,T=h*v-p*d,E=c*g-f*y,L=c*v-p*y,k=f*v-p*g,I=_*k-m*L+b*E+x*T-w*P+M*S;return I?(I=1/I,t[0]=(s*k-l*L+u*E)*I,t[1]=(i*L-n*k-o*E)*I,t[2]=(y*M-g*w+v*x)*I,t[3]=(f*w-c*M-p*x)*I,t[4]=(l*T-a*k-u*P)*I,t[5]=(r*k-i*T+o*P)*I,t[6]=(g*b-d*M-v*m)*I,t[7]=(h*M-f*b+p*m)*I,t[8]=(a*L-s*T+u*S)*I,t[9]=(n*T-r*L-o*S)*I,t[10]=(d*w-y*b+v*_)*I,t[11]=(c*b-h*w-p*_)*I,t[12]=(s*P-a*E-l*S)*I,t[13]=(r*E-n*P+i*S)*I,t[14]=(y*m-d*x-g*_)*I,t[15]=(h*x-c*m+f*_)*I,t):null}(Es(),this._pixelMatrix),this._frustum=new Ps(w),this._matrixCache={}},e.prototype._calcDistances=function(){var e=this._height/(2*Math.tan(t.BASE_FOV/2)),r=this._fov/2,n=Math.PI/2+this._pitch,i=Math.sin(r)*e/Math.sin(Math.PI-n-r);return{cameraToCenterDistance:e,furthestDistance:Math.cos(Math.PI/2-this._pitch)*i+e}},e.prototype.getTilePositionMatrix=function(t){var e="viewTile:".concat(t.toString()),r=this._matrixCache[e];if(!r){var n=this.getWorldSize()/this._mapDefine.toScale(t.z),i=ys(Es());vs(i,i,[t.x*n,t.y*n,0]),_s(i,i,[n,n,1]),gs(i,this._projectionMatrix,i),r=Ls(i),this._matrixCache[e]=r}return r},e.prototype.getDataTilePositionMatrix=function(e,r){void 0===r&&(r=t.TileServiceName.GoogleMapVector);var n="".concat(r,":").concat(e.toString()),i=this._matrixCache[n];if(!i){var o=t.tileAdapters[r],a=o.getTransformParams(e),s=a.scale,l=a.translate,u=o.getTileExtent(),h=this.getWorldSize();_s(i=ys(Es()),i,[h,h,1]),vs(i,i,[l.x,l.y,0]),_s(i,i,[1/u,1/u,1]),_s(i,i,[1/s.x,1/s.y,1]),_s(i,i,[1,-1,1]),o.getTileService().isRaster()&&(_s(i,i,[u,-u,1]),vs(i,i,[0,-1,0])),gs(i,this.getProjectionMatrix(),i),i=Ls(i),this._matrixCache[n]=i}return i},e.prototype.getCachedMatrix=function(t){return this._matrixCache[t]||null},e.prototype.cacheMatrix=function(t,e){this._matrixCache[t]=e},e.prototype.getProjectionMatrix=function(){return this._projectionMatrix},e.prototype.getLabelPlaneMatrix=function(){return this._labelPlaneMatrix},e.prototype.getGlCoordMatrix=function(){return this._glCoordMatrix},e.prototype.isVisible=function(t){return this._frustum.intersects(t)},e.prototype.isVisibleTile=function(t){return!(t.z>this.getZoom())&&this.isVisible(this.getTileBBox(t))},e.prototype.isVisibleDataTile=function(e,r){return void 0===r&&(r=t.TileServiceName.GoogleMapVector),this.isVisible(this.getDataTileBBox(e,r))},e.prototype.getVisibleTiles=function(){var e=this,r=t.toInt32(this._zoom),n=function(i){var o,a,s=[];try{for(var l=t.__values(i.newChildren()),u=l.next();!u.done;u=l.next()){var h=u.value;e.isVisibleTile(h)&&s.push.apply(s,t.__spreadArray([],t.__read(n(h)),!1))}}catch(t){o={error:t}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}return i.z===r&&s.push(i),s},i=n(new t.TileId(0,0,0)),o=this.screenPointToPrjCoord(this.getNearestPointFromEye());return i.map((function(r){var n=e.getTileBBox(r),i=t.getCenter(n),a=t.getDiagonalLength(n)/2;return[t.distance(o,i)-a,r]})).sort((function(e,r){return t.__read(e,1)[0]-t.__read(r,1)[0]})).map((function(e){return t.__read(e,2)[1]}))},e.prototype.getTileBBox=function(t){var e=t.x,r=t.y,n=t.z,i=this._mapDefine.toScale(n);return{minX:e/i,maxX:(e+1)/i,minY:r/i,maxY:(r+1)/i}},e.prototype.getDataTileBBox=function(e,r){void 0===r&&(r=t.TileServiceName.GoogleMapVector);var n=this._mapProjector,i=t.tileAdapters[r].getTileEnvelope(e),o=i.base,a=i.width,s=i.height,l=n.normalize(o),u=n.normalize({x:o.x+a,y:o.y+s});return{minX:Math.min(l.x,u.x),maxX:Math.max(l.x,u.x),minY:Math.min(l.y,u.y),maxY:Math.max(l.y,u.y)}},e.prototype.toDataTiles=function(e,r,n){void 0===r&&(r=t.TileServiceName.GoogleMapVector);for(var i=t.tileAdapters[r].getTileService(),o=n?n(e.z):i.getLevel(e.z),a=this.getTileBBox(e),s=this._mapProjector,l=s.unproject({x:a.minX,y:a.minY}),u=s.unproject({x:a.maxX,y:a.maxY}),h=[l,u,new t.LngLat(l.lng,u.lat),new t.LngLat(u.lng,l.lat)].map((function(t){return i.getTileIndex(o,t)})).filter((function(t){return t})).reduce((function(e,r){var n=r.x,i=r.y;return t.expandToInclude(e,{x:n,y:i})}),t.newEmpty()),c=[],f=(h=t.intersection(h,i.getTileIndexBounds(o))).minX;f<=h.maxX;f++)for(var p=h.minY;p<=h.maxY;p++)c.push(new t.TileId(o,f,p));return c},e.prototype.getTileUnitsPerPixel=function(e){var r,n=this._mapDefine;return r="number"==typeof e?e:e.z,t.DEFAULT_TILE_EXTENT/(n.getTileSize()*n.toScale(this._zoom-r))},e.prototype.getDataTileUnitsPerPixel=function(e,r){void 0===r&&(r=t.TileServiceName.GoogleMapVector);var n=this._mapDefine,i=t.tileAdapters[r],o=i.getTransformParams(e).scale,a=this._scale/((o.x+o.y)/2);return i.getTileExtent()/(n.getTileSize()*a)},e}(),Rs=Os,Ds=function(){function e(t,e,r,n){this._cells=t,this._indexFunction=e,this._xRange=r,this._yRange=n}return e.prototype[Symbol.iterator]=function(){var e,r;return t.__generator(this,(function(t){switch(t.label){case 0:e=this._yRange.start,t.label=1;case 1:if(!(e<=this._yRange.end))return[3,6];r=this._xRange.start,t.label=2;case 2:return r<=this._xRange.end?[4,this._cells[this._indexFunction(r,e)]]:[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return e++,[3,1];case 6:return[2]}}))},e}(),Fs=function(){function e(t,e,r){var n=this;this._width=t,this._height=e,this._cells={},this._cellCount={x:Math.ceil(t/r),y:Math.ceil(e/r)},this._indexFunction=function(t,e){return e*n._cellCount.x+t},this._scale={x:this._cellCount.x/t,y:this._cellCount.y/e},this._items={},Array.from(Array(this._cellCount.x*this._cellCount.y).keys()).forEach((function(t,e){return n._cells[e]=[]}))}return e.prototype._iterator=function(t){var r=this,n=function(t){return e._toGridIndex(t,r._scale.x,r._cellCount.x-1)},i=function(t){return e._toGridIndex(t,r._scale.y,r._cellCount.y-1)};return new Ds(this._cells,this._indexFunction,{start:n(t.minX),end:n(t.maxX)},{start:i(t.minY),end:i(t.maxY)})},e._toGridIndex=function(e,r,n){return t.clamp(Math.floor(e*r),0,n)},e.prototype.insert=function(e,r){var n,i,o=Object.keys(this._items).length;this._items[o]={bbox:e,value:r};try{for(var a=t.__values(this._iterator(e)),s=a.next();!s.done;s=a.next())s.value.push(o)}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}},e.prototype.query=function(t){return this._queryInternal(t)},e.prototype._queryInternal=function(e){var r,n,i,o;if(!this._intersects(e))return[];var a={};try{for(var s=t.__values(this._iterator(e)),l=s.next();!l.done;l=s.next()){var u=l.value;try{for(var h=(i=void 0,t.__values(u)),c=h.next();!c.done;c=h.next()){var f=c.value,p=this._items[f];!a[f]&&t.intersects(p.bbox,e)&&(a[f]=p)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return Object.values(a).map((function(t){return{bbox:t.bbox,value:t.value}}))},e.prototype.hitTest=function(t){return!!this._covers(t)||this._queryInternal(t).length>0},e.prototype._intersects=function(t){return t.maxX>=0&&t.minX<=this._width&&t.maxY>=0&&t.minY<=this._height},e.prototype._covers=function(t){return t.minX<=0&&t.maxX>=this._width&&t.minY<=0&&t.maxY>=this._height},e}(),Bs=Fs,Ns=100,zs=function(){function e(t){this._transform=t,this._grid=new Bs(t.getWidth()+200,t.getHeight()+200,50),this._ignoredGrid=new Bs(t.getWidth()+200,t.getHeight()+200,50),this._gridBoundary={minX:0,maxX:t.getWidth()+200,minY:0,maxY:t.getHeight()+200}}return e.prototype.place=function(r,n,i,o,a){var s,l,u=this._project(i,n),h=u.x,c=u.y,f={minX:h+r.minX,maxX:h+r.maxX,minY:c+r.minY,maxY:c+r.maxY};if(!t.intersects(f,this._gridBoundary))return null;var p=e._toCollisionLayer(o,a);if(o===t.OverlapType.None)return f;try{for(var d=t.__values(this._grid.query(f)),y=d.next();!y.done;y=d.next())if(y.value.value.collisionLayer===p)return null}catch(t){s={error:t}}finally{try{y&&!y.done&&(l=d.return)&&l.call(d)}finally{if(s)throw s.error}}return f},e._toCollisionLayer=function(e,r){return e===t.OverlapType.Screen?0:r},e.prototype._project=function(t,e){var r=Ms([],[e.x,e.y,0,1],t);return{x:(r[0]/r[3]+1)/2*this._transform.getWidth()+Ns,y:(-r[1]/r[3]+1)/2*this._transform.getHeight()+Ns}},e.prototype.insert=function(r,n,i,o){n!==t.OverlapType.None?this._grid.insert(r,{feature:o,collisionLayer:e._toCollisionLayer(n,i)}):this._ignoredGrid.insert(r,{feature:o})},e.prototype.query=function(t){return t={minX:t.minX+Ns,maxX:t.maxX+Ns,minY:t.minY+Ns,maxY:t.maxY+Ns},this._grid.query(t).concat(this._ignoredGrid.query(t)).map((function(t){var e=t.value.feature;return{bbox:t.bbox,feature:e}}))},e}(),Us=zs,js=function(){function e(){this._targets=[],this._sorted=!1,this._index=0}return e.prototype.add=function(t){this._targets.push(t)},e.prototype.prepare=function(){this._sorted||(this._targets.sort((function(e,r){return t.comparePoi(e.info,r.info)})),this._sorted=!0)},e.prototype.isPrepared=function(){return this._sorted},e.prototype.hasNext=function(){return this._sorted&&this._index<this._targets.length},e.prototype.getNext=function(){return this._sorted&&this._targets[this._index++]||null},e}();!function(t){t.Invalid="Invalid",t.TileBackground="TileBackground",t.TerrainOverlay="TerrainOverlay",t.Polygon="Polygon",t.Crosswalk="Crosswalk",t.Railroad="Railroad",t.Road="Road",t.Line="Line",t.Point="Point",t.Environment="Environment",t.Building="Building",t.TrafficLine="TrafficLine",t.RoadName="RoadName",t.Circle="Circle",t.Poi="Poi",t.Image="Image",t.Heatmap="Heatmap"}(ks||(ks={}));var Vs,Gs=ks,qs=function(){function t(t,e,r,n){this._text=!1,this._icon=!1,this._notUsed=!1,this._skipFade=!1,this._text=t,this._icon=e,this._notUsed=r,this._skipFade=n}return Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"notUsed",{get:function(){return this._notUsed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipFade",{get:function(){return this._skipFade},enumerable:!1,configurable:!0}),t}(),Zs=function(){function e(t,e){this._opacity=0,this._placed=!1,this._opacity=t,this._placed=e}return e.valueOf=function(r,n,i,o){return new e(r?t.clamp(r.opacity+(r.placed?1:-1)*n,0,1):o&&i?1:0,i)},Object.defineProperty(e.prototype,"opacity",{get:function(){return this._opacity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"placed",{get:function(){return this._placed},enumerable:!1,configurable:!0}),e}(),Ws=function(){function t(t,e,r){this._text=t,this._icon=e,this._notUsed=r}return t.valueOf=function(e,r,n,i,o,a){return new t(Zs.valueOf(e?e.text:null,r,n,a),Zs.valueOf(e?e.icon:null,r,i,a),o)},t.getDefault=function(){return this.valueOf(null,0,!1,!1,!0)},Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"notUsed",{get:function(){return this._notUsed},enumerable:!1,configurable:!0}),t}();!function(t){t[t.None=0]="None",t[t.Both=1]="Both",t[t.TextOnly=2]="TextOnly",t[t.IconOnly=3]="IconOnly"}(Vs||(Vs={}));var Hs,Ys=function(){function e(t,e,r,n){this._context=t,this._transform=e.clone(),this._stackIterator=n,this._featureIterator=new js,this._collisionDetector=new Us(e),this._placements={},this._opacities={},this._duplicationCheckerForPoi=new Set,this._duplicationCheckerForRoadName=new Set,this._fadeDuration=r,this._expired=!1}return e.prototype.isDone=function(){return this._featureIterator.isPrepared()&&!this._featureIterator.hasNext()},e.prototype.isPlacing=function(){return this._featureIterator.isPrepared()},e.prototype.continue=function(){var e=t.browser.now(),r=function(){return t.browser.now()-e>t.MAX_PLACEMENT_TIME_PER_FRAME};this._prepare(r)&&this._place(r)},e.prototype._prepare=function(e){if(this._featureIterator.isPrepared())return!0;var r=this._stackIterator;r.isPrepared()||r.prepare();for(var n=function(){var e,n,o,a,s=r.getNext(),l=s.layer,u=s.source,h=s.stack,c=s.stackStyle,f=s.cachedTiles,p=s.renderingType,d=u.getTileLevel(i._transform.getZoom());try{for(var y=(e=void 0,t.__values(c.getStyles())),g=y.next();!g.done;g=y.next()){var v=g.value,_=t.__spreadArray([],t.__read(f),!1).map((function(t){return{levelGap:Math.abs(t.tileId.z-d),tile:t}})).sort((function(t,e){return t.levelGap-e.levelGap})).map((function(t){return t.tile}));try{for(var m=(o=void 0,t.__values(_)),b=m.next();!b.done;b=m.next()){var x=b.value;i._addTile(l,u,h,v,x,p)}}catch(t){o={error:t}}finally{try{b&&!b.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}}}catch(t){e={error:t}}finally{try{g&&!g.done&&(n=y.return)&&n.call(y)}finally{if(e)throw e.error}}},i=this;r.hasNext()&&!e();)n();return!r.hasNext()&&!e()&&(this._featureIterator.prepare(),!0)},e.prototype._addTile=function(e,r,n,i,o,a){var s,l,u=this,h=o.tileId,c=o.styleDataMap,f=r.getPositionMatrix(this._transform,h),p=c.get(n.getId(),i.getId());if(p){var d=p.getRenderable();if(d){var y=function(t){g._featureIterator.add({layer:e,source:r,stack:n,style:i,tileData:o,renderingType:a,info:t,posMatrix:f,isPlaceable:function(){return t.levelFilter.evaluate(r.getStyleLevel(u._transform.getZoom()))}})},g=this;try{for(var v=t.__values(d.getInfoArray()),_=v.next();!_.done;_=v.next())y(_.value)}catch(t){s={error:t}}finally{try{_&&!_.done&&(l=v.return)&&l.call(v)}finally{if(s)throw s.error}}}}},e.prototype._place=function(t){for(;this._featureIterator.hasNext()&&!t();){var e=this._featureIterator.getNext();Qs(e.info,e.renderingType)?this._placePoi(e):this._placeRoadName(e)}},e.prototype._placePoi=function(t){var e=this,r=t.info,n=t.posMatrix,i=t.isPlaceable,o=r,a=o.uniqueId,s=o.textCollisionBoxes,l=o.iconCollisionBox,u=o.anchor,h=o.groupId,c=o.textPlaceInfo,f=o.textCollisionOptions,p=o.iconCollisionOptions;if(!this._duplicationCheckerForPoi.has(a)){this._duplicationCheckerForPoi.add(a);var d,y,g=i(),v=Js(g,o),_=$s(o),m=_.textOverlapType,b=_.iconOverlapType,x=0,w={text:!1,icon:!1};if(g&&s)for(var M=0;M<c.length;M++)if(d=tl(c[M].textCollisionBoxes,u,n,m,h,this._collisionDetector)){x=M;break}g&&l&&(y=this._collisionDetector.place(l,u,n,b,h));var S=function(r){r.forEach((function(r){e._collisionDetector.insert(r,m,h,t)})),w.text=!0},P=function(r){e._collisionDetector.insert(r,b,h,t),w.icon=!0};switch(v){case Vs.Both:d&&y?(S(d),P(y)):y&&(f.optional||f.allowOverlap)?P(y):d&&(p.optional||p.allowOverlap)&&S(d);break;case Vs.TextOnly:d&&S(d);break;case Vs.IconOnly:y&&P(y)}w.text&&0!==x&&this._updateTextPlaceInfo(o,x),this._placements[a]=new qs(w.text,w.icon,!g,!1)}},e.prototype._updateTextPlaceInfo=function(e,r){var n=e.textPlaceInfo,i=t.__read(n.splice(r,1),1)[0];n.unshift(i),e.textCollisionBoxes=n[0].textCollisionBoxes},e.prototype._placeRoadName=function(t){var e=this,r=t.info,n=t.posMatrix,i=t.isPlaceable,o=r,a=o.uniqueId,s=o.groupId,l=o.overlapType,u=o.anchor,h=o.textCollisionBoxes,c=o.iconCollisionBox,f=o.textCollisionOptions,p=o.iconCollisionOptions;if(this._duplicationCheckerForRoadName.has(a))this._placements[a]=new qs(!1,!1,!1,!1);else{this._duplicationCheckerForRoadName.add(a);var d,y,g=i(),v=Js(g,o),_=$s(o),m=_.textOverlapType,b=_.iconOverlapType,x={text:!1,icon:!1};g&&h&&h.length&&(d=tl(h,u,n,l,s,this._collisionDetector)),g&&c&&(y=this._collisionDetector.place(c,u,n,b,s));var w=function(r){r.forEach((function(r){e._collisionDetector.insert(r,m,s,t)})),x.text=!0},M=function(r){e._collisionDetector.insert(r,b,s,t),x.icon=!0};switch(v){case Vs.Both:d&&y?(w(d),M(y)):y&&(f.optional||f.allowOverlap)?M(y):d&&(p.optional||p.allowOverlap)&&w(d);break;case Vs.TextOnly:d&&w(d);break;case Vs.IconOnly:y&&M(y)}this._placements[a]=new qs(x.text,x.icon,!g,!1)}},e.prototype.commit=function(e,r){var n,i,o,a,s=!1,l=r?r.getFadeChange(e):1,u=(null==r?void 0:r.opacities)||{};try{for(var h=t.__values(Object.entries(this._placements)),c=h.next();!c.done;c=h.next()){var f=t.__read(c.value,2),p=f[0],d=f[1];(_=u[p])?(this._opacities[p]=Ws.valueOf(_,l,d.text,d.icon,d.notUsed),s=s||d.text!==_.text.placed||d.icon!==_.icon.placed):(this._opacities[p]=Ws.valueOf(null,l,d.text,d.icon,d.notUsed,d.skipFade),s=s||d.text||d.icon)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}try{for(var y=t.__values(Object.entries(u)),g=y.next();!g.done;g=y.next()){var v=t.__read(g.value,2),_=(p=v[0],v[1]);this._opacities[p]||(this._opacities[p]=Ws.valueOf(_,l,_.text.placed,!1,_.notUsed))}}catch(t){o={error:t}}finally{try{g&&!g.done&&(a=y.return)&&a.call(y)}finally{if(o)throw o.error}}return new Ks(this._collisionDetector,this._opacities,this._fadeDuration,e,s?e:(null==r?void 0:r.lastUpdateTime)||e,this._transform.getZoom(),r?r.getZoomAdjustment(this._transform.getZoom()):0,this._expired,this.stackIterator.preparedRenderableStacks)},e.prototype.isPlaced=function(t){var e=this._placements[t];return!!e&&!e.notUsed&&(e.text||e.icon)},e.prototype.expire=function(){this._expired=!0},Object.defineProperty(e.prototype,"stackIterator",{get:function(){return this._stackIterator},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opacities",{get:function(){return this._opacities},enumerable:!1,configurable:!0}),e}(),Xs=Ys,Ks=function(){function t(t,e,r,n,i,o,a,s,l){this._collisionDetector=t,this._opacities=e,this._fadeDuration=r,this._commitTime=n,this._lastUpdateTime=i,this._lastZoom=o,this._prevZoomAdjustment=a,this._expired=s,this._latestCheckZoom=this._lastZoom,this._cachedRenderableStacks=l}return Object.defineProperty(t.prototype,"cachedRenderableStacks",{get:function(){return this._cachedRenderableStacks},enumerable:!1,configurable:!0}),t.prototype.getFadeChange=function(t){return 0===this._fadeDuration?1:(t-this._commitTime)/this._fadeDuration+this._prevZoomAdjustment},t.prototype.hasTransitions=function(t){return t-this._lastUpdateTime<this._fadeDuration},t.prototype.getZoomAdjustment=function(t){return Math.max(0,(this._lastZoom-t)/1.5)},t.prototype.checkLatest=function(t,e){var r=.5*(this._latestCheckZoom===e?1-this.getZoomAdjustment(e):1);return this._latestCheckZoom=e,t<this._commitTime+this._fadeDuration*r},t.prototype.expire=function(){this._expired=!0},Object.defineProperty(t.prototype,"collisionDetector",{get:function(){return this._collisionDetector},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacities",{get:function(){return this._opacities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fadeDuration",{get:function(){return this._fadeDuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commitTime",{get:function(){return this._commitTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastUpdateTime",{get:function(){return this._lastUpdateTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expired",{get:function(){return this._expired},enumerable:!1,configurable:!0}),t}();function Qs(t,e){return e===Gs.Poi}function Js(t,e){var r=e.textCollisionBoxes,n=e.iconCollisionBox,i=!!(t&&r&&r.length),o=!(!t||!n),a=Vs.None;return i&&o?a=Vs.Both:i?a=Vs.TextOnly:o&&(a=Vs.IconOnly),a}function $s(e){var r=e.overlapType,n=e.textCollisionOptions,i=e.iconCollisionOptions,o=function(e){return e.allowOverlap?t.OverlapType.None:r};return{textOverlapType:o(n),iconOverlapType:o(i)}}function tl(t,e,r,n,i,o){for(var a=!1,s=[],l=0;l<t.length;l++){var u=o.place(t[l],e,r,n,i);if(!u){a=!1;break}s.push(u),a=!0}return a?s:null}function el(t){var e=t.opacity,r=t.placed?1:0;return(Math.floor(127*e)<<1)+r}!function(t){t.Invalid="Invalid",t.Before2D="Before2D",t.Terrain2D="Terrain2D",t.Object2D="Object2D",t.Overlay2D="Overlay2D",t.After2D="After2D",t.Before3D="Before3D",t.Object3D="Object3D",t.After3D="After3D",t.BeforePoi="BeforePoi",t.Poi="Poi",t.AfterPoi="AfterPoi"}(Hs||(Hs={}));var rl=Hs,nl=function(){function e(e,r,n,i,o,a,s){void 0===s&&(s=!1),this._stack=e,this._layer=r,this._source=n,this._stackStyle=i,this._cachedTiles=o,this._styleLevel=a,this._renderingType=function(t,e){if("jpeg"===e.getSourceSpec().format)return ks.TileBackground;if("image"===e.getSourceSpec().format)return ks.Image;if(!t||!t.getGeometryType())return ks.Invalid;var r=t.getGeometryType(),n=t.getProperties();switch(r.toUpperCase()){case"POLYGON":return n.bda?ks.Building:ks.Polygon;case"LINE":return n.trafficLine?ks.TrafficLine:n.buffer?ks.Road:n.poi?ks.RoadName:n.crosswalk?ks.Crosswalk:n.railroad&&!n.subwayLine?ks.Railroad:ks.Line;case"POINT":return n.circle?ks.Circle:n.heatmap?ks.Heatmap:ks.Poi;default:return ks.Invalid}}(e,r),this._renderingGroup=function(e,r){switch(void 0===r&&(r=!1),e){case t.GeometryConversionType.TileBackground:return Hs.Terrain2D;case t.GeometryConversionType.Line:case t.GeometryConversionType.TrafficLine:case t.GeometryConversionType.BufferedLine:case t.GeometryConversionType.Crosswalk:case t.GeometryConversionType.Railroad:case t.GeometryConversionType.Polygon:case t.GeometryConversionType.Image:case t.GeometryConversionType.Circle:case t.GeometryConversionType.Heatmap:return Hs.Object2D;case t.GeometryConversionType.BackgroundPoi:return Hs.After2D;case t.GeometryConversionType.Building:return r?Hs.Object2D:Hs.Object3D;case t.GeometryConversionType.Poi:case t.GeometryConversionType.RoadName:return Hs.Poi;default:return Hs.Invalid}}(t.getGeometryConversionType(e,r),s),this._uid=[this._renderingType,this._renderingGroup,this._styleLevel,this._layer.getId(),this._stack.getId()].join(":"),this._needClippingMask="GeoJson"===n.getType()&&!(this._renderingType===Gs.Poi||this._renderingType===Gs.RoadName)}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stack",{get:function(){return this._stack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stackStyle",{get:function(){return this._stackStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cachedTiles",{get:function(){return this._cachedTiles},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"styleLevel",{get:function(){return this._styleLevel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderingType",{get:function(){return this._renderingType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroup",{get:function(){return this._renderingGroup},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needClippingMask",{get:function(){return this._needClippingMask},enumerable:!1,configurable:!0}),e}(),il={Invalid:0,Before2D:1,Terrain2D:2,Object2D:3,Overlay2D:4,After2D:5,Before3D:6,Object3D:7,After3D:8,BeforePoi:9,Poi:10,AfterPoi:11},ol={Invalid:0,TileBackground:1,TerrainOverlay:2,Image:2,Polygon:3,Crosswalk:4,Road:5,Railroad:6,Line:7,Point:8,Environment:9,Building:10,TrafficLine:11,RoadName:12,Circle:13,Poi:14,Heatmap:15};function al(t,e){var r=il[t.renderingGroup]-il[e.renderingGroup];if(0!==r)return r;var n=function(t,e){if(t.renderingType===e.renderingType&&t.renderingType===Gs.TileBackground){var r=t.layer.getProperties().zIndex,n=void 0===r?0:r,i=e.layer.getProperties().zIndex,o=void 0===i?0:i;return n!==o?n-o:t.layer.getOrder()-e.layer.getOrder()}return sl(t)-sl(e)}(t,e);if(0!==n)return n;var i=t.stack.getPriority()-e.stack.getPriority();if(0!==i)return i;var o=ol[t.renderingType]-ol[e.renderingType];if(0!==o)return o;var a=t.styleLevel-e.styleLevel;return 0!==a?a:t.stack.getId()-e.stack.getId()}function sl(t){var e=t.renderingType,r=t.layer;return(e===Gs.TileBackground?1e-5:1)*r.getOrder()}var ll=function(){function e(t,e,r){this._info={},this._appConfig=t,this._renderableStacks=r,this._preparedRenderableStacks=null,this._index=0,this._init(e)}return Object.defineProperty(e.prototype,"preparedRenderableStacks",{get:function(){return this._preparedRenderableStacks||[]},enumerable:!1,configurable:!0}),e.prototype._init=function(t){var e={};this._renderableStacks.forEach((function(t){t.renderingType!==Gs.Poi&&t.renderingType!==Gs.RoadName||(e[t.uid]=new Set(t.cachedTiles.map((function(t){return t.uid}))))})),this._info=e},e.prototype.equals=function(e){var r,n,i,o;if(Object.keys(this._info).join("")!==Object.keys(e._info).join(""))return!1;try{for(var a=t.__values(Object.entries(this._info)),s=a.next();!s.done;s=a.next()){var l=t.__read(s.value,2),u=l[0],h=l[1],c=e._info[u];if(h.size!==c.size)return!1;try{for(var f=(i=void 0,t.__values(h)),p=f.next();!p.done;p=f.next()){var d=p.value;if(!c.has(d))return!1}}catch(t){i={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return!0},e.prototype.prepare=function(){if(!this._preparedRenderableStacks){var t=[],e=[];this._renderableStacks.forEach((function(r){r.renderingType===Gs.Poi?t.push(r):r.renderingType===Gs.RoadName&&e.push(r)})),this._preparedRenderableStacks=t.sort(al).concat(e)}},e.prototype.isPrepared=function(){return!!this._preparedRenderableStacks},e.prototype.hasNext=function(){return!!this._preparedRenderableStacks&&this._index<this._preparedRenderableStacks.length},e.prototype.getNext=function(){return this._preparedRenderableStacks&&this._preparedRenderableStacks[this._index++]||null},e.prototype[Symbol.iterator]=function(){var e,r,n,i,o;return t.__generator(this,(function(a){switch(a.label){case 0:if(!this._preparedRenderableStacks)return[2];a.label=1;case 1:a.trys.push([1,6,7,8]),e=t.__values(this._preparedRenderableStacks),r=e.next(),a.label=2;case 2:return r.done?[3,5]:[4,r.value];case 3:a.sent(),a.label=4;case 4:return r=e.next(),[3,2];case 5:return[3,8];case 6:return n=a.sent(),i={error:n},[3,8];case 7:try{r&&!r.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))},e}(),ul=ll,hl=function(e){function r(){return e.call(this,t.StaticTypes.Int16.size)||this}return t.__extends(r,e),r.prototype.push=function(t){return this._getAssembler().byteBuffer.writeInt16(t),this._onPush(),this},r.prototype.pushElement=function(t){var e=t.i;return this.push(e)},r.prototype.pushAll=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.pushAll.apply(this,t.__spreadArray([],t.__read(r),!1)),this},r}(t.AbstractStructArrayBuilder),cl=hl,fl=t.createLayout([{name:"aPosition",numberOfComponents:2,type:"Int16"},{name:"aTexture",numberOfComponents:2,type:"Int16"}]),pl=function(e){function r(){return e.call(this,fl.size)||this}return t.__extends(r,e),r.prototype.push=function(t,e,r,n){return this._getAssembler().byteBuffer.writeInt16(t).writeInt16(e).writeInt16(r).writeInt16(n),this._onPush(),this},r.prototype.pushElement=function(t){var e=t.x,r=t.y,n=t.u,i=t.v;return this.push(e,r,n,i)},r.prototype.pushAll=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.pushAll.apply(this,t.__spreadArray([],t.__read(r),!1)),this},r}(t.AbstractStructArrayBuilder),dl=pl,yl=function(){function e(e,r,n){this._attached=!1,this._context=e,this._buffer=this._context.gl.createFramebuffer(),this._texture=t.Texture.createEmptyBoundTexture(e,r,n)}return e.prototype.bind=function(t){void 0===t&&(t=!1);var e=this._context.gl;e.bindFramebuffer(e.FRAMEBUFFER,this._buffer),t&&this.attach()},Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},enumerable:!1,configurable:!0}),e.prototype.attach=function(){var t=this._context.gl,e=this._texture.getGLTexture();e&&(t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this._attached=!0)},e.prototype.unbind=function(){var t=this._context.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},e.prototype.getTexture=function(){return this._texture},e.prototype.destroy=function(){var t=this._context.gl;this._buffer&&(t.deleteFramebuffer(this._buffer),this._buffer=null,this._attached=!1),this._texture&&this._texture.destroy()},e}(),gl=function(){function e(e,r,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0),this._context=e,this._dynamicDraw=n;var o=this._context.gl,a=o.createBuffer();if(!a)throw new t.InitializeError("Could not create buffer");o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,a),o.bufferData(o.ELEMENT_ARRAY_BUFFER,r.toArrayBuffer(),n?o.DYNAMIC_DRAW:o.STATIC_DRAW),i&&r.clear(),this._buffer=a}return e.prototype.bind=function(){var t=this._context.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffer)},e.prototype.updateData=function(t){var e=t.toArrayBuffer();if(e){var r=this._context.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this._buffer),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e)}},e.prototype.destroy=function(){this._buffer&&(this._context.gl.deleteBuffer(this._buffer),this._buffer=null)},Object.defineProperty(e.prototype,"dynamicDraw",{get:function(){return this._dynamicDraw},enumerable:!1,configurable:!0}),e}(),vl={Transparent:[0,0,0,0],White:[1,1,1,1],Black:[0,0,0,1],Red:[1,0,0,1],Green:[0,1,0,1],Blue:[0,0,1,1],Yellow:[1,1,0,1],Purple:[1,0,1,1],Cyan:[0,1,1,1]},_l=function(){function t(t,e,r){this._blendFunc=t,this._blendColor=e,this._mask=r}return Object.defineProperty(t.prototype,"blendFunc",{get:function(){return this._blendFunc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendColor",{get:function(){return this._blendColor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},enumerable:!1,configurable:!0}),t.isDefault=function(t,e){var r=e.blendFunc;return r[0]===t.ONE&&r[1]===t.ZERO},t.disabled=function(e){return new t([e.ONE,e.ZERO],vl.Transparent,[!1,!1,!1,!1])},t.alphaBlended=function(e){return new t([e.ONE,e.ONE_MINUS_SRC_ALPHA],vl.Transparent,[!0,!0,!0,!0])},t.unblended=function(e){return new t([e.ONE,e.ZERO],vl.Transparent,[!0,!0,!0,!0])},t}(),ml=_l,bl=function(){function t(t,e,r){this._func=t,this._mask=e,this._range=r}return Object.defineProperty(t.prototype,"func",{get:function(){return this._func},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},enumerable:!1,configurable:!0}),t.isDefault=function(t,e){var r=e.func,n=e.mask;return r===t.ALWAYS&&!n},t.disabled=function(e){return new t(e.ALWAYS,!1,[0,1])},t}(),xl=bl,wl=function(){function t(t,e,r,n,i,o,a){this._func=t,this._funcRef=e,this._funcMask=r,this._mask=n,this._fail=i,this._depthFail=o,this._depthPass=a}return Object.defineProperty(t.prototype,"func",{get:function(){return this._func},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"funcRef",{get:function(){return this._funcRef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"funcMask",{get:function(){return this._funcMask},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fail",{get:function(){return this._fail},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthFail",{get:function(){return this._depthFail},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthPass",{get:function(){return this._depthPass},enumerable:!1,configurable:!0}),t.isDefault=function(t,e){var r=e.func,n=e.mask;return r===t.ALWAYS&&!n},t.disabled=function(e){return new t(e.ALWAYS,0,0,0,e.KEEP,e.KEEP,e.KEEP)},t}(),Ml=wl,Sl=function(){function e(t,e,r,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0),this._context=t,this._length=e.getLength(),this._itemSize=e.getBytesPerElement(),this._attributes=r,this._dynamicDraw=n;var o=this._context.gl,a=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferData(o.ARRAY_BUFFER,e.toArrayBuffer(),n?o.DYNAMIC_DRAW:o.STATIC_DRAW),i&&e.clear(),this._buffer=a}return e.prototype.bind=function(){var t=this._context.gl;t.bindBuffer(t.ARRAY_BUFFER,this._buffer)},e.prototype.enableAttributes=function(e){var r,n,i=this._context.gl;try{for(var o=t.__values(this._attributes),a=o.next();!a.done;a=o.next()){var s=e[a.value.name];void 0!==s&&i.enableVertexAttribArray(s)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},e.prototype.setVertexAttribPointers=function(e,r){var n,i;void 0===r&&(r=0);var o=this._context.gl;try{for(var a=t.__values(this._attributes),s=a.next();!s.done;s=a.next()){var l=s.value,u=e[l.name];void 0!==u&&o.vertexAttribPointer(u,l.numberOfComponents,o[t.StaticTypes[l.type].glType],!1,this._itemSize,l.offset+this._itemSize*r)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}},e.prototype.updateData=function(t){var e=t.toArrayBuffer();if(e){var r=this._context.gl;r.bindBuffer(r.ARRAY_BUFFER,this._buffer),r.bufferSubData(r.ARRAY_BUFFER,0,e)}},e.prototype.destroy=function(){var t=this._context.gl;this._buffer&&(t.deleteBuffer(this._buffer),this._buffer=null)},Object.defineProperty(e.prototype,"dynamicDraw",{get:function(){return this._dynamicDraw},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"itemSize",{get:function(){return this._itemSize},enumerable:!1,configurable:!0}),e}(),Pl=Sl,Tl=function(){function t(t){this._gl=t,this._glVaoExtension=t.getExtension("OES_vertex_array_object")}return Object.defineProperty(t.prototype,"gl",{get:function(){return this._gl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glVaoExtension",{get:function(){return this._glVaoExtension},enumerable:!1,configurable:!0}),t.prototype.createVertexBuffer=function(t,e,r,n){return new Pl(this,t,e,r,n)},t.prototype.createIndexBuffer=function(t,e,r){return new gl(this,t,e,r)},t.prototype.getPrimitiveSize=function(t){var e,r=this.gl;return(e={},e[r.LINES]=2,e[r.LINE_STRIP]=1,e[r.TRIANGLES]=3,e)[t]},t.prototype.unbindVao=function(){this.glVaoExtension&&this.glVaoExtension.bindVertexArrayOES(null)},t.prototype.lose=function(){var t=this.gl.getExtension("WEBGL_lose_context");t&&t.loseContext()},t.prototype.clear=function(t){var e=t.color,r=t.depth,n=t.stencil,i=this.gl,o=0;e&&(o|=i.COLOR_BUFFER_BIT,i.clearColor(e[0],e[1],e[2],e[3]),i.colorMask(!0,!0,!0,!0)),void 0!==r&&(o|=i.DEPTH_BUFFER_BIT,i.depthRange(0,1),i.clearDepth(r),i.depthMask(!0)),void 0!==n&&(o|=i.STENCIL_BUFFER_BIT,i.clearStencil(n),i.stencilMask(255)),i.clear(o)},t.prototype.setViewport=function(t,e,r,n){this.gl.viewport(t,e,r,n)},t.prototype.setColorMode=function(t){var e=this.gl,r=t.blendFunc,n=t.blendColor,i=t.mask;ml.isDefault(e,t)?e.disable(e.BLEND):(e.enable(e.BLEND),e.blendFunc(r[0],r[1]),e.blendColor(n[0],n[1],n[2],n[3])),e.colorMask(i[0],i[1],i[2],i[3])},t.prototype.setDepthMode=function(t){var e=this.gl;if(xl.isDefault(e,t))e.disable(e.DEPTH_TEST);else{var r=t.func,n=t.mask,i=t.range;e.enable(e.DEPTH_TEST),e.depthFunc(r),e.depthMask(n),e.depthRange(i[0],i[1])}},t.prototype.setStencilMode=function(t){var e=this.gl;if(Ml.isDefault(e,t))e.disable(e.STENCIL_TEST);else{var r=t.func,n=t.funcRef,i=t.funcMask,o=t.mask,a=t.fail,s=t.depthFail,l=t.depthPass;e.enable(e.STENCIL_TEST),e.stencilFunc(r,n,i),e.stencilMask(o),e.stencilOp(a,s,l)}},t.prototype.setCullFaceMode=function(t){var e=t.enable,r=t.cullFace,n=t.frontFace,i=this.gl;e?(i.enable(i.CULL_FACE),i.cullFace(r),i.frontFace(n)):i.disable(i.CULL_FACE)},t}(),El=Tl;function Ll(e,r,n){var i=e.createShader(r);if(!i)throw new t.InitializeError("Error creating shader\n");return e.shaderSource(i,n),e.compileShader(i),i}var kl=function(){function e(e,r){var n=r.fragmentSource,i=r.vertexSource;this._numberOfAttributes=0,this._attribLocations={},this._uniformBindings={};var o=e.gl,a=o.createProgram();if(!a)throw new t.InitializeError("Error creating program\n");this._program=a,this._fragmentShader=Ll(o,o.FRAGMENT_SHADER,n),this._vertexShader=Ll(o,o.VERTEX_SHADER,i)}return e.prototype.linkProgram=function(t){var e,r,n,i;e=t.gl,r=this._program,n=this._vertexShader,i=this._fragmentShader,e.attachShader(r,n),e.attachShader(r,i),e.linkProgram(r)},e.prototype.checkStatus=function(e){!function(e,r,n,i){if(!e.getProgramParameter(r,e.LINK_STATUS)){var o=e.getProgramInfoLog(r),a=e.getShaderInfoLog(n),s=e.getShaderInfoLog(i),l="Link failed : ".concat(o,"\n");throw a&&(l+="\n[Vertex shader info]\n".concat(a)),s&&(l+="\n[Fragment shader info]\n".concat(s)),new t.InitializeError(l)}}(e.gl,this._program,this._vertexShader,this._fragmentShader)},e.prototype.prepareVariables=function(t,e){for(var r=t.gl,n=this._program,i=r.getProgramParameter(n,r.ACTIVE_ATTRIBUTES),o={},a=0;a<i;a++){var s=r.getActiveAttrib(n,a);s&&(o[s.name]=r.getAttribLocation(n,s.name))}var l=r.getProgramParameter(n,r.ACTIVE_UNIFORMS),u={};for(a=0;a<l;a++){var h=r.getActiveUniform(n,a);if(h){var c=r.getUniformLocation(n,h.name);c&&(u[h.name]=c)}}this._numberOfAttributes=i,this._attribLocations=o,this._uniformBindings=e(t,u)},e.prototype.draw=function(e,r,n,i,o,a,s,l,u){var h,c;void 0===u&&(u=[]);var f=e.gl;f.useProgram(this._program),this._setRenderingState(e,n),this._bindUniformValues(s);var p=e.getPrimitiveSize(r);try{for(var d=t.__values(a.values),y=d.next();!y.done;y=d.next()){var g=y.value,v=g.getVertexArrayObject(e,l);v.bind(this,i,o,g.vertexOffset,u),f.drawElements(r,g.primitiveLength*p,f.UNSIGNED_SHORT,g.primitiveOffset*p*2),v.unbind()}}catch(t){h={error:t}}finally{try{y&&!y.done&&(c=d.return)&&c.call(d)}finally{if(h)throw h.error}}},e.prototype.drawPoints=function(t,e,r,n){if(r.length){var i=t.gl;i.useProgram(this._program),this._setRenderingState(t,e),this._bindUniformValues(n),r.enableAttributes(this._attribLocations),r.bind(),r.setVertexAttribPointers(this._attribLocations),i.drawArrays(i.POINTS,0,r.length/r.itemSize)}},e.prototype._setRenderingState=function(t,e){t.setColorMode(e.colorMode),t.setDepthMode(e.depthMode),t.setStencilMode(e.stencilMode),t.setCullFaceMode(e.cullFaceMode)},e.prototype._bindUniformValues=function(e){var r,n;try{for(var i=t.__values(Object.keys(e)),o=i.next();!o.done;o=i.next()){var a=o.value;this._uniformBindings[a].bind(e[a])}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},Object.defineProperty(e.prototype,"numberOfAttributes",{get:function(){return this._numberOfAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attribLocations",{get:function(){return this._attribLocations},enumerable:!1,configurable:!0}),e}(),Il=kl;function Al(t,e){if(!t||!e)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var Cl,Ol=function(){function t(t,e){this._value=null,this._gl=t.gl,this._location=e}return t.prototype.bind=function(t){this._needUpdate(t)&&this._bindNewValue(t)},Object.defineProperty(t.prototype,"gl",{get:function(){return this._gl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this._location},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),t}(),Rl=function(e){function r(t,r){return e.call(this,t,r)||this}return t.__extends(r,e),r.prototype._needUpdate=function(t){return this.value!==t},r.prototype._bindNewValue=function(t){this.value=t,this.gl.uniform1i(this.location,t)},r.DEFAULT=0,r}(Ol),Dl=function(e){function r(t,r){return e.call(this,t,r)||this}return t.__extends(r,e),r.prototype._needUpdate=function(t){return this.value!==t},r.prototype._bindNewValue=function(t){this.value=t,this.gl.uniform1f(this.location,t)},r.DEFAULT=0,r}(Ol),Fl=function(e){function r(t,r){return e.call(this,t,r)||this}return t.__extends(r,e),r.prototype._needUpdate=function(t){return!Al(this.value,t)},r.prototype._bindNewValue=function(t){this.value=t,this.gl.uniform2f(this.location,t[0],t[1])},r.DEFAULT=[0,0],r}(Ol),Bl=function(e){function r(t,r){return e.call(this,t,r)||this}return t.__extends(r,e),r.prototype._needUpdate=function(t){return!Al(this.value,t)},r.prototype._bindNewValue=function(t){this.value=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])},r.DEFAULT=[0,0,0],r}(Ol),Nl=function(e){function r(t,r){return e.call(this,t,r)||this}return t.__extends(r,e),r.prototype._needUpdate=function(t){return!Al(this.value,t)},r.prototype._bindNewValue=function(t){this.value=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3])},r.DEFAULT=[0,0,0,0],r}(Ol),zl=function(e){function r(t,r){return e.call(this,t,r)||this}return t.__extends(r,e),r.prototype._needUpdate=function(e){return!function(e,r){var n,i;if(!e||!r)return!1;try{for(var o=t.__values(Is),a=o.next();!a.done;a=o.next()){var s=a.value;if(e[s]!==r[s])return!1}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return!0}(this.value,e)},r.prototype._bindNewValue=function(t){this.value=t,this.gl.uniformMatrix4fv(this.location,!1,Ls(t))},r.DEFAULT=Ts(),r}(Ol),Ul=Object.freeze({__proto__:null,clippingMask:function(t,e){return{uMatrix:new zl(t,e.uMatrix)}},solid:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uColor:new Nl(t,e.uColor),uOpacity:new Dl(t,e.uOpacity)}},building:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uHeightScale:new Dl(t,e.uHeightScale),uColor:new Nl(t,e.uColor),uOpacity:new Dl(t,e.uOpacity),uLightEnabled:new Rl(t,e.uLightEnabled),uLightDirection:new Bl(t,e.uLightDirection),uLightIntensity:new Dl(t,e.uLightIntensity)}},line:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uColor:new Nl(t,e.uColor),uOpacity:new Dl(t,e.uOpacity),uWidth:new Dl(t,e.uWidth),uRatio:new Dl(t,e.uRatio),uOffset:new Dl(t,e.uOffset)}},dashedLine:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uColor:new Nl(t,e.uColor),uOpacity:new Dl(t,e.uOpacity),uWidth:new Dl(t,e.uWidth),uRatio:new Dl(t,e.uRatio),uOffset:new Dl(t,e.uOffset),uPatternScale:new Fl(t,e.uPatternScale),uSdfGamma:new Dl(t,e.uSdfGamma),uImage:new Rl(t,e.uImage),uTextureY:new Dl(t,e.uTextureY)}},poiText:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uLabelPlaneMatrix:new zl(t,e.uLabelPlaneMatrix),uGlCoordMatrix:new zl(t,e.uGlCoordMatrix),uLabelPlaneMatrix2:new zl(t,e.uLabelPlaneMatrix2),uGlCoordMatrix2:new zl(t,e.uGlCoordMatrix2),uImage:new Rl(t,e.uImage),uImageSize:new Fl(t,e.uImageSize),uColor:new Nl(t,e.uColor),uOpacity:new Dl(t,e.uOpacity),uHalo:new Rl(t,e.uHalo),uHaloColor:new Nl(t,e.uHaloColor),uHaloWidth:new Dl(t,e.uHaloWidth),uFontSize:new Dl(t,e.uFontSize),uFontWeight:new Dl(t,e.uFontWeight),uGammaScale:new Dl(t,e.uGammaScale),uDevicePixelRatio:new Dl(t,e.uDevicePixelRatio),uFadeChange:new Dl(t,e.uFadeChange),uRotate:new Dl(t,e.uRotate)}},poiIcon:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uLabelPlaneMatrix:new zl(t,e.uLabelPlaneMatrix),uGlCoordMatrix:new zl(t,e.uGlCoordMatrix),uLabelPlaneMatrix2:new zl(t,e.uLabelPlaneMatrix2),uGlCoordMatrix2:new zl(t,e.uGlCoordMatrix2),uImage:new Rl(t,e.uImage),uImageSize:new Fl(t,e.uImageSize),uOpacity:new Dl(t,e.uOpacity),uFadeChange:new Dl(t,e.uFadeChange),uRotate:new Dl(t,e.uRotate)}},circle:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uRadius:new Dl(t,e.uRadius),uColor:new Nl(t,e.uColor),uOpacity:new Dl(t,e.uOpacity),uStrokeColor:new Nl(t,e.uStrokeColor),uStrokeOpacity:new Dl(t,e.uStrokeOpacity),uStrokeWidth:new Dl(t,e.uStrokeWidth),uRatio:new Dl(t,e.uRatio),uDevicePixelRatio:new Dl(t,e.uDevicePixelRatio)}},raster:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uImage:new Rl(t,e.uImage),uFilterColor:new Nl(t,e.uFilterColor),uFilterOpacity:new Dl(t,e.uFilterOpacity)}},fillPattern:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uPatternPosition:new Nl(t,e.uPatternPosition),uPixelCoordUpper:new Fl(t,e.uPixelCoordUpper),uPixelCoordLower:new Fl(t,e.uPixelCoordLower),uImageSize:new Fl(t,e.uImageSize),uOpacity:new Dl(t,e.uOpacity),uPixelRatio:new Dl(t,e.uPixelRatio),uRatio:new Bl(t,e.uRatio),uFade:new Dl(t,e.uFade),uImage:new Rl(t,e.uImage)}},linePattern:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uColor:new Nl(t,e.uColor),uPatternPosition:new Nl(t,e.uPatternPosition),uRatio:new Nl(t,e.uRatio),uImageSize:new Fl(t,e.uImageSize),uWidth:new Dl(t,e.uWidth),uOffset:new Dl(t,e.uOffset),uOpacity:new Dl(t,e.uOpacity),uPixelRatio:new Dl(t,e.uPixelRatio),uFade:new Dl(t,e.uFade),uImage:new Rl(t,e.uImage)}},heatmap:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uRadius:new Dl(t,e.uRadius),uRatio:new Dl(t,e.uRatio)}},heatmapRaster:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uWorld:new Fl(t,e.uWorld),uOpacity:new Dl(t,e.uOpacity),uImage:new Rl(t,e.uImage),uColorRamp:new Rl(t,e.uColorRamp)}},debug:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uColor:new Nl(t,e.uColor)}},collisionBox:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uExtrudeScale:new Fl(t,e.uExtrudeScale),uPlacedColor:new Nl(t,e.uPlacedColor),uNotPlacedColor:new Nl(t,e.uNotPlacedColor)}},point:function(t,e){return{uMatrix:new zl(t,e.uMatrix),uColor:new Nl(t,e.uColor),uSize:new Dl(t,e.uSize)}},network:function(t,e){return{uMatrix:new zl(t,e.uMatrix)}}}),jl=function(){function t(t,e,r){this._enable=t,this._cullFace=e,this._frontFace=r}return Object.defineProperty(t.prototype,"enable",{get:function(){return this._enable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cullFace",{get:function(){return this._cullFace},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frontFace",{get:function(){return this._frontFace},enumerable:!1,configurable:!0}),t.disabled=function(e){return new t(!1,e.BACK,e.CCW)},t.backCCW=function(e){return new t(!0,e.BACK,e.CCW)},t}(),Vl=[1/Math.sqrt(2),-1/Math.sqrt(2),1],Gl=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s=e.context,l=e.transform,u=s.gl,h=e.useProgram("building"),c=r.source,f=r.cachedTiles,p=r.stack,d=r.stackStyle,y={};try{for(var g=t.__values(d.getStyles()),v=g.next();!v.done;v=g.next()){var _=v.value,m=[];try{for(var b=(o=void 0,t.__values(f)),x=b.next();!x.done;x=b.next()){var w=x.value,M=w.tileId,S=w.styleDataMap.get(p.getId(),_.getId()),P=S&&S.getRenderable();P&&m.push({posMatrix:c.getPositionMatrix(l,M),renderable:P})}}catch(t){o={error:t}}finally{try{x&&!x.done&&(a=b.return)&&a.call(b)}finally{if(o)throw o.error}}y[_.getId()]=m}}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}var T=0===e.transform.getPitch(),E="".concat(p.getId()),L=e.getDepthModeFor3D(),k=jl.backCCW(u),I={colorMode:ml.disabled(u),stencilMode:Ml.disabled(u),depthMode:L,cullFaceMode:k},A={colorMode:e.getColorMode(),stencilMode:new Ml(u.NOTEQUAL,255,255,255,u.KEEP,u.KEEP,u.REPLACE),depthMode:L,cullFaceMode:k},C={colorMode:e.getColorMode(),stencilMode:Ml.disabled(u),depthMode:L,cullFaceMode:k};this._drawPhase(h,s,I,I,d,y,T,E),this._drawPhase(h,s,A,C,d,y,T,E)},e.prototype._drawPhase=function(e,r,n,i,o,a,s,l){var u,h,c,f,p,d,y,g,v,_;try{for(var m=t.__values(o.getStyles()),b=m.next();!b.done;b=m.next()){var x=b.value;r.clear({stencil:0});var w=x.getGeomPaint();if(!t.isDisplayOff(w.display)){var M=t.getColorAndOpacity(null!==(p=w.fill)&&void 0!==p?p:t.DEFAULT_FILL_COLOR,null!==(d=w["fill-opacity"])&&void 0!==d?d:t.DEFAULT_FILL_OPACITY),S=M.color,P=M.opacity,T=t.getColorAndOpacity(null!==(y=w["model-wall-color"])&&void 0!==y?y:t.DEFAULT_WALL_COLOR,null!==(g=w["model-wall-opacity"])&&void 0!==g?g:t.DEFAULT_WALL_OPACITY),E=T.color,L=T.opacity,k=t.getColorAndOpacity(null!==(v=w.stroke)&&void 0!==v?v:t.DEFAULT_STROKE_COLOR,null!==(_=w["stroke-opacity"])&&void 0!==_?_:t.DEFAULT_STROKE_OPACITY),I=k.color,A=k.opacity,C=t.toFloat(w["stroke-width"],t.DEFAULT_STROKE_WIDTH),O={fillColor:S,fillOpacity:P,outlineColor:I,outlineOpacity:A,outlineWidth:C},R={fillColor:E,fillOpacity:L,outlineColor:I,outlineOpacity:A,outlineWidth:C};try{for(var D=(c=void 0,t.__values(a[x.getId()])),F=D.next();!F.done;F=D.next()){var B=F.value,N=B.renderable,z=B.posMatrix;this._drawBuilding(e,r,n,i,N,z,O,R,s,l)}}catch(t){c={error:t}}finally{try{F&&!F.done&&(f=D.return)&&f.call(D)}finally{if(c)throw c.error}}}}}catch(t){u={error:t}}finally{try{b&&!b.done&&(h=m.return)&&h.call(m)}finally{if(u)throw u.error}}},e.prototype._drawBuilding=function(t,e,r,n,i,o,a,s,l,u){var h=l?0:i.heightScale;this._drawBuildingPart(t,e,r,n,i.wall,o,h,s,u),this._drawBuildingPart(t,e,r,n,i.roof,o,h,a,u)},e.prototype._drawBuildingPart=function(t,e,r,n,i,o,a,s,l){var u=e.gl;t.draw(e,u.TRIANGLES,r,i.vertexBuffer,i.indexBuffer,i.segments,{uMatrix:o,uHeightScale:a,uColor:s.fillColor,uOpacity:s.fillOpacity,uLightEnabled:!0,uLightDirection:Vl,uLightIntensity:.10666666666666667},l),s.outlineWidth<=0||(u.lineWidth(1),i.outlineIndexBuffer&&i.outlineSegments&&t.draw(e,u.LINES,n,i.vertexBuffer,i.outlineIndexBuffer,i.outlineSegments,{uMatrix:o,uHeightScale:a,uColor:s.outlineColor,uOpacity:s.outlineOpacity,uLightEnabled:!1,uLightDirection:Bl.DEFAULT,uLightIntensity:Dl.DEFAULT},l))},e}(),ql=Gl,Zl=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p,d,y=e.context,g=e.transform,v=y.gl,_=e.useProgram("circle"),m=r.source,b=r.cachedTiles,x=r.stack,w=r.stackStyle,M={};try{for(var S=t.__values(w.getStyles()),P=S.next();!P.done;P=S.next()){var T=P.value,E=[];try{for(var L=(o=void 0,t.__values(b)),k=L.next();!k.done;k=L.next()){var I=k.value,A=I.tileId,C=I.styleDataMap.get(x.getId(),T.getId());(J=C&&C.getRenderable())&&E.push({posMatrix:m.getPositionMatrix(g,A),tileUnitsPerPixel:m.getTileUnitsPerPixel(g,A),tileId:A,renderable:J})}}catch(t){o={error:t}}finally{try{k&&!k.done&&(a=L.return)&&a.call(L)}finally{if(o)throw o.error}}M[T.getId()]=E}}catch(t){n={error:t}}finally{try{P&&!P.done&&(i=S.return)&&i.call(S)}finally{if(n)throw n.error}}var O="".concat(x.getId()),R=e.getColorMode(),D=xl.disabled(v),F=Ml.disabled(v),B=jl.disabled(v);try{for(var N=t.__values(w.getStyles()),z=N.next();!z.done;z=N.next()){var U=(T=z.value).getGeomPaint();if(!t.isDisplayOff(U.display)){var j=t.toFloat(U["circle-radius"],0),V=t.getColorAndOpacity(null!==(c=U.fill)&&void 0!==c?c:t.DEFAULT_FILL_COLOR,null!==(f=U["fill-opacity"])&&void 0!==f?f:t.DEFAULT_FILL_OPACITY),G=V.color,q=V.opacity,Z=t.getColorAndOpacity(null!==(p=U.stroke)&&void 0!==p?p:t.DEFAULT_STROKE_COLOR,null!==(d=U["stroke-opacity"])&&void 0!==d?d:t.DEFAULT_STROKE_OPACITY),W=Z.color,H=Z.opacity,Y=t.toFloat(U["stroke-width"],t.DEFAULT_STROKE_WIDTH);try{for(var X=(u=void 0,t.__values(M[T.getId()])),K=X.next();!K.done;K=X.next()){var Q=K.value,J=Q.renderable,$={uMatrix:Q.posMatrix,uRadius:j,uColor:G,uOpacity:q,uStrokeColor:W,uStrokeOpacity:H,uStrokeWidth:Y,uRatio:1/Q.tileUnitsPerPixel,uDevicePixelRatio:t.browser.devicePixelRatio};_.draw(y,y.gl.TRIANGLES,{colorMode:R,depthMode:D,stencilMode:F,cullFaceMode:B},J.vertexBuffer,J.indexBuffer,J.segments,$,O)}}catch(t){u={error:t}}finally{try{K&&!K.done&&(h=X.return)&&h.call(X)}finally{if(u)throw u.error}}}}}catch(t){s={error:t}}finally{try{z&&!z.done&&(l=N.return)&&l.call(N)}finally{if(s)throw s.error}}},e}(),Wl=Zl,Hl=function(){function e(){this._maskIds={}}return e.prototype.draw=function(e,r){var n,i,o=e.context,a=e.transform,s=e.clippingMaskFrame,l=o.gl,u=e.useProgram("clippingMask");o.clear({stencil:0});var h=r.source,c=r.cachedTiles;this._maskIds={};var f=1,p=h.getTileExtent(),d=ml.disabled(l),y=xl.disabled(l),g=jl.disabled(l);try{for(var v=t.__values(c),_=v.next();!_.done;_=v.next()){var m=_.value.tileId,b=new Ml(l.ALWAYS,f,0,255,l.KEEP,l.KEEP,l.REPLACE),x=_s(Es(),h.getPositionMatrix(a,m),[p,p,1]);u.draw(o,l.TRIANGLES,{colorMode:d,depthMode:y,stencilMode:b,cullFaceMode:g},s.vertexBuffer,s.indexBuffer,s.segments,{uMatrix:x},"$$clipping"),this._maskIds[m.toString()]=f++}}catch(t){n={error:t}}finally{try{_&&!_.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}},e.prototype.getStencilRef=function(t){return this._maskIds[t.toString()]},e}(),Yl=Hl,Xl=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p=e.context,d=e.transform,y=p.gl,g=e.useProgram("solid"),v=r.source,_=r.cachedTiles,m=r.stack,b=r.stackStyle,x=r.needClippingMask,w={};try{for(var M=t.__values(b.getStyles()),S=M.next();!S.done;S=M.next()){var P=S.value,T=[];try{for(var E=(o=void 0,t.__values(_)),L=E.next();!L.done;L=E.next()){var k=L.value,I=k.tileId,A=k.styleDataMap.get(m.getId(),P.getId());(Z=A&&A.getRenderable())&&T.push({posMatrix:v.getPositionMatrix(d,I),renderable:Z,stencilModeForClipping:e.getStencilModeForClipping(I)})}}catch(t){o={error:t}}finally{try{L&&!L.done&&(a=E.return)&&a.call(E)}finally{if(o)throw o.error}}w[P.getId()]=T}}catch(t){n={error:t}}finally{try{S&&!S.done&&(i=M.return)&&i.call(M)}finally{if(n)throw n.error}}var C="".concat(m.getId()),O=b.isTranslucent()?e.getColorMode():ml.unblended(y),R=xl.disabled(y),D=jl.disabled(y);try{for(var F=t.__values(b.getStyles()),B=F.next();!B.done;B=F.next()){var N=(P=B.value).getGeomPaint();if(!t.isDisplayOff(N.display)){var z=t.getColorAndOpacity(null!==(c=N.stroke)&&void 0!==c?c:t.DEFAULT_STROKE_COLOR,null!==(f=N["stroke-opacity"])&&void 0!==f?f:t.DEFAULT_STROKE_OPACITY),U=z.color,j=z.opacity;try{for(var V=(u=void 0,t.__values(w[P.getId()])),G=V.next();!G.done;G=V.next()){var q=G.value,Z=q.renderable,W=q.posMatrix,H=q.stencilModeForClipping,Y=x?H:Ml.disabled(y);g.draw(p,p.gl.TRIANGLES,{colorMode:O,depthMode:R,stencilMode:Y,cullFaceMode:D},Z.vertexBuffer,Z.indexBuffer,Z.segments,{uMatrix:W,uColor:U,uOpacity:j},C)}}catch(t){u={error:t}}finally{try{G&&!G.done&&(h=V.return)&&h.call(V)}finally{if(u)throw u.error}}}}}catch(t){s={error:t}}finally{try{B&&!B.done&&(l=F.return)&&l.call(F)}finally{if(s)throw s.error}}},e}(),Kl=Xl,Ql=[-1,-1],Jl={0:{space:20,vertices:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{space:20,vertices:[[6,17],[8,18],[11,21],[11,0]]},2:{space:20,vertices:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{space:20,vertices:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{space:20,vertices:[[13,21],[3,7],[18,7],Ql,[13,21],[13,0]]},5:{space:20,vertices:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{space:20,vertices:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{space:20,vertices:[[17,21],[7,0],Ql,[3,21],[17,21]]},8:{space:20,vertices:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{space:20,vertices:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]}," ":{space:16,vertices:[]},"!":{space:10,vertices:[[5,21],[5,7],Ql,[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{space:16,vertices:[[4,21],[4,14],Ql,[12,21],[12,14]]},"#":{space:21,vertices:[[11,25],[4,-7],Ql,[17,25],[10,-7],Ql,[4,12],[18,12],Ql,[3,6],[17,6]]},$:{space:20,vertices:[[8,25],[8,-4],Ql,[12,25],[12,-4],Ql,[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{space:24,vertices:[[21,21],[3,0],Ql,[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],Ql,[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{space:26,vertices:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{space:10,vertices:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{space:14,vertices:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{space:14,vertices:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{space:16,vertices:[[8,21],[8,9],Ql,[3,18],[13,12],Ql,[13,18],[3,12]]},"+":{space:26,vertices:[[13,18],[13,0],Ql,[4,9],[22,9]]},",":{space:10,vertices:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{space:26,vertices:[[4,9],[22,9]]},".":{space:10,vertices:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{space:22,vertices:[[20,25],[2,-7]]},":":{space:10,vertices:[[5,14],[4,13],[5,12],[6,13],[5,14],Ql,[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{space:10,vertices:[[5,14],[4,13],[5,12],[6,13],[5,14],Ql,[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{space:24,vertices:[[20,18],[4,9],[20,0]]},"=":{space:26,vertices:[[4,12],[22,12],Ql,[4,6],[22,6]]},">":{space:24,vertices:[[4,18],[20,9],[4,0]]},"?":{space:18,vertices:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],Ql,[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{space:27,vertices:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],Ql,[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],Ql,[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],Ql,[19,16],[18,8],[18,6],[19,5]]},A:{space:18,vertices:[[9,21],[1,0],Ql,[9,21],[17,0],Ql,[4,7],[14,7]]},B:{space:21,vertices:[[4,21],[4,0],Ql,[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],Ql,[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{space:21,vertices:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{space:21,vertices:[[4,21],[4,0],Ql,[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{space:19,vertices:[[4,21],[4,0],Ql,[4,21],[17,21],Ql,[4,11],[12,11],Ql,[4,0],[17,0]]},F:{space:18,vertices:[[4,21],[4,0],Ql,[4,21],[17,21],Ql,[4,11],[12,11]]},G:{space:21,vertices:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],Ql,[13,8],[18,8]]},H:{space:22,vertices:[[4,21],[4,0],Ql,[18,21],[18,0],Ql,[4,11],[18,11]]},I:{space:8,vertices:[[4,21],[4,0]]},J:{space:16,vertices:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{space:21,vertices:[[4,21],[4,0],Ql,[18,21],[4,7],Ql,[9,12],[18,0]]},L:{space:17,vertices:[[4,21],[4,0],Ql,[4,0],[16,0]]},M:{space:24,vertices:[[4,21],[4,0],Ql,[4,21],[12,0],Ql,[20,21],[12,0],Ql,[20,21],[20,0]]},N:{space:22,vertices:[[4,21],[4,0],Ql,[4,21],[18,0],Ql,[18,21],[18,0]]},O:{space:22,vertices:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{space:21,vertices:[[4,21],[4,0],Ql,[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{space:22,vertices:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],Ql,[12,4],[18,-2]]},R:{space:21,vertices:[[4,21],[4,0],Ql,[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],Ql,[11,11],[18,0]]},S:{space:20,vertices:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{space:16,vertices:[[8,21],[8,0],Ql,[1,21],[15,21]]},U:{space:22,vertices:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{space:18,vertices:[[1,21],[9,0],Ql,[17,21],[9,0]]},W:{space:24,vertices:[[2,21],[7,0],Ql,[12,21],[7,0],Ql,[12,21],[17,0],Ql,[22,21],[17,0]]},X:{space:20,vertices:[[3,21],[17,0],Ql,[17,21],[3,0]]},Y:{space:18,vertices:[[1,21],[9,11],[9,0],Ql,[17,21],[9,11]]},Z:{space:20,vertices:[[17,21],[3,0],Ql,[3,21],[17,21],Ql,[3,0],[17,0]]},"[":{space:14,vertices:[[4,25],[4,-7],Ql,[5,25],[5,-7],Ql,[4,25],[11,25],Ql,[4,-7],[11,-7]]},"\\":{space:14,vertices:[[0,21],[14,-3]]},"]":{space:14,vertices:[[9,25],[9,-7],Ql,[10,25],[10,-7],Ql,[3,25],[10,25],Ql,[3,-7],[10,-7]]},"^":{space:16,vertices:[[6,15],[8,18],[10,15],Ql,[3,12],[8,17],[13,12],Ql,[8,17],[8,0]]},_:{space:16,vertices:[[0,-2],[16,-2]]},"`":{space:10,vertices:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{space:19,vertices:[[15,14],[15,0],Ql,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{space:19,vertices:[[4,21],[4,0],Ql,[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{space:18,vertices:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{space:19,vertices:[[15,21],[15,0],Ql,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{space:18,vertices:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{space:12,vertices:[[10,21],[8,21],[6,20],[5,17],[5,0],Ql,[2,14],[9,14]]},g:{space:19,vertices:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],Ql,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{space:19,vertices:[[4,21],[4,0],Ql,[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{space:8,vertices:[[3,21],[4,20],[5,21],[4,22],[3,21],Ql,[4,14],[4,0]]},j:{space:10,vertices:[[5,21],[6,20],[7,21],[6,22],[5,21],Ql,[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{space:17,vertices:[[4,21],[4,0],Ql,[14,14],[4,4],Ql,[8,8],[15,0]]},l:{space:8,vertices:[[4,21],[4,0]]},m:{space:30,vertices:[[4,14],[4,0],Ql,[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],Ql,[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{space:19,vertices:[[4,14],[4,0],Ql,[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{space:19,vertices:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{space:19,vertices:[[4,14],[4,-7],Ql,[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{space:19,vertices:[[15,14],[15,-7],Ql,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{space:13,vertices:[[4,14],[4,0],Ql,[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{space:17,vertices:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{space:12,vertices:[[5,21],[5,4],[6,1],[8,0],[10,0],Ql,[2,14],[9,14]]},u:{space:19,vertices:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],Ql,[15,14],[15,0]]},v:{space:16,vertices:[[2,14],[8,0],Ql,[14,14],[8,0]]},w:{space:22,vertices:[[3,14],[7,0],Ql,[11,14],[7,0],Ql,[11,14],[15,0],Ql,[19,14],[15,0]]},x:{space:17,vertices:[[3,14],[14,0],Ql,[14,14],[3,0]]},y:{space:16,vertices:[[2,14],[8,0],Ql,[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{space:17,vertices:[[14,14],[3,0],Ql,[3,14],[14,14],Ql,[3,0],[14,0]]},"{":{space:14,vertices:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],Ql,[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],Ql,[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{space:8,vertices:[[4,25],[4,-7]]},"}":{space:14,vertices:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],Ql,[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],Ql,[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{space:24,vertices:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],Ql,[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}},$l=function(){function e(e){this._path=[],this._baseline=e.baseline,this._left=t.getOrDefault(e,"left",0),this._indent=t.getOrDefault(e,"indent",0),this._lineHeight=t.getOrDefault(e,"lineHeight",30),this._verticalFlip=t.getOrDefault(e,"verticalFlip",!1)}return e.prototype.addTo=function(e,r,n,i){var o,a,s,l,u;void 0===i&&(i=1),this._left=r,this._baseline=n;try{for(var h=t.__values(e),c=h.next();!c.done;c=h.next()){var f=c.value;if("\n"!==f){"\t"===f&&this.skip(4*Jl[" "].space*i);var p=Jl[f];if(p){var d=null;try{for(var y=(s=void 0,t.__values(p.vertices)),g=y.next();!g.done;g=y.next()){var v=g.value;if(v!==Ql){var _={x:this._indent+this._left+v[0]*i,y:this._baseline-(u=v[1],(this._verticalFlip?this.lineHeight-u:u)*i)};d&&this._path.push(d.x,d.y,_.x,_.y),d=_}else d=null}}catch(t){s={error:t}}finally{try{g&&!g.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}this._left+=p.space*i}}else this.nextLine(i)}}catch(t){o={error:t}}finally{try{c&&!c.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}return this},e.prototype.append=function(t,e){return this.addTo(t,this._left,this._baseline,e)},e.prototype.nextLine=function(t,e){return void 0===t&&(t=1),this._baseline+=(e||this._lineHeight)*t,this._left=0,this},e.prototype.skip=function(t){return this._left+=t,this},Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseline",{get:function(){return this._baseline},set:function(t){this._baseline=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indent",{get:function(){return this._indent},set:function(t){this._indent=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t},enumerable:!1,configurable:!0}),e.prototype.toVertices=function(){return this._path},e}(),tu=$l,eu=((Cl={})[t.TileServiceName.VsmLegacyVector]={boundaryColor:vl.Purple,keyPrefix:"LV. "},Cl[t.TileServiceName.VsmLegacyRaster]={boundaryColor:vl.Cyan,keyPrefix:"LR. "},Cl[t.TileServiceName.VsmVector]={boundaryColor:vl.Blue,keyPrefix:"V. "},Cl),ru=function(){function e(){this._renderingId="$$debug"}return e.prototype.draw=function(e,r){var n=this,i=r.visibleTiles,o=e.options,a=o.showTileDebugInfo,s=o.showVectorTileDebugInfo,l=o.showLegacyVectorTileDebugInfo,u=o.showLegacyRasterTileDebugInfo;if(a||s||l||u){var h=e.useProgram("debug"),c=this._getRenderingState(e.context);[u&&t.TileServiceName.VsmLegacyRaster,l&&t.TileServiceName.VsmLegacyVector,s&&t.TileServiceName.VsmVector].forEach((function(t){if(t){var r=eu[t];n._drawDataTileDebug(h,e,c,i,t,r.boundaryColor,r.keyPrefix)}})),a&&this._drawViewTileDebug(h,e,c,i)}},e.prototype._getRenderingState=function(t){var e=t.gl;return{colorMode:ml.alphaBlended(e),depthMode:xl.disabled(e),stencilMode:Ml.disabled(e),cullFaceMode:jl.disabled(e)}},e.prototype._drawDataTileDebug=function(e,r,n,i,o,a,s){var l,u,h=r.transform,c=t.tileAdapters[o],f=this._getVisibleOtherServiceTiles(i,h,o),p=function(t){var e=c.getTileExtent(),r=h.getDataTilePositionMatrix(t,o);if(c.getTileService().isRaster())return r;var n=_s(ps(),r,[e,-e,1]);return vs(n,n,[0,-1,0]),n};try{for(var d=t.__values(f),y=d.next();!y.done;y=d.next()){var g=y.value,v=c.getTransformParams(g).scale,_=p(g);this._drawTileBoundary(e,r,n,_,a);var m=_s(ps(),_,[v.x/h.getScale(),v.y/h.getScale(),1]);this._drawTileText(e,r,n,g,m,s)}}catch(t){l={error:t}}finally{try{y&&!y.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}},e.prototype._getVisibleOtherServiceTiles=function(e,r,n){var i=e.filter((function(t){return t.z>2}));return t.uniqueKey(t.flatMap(i,(function(t){return r.toDataTiles(t,n)})),(function(t){return t.toString()})).filter((function(t){return r.isVisibleDataTile(t,n)}))},e.prototype._drawViewTileDebug=function(e,r,n,i){var o,a,s=r.transform;try{for(var l=t.__values(i),u=l.next();!u.done;u=l.next()){var h=u.value,c=s.getMapDefine().toScale(h.z),f=s.getTilePositionMatrix(h);this._drawTileBoundary(e,r,n,f,vl.Red);var p=_s(ps(),f,[c/s.getScale(),c/s.getScale(),1]);this._drawTileText(e,r,n,h,p)}}catch(t){o={error:t}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}},e.prototype._drawTileBoundary=function(t,e,r,n,i){var o=e.context,a=e.tileBoundary,s=o.gl,l={uMatrix:n,uColor:i};t.draw(o,s.LINE_STRIP,r,a.vertexBuffer,a.indexBuffer,a.segments,l,this._renderingId)},e.prototype._drawTileText=function(e,r,n,i,o,a){var s,l,u,h,c=this;void 0===a&&(a="");var f=r.context,p=r.transform,d=f.gl,y=t.DEFAULT_TILE_EXTENT*t.browser.devicePixelRatio,g=y/(512*p.getEnlargeScaleFactor()),v=g/8,_=a+i.toString(),m=new tu({baseline:50*g,indent:20*g});m.append(_,8*v);for(var b=m.toVertices(),x=new t.PositionArrayBuilder,w=new t.LinesIndexArrayBuilder,M=0;M<b.length;M+=2)x.push(Math.round(b[M]),Math.round(b[M+1]));for(M=0;M<x.getElementSize();M+=2)w.push(M,M+1);var S=new t.VectorRenderable(f.createVertexBuffer(x.build(),t.PositionLayout.fields),f.createIndexBuffer(w.build()),t.SegmentArray.newSimpleArray(0,x.getElementSize(),0,w.getElementSize())),P=function(t){e.draw(f,d.LINES,n,S.vertexBuffer,S.indexBuffer,S.segments,t,c._renderingId)},T=_s(ps(),o,[1/y,1/y,1]),E=[[-1,-1,0],[-1,1,0],[1,-1,0],[1,1,0]],L=t.__spreadArray(t.__spreadArray([],t.__read(E),!1),[[-1,0,0],[0,-1,0],[1,0,0],[0,1,0]],!1);try{for(var k=t.__values(L),I=k.next();!I.done;I=k.next())for(var A=I.value,C=0;C<2;C++)P({uMatrix:vs(ps(),T,bs(ms(),A,(2+C)*g)),uColor:vl.White})}catch(t){s={error:t}}finally{try{I&&!I.done&&(l=k.return)&&l.call(k)}finally{if(s)throw s.error}}var O=t.__spreadArray(t.__spreadArray([],t.__read(E),!1),[[0,0,0]],!1);try{for(var R=t.__values(O),D=R.next();!D.done;D=R.next())A=D.value,P({uMatrix:vs(ps(),T,bs(ms(),A,g)),uColor:vl.Black})}catch(t){u={error:t}}finally{try{D&&!D.done&&(h=R.return)&&h.call(R)}finally{if(u)throw u.error}}S.destroy()},e}(),nu=ru,iu=function(){function e(){}return e.prototype.draw=function(e,r){var n=e.context,i=e.size,o=r.layer,a=r.stack,s=r.stackStyle,l="".concat(o.getId(),"/").concat(a.getId()),u=i.width/4,h=i.height/4,c=e.getHeatmapFrameBuffer(l,u,h);c.bind(),c.attached||c.attach(),n.setViewport(0,0,u,h),n.clear({color:t.TRANSPARENT_COLOR}),this._drawAtFrameBuffer(e,this._getTileBundlesMap(e,r),s,l),n.setViewport(0,0,i.width,i.height),c.unbind(),this._draw(e,s,c,l)},e.prototype._drawAtFrameBuffer=function(e,r,n,i){var o,a,s,l,u=e.context,h=u.gl,c=e.useProgram("heatmap"),f={colorMode:new ml([h.ONE,h.ONE],vl.Transparent,[!0,!0,!0,!0]),depthMode:xl.disabled(h),stencilMode:Ml.disabled(h),cullFaceMode:jl.disabled(h)};try{for(var p=t.__values(n.getStyles()),d=p.next();!d.done;d=p.next()){var y=d.value,g=y.getGeomPaint();if(!t.isDisplayOff(g.display))try{for(var v=(s=void 0,t.__values(r[y.getId()])),_=v.next();!_.done;_=v.next()){var m=_.value,b=m.renderable,x=m.posMatrix,w=m.tileUnitsPerPixel,M={uMatrix:x,uRadius:t.toFloat(g["circle-radius"],0),uRatio:1/w};c.draw(u,u.gl.TRIANGLES,f,b.vertexBuffer,b.indexBuffer,b.segments,M,i)}}catch(t){s={error:t}}finally{try{_&&!_.done&&(l=v.return)&&l.call(v)}finally{if(s)throw s.error}}}}catch(t){o={error:t}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}},e.prototype._draw=function(e,r,n,i){var o,a,s=e.context,l=e.size,u=e.clippingMaskFrame,h=s.gl,c=e.useProgram("heatmapRaster"),f={colorMode:e.getColorMode(),depthMode:xl.disabled(h),stencilMode:Ml.disabled(h),cullFaceMode:jl.disabled(h)},p=ps();!function(t,e,r,n,i,o,a){var s=1/(e-r),l=1/(n-i),u=1/(o-a);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*l,t[14]=(a+o)*u,t[15]=1}(p,0,l.width,0,l.height,0,1);try{for(var d=t.__values(r.getStyles()),y=d.next();!y.done;y=d.next()){var g=y.value.getGeomPaint();if(!t.isDisplayOff(g.display)){var v=n.getTexture(),_=e.getHeatmapColorTexture(i,g["heatmap-colors"]);v.bind({filter:h.LINEAR,wrap:h.CLAMP_TO_EDGE,activeUnit:0}),_.bind({filter:h.LINEAR,wrap:h.CLAMP_TO_EDGE,activeUnit:1});var m={uMatrix:p,uWorld:[h.drawingBufferWidth,h.drawingBufferHeight],uImage:0,uColorRamp:1,uOpacity:t.toFloat(g["fill-opacity"],t.DEFAULT_FILL_OPACITY)};c.draw(s,s.gl.TRIANGLES,f,u.vertexBuffer,u.indexBuffer,u.segments,m,i)}}}catch(t){o={error:t}}finally{try{y&&!y.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}},e.prototype._getTileBundlesMap=function(e,r){var n,i,o,a,s=e.transform,l=r.source,u=r.cachedTiles,h=r.stack,c=r.stackStyle,f={};try{for(var p=t.__values(c.getStyles()),d=p.next();!d.done;d=p.next()){var y=d.value,g=[];try{for(var v=(o=void 0,t.__values(u)),_=v.next();!_.done;_=v.next()){var m=_.value,b=m.tileId,x=m.styleDataMap.get(h.getId(),y.getId()),w=x&&x.getRenderable();w&&g.push({posMatrix:l.getPositionMatrix(s,b),tileUnitsPerPixel:l.getTileUnitsPerPixel(s,b),tileId:b,renderable:w})}}catch(t){o={error:t}}finally{try{_&&!_.done&&(a=v.return)&&a.call(v)}finally{if(o)throw o.error}}f[y.getId()]=g}}catch(t){n={error:t}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}return f},e}(),ou=iu,au=function(){function e(e,r,n){this._context=e,this._image=new t.AlphaImage(r,n),this._texture=new t.Texture(e,this._image),this._positions={},this._nextRow=0}return e.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this._positions[r]||(this._positions[r]=this._addDash(t,e)),this._positions[r]},e.prototype._addDash=function(t,e){var r=e?7:0,n=2*r+1,i=this._image.getWidth(),o=this._image.getHeight();if(this._nextRow+n>o)return console.warn("LineAtlas out of space"),null;for(var a=0,s=0;s<t.length;s++)a+=t[s];for(var l=i/a,u=l/2,h=t.length%2==1,c=-r;c<=r;c++)for(var f=this._nextRow+r+c,p=h?-t[t.length-1]:0,d=t[0],y=1,g=0;g<i;g++){for(;d<g/l;)p=d,d+=t[y],h&&y===t.length-1&&(d+=t[0]),y++;var v=Math.abs(g-p*l),_=Math.abs(g-d*l),m=Math.min(v,_),b=y%2==1,x=void 0;if(e){var w=r?c/r*(u+1):0;if(b){var M=u-Math.abs(w);x=Math.sqrt(m*m+M*M)}else x=u-Math.sqrt(m*m+w*w)}else x=(b?1:-1)*m;var S=Math.max(0,Math.min(255,x+128));this._image.setPixel(g,f,[S])}var P={y:(this._nextRow+r+.5)/o,width:a,height:2*r/o};return this._nextRow+=n,this._texture.update(this._image),P},e.prototype.bind=function(t){void 0===t&&(t={});var e=this._context.gl;this._texture.bind({filter:e.LINEAR,wrap:e.REPEAT,activeUnit:t.activeUnit})},e.prototype.destroy=function(){this._texture&&this._texture.destroy()},Object.defineProperty(e.prototype,"width",{get:function(){return this._image.getWidth()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._image.getHeight()},enumerable:!1,configurable:!0}),e}(),su=au,lu=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p,d,y,g,v=e.context,_=e.transform,m=v.gl,b=r.source,x=r.cachedTiles,w=r.stack,M=r.stackStyle,S=r.needClippingMask,P={};try{for(var T=t.__values(M.getStyles()),E=T.next();!E.done;E=T.next()){var L=E.value,k=[];try{for(var I=(o=void 0,t.__values(x)),A=I.next();!A.done;A=I.next()){var C=A.value,O=C.tileId,R=C.styleDataMap,D=C.tileCompositeData,F=R.get(w.getId(),L.getId());if(K=F&&F.getRenderable()){var B=D;k.push({posMatrix:b.getPositionMatrix(_,O),tileUnitsPerPixel:b.getTileUnitsPerPixel(_,O),tileId:O,renderable:K,stencilModeForClipping:e.getStencilModeForClipping(O),patternAtlasTexture:B.getPatternAtlasTexture&&B.getPatternAtlasTexture(v)})}}}catch(t){o={error:t}}finally{try{A&&!A.done&&(a=I.return)&&a.call(I)}finally{if(o)throw o.error}}P[L.getId()]=k}}catch(t){n={error:t}}finally{try{E&&!E.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}var N=e.getColorMode(),z=xl.disabled(m),U=jl.disabled(m);try{for(var j=t.__values(M.getStyles()),V=j.next();!V.done;V=j.next()){var G=(L=V.value).getGeomPaint(),q=t.toFloat(G["stroke-width"],t.DEFAULT_STROKE_WIDTH);if(!(t.isDisplayOff(G.display)||q<=0)){var Z=t.toArray(G["stroke-dasharray"]).map((function(e){return e*t.getLineDensity()})),W=Z.length>0;if(!W&&G["stroke-pattern"])try{for(var H=(u=void 0,t.__values(P[L.getId()])),Y=H.next();!Y.done;Y=H.next()){var X=Y.value,K=X.renderable,Q=X.posMatrix,J=(O=X.tileId,X.stencilModeForClipping),$=X.patternAtlasTexture,tt=X.tileUnitsPerPixel;if($&&K.patternPosition){$.bind({filter:m.LINEAR,wrap:m.CLAMP_TO_EDGE});var et,rt=[$.width,$.height],nt=Math.pow(2,Math.floor(_.getZoom())-O.z),it=b.getTileSize()*_.getEnlargeScaleFactor()*nt/b.getTileExtent(),ot=e.getFadeChangeByIntegerZoom();et=_.getZoom()>e.lastIntegerZoom?2:.5;var at=t.getColorAndOpacity(null!==(p=G.stroke)&&void 0!==p?p:t.TRANSPARENT_COLOR,null!==(d=G["stroke-opacity"])&&void 0!==d?d:t.DEFAULT_STROKE_OPACITY),st={uMatrix:Q,uColor:at.color,uOpacity:at.opacity,uWidth:Math.max(q*t.getLineDensity(),1),uImage:0,uImageSize:rt,uRatio:[1/tt,it,et,1],uFade:ot,uPatternPosition:K.patternPosition,uPixelRatio:K.patternPixelRatio,uOffset:0},lt=S?J:Ml.disabled(m);e.useProgram("linePattern").draw(v,v.gl.TRIANGLES,{colorMode:N,depthMode:z,stencilMode:lt,cullFaceMode:U},K.vertexBuffer,K.indexBuffer,K.segments,st,"".concat(w.getId()))}}}catch(t){u={error:t}}finally{try{Y&&!Y.done&&(h=H.return)&&h.call(H)}finally{if(u)throw u.error}}else try{for(var ut=(c=void 0,t.__values(P[L.getId()])),ht=ut.next();!ht.done;ht=ut.next()){var ct=ht.value,ft=(K=ct.renderable,Q=ct.posMatrix,tt=ct.tileUnitsPerPixel,J=ct.stencilModeForClipping,1/tt),pt=e.lineAtlas,dt=t.getColorAndOpacity(null!==(y=G.stroke)&&void 0!==y?y:t.DEFAULT_STROKE_COLOR,null!==(g=G["stroke-opacity"])&&void 0!==g?g:t.DEFAULT_STROKE_OPACITY);if(st={uMatrix:Q,uColor:dt.color,uOpacity:dt.opacity,uWidth:Math.max(q*t.getLineDensity(),1),uRatio:ft,uOffset:0},W){var yt=pt.getDash(Z,!1);if(!yt)continue;st=t.__assign(t.__assign({},st),{uPatternScale:[ft/yt.width,-yt.height/2],uSdfGamma:pt.width/(256*yt.width*t.browser.devicePixelRatio)/2,uImage:0,uTextureY:yt.y}),pt.bind()}lt=S?J:Ml.disabled(m),e.useProgram(W?"dashedLine":"line").draw(v,v.gl.TRIANGLES,{colorMode:N,depthMode:z,stencilMode:lt,cullFaceMode:U},K.vertexBuffer,K.indexBuffer,K.segments,st,"".concat(w.getId()))}}catch(t){c={error:t}}finally{try{ht&&!ht.done&&(f=ut.return)&&f.call(ut)}finally{if(c)throw c.error}}}}}catch(t){s={error:t}}finally{try{V&&!V.done&&(l=j.return)&&l.call(j)}finally{if(s)throw s.error}}},e.prototype._drawDebug=function(e,r,n){var i,o,a,s,l=e.context,u=l.gl,h=r.stackStyle,c=e.useProgram("point"),f={colorMode:e.getColorMode(),depthMode:xl.disabled(u),stencilMode:Ml.disabled(u),cullFaceMode:jl.disabled(u)},p=t.getDensity(!0);try{for(var d=t.__values(h.getStyles()),y=d.next();!y.done;y=d.next()){var g=y.value;if(g.getGeomPaint()["stroke-debug"])try{for(var v=(a=void 0,t.__values(n[g.getId()])),_=v.next();!_.done;_=v.next()){var m=_.value,b=m.renderable,x=m.posMatrix;c.drawPoints(l,f,b.vertexBuffer,{uMatrix:x,uColor:[1,0,0,1],uSize:4*p})}}catch(t){a={error:t}}finally{try{_&&!_.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}}}catch(t){i={error:t}}finally{try{y&&!y.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}},e}(),uu=lu,hu=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p=e.context,d=e.transform,y=e.fadeChange,g=e.options,v=p.gl,_=r.source,m=r.cachedTiles,b=r.stack,x=r.stackStyle,w={};try{for(var M=t.__values(x.getStyles()),S=M.next();!S.done;S=M.next()){var P=S.value,T=[];try{for(var E=(o=void 0,t.__values(m)),L=E.next();!L.done;L=E.next()){var k=L.value,I=k.tileId,A=k.styleDataMap,C=k.tileCompositeData,O=A.get(b.getId(),P.getId());if(O){var R=O.getRenderable();if(R&&R.getInfoArray().some((function(t){return t.levelFilter.evaluate(_.getStyleLevel(d.getZoom()))}))){var D=C;T.push({posMatrix:_.getPositionMatrix(d,I),tileUnitsPerPixel:_.getTileUnitsPerPixel(d,I),renderable:R,glyphAtlasTexture:D.getGlyphAtlasTexture(p),iconAtlasTexture:D.getIconAtlasTexture(p)})}}}}catch(t){o={error:t}}finally{try{L&&!L.done&&(a=E.return)&&a.call(E)}finally{if(o)throw o.error}}w[P.getId()]=T}}catch(t){n={error:t}}finally{try{S&&!S.done&&(i=M.return)&&i.call(M)}finally{if(n)throw n.error}}var F="".concat(b.getId()),B={colorMode:e.getColorMode(),depthMode:e.getDepthMode(0,!1),stencilMode:Ml.disabled(v),cullFaceMode:jl.disabled(v)};try{for(var N=t.__values(x.getStyles()),z=N.next();!z.done;z=N.next()){T=w[(P=z.value).getId()];var U=P.getIconPaint(),j=P.getLabelPaint(),V=U&&!t.isDisplayOff(U.display),G=j&&!t.isDisplayOff(j.display);if((V||G)&&this._updateOffset(p,d,T,g.showCollisionDetection),V&&this._drawPois(e,T,!1,{},B,y,F),G){var q=t.getColorAndOpacity(null!==(u=j.fill)&&void 0!==u?u:t.DEFAULT_FILL_COLOR,null!==(h=j["fill-opacity"])&&void 0!==h?h:t.DEFAULT_FILL_OPACITY),Z=q.color,W=q.opacity,H=t.getColorAndOpacity(null!==(c=j.stroke)&&void 0!==c?c:t.DEFAULT_LABEL_STROKE_COLOR,null!==(f=j["stroke-opacity"])&&void 0!==f?f:t.DEFAULT_LABEL_STROKE_OPACITY),Y={fillColor:Z,fillOpacity:W,strokeColor:H.color,strokeOpacity:H.opacity,strokeWidth:t.toFloat(j["stroke-width"],t.DEFAULT_LABEL_STROKE_WIDTH),fontWeight:t.getFontWeight(j["font-weight"])};this._drawPois(e,T,!0,Y,B,y,F)}}}catch(t){s={error:t}}finally{try{z&&!z.done&&(l=N.return)&&l.call(N)}finally{if(s)throw s.error}}g.showCollisionDetection&&this._drawDebugBox(e,r,w),g.showPoiVertex&&this._drawDebugPoint(e,r,w)},e.prototype._updateOffset=function(e,r,n,i){var o,a,s,l,u,h,c=function(e,r){var n=t.toDegree(e+r)%360;return n<0&&(n=360+n),n>90&&n<270},f=!1;try{for(var p=t.__values(n),d=p.next();!d.done;d=p.next()){var y=d.value.renderable,g=new t.PoiOffsetArrayBuilder,v=new t.PoiOffsetArrayBuilder;try{for(var _=(s=void 0,t.__values(y.getInfoArray())),m=_.next();!m.done;m=_.next()){var b=m.value,x=b.glyphVerticesLength,w=b.iconVerticesLength,M=b.textPlaceInfo,S=b.iconQuad,P=b.rotateAlignment,T=b.keepUpright,E=b.angle,L=x>0,k=w>0,I=r.getAngle(),A=P===t.Alignment.Map&&T&&c(E,I),C=function(t,e){e.forEach((function(e){t.push(Math.round(32*e.x),Math.round(32*e.y))}))};if(L){var O=M[0].quads;try{for(var R=(u=void 0,t.__values(O)),D=R.next();!D.done;D=R.next()){var F=D.value,B=F.topLeft,N=F.topRight,z=F.bottomLeft,U=F.bottomRight;A&&(B=t.rotate(B,Math.PI),N=t.rotate(N,Math.PI),z=t.rotate(z,Math.PI),U=t.rotate(U,Math.PI)),C(g,[B,N,z,U])}}catch(t){u={error:t}}finally{try{D&&!D.done&&(h=R.return)&&h.call(R)}finally{if(u)throw u.error}}}k&&S&&(B=S.topLeft,N=S.topRight,z=S.bottomLeft,U=S.bottomRight,A&&(B=t.rotate(B,Math.PI),N=t.rotate(N,Math.PI),z=t.rotate(z,Math.PI),U=t.rotate(U,Math.PI),f=!0),C(v,[B,N,z,U]))}}catch(t){s={error:t}}finally{try{m&&!m.done&&(l=_.return)&&l.call(_)}finally{if(s)throw s.error}}y.text.offsetBuffer.updateData(g.build()),f&&y.icon.offsetBuffer.updateData(v.build()),i&&y.updateCollisionBox(e)}}catch(t){o={error:t}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}},e.prototype._drawPois=function(e,r,n,i,o,a,s){var l,u,h=this,c=e.context,f=e.transform,p=c.gl,d=e.useProgram("poiText"),y=e.useProgram("poiIcon"),g=function(e,r,l,u,g){var _=n?u:g;if(!_)return"continue";var m=gs(Ts(),f.getLabelPlaneMatrix(),r),b=f.getGlCoordMatrix(),x=Ts();ys(x),_s(x,x,[1/l,1/l,1]);var w=ds(r);_s(w,w,[l,l,1]),_.bind({filter:p.LINEAR,wrap:p.CLAMP_TO_EDGE});var M=n?e.text:e.icon,S={uMatrix:r,uLabelPlaneMatrix:m,uGlCoordMatrix:b,uLabelPlaneMatrix2:x,uGlCoordMatrix2:w,uImage:0,uImageSize:[_.width,_.height],uFadeChange:a,uRotate:f.getAngle()};if(n){var P=i,T=function(r){var n=t.__assign(t.__assign({},S),{uColor:P.fillColor,uOpacity:r?P.strokeOpacity:P.fillOpacity,uHalo:r,uHaloColor:P.strokeColor,uHaloWidth:P.strokeWidth*t.getLineDensity(),uFontSize:e.fontSize,uFontWeight:P.fontWeight,uGammaScale:Math.cos(t.toRadian(f.getPitch()))*f.getCameraToCenterDistance(),uDevicePixelRatio:t.browser.devicePixelRatio});h._drawPart(d,c,o,M,n,s)};P.strokeWidth>0&&P.strokeOpacity>0&&T(!0),T(!1)}else{var E=t.__assign(t.__assign({},S),{uOpacity:1});v._drawPart(y,c,o,M,E,s)}},v=this;try{for(var _=t.__values(r),m=_.next();!m.done;m=_.next()){var b=m.value;g(b.renderable,b.posMatrix,b.tileUnitsPerPixel,b.glyphAtlasTexture,b.iconAtlasTexture)}}catch(t){l={error:t}}finally{try{m&&!m.done&&(u=_.return)&&u.call(_)}finally{if(l)throw l.error}}},e.prototype._drawPart=function(t,e,r,n,i,o){t.draw(e,e.gl.TRIANGLES,r,n.vertexBuffer,n.indexBuffer,n.segments,i,o,[n.opacityBuffer,n.offsetBuffer])},e.prototype._drawDebugPoint=function(e,r,n){var i,o,a,s,l=e.context,u=l.gl,h=r.stackStyle,c=e.useProgram("point"),f={colorMode:e.getColorMode(),depthMode:xl.disabled(u),stencilMode:Ml.disabled(u),cullFaceMode:jl.disabled(u)},p=t.getDensity(!0);try{for(var d=t.__values(h.getStyles()),y=d.next();!y.done;y=d.next()){var g=y.value;try{for(var v=(a=void 0,t.__values(n[g.getId()])),_=v.next();!_.done;_=v.next()){var m=_.value,b=m.renderable,x=m.posMatrix;c.drawPoints(l,f,b.text.vertexBuffer,{uMatrix:x,uColor:[1,0,0,1],uSize:6*p}),c.drawPoints(l,f,b.icon.vertexBuffer,{uMatrix:x,uColor:[1,0,0,1],uSize:6*p})}}catch(t){a={error:t}}finally{try{_&&!_.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}}}catch(t){i={error:t}}finally{try{y&&!y.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}},e.prototype._drawDebugBox=function(e,r,n){var i,o,a,s,l=e.context,u=e.transform,h=l.gl,c=e.useProgram("collisionBox"),f=r.stack,p=r.stackStyle,d={colorMode:e.getColorMode(),depthMode:xl.disabled(h),stencilMode:Ml.disabled(h),cullFaceMode:jl.disabled(h)},y="".concat(f.getId());try{for(var g=t.__values(p.getStyles()),v=g.next();!v.done;v=g.next()){var _=v.value;try{for(var m=(a=void 0,t.__values(n[_.getId()])),b=m.next();!b.done;b=m.next()){var x=b.value,w=x.renderable,M=x.posMatrix,S=w.getCollisionBox(l);S&&c.draw(l,h.LINES,d,S.vertexBuffer,S.indexBuffer,S.segments,{uMatrix:M,uExtrudeScale:[2/u.getWidth(),-2/u.getHeight()],uPlacedColor:[0,0,.8,.8],uNotPlacedColor:[.6,0,0,.6]},y,[S.collisionBuffer])}}catch(t){a={error:t}}finally{try{b&&!b.done&&(s=m.return)&&s.call(m)}finally{if(a)throw a.error}}}}catch(t){i={error:t}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}},e}(),cu=hu,fu=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b,x=e.context,w=e.transform,M=x.gl,S=e.useProgram("solid"),P=e.useProgram("line"),T=e.useProgram("fillPattern"),E=r.source,L=r.cachedTiles,k=r.stack,I=r.stackStyle,A=r.needClippingMask,C={};try{for(var O=t.__values(I.getStyles()),R=O.next();!R.done;R=O.next()){var D=R.value,F=[];try{for(var B=(o=void 0,t.__values(L)),N=B.next();!N.done;N=B.next()){var z=N.value,U=z.tileId,j=z.styleDataMap,V=z.tileCompositeData,G=j.get(k.getId(),D.getId());if(it=G&&G.getRenderable()){var q=V;F.push({posMatrix:E.getPositionMatrix(w,U),tileUnitsPerPixel:E.getTileUnitsPerPixel(w,U),tileId:U,renderable:it,stencilModeForClipping:e.getStencilModeForClipping(U),patternAtlasTexture:q.getPatternAtlasTexture&&q.getPatternAtlasTexture(x)})}}}catch(t){o={error:t}}finally{try{N&&!N.done&&(a=B.return)&&a.call(B)}finally{if(o)throw o.error}}C[D.getId()]=F}}catch(t){n={error:t}}finally{try{R&&!R.done&&(i=O.return)&&i.call(O)}finally{if(n)throw n.error}}var Z="".concat(k.getId()),W=I.isTranslucent()?e.getColorMode():ml.unblended(M),H=xl.disabled(M),Y=jl.disabled(M);try{for(var X=t.__values(I.getStyles()),K=X.next();!K.done;K=X.next()){var Q=(D=K.value).getGeomPaint();if(!t.isDisplayOff(Q.display)){var J=(Pt=t.toInt(k.getProperties().border))>0?new Ml(M.GEQUAL,Pt,Pt,255,M.KEEP,M.REPLACE,M.REPLACE):Ml.disabled(M);if(Q["fill-pattern"]){var $=e.getColorMode(),tt=t.toFloat(Q["fill-opacity"],t.DEFAULT_FILL_OPACITY);try{for(var et=(u=void 0,t.__values(C[D.getId()])),rt=et.next();!rt.done;rt=et.next()){var nt=rt.value,it=nt.renderable,ot=nt.posMatrix,at=nt.stencilModeForClipping,st=(U=nt.tileId,nt.patternAtlasTexture);if(st&&it.patternPosition){var lt=A?at:J;st.bind({filter:M.LINEAR,wrap:M.CLAMP_TO_EDGE});var ut,ht=[st.width,st.height],ct=Math.pow(2,Math.floor(w.getZoom())-U.z),ft=E.getTileSize()*w.getEnlargeScaleFactor()*ct,pt=ft/E.getTileExtent(),dt=e.getFadeChangeByIntegerZoom();ut=w.getZoom()>e.lastIntegerZoom?2:.5;var yt=ft*U.x,gt=ft*(Math.pow(2,U.z)-1-U.y);this._drawPatternPolygon(T,x,{colorMode:$,depthMode:H,stencilMode:lt,cullFaceMode:Y},it,ot,tt,ht,[yt,gt],pt,ut,1,dt,Z)}}}catch(t){u={error:t}}finally{try{rt&&!rt.done&&(h=et.return)&&h.call(et)}finally{if(u)throw u.error}}}else{var vt=t.getColorAndOpacity(null!==(v=Q.fill)&&void 0!==v?v:t.DEFAULT_FILL_COLOR,null!==(_=Q["fill-opacity"])&&void 0!==_?_:t.DEFAULT_FILL_OPACITY),_t=vt.color;tt=vt.opacity;try{for(var mt=(c=void 0,t.__values(C[D.getId()])),bt=mt.next();!bt.done;bt=mt.next()){var xt=bt.value;it=xt.renderable,ot=xt.posMatrix,at=xt.stencilModeForClipping,lt=A?at:J,this._drawPolygon(S,x,{colorMode:W,depthMode:H,stencilMode:lt,cullFaceMode:Y},it,ot,_t,tt,Z)}}catch(t){c={error:t}}finally{try{bt&&!bt.done&&(f=mt.return)&&f.call(mt)}finally{if(c)throw c.error}}}}}}catch(t){s={error:t}}finally{try{K&&!K.done&&(l=X.return)&&l.call(X)}finally{if(s)throw s.error}}try{for(var wt=t.__values(I.getStyles()),Mt=wt.next();!Mt.done;Mt=wt.next()){Q=(D=Mt.value).getGeomPaint();var St=t.toFloat(Q["stroke-width"],t.DEFAULT_STROKE_WIDTH);if(!(t.isDisplayOff(Q.display)||St<=0)){var Pt,Tt=t.getColorAndOpacity(null!==(m=Q.stroke)&&void 0!==m?m:t.DEFAULT_STROKE_COLOR,null!==(b=Q["stroke-opacity"])&&void 0!==b?b:t.DEFAULT_STROKE_OPACITY);_t=Tt.color,tt=Tt.opacity,J=(Pt=t.toInt(k.getProperties().border))>0?new Ml(M.NOTEQUAL,Pt,Pt,255,M.KEEP,M.KEEP,M.KEEP):Ml.disabled(M);try{for(var Et=(y=void 0,t.__values(C[D.getId()])),Lt=Et.next();!Lt.done;Lt=Et.next()){var kt=Lt.value,It=(it=kt.renderable,ot=kt.posMatrix,kt.tileUnitsPerPixel);at=kt.stencilModeForClipping,it.outlineRenderable&&(lt=A?at:J,this._drawPolygonOutline(P,x,{colorMode:W,depthMode:H,stencilMode:lt,cullFaceMode:Y},it.outlineRenderable,ot,_t,tt,1/It,St*t.getLineDensity()*2,Z))}}catch(t){y={error:t}}finally{try{Lt&&!Lt.done&&(g=Et.return)&&g.call(Et)}finally{if(y)throw y.error}}}}}catch(t){p={error:t}}finally{try{Mt&&!Mt.done&&(d=wt.return)&&d.call(wt)}finally{if(p)throw p.error}}},e.prototype._drawPolygon=function(t,e,r,n,i,o,a,s){t.draw(e,e.gl.TRIANGLES,r,n.vertexBuffer,n.indexBuffer,n.segments,{uMatrix:i,uColor:o,uOpacity:a},s)},e.prototype._drawPolygonOutline=function(t,e,r,n,i,o,a,s,l,u){t.draw(e,e.gl.TRIANGLES,r,n.vertexBuffer,n.indexBuffer,n.segments,{uMatrix:i,uColor:o,uOpacity:a,uWidth:l,uRatio:s,uOffset:0},u)},e.prototype._drawPatternPolygon=function(e,r,n,i,o,a,s,l,u,h,c,f,p){var d=t.__read(l,2),y=d[0],g=d[1];e.draw(r,r.gl.TRIANGLES,n,i.vertexBuffer,i.indexBuffer,i.segments,{uMatrix:o,uPixelCoordUpper:[y>>16,g>>16],uPixelCoordLower:[65535&y,65535&g],uImage:0,uImageSize:s,uPatternPosition:i.patternPosition,uRatio:[u,h,c],uFade:f,uPixelRatio:i.patternPixelRatio,uOpacity:a},p)},e}(),pu=fu,du=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m=e.context,b=e.transform,x=m.gl,w=e.useProgram("line"),M=e.useProgram("dashedLine"),S=r.source,P=r.cachedTiles,T=r.stack,E=r.stackStyle,L=r.needClippingMask,k={};try{for(var I=t.__values(E.getStyles()),A=I.next();!A.done;A=I.next()){var C=A.value,O=[];try{for(var R=(o=void 0,t.__values(P)),D=R.next();!D.done;D=R.next()){var F=D.value,B=F.tileId,N=F.styleDataMap.get(T.getId(),C.getId());(et=N&&N.getRenderable())&&O.push({posMatrix:S.getPositionMatrix(b,B),tileUnitsPerPixel:S.getTileUnitsPerPixel(b,B),renderable:et,stencilModeForClipping:e.getStencilModeForClipping(B)})}}catch(t){o={error:t}}finally{try{D&&!D.done&&(a=R.return)&&a.call(R)}finally{if(o)throw o.error}}k[C.getId()]=O}}catch(t){n={error:t}}finally{try{A&&!A.done&&(i=I.return)&&i.call(I)}finally{if(n)throw n.error}}var z="".concat(T.getId()),U=e.getColorMode(),j=xl.disabled(x),V=jl.disabled(x);try{for(var G=t.__values(E.getStyles()),q=G.next();!q.done;q=G.next()){var Z=(C=q.value).getGeomPaint();if(!t.isDisplayOff(Z.display)){var W=t.getColorAndOpacity(null!==(y=Z.stroke)&&void 0!==y?y:t.DEFAULT_STROKE_COLOR,null!==(g=Z["stroke-opacity"])&&void 0!==g?g:t.DEFAULT_STROKE_OPACITY),H=W.color,Y=W.opacity,X=t.toFloat(Z.buffer,t.DEFAULT_BUFFER),K=t.toFloat(Z["stroke-width"],t.DEFAULT_STROKE_WIDTH),Q=Z["stroke-dasharray"]?2*K+X:K;try{for(var J=(u=void 0,t.__values(k[C.getId()])),$=J.next();!$.done;$=J.next()){var tt=$.value,et=tt.renderable,rt=tt.posMatrix,nt=tt.tileUnitsPerPixel,it=tt.stencilModeForClipping,ot=L?it:Ml.disabled(x);w.draw(m,m.gl.TRIANGLES,{colorMode:U,depthMode:j,stencilMode:ot,cullFaceMode:V},et.vertexBuffer,et.indexBuffer,et.segments,{uMatrix:rt,uColor:H,uOpacity:Y,uWidth:Q*t.getLineDensity(),uRatio:1/nt,uOffset:0},z)}}catch(t){u={error:t}}finally{try{$&&!$.done&&(h=J.return)&&h.call(J)}finally{if(u)throw u.error}}}}}catch(t){s={error:t}}finally{try{q&&!q.done&&(l=G.return)&&l.call(G)}finally{if(s)throw s.error}}try{for(var at=t.__values(E.getStyles()),st=at.next();!st.done;st=at.next()){Z=(C=st.value).getGeomPaint();var lt=t.toArray(Z["stroke-dasharray"]).map((function(e){return e*t.getLineDensity()}));if(!t.isDisplayOff(Z.display)&&0!==lt.length){var ut=t.getColorAndOpacity(null!==(v=Z.fill)&&void 0!==v?v:t.DEFAULT_FILL_COLOR,null!==(_=Z["fill-opacity"])&&void 0!==_?_:t.DEFAULT_FILL_OPACITY);H=ut.color,Y=ut.opacity,X=t.toFloat(Z.buffer,t.DEFAULT_BUFFER);try{for(var ht=(p=void 0,t.__values(k[C.getId()])),ct=ht.next();!ct.done;ct=ht.next()){var ft=ct.value,pt=(et=ft.renderable,rt=ft.posMatrix,nt=ft.tileUnitsPerPixel,it=ft.stencilModeForClipping,1/nt),dt=e.lineAtlas,yt=dt.getDash(lt,!1);yt&&(dt.bind(),ot=L?it:Ml.disabled(x),M.draw(m,m.gl.TRIANGLES,{colorMode:U,depthMode:j,stencilMode:ot,cullFaceMode:V},et.vertexBuffer,et.indexBuffer,et.segments,{uMatrix:rt,uColor:H,uOpacity:Y,uWidth:X*t.getLineDensity(),uRatio:pt,uOffset:0,uPatternScale:[pt/yt.width,-yt.height/2],uSdfGamma:dt.width/(256*yt.width*t.browser.devicePixelRatio)/2,uImage:0,uTextureY:yt.y},z))}}catch(t){p={error:t}}finally{try{ct&&!ct.done&&(d=ht.return)&&d.call(ht)}finally{if(p)throw p.error}}}}}catch(t){c={error:t}}finally{try{st&&!st.done&&(f=at.return)&&f.call(at)}finally{if(c)throw c.error}}},e}(),yu=du,gu=function(){function e(){}return e.prototype.draw=function(e,r){var n,i=e.context,o=e.transform,a=e.rasterFrame,s=i.gl,l=e.useProgram("raster"),u=r.source,h=r.cachedTiles,c=r.stack,f=r.stackStyle,p=[0,0,0,0],d=0;if(c!==t.Stack.DUMMY){var y=f.getStyles()[0],g=y&&y.getGeomPaint();if(t.isDisplayOff(g.display))return;if(g.fill){var v=t.__read(t.toGLColor(g.fill),4),_=v[0],m=v[1],b=v[2],x=v[3],w=t.toFloat(null!==(n=g["fill-opacity"])&&void 0!==n?n:0);p=[_,m,b,1],d=1===x?w:0===w?x:x*w}}var M={colorMode:e.getColorMode(),depthMode:xl.disabled(s),stencilMode:Ml.disabled(s),cullFaceMode:jl.disabled(s)};h.forEach((function(t){var e=t.tileId,r=t.styleDataMap,n=t.tileCompositeData,h=r.get(),c=h.getRenderable(),f=n,y=f.texture,g=f.textureOptions;if(h&&c&&y){var v=c.transform,_=v.origin,m=v.scale,b=u.getPositionMatrix(o,e),x=Es();vs(x,b,[_.x,_.y,0]),_s(x,x,[m.x,m.y,1]),y.bind({filter:s.LINEAR,minFilter:g.useMipmap?s.LINEAR_MIPMAP_NEAREST:s.LINEAR,wrap:s.CLAMP_TO_EDGE}),l.draw(i,s.TRIANGLES,M,a.vertexBuffer,a.indexBuffer,a.segments,{uMatrix:x,uImage:0,uFilterColor:p,uFilterOpacity:d},"$$raster")}}))},e}(),vu=gu,_u=function(t,e,r){var n=Ms([],[e.x,e.y,0,1],t);return{x:(n[0]/n[3]+1)/2*r.getWidth(),y:(-n[1]/n[3]+1)/2*r.getHeight()}},mu=function(e){for(var r=0,n=[{point:e[0],segLen:0,accLen:0}],i=1;i<e.length;i++){var o=t.distance(e[i-1],e[i]);r+=o,n.push({point:e[i],segLen:o,accLen:r})}return n},bu=function(e,r){if(0===r)return e;for(var n=[],i=0;i<e.length;i++){var o=e[i-1],a=e[i],s=e[i+1],l=0===i?{x:0,y:0}:t.perpendicular(t.normalize(t.subtract(a,o))),u=i===e.length-1?{x:0,y:0}:t.perpendicular(t.normalize(t.subtract(s,a))),h=t.normalize(t.add(l,u)),c=t.add(t.multiply(h,r),a);n.push(c)}return n},xu=function(t,e,r,n){for(var i=n>0,o=i?1:-1,a=!1,s=0,l=0,u=i?0:t.length-2,h=i?t.length-1:-1,c=t[e].accLen+t[e+1].segLen*r+n;u!==h;){var f=t[u].accLen,p=t[u+1].accLen;if(f<=c&&c<=p){s=u,l=(c-f)/t[u+1].segLen,a=!0;break}u+=o}return[a,s,l]},wu=function(e,r,n){var i=e[r].point,o=e[r+1].point;return t.add(i,t.multiply(t.subtract(o,i),n))},Mu=function(e,r,n,i,o,a,s,l,u,h){var c,f=0,p=e.topLeft,d=p.x,y=p.y,g=e.bottomRight,v=g.x,_=g.y,m=d*r*n,b=v*r*n,x=(m+b)/2,w=t.__read(xu(o,a,s,m),3),M=w[0],S=w[1],P=w[2],T=t.__read(xu(o,a,s,b),3),E=T[0],L=T[1],k=T[2];if(!M||!E)throw"overflow";var I=t.__read(xu(o,a,s,x),3),A=I[1],C=I[2],O=wu(o,S,P),R=wu(o,L,k),D=wu(o,A,C);i&&(O=(c=t.__read([R,O],2))[0],R=c[1],f+=Math.PI);var F=f+t.angleWithX(t.normalize(t.subtract(O,R))),B={x:(d+v)/2,y:(y+_)/2},N=function(e,r,n,i,o,a){var s=n.topLeft,l=s.x,u=s.y,h=n.bottomRight,c={x:(l+h.x)/2*i,y:(u+h.y)/2*i},f=_u(o,e,a),p=t.subtract(f,r);return t.add(c,p)}(l,D,e,r,u,h),z=function(e){var n=t.subtract(B,e),i=t.rotate(n,F),o=t.add(B,i);return t.subtract(o,t.multiply(N,1/r))};return{topLeft:z(e.topLeft),topRight:z(e.topRight),bottomLeft:z(e.bottomLeft),bottomRight:z(e.bottomRight),texture:e.texture}},Su=function(e,r,n,i,o,a,s,l,u,h){for(var c,f,p,d,y,g=[],v=null,_=function(e,r,n){var i,o,a=[],s=function(t){return(t.topLeft.y+t.bottomRight.y)/2};if(r){var l=s(r),u=r.bottomRight.x-r.topLeft.x;a.push({y:l,w:u,iconQuad:r,textQuads:[]})}if(e.length){var h=[[]],c=[],f=h[0],p=s(e[0]);try{for(var d=t.__values(e),y=d.next();!y.done;y=d.next()){var g=y.value;(l=s(g))>p+t.DEFAULT_FONT_LINE_HEIGHT-2&&(c.push(p),f=[],h.push(f),p=l),f.push(g)}}catch(t){i={error:t}}finally{try{y&&!y.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}c.push(p);for(var v=0;v<h.length;v++){var _=t.__spreadArray([],t.__read(h[v]),!1),m=0,b=0;_.length&&(m=_[0].topLeft.x,b=_[_.length-1].bottomRight.x);var x=(b-m)*n;a.push({y:c[v],w:x,iconQuad:null,textQuads:_})}}return a}(r,n,u),m=e.map((function(t){return _u(i,t,o)})),b=!1,x=!1,w=1,M=0;M<_.length;M++){var S=_[M],P=S.w,T=S.y,E=S.iconQuad,L=S.textQuads,k=bu(m,T*(E?1:u)),I=mu(k),A=t.__read(xu(I,s,l,-P/2),3),C=A[0],O=A[1],R=A[2],D=t.__read(xu(I,s,l,P/2),3),F=D[0],B=D[1],N=D[2];if(!C||!F){b=!0;break}if(0===M)p=wu(I,O,R),d=wu(I,B,N),void 0,y=t.normalize(t.subtract(d,p)),x=t.dot({x:1,y:0},y)<=0,w=h&&x?-1:1;try{if(E&&(v=V=Mu(E,1,w,x,I,s,l,a,i,o)),L.length)try{for(var z=(c=void 0,t.__values(L)),U=z.next();!U.done;U=z.next()){var j=U.value,V=Mu(j,u,w,x,I,s,l,a,i,o);g.push(V)}}catch(t){c={error:t}}finally{try{U&&!U.done&&(f=z.return)&&f.call(z)}finally{if(c)throw c.error}}}catch(t){b=!0}}return b?{updatedTextQuads:[],updatedIconQuad:null}:{updatedTextQuads:g,updatedIconQuad:v}},Pu=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p=e.context,d=e.transform,y=e.fadeChange,g=e.options,v=p.gl,_=r.source,m=r.cachedTiles,b=r.stack,x=r.stackStyle,w={};try{for(var M=t.__values(x.getStyles()),S=M.next();!S.done;S=M.next()){var P=S.value,T=[];try{for(var E=(o=void 0,t.__values(m)),L=E.next();!L.done;L=E.next()){var k=L.value,I=k.tileId,A=k.styleDataMap,C=k.tileCompositeData,O=A.get(b.getId(),P.getId());if(O){var R=O.getRenderable();if(R&&R.getInfoArray().some((function(t){return t.levelFilter.evaluate(_.getStyleLevel(d.getZoom()))}))){var D=C;T.push({posMatrix:_.getPositionMatrix(d,I),tileUnitsPerPixel:_.getTileUnitsPerPixel(d,I),renderable:R,glyphAtlasTexture:D.getGlyphAtlasTexture(p),iconAtlasTexture:D.getIconAtlasTexture(p)})}}}}catch(t){o={error:t}}finally{try{L&&!L.done&&(a=E.return)&&a.call(E)}finally{if(o)throw o.error}}w[P.getId()]=T}}catch(t){n={error:t}}finally{try{S&&!S.done&&(i=M.return)&&i.call(M)}finally{if(n)throw n.error}}var F="".concat(b.getId()),B={colorMode:e.getColorMode(),depthMode:e.getDepthMode(0,!1),stencilMode:Ml.disabled(v),cullFaceMode:jl.disabled(v)};try{for(var N=t.__values(x.getStyles()),z=N.next();!z.done;z=N.next()){T=w[(P=z.value).getId()];var U=P.getIconPaint(),j=P.getLabelPaint(),V=P.getPoiPaint(),G=U&&!t.isDisplayOff(U.display),q=j&&!t.isDisplayOff(j.display),Z=t.getRotationAlignment(V,t.GeometryConversionType.RoadName);if((G||q)&&Z===t.Alignment.Map&&this._updateOffset(p,d,T,g.showCollisionDetection),G&&this._drawPois(e,T,!1,{},B,y,F),q){var W=t.getColorAndOpacity(null!==(u=j.fill)&&void 0!==u?u:t.DEFAULT_FILL_COLOR,null!==(h=j["fill-opacity"])&&void 0!==h?h:t.DEFAULT_FILL_OPACITY),H=W.color,Y=W.opacity,X=t.getColorAndOpacity(null!==(c=j.stroke)&&void 0!==c?c:t.DEFAULT_LABEL_STROKE_COLOR,null!==(f=j["stroke-opacity"])&&void 0!==f?f:t.DEFAULT_LABEL_STROKE_OPACITY),K={fillColor:H,fillOpacity:Y,strokeColor:X.color,strokeOpacity:X.opacity,strokeWidth:t.toFloat(j["stroke-width"],t.DEFAULT_LABEL_STROKE_WIDTH),fontWeight:t.getFontWeight(j["font-weight"])};this._drawPois(e,T,!0,K,B,y,F)}}}catch(t){s={error:t}}finally{try{z&&!z.done&&(l=N.return)&&l.call(N)}finally{if(s)throw s.error}}g.showCollisionDetection&&this._drawDebugBox(e,r,w),g.showPoiVertex&&this._drawDebugPoint(e,r,w),g.showNetwork&&this._drawNetwork(e,r,w)},e.prototype._updateOffset=function(e,r,n,i){var o,a,s,l,u=function(t,e){e.forEach((function(e){t.push(Math.round(32*e.x),Math.round(32*e.y))}))};try{for(var h=t.__values(n),c=h.next();!c.done;c=h.next()){var f=c.value,p=f.renderable,d=f.posMatrix,y=new t.PoiOffsetArrayBuilder,g=new t.PoiOffsetArrayBuilder,v=function(e){var n,i,o=e.textQuads,a=e.iconQuad,s=e.fontSize,l=e.vertices,h=e.anchorIdx,c=e.anchorT,f=e.anchor,p=e.keepUpright,v=s/t.DEFAULT_SDF_SIZE,_=Su(l,o,a,d,r,f,h,c,v,p),m=_.updatedTextQuads,b=_.updatedIconQuad;m.length?(e.updatedTextQuads=m,e.textCollisionBoxes=m.map((function(e){var r=t.getPoiQuadBBox(e);return{minX:r.minX*v,maxX:r.maxX*v,minY:r.minY*v,maxY:r.maxY*v}}))):(e.updatedTextQuads=o.map((function(t){return{topLeft:{x:0,y:0},topRight:{x:0,y:0},bottomLeft:{x:0,y:0},bottomRight:{x:0,y:0},texture:t.texture}})),e.textCollisionBoxes=null),b?(e.updatedIconQuad=b,e.iconCollisionBox=t.getPoiQuadBBox(b)):(e.updatedIconQuad=null,e.iconCollisionBox=null);var x=e.glyphVerticesLength>0,w=e.iconVerticesLength>0;if(x)try{for(var M=(n=void 0,t.__values(e.updatedTextQuads)),S=M.next();!S.done;S=M.next()){var P=S.value,T=P.topLeft,E=P.topRight,L=P.bottomLeft,k=P.bottomRight;u(y,[T,E,L,k])}}catch(t){n={error:t}}finally{try{S&&!S.done&&(i=M.return)&&i.call(M)}finally{if(n)throw n.error}}if(w&&e.updatedIconQuad){var I=e.updatedIconQuad;T=I.topLeft,E=I.topRight,L=I.bottomLeft,k=I.bottomRight,u(g,[T,E,L,k])}};try{for(var _=(s=void 0,t.__values(p.getInfoArray())),m=_.next();!m.done;m=_.next())v(m.value)}catch(t){s={error:t}}finally{try{m&&!m.done&&(l=_.return)&&l.call(_)}finally{if(s)throw s.error}}p.text.offsetBuffer.updateData(y.build()),p.icon.offsetBuffer.updateData(g.build()),i&&p.updateCollisionBox(e)}}catch(t){o={error:t}}finally{try{c&&!c.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}},e.prototype._drawNetwork=function(e,r,n){var i,o,a,s,l=e.context,u=l.gl,h=r.stack,c=r.stackStyle,f=e.useProgram("network"),p="".concat(h.getId()),d={colorMode:e.getColorMode(),depthMode:xl.disabled(u),stencilMode:Ml.disabled(u),cullFaceMode:jl.disabled(u)};try{for(var y=t.__values(c.getStyles()),g=y.next();!g.done;g=y.next()){var v=g.value;try{for(var _=(a=void 0,t.__values(n[v.getId()])),m=_.next();!m.done;m=_.next()){var b=m.value,x=b.renderable,w=b.posMatrix;f.draw(l,u.LINES,d,x.network.vertexBuffer,x.network.indexBuffer,x.network.segments,{uMatrix:w},p)}}catch(t){a={error:t}}finally{try{m&&!m.done&&(s=_.return)&&s.call(_)}finally{if(a)throw a.error}}}}catch(t){i={error:t}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}},e.prototype._drawDebugPoint=function(e,r,n){var i,o,a,s,l=e.context,u=l.gl,h=r.stackStyle,c=e.useProgram("point"),f={colorMode:e.getColorMode(),depthMode:xl.disabled(u),stencilMode:Ml.disabled(u),cullFaceMode:jl.disabled(u)},p=t.getDensity(!0);try{for(var d=t.__values(h.getStyles()),y=d.next();!y.done;y=d.next()){var g=y.value;try{for(var v=(a=void 0,t.__values(n[g.getId()])),_=v.next();!_.done;_=v.next()){var m=_.value,b=m.renderable,x=m.posMatrix;c.drawPoints(l,f,b.text.vertexBuffer,{uMatrix:x,uColor:[1,0,0,1],uSize:6*p}),c.drawPoints(l,f,b.icon.vertexBuffer,{uMatrix:x,uColor:[1,0,0,1],uSize:6*p})}}catch(t){a={error:t}}finally{try{_&&!_.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}}}catch(t){i={error:t}}finally{try{y&&!y.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}},e.prototype._drawPois=function(e,r,n,i,o,a,s){var l,u,h=this,c=e.context,f=e.transform,p=c.gl,d=e.useProgram("poiText"),y=e.useProgram("poiIcon"),g=function(e,r,l,u,g){var _=n?u:g;if(!_)return"continue";var m=gs(Ts(),f.getLabelPlaneMatrix(),r),b=f.getGlCoordMatrix(),x=Ts();ys(x),_s(x,x,[1/l,1/l,1]);var w=ds(r);_s(w,w,[l,l,1]),_.bind({filter:p.LINEAR,wrap:p.CLAMP_TO_EDGE});var M=n?e.text:e.icon,S={uMatrix:r,uLabelPlaneMatrix:m,uGlCoordMatrix:b,uLabelPlaneMatrix2:x,uGlCoordMatrix2:w,uImage:0,uImageSize:[_.width,_.height],uFadeChange:a,uRotate:f.getAngle()};if(n){var P=i,T=function(r){var n=t.__assign(t.__assign({},S),{uColor:P.fillColor,uOpacity:r?P.strokeOpacity:P.fillOpacity,uHalo:r,uHaloColor:P.strokeColor,uHaloWidth:P.strokeWidth*t.getLineDensity(),uFontSize:e.fontSize,uFontWeight:P.fontWeight,uGammaScale:Math.cos(t.toRadian(f.getPitch()))*f.getCameraToCenterDistance(),uDevicePixelRatio:t.browser.devicePixelRatio});h._drawPart(d,c,o,M,n,s)};P.strokeWidth>0&&P.strokeOpacity>0&&T(!0),T(!1)}else{var E=t.__assign(t.__assign({},S),{uOpacity:1});v._drawPart(y,c,o,M,E,s)}},v=this;try{for(var _=t.__values(r),m=_.next();!m.done;m=_.next()){var b=m.value;g(b.renderable,b.posMatrix,b.tileUnitsPerPixel,b.glyphAtlasTexture,b.iconAtlasTexture)}}catch(t){l={error:t}}finally{try{m&&!m.done&&(u=_.return)&&u.call(_)}finally{if(l)throw l.error}}},e.prototype._drawPart=function(t,e,r,n,i,o){t.draw(e,e.gl.TRIANGLES,r,n.vertexBuffer,n.indexBuffer,n.segments,i,o,[n.opacityBuffer,n.offsetBuffer])},e.prototype._drawDebugBox=function(e,r,n){var i,o,a,s,l=e.context,u=e.transform,h=l.gl,c=e.useProgram("collisionBox"),f=r.stack,p=r.stackStyle,d={colorMode:e.getColorMode(),depthMode:xl.disabled(h),stencilMode:Ml.disabled(h),cullFaceMode:jl.disabled(h)},y="".concat(f.getId());try{for(var g=t.__values(p.getStyles()),v=g.next();!v.done;v=g.next()){var _=v.value;try{for(var m=(a=void 0,t.__values(n[_.getId()])),b=m.next();!b.done;b=m.next()){var x=b.value,w=x.renderable,M=x.posMatrix,S=w.getCollisionBox(l);S&&c.draw(l,h.LINES,d,S.vertexBuffer,S.indexBuffer,S.segments,{uMatrix:M,uExtrudeScale:[2/u.getWidth(),-2/u.getHeight()],uPlacedColor:[0,0,.3,.3],uNotPlacedColor:[.25,0,0,.25]},y,[S.collisionBuffer])}}catch(t){a={error:t}}finally{try{b&&!b.done&&(s=m.return)&&s.call(m)}finally{if(a)throw a.error}}}}catch(t){i={error:t}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}},e}(),Tu=Pu,Eu=function(){function e(){}return e.prototype.draw=function(e,r){var n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m=e.context,b=e.transform,x=m.gl,w=e.useProgram("line"),M=r.source,S=r.cachedTiles,P=r.stack,T=r.stackStyle,E=r.needClippingMask,L={};try{for(var k=t.__values(T.getStyles()),I=k.next();!I.done;I=k.next()){var A=I.value,C=[];try{for(var O=(o=void 0,t.__values(S)),R=O.next();!R.done;R=O.next()){var D=R.value,F=D.tileId,B=D.styleDataMap.get(P.getId(),A.getId());(tt=B&&B.getRenderable())&&C.push({posMatrix:M.getPositionMatrix(b,F),tileUnitsPerPixel:M.getTileUnitsPerPixel(b,F),renderable:tt,stencilModeForClipping:e.getStencilModeForClipping(F)})}}catch(t){o={error:t}}finally{try{R&&!R.done&&(a=O.return)&&a.call(O)}finally{if(o)throw o.error}}L[A.getId()]=C}}catch(t){n={error:t}}finally{try{I&&!I.done&&(i=k.return)&&i.call(k)}finally{if(n)throw n.error}}var N="".concat(P.getId()),z=T.isTranslucent()?e.getColorMode():ml.unblended(x),U=xl.disabled(x),j=jl.disabled(x),V=new Ml(x.ALWAYS,8,255,255,x.REPLACE,x.REPLACE,x.REPLACE),G=new Ml(x.NOTEQUAL,8,255,255,x.KEEP,x.KEEP,x.KEEP);try{for(var q=t.__values(T.getStyles()),Z=q.next();!Z.done;Z=q.next()){var W=(A=Z.value).getGeomPaint();if(!t.isDisplayOff(W.display)){var H=t.getColorAndOpacity(null!==(y=W.fill)&&void 0!==y?y:t.DEFAULT_FILL_COLOR,null!==(g=W["fill-opacity"])&&void 0!==g?g:t.DEFAULT_FILL_OPACITY),Y=H.color,X=H.opacity,K=t.toFloat(W.buffer,t.DEFAULT_BUFFER);try{for(var Q=(u=void 0,t.__values(L[A.getId()])),J=Q.next();!J.done;J=Q.next()){var $=J.value,tt=$.renderable,et=$.posMatrix,rt=$.tileUnitsPerPixel,nt=$.stencilModeForClipping,it=E?new Ml(x.EQUAL,128|nt.funcRef,127,255,x.KEEP,x.KEEP,x.REPLACE):V;this._drawLine(w,m,{colorMode:z,depthMode:U,stencilMode:it,cullFaceMode:j},tt,et,Y,X,K*t.getLineDensity(),1/rt,N)}}catch(t){u={error:t}}finally{try{J&&!J.done&&(h=Q.return)&&h.call(Q)}finally{if(u)throw u.error}}}}}catch(t){s={error:t}}finally{try{Z&&!Z.done&&(l=q.return)&&l.call(q)}finally{if(s)throw s.error}}try{for(var ot=t.__values(T.getStyles()),at=ot.next();!at.done;at=ot.next()){W=(A=at.value).getGeomPaint();var st=t.toFloat(W["stroke-width"],t.DEFAULT_STROKE_WIDTH);if(!(t.isDisplayOff(W.display)||st<=0)){var lt=t.getColorAndOpacity(null!==(v=W.stroke)&&void 0!==v?v:t.DEFAULT_STROKE_COLOR,null!==(_=W["stroke-opacity"])&&void 0!==_?_:t.DEFAULT_STROKE_OPACITY);Y=lt.color,X=lt.opacity,K=t.toFloat(W.buffer,t.DEFAULT_BUFFER)+2*st;try{for(var ut=(p=void 0,t.__values(L[A.getId()])),ht=ut.next();!ht.done;ht=ut.next()){var ct=ht.value;tt=ct.renderable,et=ct.posMatrix,rt=ct.tileUnitsPerPixel,nt=ct.stencilModeForClipping,it=E?nt:G,this._drawLine(w,m,{colorMode:z,depthMode:U,stencilMode:it,cullFaceMode:j},tt,et,Y,X,K*t.getLineDensity(),1/rt,N)}}catch(t){p={error:t}}finally{try{ht&&!ht.done&&(d=ut.return)&&d.call(ut)}finally{if(p)throw p.error}}}}}catch(t){c={error:t}}finally{try{at&&!at.done&&(f=ot.return)&&f.call(ot)}finally{if(c)throw c.error}}},e.prototype._drawLine=function(t,e,r,n,i,o,a,s,l,u){t.draw(e,e.gl.TRIANGLES,r,n.vertexBuffer,n.indexBuffer,n.segments,{uMatrix:i,uColor:o,uOpacity:a,uWidth:s,uRatio:l,uOffset:0},u)},e}(),Lu=Eu,ku="#define GLSLIFY 1\n#if !defined(GL_ES)\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n#define SDF_PIXEL 8.0\n#define SDF_FONT_SIZE 24.0\n",Iu="#define GLSLIFY 1\nbool isTrue(float value){return value>0.5;}bool isFalse(float value){return value<0.5;}float conditional(bool condition,float exprIfTrue,float exprIfFalse){if(condition){return exprIfTrue;}else{return exprIfFalse;}}vec4 conditional(bool condition,vec4 exprIfTrue,vec4 exprIfFalse){if(condition){return exprIfTrue;}else{return exprIfFalse;}}mat4 conditional(bool condition,mat4 exprIfTrue,mat4 exprIfFalse){if(condition){return exprIfTrue;}else{return exprIfFalse;}}";function Au(t,e){return{fragmentSource:Cu(ku,"precision mediump float;\n#define GLSLIFY 1\n",Iu,t),vertexSource:Cu(ku,"precision highp float;\n#define GLSLIFY 1\nvec2 unpackOpacity(float value){return vec2(float(int(value)/2)/127.0,mod(value,2.0));}",Iu,e)}}function Cu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.join("\n")}var Ou,Ru,Du=Au("precision mediump float;\n#define GLSLIFY 1\nvoid main(){gl_FragColor=vec4(1.0);}","#define GLSLIFY 1\nuniform mat4 uMatrix;attribute vec2 aPosition;void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);}"),Fu=Au("#define GLSLIFY 1\nuniform highp vec4 uColor;uniform lowp float uOpacity;void main(){gl_FragColor=uColor*uOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;attribute vec2 aPosition;void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);}"),Bu=Au("#define GLSLIFY 1\nvarying highp vec4 vColor;uniform lowp float uOpacity;void main(){gl_FragColor=vColor*uOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform highp float uHeightScale;uniform highp vec4 uColor;uniform bool uLightEnabled;uniform lowp vec3 uLightDirection;uniform lowp float uLightIntensity;attribute vec3 aPosition;attribute vec3 aNormal;varying highp vec4 vColor;void main(){highp float lightValue;if(uLightEnabled){lightValue=dot(aNormal/16384.0,uLightDirection);lightValue=(clamp(lightValue,-1.0,1.0)+1.0)/2.0;lightValue=1.0-(1.0-lightValue)*uLightIntensity;}else{lightValue=1.0;}gl_Position=uMatrix*vec4(aPosition.xy,aPosition.z*uHeightScale,1.0);vColor=vec4(uColor.rgb*lightValue,uColor.a);}"),Nu=Au("#define GLSLIFY 1\nuniform highp vec4 uColor;uniform lowp float uOpacity;void main(){gl_FragColor=uColor*uOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform float uWidth;uniform float uRatio;uniform float uOffset;attribute vec2 aPosition;attribute vec4 aData;void main(){vec2 extrude=(aData.xy-128.0)/63.0;vec2 normal=vec2(floor(aData.z/2.0),mod(aData.z,2.0)*2.0-1.0);float direction=aData.w-1.0;float halfWidth=uWidth/2.0;float outset=conditional(halfWidth==0.0,0.0,max(halfWidth,uRatio));float u=direction/2.0;float t=1.0-abs(u);vec2 offset=-uOffset*extrude*normal.y*mat2(t,-u,u,t);vec4 projected=uMatrix*vec4(outset*extrude/uRatio,0.0,0.0);gl_Position=uMatrix*vec4(aPosition+offset/uRatio,0.0,1.0)+projected;}"),zu=Au("#define GLSLIFY 1\nuniform sampler2D uImage;uniform float uSdfGamma;uniform highp vec4 uColor;uniform lowp float uOpacity;varying vec2 vTexturePosition;void main(){float distance=texture2D(uImage,vTexturePosition).a;float alpha=smoothstep(0.5-uSdfGamma,0.5+uSdfGamma,distance);gl_FragColor=uColor*alpha*uOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform float uWidth;uniform float uRatio;uniform float uOffset;uniform vec2 uPatternScale;uniform float uTextureY;attribute vec2 aPosition;attribute vec4 aData;attribute float aDistance;varying vec2 vTexturePosition;void main(){vec2 extrude=(aData.xy-128.0)/63.0;vec2 normal=vec2(floor(aData.z/2.0),mod(aData.z,2.0)*2.0-1.0);float direction=aData.w-1.0;float halfWidth=uWidth/2.0;float outset=conditional(halfWidth==0.0,0.0,max(halfWidth,uRatio));float u=direction/2.0;float t=1.0-abs(u);vec2 offset=-uOffset*extrude*normal.y*mat2(t,-u,u,t);vec4 projected=uMatrix*vec4(outset*extrude/uRatio,0.0,0.0);gl_Position=uMatrix*vec4(aPosition+offset/uRatio,0.0,1.0)+projected;vTexturePosition=vec2(aDistance*uPatternScale.x,normal.y*uPatternScale.y+uTextureY);}"),Uu=Au("#define GLSLIFY 1\nuniform sampler2D uImage;uniform highp vec4 uColor;uniform lowp float uOpacity;uniform bool uHalo;uniform highp vec4 uHaloColor;uniform lowp float uHaloWidth;uniform highp float uGammaScale;uniform lowp float uDevicePixelRatio;uniform lowp float uFontWeight;varying vec2 vTexturePosition;varying float vGammaScale;varying float vSize;varying float vFadeOpacity;varying lowp float vPitchWithMap;vec4 getColor(){return conditional(uHalo,uHaloColor,uColor);}float getGamma(float fontScale){float edgeGamma=0.105/uDevicePixelRatio;float divider=fontScale*conditional(isTrue(vPitchWithMap),uGammaScale,1.0);return conditional(uHalo,(1.19/SDF_PIXEL+edgeGamma)/divider,edgeGamma/divider);}float getBuffer(float fontScale){return conditional(uHalo,(6.0-uHaloWidth/fontScale)/SDF_PIXEL,(256.0-64.0)/256.0);}void main(){float fontScale=vSize/SDF_FONT_SIZE;vec4 color=getColor();float gamma=getGamma(fontScale);float buf=getBuffer(fontScale);float distance=texture2D(uImage,vTexturePosition).a;float gammaScaled=gamma*vGammaScale;float alpha=smoothstep(buf-gammaScaled-(0.01*uFontWeight),buf+gammaScaled-(0.01*uFontWeight),distance);gl_FragColor=color*alpha*uOpacity*vFadeOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform mat4 uLabelPlaneMatrix;uniform mat4 uGlCoordMatrix;uniform mat4 uLabelPlaneMatrix2;uniform mat4 uGlCoordMatrix2;uniform vec2 uImageSize;uniform float uFontSize;uniform float uFadeChange;uniform float uRotate;attribute vec2 aPosition;attribute vec2 aOffset;attribute vec2 aTexturePosition;attribute float aPitchWithMap;attribute float aRotateWithMap;attribute float aFadeOpacity;varying vec2 vTexturePosition;varying float vGammaScale;varying float vSize;varying float vFadeOpacity;varying float vPitchWithMap;mat4 getLabelPlaneMatrix(){return conditional(isFalse(aPitchWithMap),uLabelPlaneMatrix,uLabelPlaneMatrix2);}mat4 getGlCoordMatrix(){return conditional(isFalse(aPitchWithMap),uGlCoordMatrix,uGlCoordMatrix2);}mat2 getRotateMatrix(){if(isTrue(aPitchWithMap)){if(isTrue(aRotateWithMap)){return mat2(1.0,0.0,0.0,-1.0);}else{float cos=cos(uRotate);float sin=sin(uRotate);return mat2(1.0,0.0,0.0,-1.0)*mat2(cos,-sin,sin,cos);}}else{return mat2(1.0,0.0,0.0,1.0);}}void main(){float size=uFontSize;float fontScale=size/SDF_FONT_SIZE;mat4 labelPlaneMatrix=getLabelPlaneMatrix();mat4 glCoordMatrix=getGlCoordMatrix();mat2 rotateMatrix=getRotateMatrix();vec4 projectedPos=labelPlaneMatrix*vec4(aPosition,0.0,1.0);gl_Position=glCoordMatrix*vec4(projectedPos.xy/projectedPos.w+rotateMatrix*(aOffset/32.0*fontScale),0.0,1.0);vTexturePosition=aTexturePosition/uImageSize;vGammaScale=gl_Position.w;vSize=size;vec2 unpackedOpacity=unpackOpacity(aFadeOpacity);float fadeChange=conditional(unpackedOpacity[1]>0.0,uFadeChange,-uFadeChange);vFadeOpacity=max(0.0,min(unpackedOpacity[0]+fadeChange,1.0));vPitchWithMap=aPitchWithMap;}"),ju=Au("#define GLSLIFY 1\nuniform sampler2D uImage;uniform lowp float uOpacity;varying vec2 vTexturePosition;varying float vFadeOpacity;void main(){gl_FragColor=texture2D(uImage,vTexturePosition)*uOpacity*vFadeOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform mat4 uLabelPlaneMatrix;uniform mat4 uGlCoordMatrix;uniform mat4 uLabelPlaneMatrix2;uniform mat4 uGlCoordMatrix2;uniform highp vec2 uImageSize;uniform float uFadeChange;uniform highp float uRotate;attribute vec2 aPosition;attribute vec2 aOffset;attribute vec2 aTexturePosition;attribute float aPitchWithMap;attribute float aRotateWithMap;attribute float aFadeOpacity;varying vec2 vTexturePosition;varying float vFadeOpacity;mat4 getLabelPlaneMatrix(){return conditional(isFalse(aPitchWithMap),uLabelPlaneMatrix,uLabelPlaneMatrix2);}mat4 getGlCoordMatrix(){return conditional(isFalse(aPitchWithMap),uGlCoordMatrix,uGlCoordMatrix2);}mat2 getRotateMatrix(){if(isTrue(aPitchWithMap)){if(isTrue(aRotateWithMap)){return mat2(1.0,0.0,0.0,-1.0);}else{highp float cos=cos(uRotate);highp float sin=sin(uRotate);return mat2(1.0,0.0,0.0,-1.0)*mat2(cos,-sin,sin,cos);}}else{return mat2(1.0,0.0,0.0,1.0);}}void main(){mat4 labelPlaneMatrix=getLabelPlaneMatrix();mat4 glCoordMatrix=getGlCoordMatrix();mat2 rotateMatrix=getRotateMatrix();vec4 projectedPos=labelPlaneMatrix*vec4(aPosition,0.0,1.0);gl_Position=glCoordMatrix*vec4(projectedPos.xy/projectedPos.w+rotateMatrix*aOffset/32.0,0.0,1.0);vTexturePosition=aTexturePosition/uImageSize;vec2 unpackedOpacity=unpackOpacity(aFadeOpacity);float fadeChange=conditional(unpackedOpacity[1]>0.0,uFadeChange,-uFadeChange);vFadeOpacity=max(0.0,min(unpackedOpacity[0]+fadeChange,1.0));}"),Vu=Au("#define GLSLIFY 1\nuniform vec4 uColor;uniform float uOpacity;uniform vec4 uStrokeColor;uniform float uStrokeOpacity;uniform mediump float uStrokeWidth;varying vec2 vExtrude;varying lowp float vAntialiasBlur;varying float vRadius;void main(){float extrudeLen=length(vExtrude);float opacity=smoothstep(0.0,vAntialiasBlur,1.0-extrudeLen);float colorFactor=conditional(uStrokeWidth<0.01,1.0,smoothstep(0.0,vAntialiasBlur,vRadius/(vRadius+uStrokeWidth)-extrudeLen));vec4 color=mix(uStrokeColor*uStrokeOpacity,uColor*uOpacity,colorFactor);gl_FragColor=color*opacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform float uRatio;uniform float uDevicePixelRatio;uniform float uRadius;uniform mediump float uStrokeWidth;attribute vec2 aPosition;attribute float aData;varying vec2 vExtrude;varying lowp float vAntialiasBlur;varying float vRadius;void main(){vec2 center=floor(aPosition/2.0);vec2 extrude=vec2(mod(aPosition,2.0)*2.0-1.0);float radius=conditional(uRadius==0.0,aData,uRadius);vec2 corner=center+extrude*(radius+uStrokeWidth)/uRatio;gl_Position=uMatrix*vec4(corner,0.0,1.0);vExtrude=extrude;vAntialiasBlur=1.0/(radius+uStrokeWidth)/uDevicePixelRatio;vRadius=radius;}"),Gu=Au("#define GLSLIFY 1\nuniform sampler2D uImage;uniform highp vec4 uFilterColor;uniform lowp float uFilterOpacity;varying vec2 vPosition;void main(){vec4 color=texture2D(uImage,vPosition);gl_FragColor=conditional(uFilterOpacity==0.0,color,color*(1.0-uFilterOpacity)+uFilterColor*uFilterOpacity);}","#define GLSLIFY 1\nuniform mat4 uMatrix;attribute vec2 aPosition;attribute vec2 aTexture;varying vec2 vPosition;void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);vPosition=aTexture;}"),qu=Au("#define GLSLIFY 1\nuniform float uOpacity;uniform vec2 uImageSize;uniform float uFade;uniform mediump vec4 uPatternPosition;uniform sampler2D uImage;varying vec2 vPosition1;varying vec2 vPosition2;void main(){vec2 imagecoord1=mod(vPosition1,1.0);vec2 pos1=mix(uPatternPosition.xw/uImageSize,uPatternPosition.zy/uImageSize,imagecoord1);vec4 color1=texture2D(uImage,pos1);vec2 imagecoord2=mod(vPosition2,1.0);vec2 pos2=mix(uPatternPosition.xw/uImageSize,uPatternPosition.zy/uImageSize,imagecoord2);vec4 color2=texture2D(uImage,pos2);vec4 color=mix(color1,color2,uFade);gl_FragColor=color*uOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform vec2 uPixelCoordUpper;uniform vec2 uPixelCoordLower;uniform mediump vec4 uPatternPosition;uniform float uPixelRatio;uniform vec3 uRatio;uniform float opacity;attribute vec2 aPosition;varying vec2 vPosition1;varying vec2 vPosition2;vec2 getPatternPos(vec2 uPixelCoordUpper,vec2 uPixelCoordLower,vec2 patternSize,vec2 aPos,float tileZoomRatio){vec2 pixelCoordUpperReduced=mod(mod(uPixelCoordUpper,patternSize)*256.0,patternSize)*256.0;vec2 offset=mod(pixelCoordUpperReduced+uPixelCoordLower,patternSize);return(tileZoomRatio*aPos+offset)/patternSize;}void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);float tileZoomRatio=uRatio.x;float fromScale=uRatio.y;float toScale=uRatio.z;vec2 patternSize=(uPatternPosition.zw-uPatternPosition.xy)/uPixelRatio;vPosition1=getPatternPos(uPixelCoordUpper,uPixelCoordLower,patternSize*fromScale,aPosition,tileZoomRatio);vPosition2=getPatternPos(uPixelCoordUpper,uPixelCoordLower,patternSize*toScale,aPosition,tileZoomRatio);}"),Zu=Au("#define GLSLIFY 1\nuniform float uPixelRatio;uniform float uFade;uniform float uOpacity;uniform vec2 uImageSize;uniform mediump vec4 uRatio;uniform vec4 uPatternPosition;uniform vec4 uColor;uniform sampler2D uImage;varying float vDistance;varying float vWidth;varying vec2 vNormal;void main(){float tileZoomRatio=uRatio.y;float fromScale=uRatio.z;float toScale=uRatio.w;vec2 patternSize=(uPatternPosition.zw-uPatternPosition.xy)/uPixelRatio;float widthFrom=patternSize.x*fromScale/tileZoomRatio;float widthTo=patternSize.x*toScale/tileZoomRatio;float aspect=patternSize.y/vWidth;float xFrom=mod(vDistance/widthFrom*aspect,1.0);float xTo=mod(vDistance/widthTo*aspect,1.0);float y=0.5*vNormal.y+0.5;vec2 texelSize=1.0/uImageSize;vec2 posFrom=mix(uPatternPosition.xy*texelSize-texelSize,uPatternPosition.zw*texelSize+texelSize,vec2(xFrom,y));vec2 posTo=mix(uPatternPosition.xy*texelSize-texelSize,uPatternPosition.zw*texelSize+texelSize,vec2(xTo,y));vec4 colorFrom=texture2D(uImage,posFrom);vec4 colorTo=texture2D(uImage,posTo);vec4 patternColor=mix(colorFrom,colorTo,uFade);gl_FragColor=(patternColor*patternColor.a+uColor*(1.0-patternColor.a))*uOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform float uWidth;uniform float uOffset;uniform mediump vec4 uRatio;attribute vec2 aPosition;attribute vec4 aData;attribute float aDistance;varying float vDistance;varying vec2 vNormal;varying float vWidth;void main(){vec2 extrude=(aData.xy-128.0)/63.0;vec2 normal=vec2(floor(aData.z/2.0),mod(aData.z,2.0)*2.0-1.0);float direction=aData.w-1.0;float halfWidth=uWidth/2.0;float outset=conditional(halfWidth==0.0,0.0,max(halfWidth,uRatio.x));float u=direction/2.0;float t=1.0-abs(u);vec2 offset=-uOffset*extrude*normal.y*mat2(t,-u,u,t);vec4 projected=uMatrix*vec4(outset*extrude/uRatio.x,0.0,0.0);gl_Position=uMatrix*vec4(aPosition+offset/uRatio.x,0.0,1.0)+projected;vDistance=aDistance;vWidth=uWidth;vNormal=normal;}"),Wu=Au("#define GLSLIFY 1\nvarying vec2 vExtrude;varying float vWeight;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(){float d=-0.5*3.0*3.0*dot(vExtrude,vExtrude);float val=vWeight*GAUSS_COEF*exp(d);vec4 color=vec4(val,1.0,1.0,1.0);gl_FragColor=color;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform float uRatio;uniform float uRadius;attribute vec2 aPosition;attribute float aData;varying vec2 vExtrude;varying float vWeight;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(){vec2 center=floor(aPosition/2.0);vec2 extrude=vec2(mod(aPosition,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/aData/GAUSS_COEF))/3.0;vExtrude=S*extrude;vWeight=aData;vec2 corner=center+vExtrude*uRadius/uRatio;gl_Position=uMatrix*vec4(corner,0.0,1.0);}"),Hu=Au("#define GLSLIFY 1\nuniform sampler2D uImage;uniform sampler2D uColorRamp;uniform float uOpacity;varying vec2 vPos;void main(){float t=texture2D(uImage,vPos).r;vec4 color=texture2D(uColorRamp,vec2(t,0.5));gl_FragColor=color*uOpacity;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform vec2 uWorld;attribute vec2 aPosition;varying vec2 vPos;void main(){vec2 center=aPosition.xy;gl_Position=uMatrix*vec4(center*uWorld,0,1);vPos.x=center.x;vPos.y=center.y;}"),Yu=Au("#define GLSLIFY 1\nuniform highp vec4 uColor;void main(){gl_FragColor=uColor;}","#define GLSLIFY 1\nuniform mat4 uMatrix;attribute vec2 aPosition;void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);}"),Xu=Au("#define GLSLIFY 1\nuniform highp vec4 uPlacedColor;uniform highp vec4 uNotPlacedColor;varying lowp float vPlaced;varying lowp float vNotUsed;void main(){gl_FragColor=conditional(isTrue(vPlaced),uPlacedColor,uNotPlacedColor);if(isTrue(vNotUsed)){gl_FragColor=vec4(0.0,0.0,0.0,0.0);}}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform vec2 uExtrudeScale;attribute vec2 aPosition;attribute vec2 aExtrude;attribute lowp float aPlaced;attribute lowp float aNotUsed;varying lowp float vPlaced;varying lowp float vNotUsed;void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);gl_Position.xy+=aExtrude*uExtrudeScale*gl_Position.w;vPlaced=aPlaced;vNotUsed=aNotUsed;}"),Ku=Au("#define GLSLIFY 1\nuniform highp vec4 uColor;void main(){gl_FragColor=uColor;}","#define GLSLIFY 1\nuniform mat4 uMatrix;uniform float uSize;attribute vec2 aPosition;void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);gl_PointSize=uSize;}"),Qu=Au("#define GLSLIFY 1\nvarying highp vec3 vColor;void main(){gl_FragColor=vec4(vColor,1.0);}","#define GLSLIFY 1\nuniform mat4 uMatrix;attribute vec2 aPosition;attribute vec3 aColor;varying highp vec3 vColor;void main(){gl_Position=uMatrix*vec4(aPosition,0.0,1.0);vColor=vec3(aColor[0]/255.0,aColor[1]/255.0,aColor[2]/255.0);}"),Ju=Object.freeze({__proto__:null,clippingMask:Du,solid:Fu,building:Bu,line:Nu,dashedLine:zu,poiText:Uu,poiIcon:ju,circle:Vu,raster:Gu,fillPattern:qu,linePattern:Zu,heatmap:Wu,heatmapRaster:Hu,debug:Yu,collisionBox:Xu,point:Ku,network:Qu}),$u={debug:new nu,stack:(Ou={},Ou[Gs.Invalid]=null,Ou[Gs.TileBackground]=new vu,Ou[Gs.TerrainOverlay]=null,Ou[Gs.Polygon]=new pu,Ou[Gs.Crosswalk]=new Kl,Ou[Gs.Railroad]=new yu,Ou[Gs.Road]=new Lu,Ou[Gs.Line]=new uu,Ou[Gs.Point]=null,Ou[Gs.Environment]=null,Ou[Gs.Building]=new ql,Ou[Gs.TrafficLine]=null,Ou[Gs.RoadName]=new Tu,Ou[Gs.Circle]=new Wl,Ou[Gs.Poi]=new cu,Ou[Gs.Image]=new vu,Ou[Gs.Heatmap]=new ou,Ou)},th=1/Math.pow(2,16),eh=function(){function e(t,e,r,n){this._width=0,this._height=0,this._heatmapFrameBuffers={},this._heatmapColorTextures={},this._options={},this._depthFor3D=0,this._currentStackNumber=0,this._placement=null,this._placementResult=null,this._fadeChange=0,this._lastFloorZoom=0,this._lastIntegerZoom=0,this._lastIntegerZoomTime=0,this._renderableStacks=[],this._context=new El(t),this._transform=e,this._programs=this._loadPrograms(),this._clippingMaskRenderer=new Yl,this._tileBoundary=this._initTileBoundary(),this._clippingMaskFrame=this._initClippingMaskFrame(),this._rasterFrame=this._initRasterFrame(),this._lineAtlas=this._initLineAtlas(),this._fadeDuration=r,this._maxPreparationTimePerFrame=n}return e.prototype._loadPrograms=function(){var e,r,n,i,o,a,s,l,u=new Map;try{for(var h=t.__values(Object.entries(Ju)),c=h.next();!c.done;c=h.next()){var f=t.__read(c.value,2),p=f[0],d=f[1],y=new Il(this._context,d);u.set(p,y)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}try{for(var g=t.__values(u.values()),v=g.next();!v.done;v=g.next())(y=v.value).linkProgram(this._context)}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}try{for(var _=t.__values(u.values()),m=_.next();!m.done;m=_.next())(y=m.value).checkStatus(this._context)}catch(t){o={error:t}}finally{try{m&&!m.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}try{for(var b=t.__values(u),x=b.next();!x.done;x=b.next()){var w=t.__read(x.value,2),M=w[0];(y=w[1]).prepareVariables(this._context,Ul[M])}}catch(t){s={error:t}}finally{try{x&&!x.done&&(l=b.return)&&l.call(b)}finally{if(s)throw s.error}}return u},e.prototype._initTileBoundary=function(){var e=new t.PositionArrayBuilder;e.pushAll({x:0,y:1},{x:0,y:0},{x:1,y:0},{x:1,y:1});var r=new cl;return r.pushAll({i:0},{i:1},{i:2},{i:3},{i:0}),new t.VectorRenderable(this._context.createVertexBuffer(e.build(),t.PositionLayout.fields),this._context.createIndexBuffer(r.build()),t.SegmentArray.newSimpleArray(0,e.getElementSize(),0,r.getElementSize()))},e.prototype._initClippingMaskFrame=function(){var e=new t.PositionArrayBuilder;e.push(0,0),e.push(1,0),e.push(0,1),e.push(1,1);var r=new t.TrianglesIndexArrayBuilder;return r.push(0,1,2),r.push(2,1,3),new t.VectorRenderable(this.context.createVertexBuffer(e.build(),t.PositionLayout.fields),this.context.createIndexBuffer(r.build()),t.SegmentArray.newSimpleArray(0,e.getElementSize(),0,r.getElementSize()))},e.prototype._initRasterFrame=function(){var e=new dl;e.push(0,0,0,0),e.push(1,0,1,0),e.push(0,1,0,1),e.push(1,1,1,1);var r=new t.TrianglesIndexArrayBuilder;return r.push(0,1,2),r.push(2,1,3),new t.VectorRenderable(this._context.createVertexBuffer(e.build(),fl.fields),this._context.createIndexBuffer(r.build()),t.SegmentArray.newSimpleArray(0,e.getElementSize(),0,r.getElementSize()))},e.prototype._initLineAtlas=function(){return new su(this._context,256,512)},Object.defineProperty(e.prototype,"size",{get:function(){return{width:this._width,height:this._height}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileBoundary",{get:function(){return this._tileBoundary},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clippingMaskFrame",{get:function(){return this._clippingMaskFrame},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rasterFrame",{get:function(){return this._rasterFrame},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineAtlas",{get:function(){return this._lineAtlas},enumerable:!1,configurable:!0}),e.prototype.prepare=function(e){var r,n,i,o,a=this,s=t.browser.now(),l=function(){if(t.browser.now()-s>a._maxPreparationTimePerFrame)throw"TimeOver"},u=function(e){var r,n,i=e.styleDataMap,o=e.tileCompositeData;if(e.prepared)for(;e.hasLink();){l(),u(e.frontLink());var s=e.popLink();e.merge(s),s.destroy()}else{l(),o.prepare(a._context);try{for(var h=t.__values(i.values()),c=h.next();!c.done;c=h.next()){var f=c.value;l(),f.prepare(a._context)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}e.markPrepared()}},h=!1;try{t:for(var c=t.__values(e.getTargetLayersAndSources()),f=c.next();!f.done;f=c.next()){var p=f.value.source;try{for(var d=(i=void 0,t.__values(p.getCachedTiles())),y=d.next();!y.done;y=d.next()){var g=y.value;try{u(g)}catch(t){if("TimeOver"===t){h=!0;break t}throw t}}}catch(t){i={error:t}}finally{try{y&&!y.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return this._prepareRenderableStacks(e),h},e.prototype.getFadeChangeByIntegerZoom=function(){return 0===this._fadeDuration?1:Math.min((t.browser.now()-this._lastIntegerZoomTime)/this._fadeDuration,1)},e.prototype.render=function(e,r){this._context.clear({color:vl.Transparent,depth:1,stencil:0}),this._options=r;var n=Math.floor(this.transform.getZoom());this._lastFloorZoom>n?(this._lastIntegerZoom=n+1,this._lastIntegerZoomTime=t.browser.now()):this._lastFloorZoom<n&&(this._lastIntegerZoom=n,this._lastIntegerZoomTime=t.browser.now()),this._lastFloorZoom=n,this._renderLayers(e),$u.debug.draw(this,{visibleTiles:this._transform.getVisibleTiles()})},e.prototype._renderLayers=function(e){var r,n,i,o=e.getStyle();if(o){this._depthFor3D=15*(o.getTotalStackCount()+2)*th,this._currentStackNumber=0,this._fadeChange=(null===(i=this._placementResult)||void 0===i?void 0:i.getFadeChange(t.browser.now()))||0;var a=this._renderableStacks;this._placementResult&&(a=t.__spreadArray(t.__spreadArray([],t.__read(this._renderableStacks.filter((function(t){return t.renderingType!==Gs.Poi&&t.renderingType!==Gs.RoadName}))),!1),t.__read(this._placementResult.cachedRenderableStacks),!1));var s=!1;try{for(var l=t.__values(a.sort(al)),u=l.next();!u.done;u=l.next()){var h=u.value,c=h.source,f=h.layer,p=h.stack,d=h.stackStyle,y=h.renderingType,g=h.cachedTiles,v=h.needClippingMask,_=y&&$u.stack[y];_&&(v&&this._clippingMaskRenderer.draw(this,{source:c,cachedTiles:g,layer:f,stack:p,stackStyle:d}),_.draw(this,{source:c,cachedTiles:g,layer:f,stack:p,stackStyle:d,needClippingMask:v}),this._currentStackNumber++,y===Gs.Heatmap&&(s=!0))}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}s||(this._destroyHeatmapFrameBuffers(),this._destroyHeatmapColorTextures())}},e.prototype._prepareRenderableStacks=function(e){var r,n,i=e.getStyle();if(i){var o=this.transform.getZoom(),a=0===this.transform.getPitch(),s=[],l=function(e,r){var n,l,u,h,c=r.getCachedTiles().filter((function(t){return t.prepared}));c.forEach((function(t){return t.clear()}));var f=new Map;c.forEach((function(e){var r=e.tileId.z;t.computeIfAbsent$1(f,r,(function(){return[]})).push(e)}));var p=r.getStyleLevel(o),d=r.getTileLevel(o),y=function(t){return t===d?p:t<d?Math.min(r.getStyleLevel(t+1)-1,p-1):Math.max(r.getStyleLevel(t),p+1)};try{for(var g=(n=void 0,t.__values(function(e,r,n){var i=r.getRenderType();if(i===Lo.Vector){var o=n.getLayerStyle(e.getId());return o?e.getStacks().map((function(t){return{stack:t,stackStyle:o.getStackStyle(t.getId())}})):[]}if(i===Lo.Raster){var a=e.getStacks(),s=n.getLayerStyle(e.getId());return 0===a.length?[{stack:t.Stack.DUMMY,stackStyle:t.StackStyle.DUMMY}]:s?e.getStacks().map((function(t){return{stack:t,stackStyle:s.getStackStyle(t.getId())}})):[]}return[]}(e,r,i))),v=g.next();!v.done;v=g.next()){var _=v.value,m=_.stack,b=_.stackStyle;if(b&&m.getVisibility())try{for(var x=(u=void 0,t.__values(f)),w=x.next();!w.done;w=x.next()){var M=t.__read(w.value,2),S=M[0],P=M[1],T=y(S);if(("Image"!==r.getType()||m.hasViewLevel(p))&&m.hasViewLevel(T)){var E=new nl(m,e,r,b,P,T,a);s.push(E)}}}catch(t){u={error:t}}finally{try{w&&!w.done&&(h=x.return)&&h.call(x)}finally{if(u)throw u.error}}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(l=g.return)&&l.call(g)}finally{if(n)throw n.error}}};try{for(var u=t.__values(e.getTargetLayersAndSources()),h=u.next();!h.done;h=u.next()){var c=h.value;l(c.layer,c.source)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}this._renderableStacks=s.filter((function(t){return t.renderingType!==Gs.Invalid&&t.renderingGroup!==rl.Invalid}))}},e.prototype.resize=function(e,r){this._width=e*t.browser.devicePixelRatio,this._height=r*t.browser.devicePixelRatio,this._context.setViewport(0,0,this._width,this._height),this._destroyHeatmapFrameBuffers()},e.prototype.getHeatmapFrameBuffer=function(t,e,r){return this._heatmapFrameBuffers[t]||(this._heatmapFrameBuffers[t]=new yl(this._context,e,r)),this._heatmapFrameBuffers[t]},e.prototype.getHeatmapColorTexture=function(e,r){if(!this._heatmapColorTextures[e]){var n=function(e,r,n){void 0===e&&(e=256),void 0===r&&(r=1),void 0===n&&(n={0:"rgba(0,0,255,0)",.2:"#0000ff",.4:"#00ff00",.6:"#ffff00",1:"#ff0000"});for(var i=new t.RgbaImage(e,r),o=Object.keys(n).map((function(t){return parseFloat(t)})).sort((function(t,e){return t-e})),a=o.map((function(t){return n[t]})),s=o.map((function(t){return Math.round(256*t)})),l=[],u=0,h=o.length-1;u<h;u++){var c=s[u+1]-s[u],f=t.genGradient(a[u],a[u+1],c);l=t.__spreadArray(t.__spreadArray([],t.__read(l),!1),t.__read(f),!1)}for(c=0;c<e;c++)for(var p=t.__read(l[c],4),d=p[0],y=p[1],g=p[2],v=p[3],_=0;_<r;_++)i.setPixel(c,_,[Math.floor(255*d),Math.floor(255*y),Math.floor(255*g),Math.floor(255*v)]);return i}(256,1,r);this._heatmapColorTextures[e]=new t.Texture(this._context,n)}return this._heatmapColorTextures[e]},e.prototype._destroyHeatmapFrameBuffers=function(){for(var t in this._heatmapFrameBuffers)this._heatmapFrameBuffers[t].destroy(),delete this._heatmapFrameBuffers[t]},e.prototype._destroyHeatmapColorTextures=function(){for(var t in this._heatmapColorTextures)this._heatmapColorTextures[t].destroy(),delete this._heatmapColorTextures[t]},e.prototype.useProgram=function(t){var e=this._programs.get(t);return e||((e=new Il(this._context,Ju[t])).linkProgram(this._context),e.checkStatus(this._context),e.prepareVariables(this._context,Ul[t]),this._programs.set(t,e)),e},e.prototype.destroy=function(){this._tileBoundary.destroy(),this._rasterFrame.destroy(),this._lineAtlas.destroy(),this._destroyHeatmapFrameBuffers(),this._destroyHeatmapColorTextures()},e.prototype.getColorMode=function(){return ml.alphaBlended(this._context.gl)},e.prototype.getDepthMode=function(t,e,r){var n=(15*this._currentStackNumber+t)*th;return new xl(r||this._context.gl.LEQUAL,!1,[n,n])},e.prototype.getDepthModeFor3D=function(t){return new xl(t||this._context.gl.LEQUAL,!0,[0,1-this._depthFor3D])},e.prototype.getStencilModeForClipping=function(t){var e=this.context.gl;return new Ml(e.EQUAL,this._clippingMaskRenderer.getStencilRef(t),255,255,e.KEEP,e.KEEP,e.KEEP)},e.prototype.updatePlacement=function(e){var r,n;if(!e.getStyle())return!1;var i=new ul(e,this._transform,this._renderableStacks),o=!(this._placement&&i.equals(this._placement.stackIterator));(!this._placement||this._placement.isDone()&&!(null===(r=this._placementResult)||void 0===r?void 0:r.checkLatest(t.browser.now(),this._transform.getZoom())))&&(this._placement=new Xs(this._context,this._transform,this._fadeDuration,i));var a=this._placement;a.isDone()?null===(n=this._placementResult)||void 0===n||n.expire():(a.continue(),a.isDone()&&(this._placementResult&&this._clearReplacedTiles(a.stackIterator.preparedRenderableStacks,this._placementResult.cachedRenderableStacks),this._placementResult=a.commit(t.browser.now(),this._placementResult)),o&&a.expire());var s=this._placementResult;return s&&function(e,r){var n,i,o,a,s,l,u,h;try{for(var c=t.__values(e),f=c.next();!f.done;f=c.next()){var p=f.value,d=p.stack,y=p.stackStyle,g=p.cachedTiles;try{for(var v=(o=void 0,t.__values(y.getStyles())),_=v.next();!_.done;_=v.next()){var m=_.value;try{for(var b=(s=void 0,t.__values(g)),x=b.next();!x.done;x=b.next()){var w=x.value.styleDataMap.get(d.getId(),m.getId());if(w){var M=w.getRenderable();if(M){var S=new t.PlacementOpacityArrayBuilder,P=new t.PlacementOpacityArrayBuilder,T=Ws.getDefault();try{for(var E=(u=void 0,t.__values(M.getInfoArray())),L=E.next();!L.done;L=E.next()){var k=L.value,I=k.uniqueId,A=k.glyphVerticesLength,C=k.iconVerticesLength,O=r[I]||T,R=C>0;if(A>0)for(var D=el(O.text),F=0;F<A;F++)S.push(D);if(R)for(D=el(O.icon),F=0;F<C;F++)P.push(D);k.textPlaced=O.text.placed,k.iconPlaced=O.icon.placed,k.notUsed=O.notUsed}}catch(t){u={error:t}}finally{try{L&&!L.done&&(h=E.return)&&h.call(E)}finally{if(u)throw u.error}}M.text&&M.text.opacityBuffer.updateData(S.build()),M.icon&&M.icon.opacityBuffer.updateData(P.build())}}}}catch(t){s={error:t}}finally{try{x&&!x.done&&(l=b.return)&&l.call(b)}finally{if(s)throw s.error}}}}catch(t){o={error:t}}finally{try{_&&!_.done&&(a=v.return)&&a.call(v)}finally{if(o)throw o.error}}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}}(s.cachedRenderableStacks,s.opacities),o||!a.isDone()||!!s&&(s.hasTransitions(t.browser.now())||s.expired)},e.prototype._clearReplacedTiles=function(t,e){var r=new Set;t.forEach((function(t){var e=t.layer.getId();t.cachedTiles.forEach((function(t){if(!t.willReplace){var n="".concat(e,"/").concat(t.tileId.toString());r.add(n)}}))})),e.forEach((function(t){var e=t.layer.getId();t.cachedTiles.forEach((function(t){t.willReplace&&r.has("".concat(e,"/").concat(t.tileId.toString()))&&t.destroy()}))}))},Object.defineProperty(e.prototype,"fadeChange",{get:function(){return this._fadeChange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastIntegerZoom",{get:function(){return this._lastIntegerZoom},enumerable:!1,configurable:!0}),e.prototype.getPlacementResult=function(){return this._placementResult},e.prototype.isFinishedPlacement=function(){return!this._placement||this._placement.isDone()},Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),e}(),rh=eh;!function(t){t.ShowTileDebugInfo="ShowTileDebugInfo",t.ShowVectorTileDebugInfo="ShowVectorTileDebugInfo",t.ShowLegacyVectorTileDebugInfo="ShowLegacyVectorTileDebugInfo",t.ShowLegacyRasterTileDebugInfo="ShowLegacyRasterTileDebugInfo",t.ShowCollisionDetection="ShowCollisionDetection",t.ShowPoiVertex="ShowPoiVertex",t.ShowNetwork="ShowNetwork"}(Ru||(Ru={}));var nh=function(){function t(t){this._runnable=t,this._state="Ready"}return t.prototype.run=function(){this._state="Running",this._runnable&&this._runnable(),this._state="Done"},t.prototype.cancel=function(){"Ready"===this._state&&(this._state="Cancelled")},t.prototype.isReady=function(){return"Ready"===this._state},t.prototype.isCancelled=function(){return"Cancelled"===this._state},t.prototype.isRunning=function(){return"Running"===this._state},t.prototype.isDone=function(){return"Done"===this._state},t}(),ih=function(){function e(){this._queue=[]}return e.prototype.submit=function(t){var e=new nh(t);return this._queue.push(e),e},e.prototype.execute=function(){var e,r,n=this._queue;this._queue=[];try{for(var i=t.__values(n),o=i.next();!o.done;o=i.next()){var a=o.value;a.isReady()&&a.run()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},e.prototype.clear=function(){this._queue=[]},e}(),oh=ih,ah={exports:{}};!function(t){!function(){
/**
        		 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
        		 *
        		 * @codingstandard ftlabs-jsv2
        		 * @copyright The Financial Times Limited [All Rights Reserved]
        		 * @license MIT License (see LICENSE.txt)
        		 */
function e(t,r){var i;if(r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=t,this.tapDelay=r.tapDelay||200,this.tapTimeout=r.tapTimeout||700,!e.notNeeded(t)){for(var o=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=this,s=0,l=o.length;s<l;s++)a[o[s]]=u(a[o[s]],a);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,r,n){var i=Node.prototype.removeEventListener;"click"===e?i.call(t,e,r.hijacked||r,n):i.call(t,e,r,n)},t.addEventListener=function(e,r,n){var i=Node.prototype.addEventListener;"click"===e?i.call(t,e,r.hijacked||(r.hijacked=function(t){t.propagationStopped||r(t)}),n):i.call(t,e,r,n)}),"function"==typeof t.onclick&&(i=t.onclick,t.addEventListener("click",(function(t){i(t)}),!1),t.onclick=null)}function u(t,e){return function(){return t.apply(e,arguments)}}}var r=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!r,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!r,o=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),a=i&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(t){switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(i&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},e.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},e.prototype.sendClick=function(t,e){var r,n;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),n=e.changedTouches[0],(r=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(t),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),r.forwardedTouchEvent=!0,t.dispatchEvent(r)},e.prototype.determineEventType=function(t){return n&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(t){var e;i&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type&&"month"!==t.type?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},e.prototype.updateScrollParent=function(t){var e,r;if(!(e=t.fastClickScrollParent)||!e.contains(t)){r=t;do{if(r.scrollHeight>r.offsetHeight){e=r,t.fastClickScrollParent=r;break}r=r.parentElement}while(r)}e&&(e.fastClickLastScrollTop=e.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},e.prototype.onTouchStart=function(t){var e,r,n;if(t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),r=t.targetTouches[0],i){if((n=window.getSelection()).rangeCount&&!n.isCollapsed)return!0;if(!o){if(r.identifier&&r.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=r.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=r.pageX,this.touchStartY=r.pageY,t.timeStamp-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},e.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],r=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>r||Math.abs(e.pageY-this.touchStartY)>r},e.prototype.onTouchMove=function(t){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0)},e.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(t){var e,r,s,l,u,h=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(t.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,r=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,a&&(u=t.changedTouches[0],(h=document.elementFromPoint(u.pageX-window.pageXOffset,u.pageY-window.pageYOffset)||h).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(s=h.tagName.toLowerCase())){if(e=this.findControl(h)){if(this.focus(h),n)return!1;h=e}}else if(this.needsFocus(h))return t.timeStamp-r>100||i&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(h),this.sendClick(h,t),i&&"select"===s||(this.targetElement=null,t.preventDefault()),!1);return!(!i||o||!(l=h.fastClickScrollParent)||l.fastClickLastScrollTop===l.scrollTop)||(this.needsClick(h)||(t.preventDefault(),this.sendClick(h,t)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(t){return!(this.targetElement&&!t.forwardedTouchEvent&&t.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)&&(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),1))},e.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail||((e=this.onMouse(t))||(this.targetElement=null),e)},e.prototype.destroy=function(){var t=this.layer;n&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(t){var e,r,i;if(void 0===window.ontouchstart)return!0;if(r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&i[2]>=3&&(e=document.querySelector("meta[name=viewport]"))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction||!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(e=document.querySelector("meta[name=viewport]"))&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||"none"===t.style.touchAction||"manipulation"===t.style.touchAction},e.attach=function(t,r){return new e(t,r)},t.exports?(t.exports=e.attach,t.exports.FastClick=e):window.FastClick=e}()}(ah);var sh=ah.exports,lh={center:{lng:0,lat:0},zoom:0,bearing:0,pitch:0,enlargeScaleFactor:t.DEFAULT_GLOBAL_VARIABLES.enlargeScaleFactor,interactive:!0,preserveDrawingBuffer:!1,fadeDuration:200,maxPreparationTimePerFrame:t.DEFAULT_MAX_PREPARATION_TIME_PER_FRAME,emitFirstPaint:!1,fontScale:t.DEFAULT_GLOBAL_VARIABLES.fontScale,iconScale:t.DEFAULT_GLOBAL_VARIABLES.iconScale,customStyleProperties:t.DEFAULT_GLOBAL_VARIABLES.customStyleProperties,optimize:{noQuery:!1}},uh=function(e){function r(r){var n=e.call(this)||this;return n._mapScene=null,n._frame=null,n._appConfig=null,n._globalVariables=t.DEFAULT_GLOBAL_VARIABLES,n._destroyed=!1,n._mutex=new t.Mutex,r=t.merge([r,lh],!1),n._container=n._initContainer(r),n._canvasContainer=n._initCanvasContainer(),n._canvas=n._initCanvas(),n._overlayContainer=n._initOverlayContainer(),n._controlContainer=n._initControlContainer(),n._alt=n._initAlt(r),n._transform=new Rs({enlargeScaleFactor:r.enlargeScaleFactor,minZoom:r.minZoom,maxZoom:r.maxZoom,minPitch:r.minPitch,maxPitch:r.maxPitch,maxBounds:r.maxBounds}),n._renderTaskScheduler=new oh,n._camera=new Dt(n),n._controlDocks=new Bt(n._controlContainer),n._controlSet=new Nt,n._enabledAdditionalFuncNames=new Set,n._preserveDrawingBuffer=Boolean(r.preserveDrawingBuffer),n._fadeDuration=Math.max(r.fadeDuration,0),n._maxPreparationTimePerFrame=r.maxPreparationTimePerFrame&&r.maxPreparationTimePerFrame>0?r.maxPreparationTimePerFrame:t.DEFAULT_MAX_PREPARATION_TIME_PER_FRAME,n._optimize=r.optimize,n._setupMapScene(),n._domEventRegistrations=n._initDomEventRegistrations(),n._initMapEventHandlers(),r.emitFirstPaint&&(n._firstPaintChecker=new ls,n._firstPaintHandler=n._checkFirstPaint.bind(n),n.on(x.Data,n._firstPaintHandler)),n._mapInteraction=new Te(n,r.interactive),n._mapInteraction.bind(),n._id=r.id||"__vsm_".concat(Date.now(),"_").concat(t.v4(),"__"),n._dirty={sources:!1,styles:!1,preparation:!1,placement:!1},n._causesOfDirtySources=new Set,n._camera.jumpTo(r),r.bounds&&(n.resize(),n._camera.setBounds(r.bounds,{padding:r.padding,duration:0})),n.resize(),n.setConfig(r.config,{autoStyleLoad:r.autoStyleLoad,preloadStyle:r.preloadStyle,defaultStyle:r.defaultStyle},{fontScale:r.fontScale,iconScale:r.iconScale,enlargeScaleFactor:r.enlargeScaleFactor,customStyleProperties:r.customStyleProperties}),n._mapOverlay=new uo({container:n.getOverlayContainer(),map:n}),n}return t.__extends(r,e),r.prototype._initDomEventRegistrations=function(){var t=this,e=[{target:window,type:"online",handler:function(){return t._update("online")}},{target:window,type:"resize",handler:function(e){t.resize(Mt(e))}},{target:this._canvas,type:"webglcontextlost",handler:function(e){e.cancelable&&e.preventDefault(),t.cancelRepaint(),t.emit(new Pt(x.ContextLost,t)),console.info("webgl context lost")}},{target:this._canvas,type:"webglcontextrestored",handler:function(e){t._setupMapScene(),t.resize(Mt(e)),console.info("webgl context restore")}}];return e.forEach(u),e},r.prototype._initContainer=function(e){var r;if(e.container instanceof HTMLElement?r=e.container:"string"==typeof e.container&&(r=function(t){return window.document.getElementById(t)}(e.container)),!r)throw new t.InitializeError("Failed to init map container");return r.classList.add("vsm-container","vsm-container-bg"),r},r.prototype._initCanvasContainer=function(){return n("div","vsm-canvas-container",this._container)},r.prototype._initCanvas=function(){var t=n("canvas","vsm-canvas",this._canvasContainer);t.style.position="absolute",t.style.left="0",t.style.top="0",t.tabIndex=0;var e=o(this._container);return a(t,e.width,e.height),sh.FastClick.attach(t),t},r.prototype._initOverlayContainer=function(){var t=n("div",null,this._canvasContainer);return t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.transform="translateZ(0px)",t},r.prototype._initControlContainer=function(){return n("div","vsm-control-container",this._container)},r.prototype._initAlt=function(t){var e;return t.alt?e=t.alt:(e=n("div")).innerText="WebGL is not supported",e.classList.add("vsm-alt"),e},r.prototype._setupMapScene=function(){var e=this._canvas,r=co(t.__assign(t.__assign({},ho),{preserveDrawingBuffer:this._preserveDrawingBuffer}),e);r?this._mapScene=new rh(r,this._transform,this._fadeDuration,this._maxPreparationTimePerFrame):(this._mapScene=null,this._container.appendChild(this._alt))},r.prototype._initMapEventHandlers=function(){var t=this,e=function(e){return t._update(e.name)};this.on(x.Move,e),this.on(x.MoveEnd,e),this.on(x.Data,e),this.on(x.SourceLoad,e),this.on(x.ConfigLoad,e),this.on(x.StyleLoad,e),this.on(x.Resize,e)},r.prototype._checkFirstPaint=function(t){var e,r,n=this;null===(e=this._firstPaintChecker)||void 0===e||e.addTile(t),(null===(r=this._firstPaintChecker)||void 0===r?void 0:r.check())&&(this.once(x.FirstPaint,(function(){n.off(x.Data,n._firstPaintHandler)})),this.emit(new Pt(x.FirstPaint,this)),window.emit=function(t){n.emit(new Pt(t,n))},this._firstPaintChecker=null)},r.prototype._resizeCanvas=function(t,e){a(this._canvas,t,e)},r.prototype.requestRenderFrame=function(t){return this._update("requestRenderFrame"),t?this._renderTaskScheduler.submit(t):null},r.prototype._render=function(){if(!this._destroyed){var e=t.browser.now();this._renderTaskScheduler.execute();var r=this._appConfig,n=this._mapScene,i=new Set(this._causesOfDirtySources);r&&this._dirty.styles&&(this._dirty.styles=!1,r.updateStyles(this._transform)),r&&this._dirty.sources&&(this._dirty.sources=!1,this._causesOfDirtySources.clear(),r.updateSources(this._transform)),r&&n?(this._dirty.preparation=n.prepare(r),this._dirty.placement=n.updatePlacement(r),n.render(r,{showTileDebugInfo:this.isEnabled(Ru.ShowTileDebugInfo),showVectorTileDebugInfo:this.isEnabled(Ru.ShowVectorTileDebugInfo),showLegacyVectorTileDebugInfo:this.isEnabled(Ru.ShowLegacyVectorTileDebugInfo),showLegacyRasterTileDebugInfo:this.isEnabled(Ru.ShowLegacyRasterTileDebugInfo),showCollisionDetection:this.isEnabled(Ru.ShowCollisionDetection),showPoiVertex:this.isEnabled(Ru.ShowPoiVertex),showNetwork:this.isEnabled(Ru.ShowNetwork)})):(this._dirty.preparation=!1,this._dirty.placement=!1);var o=t.browser.now()-e;this.emit(new Pt(x.Render,this,{elapsedTime:o})),this._dirty.sources||this._dirty.preparation||this._dirty.placement?this.requestRepaint():this.isMoving()||(this.emit(new Pt(x.Idle,this)),this._isFinishedScene()&&!this._isMovingEvent(i)&&this.emit(new Pt(x.RenderComplete,this)))}},r.prototype._isMovingEvent=function(e){var r,n;try{for(var i=t.__values(t.__spreadArray([],t.__read(e),!1)),o=i.next();!o.done;o=i.next()){var a=o.value;if(k.has(a))return!0}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!1},r.prototype._isFinishedScene=function(){var e,r;if(!this._appConfig||!this._mapScene)return!0;try{for(var n=t.__values(Object.values(this._dirty)),i=n.next();!i.done;i=n.next())if(i.value)return!1}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!this._appConfig.hasLoadingSources()&&this._mapScene.isFinishedPlacement()},r.prototype._update=function(t){this._appConfig&&(t&&t.indexOf("style:")>-1?this._dirty.styles=!0:(this._dirty.sources=!0,this._causesOfDirtySources.add(t||"unknown")),this.requestRepaint())},r.prototype.requestRepaint=function(){var t,e=this;this._frame||(this._frame=(t=be((function(t){e._frame=null,e._render()})),{cancel:function(){return be.cancel(t)}}))},r.prototype.cancelRepaint=function(){this._frame&&(this._frame.cancel(),this._frame=null)},r.prototype.resize=function(t){var e=o(this._container),r=e.width,n=e.height;this._resizeCanvas(r,n),this._transform.resize(r,n),this._mapScene&&this._mapScene.resize(r,n),this.emit(new Pt(x.Resize,this,t))},r.prototype.getContainer=function(){return this._container},r.prototype.getCanvasContainer=function(){return this._canvasContainer},r.prototype.getCanvas=function(){return this._canvas},r.prototype.getOverlayContainer=function(){return this._overlayContainer},r.prototype.getTransform=function(){return this._transform},r.prototype.getCamera=function(){return this._camera},r.prototype.getMapOverlay=function(){return this._mapOverlay},r.prototype.project=function(t){return this._transform.lngLatToScreenPoint(t)},r.prototype.unproject=function(t){return this._transform.screenPointToLngLat(t)},r.prototype.setControlDock=function(t,e){return this._controlDocks.setDock(t,e)},r.prototype.getControlDock=function(t){return this._controlDocks.getDock(t)},r.prototype.addControl=function(t,e){if(void 0===e&&(e=St.Default),!this._controlSet.has(t)){var r=t.createDom(this);this._controlSet.add({control:t,element:r,dockName:e}),this._controlDocks.addControl(e,r),t.onAdd(this)}return this},r.prototype.removeControl=function(t){var e=this._controlSet.find(t);return e>-1&&(g(this._controlSet.remove(e).element),t.onRemove(this)),this},r.prototype.replaceControl=function(t,e){var r=this._controlSet.find(e);if(r>-1){var n={control:t,element:t.createDom(this),dockName:this._controlSet.get(r).dockName},i=this._controlSet.replace(r,n);this._controlDocks.replaceControl(n.dockName,n.element,i.element),n.control.onAdd(this),g(i.element),i.control.onRemove(this)}return this},r.prototype.destroy=function(){for(this._destroyed=!0;this._controlSet.size()>0;){var t=this._controlSet.remove(this._controlSet.size()-1),e=t.control;g(t.element),e.onRemove(this)}this.cancelRepaint(),this._renderTaskScheduler.clear(),this.setConfig(null),this._mapInteraction.unbind(),this._domEventRegistrations.forEach(h),this.removeAllListeners(),this._mapScene&&this._mapScene.destroy(),g(this._canvasContainer),g(this._controlContainer),g(this._alt),this._container.classList.remove("vsm-container"),this._alt.classList.remove("vsm-alt"),this.emit(new Pt(x.Destroy,this))},r.prototype.enable=function(){for(var e,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];try{for(var o=t.__values(n),a=o.next();!a.done;a=o.next()){var s=a.value;this._enabledAdditionalFuncNames.add(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return this.requestRepaint(),this},r.prototype.disable=function(){for(var e,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];try{for(var o=t.__values(n),a=o.next();!a.done;a=o.next()){var s=a.value;this._enabledAdditionalFuncNames.delete(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return this.requestRepaint(),this},r.prototype.isEnabled=function(t){return this._enabledAdditionalFuncNames.has(t)},r.prototype.setConfig=function(e,r,n){var i=this;void 0===r&&(r={}),void 0===n&&(n={}),this._mutex.acquire().then((function(o){return t.__awaiter(i,void 0,void 0,(function(){return t.__generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,,2,3]),[4,t.__awaiter(i,void 0,void 0,(function(){var i;return t.__generator(this,(function(o){switch(o.label){case 0:return[4,this._clearConfig()];case 1:return o.sent(),e&&(this._appConfig=new os(this,e,r)),i=t.merge([n,this._globalVariables,t.DEFAULT_GLOBAL_VARIABLES],!1),[4,this._setGlobalVariables(i)];case 2:return o.sent(),[2]}}))}))];case 1:return a.sent(),[3,3];case 2:return o(),[7];case 3:return[2]}}))}))}))},r.prototype._clearConfig=function(){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return this._appConfig?[4,this._appConfig.destroy()]:[3,2];case 1:t.sent(),this._appConfig=null,t.label=2;case 2:return[2]}}))}))},r.prototype._setGlobalVariables=function(e){var r;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return this._globalVariables=e,this._transform.setEnlargeScaleFactor(e.enlargeScaleFactor),[2,null===(r=this._appConfig)||void 0===r?void 0:r.setGlobalVariables(e)]}))}))},r.prototype.getConfig=function(){return this._appConfig&&ki(this._appConfig.spec)},r.prototype.getFetchedConfig=function(){return this._appConfig&&ki(this._appConfig.fetchedSpec)},r.prototype.getAvailableStyles=function(){return this._appConfig?this._appConfig.getAvailableStyles():{}},r.prototype.getCurrentStyle=function(){return this._appConfig?this._appConfig.getStyleSpec():null},r.prototype.getStyleProperties=function(t){var e;return void 0===t&&(t={}),null===(e=this._appConfig)||void 0===e?void 0:e.getStyleProperties(t)},r.prototype.setStyleProperties=function(t){var e;null===(e=this._appConfig)||void 0===e||e.setStyleProperties(t),this._update("style:changeStyleProp")},r.prototype.loadStyle=function(e,r){var n;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,null===(n=this._appConfig)||void 0===n?void 0:n.loadStyle(e,r)];case 1:return t.sent(),[2]}}))}))},r.prototype.getId=function(){return this._id},r.prototype.isMoving=function(){return this._camera.isMoving()||this._mapInteraction.isActive()},r.prototype.isInteracting=function(){return this._mapInteraction.isActive()},r.prototype.setInteractive=function(t){this._mapInteraction.setInteractive(t)},r.prototype.getInteractive=function(){return this._mapInteraction.getInteractive()},r.prototype.addStyle=function(e,r){var n;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,null===(n=this._appConfig)||void 0===n?void 0:n.addStyle(e,r)];case 1:return t.sent(),this.requestRepaint(),[2]}}))}))},r.prototype.removeStyle=function(e){var r;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,null===(r=this._appConfig)||void 0===r?void 0:r.removeStyle(e)];case 1:return t.sent(),this.requestRepaint(),[2]}}))}))},r.prototype.getLayer=function(t){var e;return(null===(e=this._appConfig)||void 0===e?void 0:e.getLayer(t))||null},r.prototype.getLayers=function(){var t;return(null===(t=this._appConfig)||void 0===t?void 0:t.getLayers())||null},r.prototype.addLayer=function(e,r){var n;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,null===(n=this._appConfig)||void 0===n?void 0:n.addLayer(e,r)];case 1:return t.sent(),this._update("addLayer"),[2]}}))}))},r.prototype.removeLayer=function(e){var r;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,null===(r=this._appConfig)||void 0===r?void 0:r.removeLayer(e)];case 1:return t.sent(),this.requestRepaint(),[2]}}))}))},r.prototype.hasLayer=function(t){var e;return!!(null===(e=this._appConfig)||void 0===e?void 0:e.getLayer(t))},r.prototype.updateGeoJsonSourceData=function(e,r){var n;return t.__awaiter(this,void 0,void 0,(function(){var i;return t.__generator(this,(function(t){switch(t.label){case 0:return(i=null===(n=this._appConfig)||void 0===n?void 0:n.getSource(e))?[4,i.updateData(r)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},r.prototype.addImageResources=function(e,r,n){var i;return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,null===(i=this._appConfig)||void 0===i?void 0:i.addImageResources(e,r,n)];case 1:return t.sent(),[2]}}))}))},r.prototype.queryRenderedFeatures=function(e,r){var n;return void 0===r&&(r={buffer:0}),!this._appConfig||this._optimize.noQuery?t.toGeoJsonFeatureCollection([]):this._appConfig.queryRenderedFeatures(e,r,this._transform,null===(n=this._mapScene)||void 0===n?void 0:n.getPlacementResult())},r.prototype.getActiveLayers=function(){return this._appConfig?this._appConfig.getActiveLayers().map((function(t){return{id:t.getId(),type:t.getType()}})):[]},r.prototype.getPoiScale=function(){var t=this._globalVariables;return{fontScale:t.fontScale,iconScale:t.iconScale}},r.prototype.setPoiScale=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i;return t.__generator(this,(function(o){switch(o.label){case 0:return r=this._globalVariables,n=e.fontScale,i=e.iconScale,t.isNum(n)&&r.fontScale!==n||t.isNum(i)&&r.iconScale!==i?[4,this._setGlobalVariables({fontScale:null!=n?n:r.fontScale,iconScale:null!=i?i:r.iconScale,enlargeScaleFactor:r.enlargeScaleFactor,customStyleProperties:r.customStyleProperties})]:[3,2];case 1:o.sent(),this._update("style:poiScale"),o.label=2;case 2:return[2]}}))}))},r.prototype.getEnlargeScaleFactor=function(){return this._globalVariables.enlargeScaleFactor},r.prototype.setEnlargeScaleFactor=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(r){switch(r.label){case 0:return this._globalVariables.enlargeScaleFactor===e?[2]:[4,this._setGlobalVariables(t.__assign(t.__assign({},this._globalVariables),{enlargeScaleFactor:e}))];case 1:return r.sent(),this._update("style:enlargeScaleFactor"),[2]}}))}))},r.prototype.getCustomStyleProperties=function(){return t.__assign({},this._globalVariables.customStyleProperties)},r.prototype.setCustomStyleProperties=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(r){switch(r.label){case 0:return oo(this._globalVariables.customStyleProperties,e)?[2]:[4,this._setGlobalVariables(t.__assign(t.__assign({},this._globalVariables),{customStyleProperties:t.__assign({},e)}))];case 1:return r.sent(),this._update("style:customProperties"),[2]}}))}))},r.prototype.reload=function(t){this._appConfig&&this._update("reload")},r.prototype.getOptimize=function(){return this._optimize},r}(t.EventEmitter);uh.ControlDockNames=St,uh.EventNames=x,uh.ErrorNames=t.MapErrorName,uh.AdditionalFuncNames=Ru,uh.TileServiceNames=t.TileServiceName,uh.isSupported=function(t){return null!==co(ho,t)};var hh=uh;Xa.init();var ch={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},fh=function(e){function r(t){void 0===t&&(t={});var r,n,i,o,a=this;return(a=e.call(this)||this)._updateHandler=a._update.bind(a),a._offset=null!==(r=t.offset)&&void 0!==r?r:{x:0,y:0},a._anchor=null!==(n=t.anchor)&&void 0!==n?n:"center",a._hideOnUpdate=null!==(i=t.hideOnUpdate)&&void 0!==i&&i,function(t){return!("element"in t)}(t)?(a._element=dh(t),a._anchor=null!==(o=t.anchor)&&void 0!==o?o:"bottom"):a._element=t.element,a._element.classList.add("vsm-marker"),t.lngLat&&a.setLngLat(t.lngLat),t.map&&a.setMap(t.map),a}return t.__extends(r,e),r.prototype.setMap=function(t){t?(this._map=t,this._hideOnUpdate?(t.getOverlayContainer().appendChild(this._element),this._update(),this._map.getMapOverlay().on("update",this._updateHandler)):(t.getCanvasContainer().appendChild(this._element),this._update(),this._map.on(x.Move,this._updateHandler),this._map.on(x.MoveEnd,this._updateHandler),this._map.on(x.Resize,this._updateHandler))):this.destroy()},r.prototype.destroy=function(){g(this._element),this._map&&(this._hideOnUpdate?this._map.getMapOverlay().off("update",this._updateHandler):(this._map.off(x.Move,this._updateHandler),this._map.off(x.MoveEnd,this._updateHandler),this._map.off(x.Resize,this._updateHandler)),this._map=null)},r.prototype.getElement=function(){return this._element},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(t){this._lngLat=t,this._update()},r.prototype.getAnchor=function(){return this._anchor},r.prototype.setAnchor=function(t){this._anchor=t,this._update()},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(t){this._offset=t,this._update()},r.prototype._update=function(){if(this._map&&this._lngLat){var t,e,r=this._map.project(this._lngLat),n=r.x,i=r.y;if(this._hideOnUpdate){var o=this._map.getMapOverlay().translate;n-=o.x,i-=o.y}t=this._element,e="".concat(ch[this._anchor]," translate(").concat(n+this._offset.x,"px, ").concat(i+this._offset.y,"px)"),t.style.transform=e}},r}(t.EventEmitter),ph=fh,dh=function(t){var e=t.scale,r=t.color,o=n("div"),a=i('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="35.25px" width="27px" viewBox="0 0 27 35.25" style="display: block">\n    <g fill-rule="nonzero">\n        <g fill="currentColor">\n            <path d="M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z" />\n        </g>\n        <g opacity="0.25" fill="#000000" style=" ">\n            <path d="M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z" />\n        </g>\n        <g fill="#FFFFFF" transform="translate(8.0, 8.0)">\n            <circle cx="5.5" cy="5.5" r="5.4999962" />\n        </g>\n    </g>\n</svg>',"",o);return a&&e&&(a.setAttributeNS(null,"height","".concat(35.25*e,"px")),a.setAttributeNS(null,"width","".concat(27*e,"px"))),o.style.color=null!=r?r:"#007cff",o},yh=Object.freeze({__proto__:null,FirstPaintChecker:ls,getConnectionLimits:function(){return t.__assign({},Xa.globalProperties.connectionLimits)},setConnectionLimits:function(e){Xa.globalProperties.connectionLimits=t.__assign(t.__assign({},Xa.globalProperties.connectionLimits),e);var r=e.maxConnectionsPerHost,n=e.maxConnections,i=e.maxConnectionsPerHostForEachWorker,o=e.maxConnectionsForEachWorker;if(t.ajax.setConnectionLimits({maxConnectionsPerHost:r,maxConnections:n}),i||o){var a=t.v4(),s=ts(),l=s.acquire(a);setTimeout((function(){var e,r;try{for(var n=t.__values(l),u=n.next();!u.done;u=n.next()){var h=u.value,c={type:"Global",method:"SetConnectionLimits",params:{maxConnectionsPerHost:i,maxConnections:o}};h.postMessage(c)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}s.release(a)}),0)}}}),gh=function(e,r,n,i,o){var a=function(t){for(var e=r[0],n=1;n<r.length&&!(r[n].min>t);n++)e=r[n];return e.stackId},s={type:"FeatureCollection",features:[]};if(n)for(var l=t.__read(o.x,2),u=l[0],h=l[1],c=t.__read(o.y,2),f=c[0],p=c[1],d=u;d<h+1;d++)for(var y=f;y<p+1;y++){var g="".concat(d,":").concat(y);if(e[g]){var v=e[g],_=v.geometry,m=v.count,b=v.sum,x={type:"Feature",geometry:_,properties:{count:m,value:b,stackId:M=a(b)}};s.features.push(x)}else{var w=_h(d,y,i),M=a(0);x={type:"Feature",geometry:{type:"Polygon",coordinates:mh(w)},properties:{count:0,value:0,stackId:M}},s.features.push(x)}}else Object.keys(e).sort().forEach((function(t){var r=e[t],n=r.geometry,i=r.count,o=r.sum,l={type:"Feature",geometry:n,properties:{count:i,value:o,stackId:a(o)}};s.features.push(l)}));return s},vh=function(e,r,n){var i=t.epsg4326ToEpsg3857({x:e,y:r}),o=i.x,a=i.y;return[Math.floor((o-t.GoogleMap.BOUNDS.minX)/n),Math.floor((t.GoogleMap.BOUNDS.maxY-a)/n)]},_h=function(e,r,n){var i=t.epsg3857ToEpsg4326({x:t.GoogleMap.BOUNDS.minX+e*n,y:t.GoogleMap.BOUNDS.maxY-(r+1)*n}),o=i.x,a=i.y,s=t.epsg3857ToEpsg4326({x:t.GoogleMap.BOUNDS.minX+(e+1)*n,y:t.GoogleMap.BOUNDS.maxY-r*n});return{minX:o,minY:a,maxX:s.x,maxY:s.y}},mh=function(t){var e=t.minX,r=t.minY,n=t.maxX,i=t.maxY;return[[[e,r],[n,r],[n,i],[e,i],[e,r]]]},bh=Object.freeze({__proto__:null,convert:function(e,r){void 0===r&&(r={});var n=r.size,i=void 0===n?1e4:n,o=r.domain,a=void 0===o?"korea":o,s=r.valuePropName,l=r.fillBlank,u=void 0!==l&&l,h=r.styles,c=i*("world"===a?1:1.2),f=function(e,r,n,i){var o={},a=1/0,s=-1/0,l=1/0,u=-1/0,h=1/0,c=-1/0;return e.features.forEach((function(e){var f;if(n){if(!e.properties||!e.properties[n])return;f=t.toFloat(e.properties[n])}else f=1;var p=e.geometry.coordinates,d=t.__read(vh(p[0],p[1],r),2),y=d[0],g=d[1],v="".concat(y,":").concat(g);if(o[v])o[v].count++,o[v].sum+=f;else{var _=_h(y,g,r);o[v]={geometry:{type:"Polygon",coordinates:mh(_)},count:1,sum:f}}var m=o[v].sum;a=m<a?m:a,s=m>s?m:s,i&&(l=l<y?l:y,h=h<g?h:g,u=u>y?u:y,c=c>g?c:g)})),{squares:o,min:a,max:s,indexRange:{x:[l,u],y:[h,c]}}}(e,c,s,u),p=f.squares,d=f.min,y=f.max,g=f.indexRange;if(!h){var v=(y-d)/5;h=t.genGradient("rgba(255, 0, 0, 0.1)","rgba(255, 0, 0, 0.8)",5).map((function(t,e){var r=d+v*e,n="rgba(".concat([255*t[0],255*t[1],255*t[2],t[3]].join(","),")");return{value:r,style:{fill:n,stroke:n,"stroke-width":.3}}})),u&&h.unshift({value:0,style:{fill:"rgba(0,0,0,0.1)",stroke:"rgba(0,0,0,0.1)","stroke-width":.3}})}var _=function(t,e){for(var r=[],n={},i=[],o=0;o<t.length;o++){var a=o,s=t[o],l=s.value,u=s.style;r.push({id:a,name:" - stack:".concat(o),geometryType:"POLYGON"}),n[a]=[{id:o,condition:"",priority:1,geometry:u}],i.push({stackId:a,min:l,max:o===t.length-1?e:t[o+1].value,style:u})}return{stacks:r,styles:n,legends:i}}(h,y),m=_.stacks,b=_.styles,x=_.legends;return{stacks:m,styles:b,legends:x,featureCollection:gh(p,x,u,c,g)}}}),xh=Object.freeze({__proto__:null,POI_SCALE:{small:{fontScale:.869,iconScale:.818},normal:{fontScale:1,iconScale:1},large:{fontScale:1.154,iconScale:1.091}},getClickableLookupFilter:function(t){return function(e){var r,n,i=e.geometryType,o=e.layerId,a=e.stackId;if(e.getFeatureProperty("stackId"))return!0;if("POINT"===i){var s=null===(n=null===(r=t.getLayer(o))||void 0===r?void 0:r.getStack(a))||void 0===n?void 0:n.getNoPopupCategories();if(!s)return!0;for(var l=[e.getFeatureProperty("categoryLargeId"),e.getFeatureProperty("categoryMediumId"),e.getFeatureProperty("categorySmallId"),e.getFeatureProperty("categoryDetailId")],u=!1,h=0,c=s.length;h<c&&!(u=s[h].split(",").every((function(t,e){return t===l[e]})));h++);return!u}return!1}},isEnoughSpec:function(e){void 0===e&&(e={and:7});var r=Me.device.type,n=Me.os,i=n.name,o=n.version,a=!0;if(r&&["mobile","tablet"].indexOf(r)>-1&&i&&o){var s=[];e.ios&&s.push({name:"iOS",min:e.ios}),e.and&&s.push({contain:"Android",min:e.and});var l=t.__read(o.split(".").map((function(t){return parseInt(t)})),3)[0];a=!s.some((function(t){return t.name?i===t.name&&l<t.min:t.contain?i.indexOf(t.contain)>-1&&l<t.min:void 0}))}return a},setBuildingVisibility:function(t,e){var r;null===(r=t.getLayers())||void 0===r||r.forEach((function(t){t.getStacks().forEach((function(t){t.getProperties().bda&&t.setVisibility(e)}))})),t.requestRepaint()}});return{Map:hh,Event:t.Event,LngLat:t.LngLat,LngLatBounds:It,TileId:t.TileId,Marker:ph,MapControls:{AbstractMapControl:e,MapControlContainer:w,LayoutControl:q,GroupControl:V,ButtonControl:M,CenterPointerControl:T,ZoomInControl:nt,ZoomOutControl:ot,CompassControl:A,PitchAlignerControl:et,NavigationControl:st,FullScreenControl:N,HtmlElementControl:G,ScaleBarControl:ft,MyLocationControl:$,TransformViewControl:yt,MousePointControl:K,ViewFinderControl:_t,layoutCtrl:q.from,layoutCtrlClass:q.fromClass,layoutCtrlStyle:q.fromStyle,createDock:z,isInstanceOfMapControl:U},Extensions:{Common:yh,TmapUtils:xh,SquareMapUtils:bh},registerWorker:Wa.registerWorker,__info:{version:"1.1.2",timestamp:"2023. 08. 16. 14:08:03",profile:"production"}}})),r.type="deps";r.type,r.name,r.dependencies;const n=r.factory;let i;!function(t,e){i={dependencies:t,factory:e}}(["./CommonModule"],(function(t){var e=function(){function e(e){this._actor=e,this.resourceRegistry={},this._refCounts={},this._glyphCache={},this._iconCache={},this._glyphMutex=new t.Mutex,this._iconMutex=new t.Mutex}return e.prototype.registerAll=function(e,r){var n,i;this.resourceRegistry[e]=r;try{for(var o=t.__values(Object.values(r)),a=o.next();!a.done;a=o.next()){var s=a.value.url;this._refCounts[s]=this._refCounts[s]||0,this._refCounts[s]++}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e.prototype.register=function(t,e){this.resourceRegistry[t][e.code]=e;var r=e.url;this._refCounts[r]=this._refCounts[r]||0,this._refCounts[r]++},e.prototype.unregister=function(e){var r,n;if(this.resourceRegistry[e]){try{for(var i=t.__values(Object.entries(this.resourceRegistry[e])),o=i.next();!o.done;o=i.next()){var a=t.__read(o.value,2),s=a[0],l=a[1].url;this._refCounts[l]&&(this._refCounts[l]--,0===this._refCounts[l]&&(this._removeCache(s,l),delete this._refCounts[l]))}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}delete this.resourceRegistry[e]}},e.prototype._removeCache=function(t,e){var r=this;"FONTS"===t?this._glyphMutex.acquire().then((function(t){delete r._glyphCache[e],t()})):this._iconMutex.acquire().then((function(t){delete r._iconCache[e],t()}))},e.prototype.getGlyphs=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,u,h,c=this;return t.__generator(this,(function(f){switch(f.label){case 0:return(n=this.resourceRegistry[e].FONTS)&&n.url?(i=n.url,[4,this._glyphMutex.runExclusive((function(){return c._getGlyphCacheItem(e,i)}))]):[2,{}];case 1:return o=f.sent(),a=o.glyphPathFactory,s=o.glyphMap,l=this._toFontStackPaths(r,a),u=this._separateGlyphs(e,l,s),h=u.glyphMap,0===u.needToRequest.length?[2,h]:[2,this._glyphMutex.runExclusive((function(){return t.__awaiter(c,void 0,void 0,(function(){var r,n,i,o,a,u,h,c,f,p,d;return t.__generator(this,(function(y){switch(y.label){case 0:return r=this._separateGlyphs(e,l,s),n=r.glyphMap,i=r.needToRequest,[4,this._requestGlyphs(e,i,s)];case 1:o=y.sent();try{for(a=t.__values(Object.entries(o)),u=a.next();!u.done;u=a.next())h=t.__read(u.value,2),c=h[0],f=h[1],n[c]=t.__assign(t.__assign({},n[c]),f)}catch(t){p={error:t}}finally{try{u&&!u.done&&(d=a.return)&&d.call(a)}finally{if(p)throw p.error}}return[2,n]}}))}))}))]}}))}))},e.prototype._getGlyphCacheItem=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i;return t.__generator(this,(function(t){switch(t.label){case 0:return this._glyphCache[r]?[2,this._glyphCache[r]]:[4,this._trySend(e,"GetGlyphPathFactory",{})];case 1:return n=t.sent(),i={glyphPathFactory:n,glyphMap:{}},this._glyphCache[r]=i,[2,i]}}))}))},e.prototype._toFontStackPaths=function(e,r){var n,i,o=[],a=function(e,n){var i=t.unique(n.map((function(t){return r.createPath(e,t)})));o.push({fontStack:e,paths:i})};try{for(var s=t.__values(Object.entries(e)),l=s.next();!l.done;l=s.next()){var u=t.__read(l.value,2);a(u[0],u[1])}}catch(t){n={error:t}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},e.prototype._separateGlyphs=function(e,r,n){var i,o,a,s,l={},u=[];try{for(var h=t.__values(r),c=h.next();!c.done;c=h.next()){var f=c.value,p=f.fontStack,d=f.paths,y=[];l[p]={};try{for(var g=(a=void 0,t.__values(d)),v=g.next();!v.done;v=g.next()){var _=v.value;n[_]?l[p]=t.__assign(t.__assign({},l[p]),n[_]):y.push(_)}}catch(t){a={error:t}}finally{try{v&&!v.done&&(s=g.return)&&s.call(g)}finally{if(a)throw a.error}}y.length>0&&u.push({fontStack:p,paths:y})}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return{glyphMap:l,needToRequest:u}},e.prototype._requestGlyphs=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b;return t.__generator(this,(function(x){switch(x.label){case 0:return 0===r.length?[2,{}]:[4,this._trySend(e,"GetGlyphs",r)];case 1:i=x.sent(),o={};try{for(a=t.__values(Object.entries(i)),s=a.next();!s.done;s=a.next()){l=t.__read(s.value,2),u=l[0],h=l[1];try{for(m=void 0,c=t.__values(h),f=c.next();!f.done;f=c.next())p=f.value,d=p.path,y=p.raw,g=t.parseSdf(y),n[d]=g,o[u]=t.__assign(t.__assign({},o[u]),g)}catch(t){m={error:t}}finally{try{f&&!f.done&&(b=c.return)&&b.call(c)}finally{if(m)throw m.error}}}}catch(t){v={error:t}}finally{try{s&&!s.done&&(_=a.return)&&_.call(a)}finally{if(v)throw v.error}}return[2,o]}}))}))},e.prototype.getIcons=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o=this;return t.__generator(this,(function(a){return n=this._separateIcons(e,r),i=n.iconMap,0===n.needToRequest.length?[2,i]:[2,this._iconMutex.runExclusive((function(){return t.__awaiter(o,void 0,void 0,(function(){var n,i,o,a;return t.__generator(this,(function(s){switch(s.label){case 0:return n=this._separateIcons(e,r),i=n.iconMap,o=n.needToRequest,[4,this._requestIcons(e,o)];case 1:return a=s.sent(),[2,t.__assign(t.__assign({},i),a)]}}))}))}))]}))}))},e.prototype._separateIcons=function(e,r){var n,i,o={},a=[],s=this.resourceRegistry[e];try{for(var l=t.__values(r),u=l.next();!u.done;u=l.next()){var h=u.value,c=h.toString(),f=s[h.packageName];if(f&&f.url){var p=f.url;this._iconCache[p]=this._iconCache[p]||{};var d=this._iconCache[p][c];d?o[c]=d:a.push(h)}}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return{iconMap:o,needToRequest:a}},e.prototype._requestIcons=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,u,h,c,f,p;return t.__generator(this,(function(d){switch(d.label){case 0:return 0===r.length?[2,{}]:[4,this._trySend(e,"GetIcons",r)];case 1:n=d.sent(),i=this.resourceRegistry[e];try{for(o=t.__values(Object.entries(n)),a=o.next();!a.done;a=o.next())s=t.__read(a.value,2),l=s[0],u=s[1],h=t.IconId.parse(l).packageName,(c=i[h].url)&&(this._iconCache[c]=this._iconCache[c]||{},this._iconCache[c][l]=u)}catch(t){f={error:t}}finally{try{a&&!a.done&&(p=o.return)&&p.call(o)}finally{if(f)throw f.error}}return[2,n]}}))}))},e.prototype._trySend=function(t,e,r){try{return this._actor.send(t,e,r)}catch(t){throw new Error("Could not get resources")}},e}(),r=function(){function e(t,e){this._resourceManager=t,this._mapId=e}return e.prototype.registerAll=function(t){this._resourceManager.registerAll(this._mapId,t)},e.prototype.register=function(t){this._resourceManager.register(this._mapId,t)},e.prototype.unregister=function(){this._resourceManager.unregister(this._mapId)},e.prototype.getGlyphs=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,this._resourceManager.getGlyphs(this._mapId,e)]}))}))},e.prototype.getIcons=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,this._resourceManager.getIcons(this._mapId,e)]}))}))},e}(),n=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))},i=function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},o=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},a=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},s=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(){function t(e){void 0===e&&(e=t.minComparator);var r=this;this.compare=e,this.heapArray=[],this._limit=0,this.offer=this.add,this.element=this.peek,this.poll=this.pop,this._invertedCompare=function(t,e){return r.compare(t,e).then((function(t){return-1*t}))}}t.getChildrenIndexOf=function(t){return[2*t+1,2*t+2]},t.getParentIndexOf=function(t){if(t<=0)return-1;var e=t%2?1:2;return Math.floor((t-e)/2)},t.getSiblingIndexOf=function(t){return t<=0?-1:t+(t%2?1:-1)},t.minComparator=function(t,e){return n(this,void 0,void 0,(function(){return i(this,(function(r){return t>e?[2,1]:t<e?[2,-1]:[2,0]}))}))},t.maxComparator=function(t,e){return n(this,void 0,void 0,(function(){return i(this,(function(r){return e>t?[2,1]:e<t?[2,-1]:[2,0]}))}))},t.minComparatorNumber=function(t,e){return n(this,void 0,void 0,(function(){return i(this,(function(r){return[2,t-e]}))}))},t.maxComparatorNumber=function(t,e){return n(this,void 0,void 0,(function(){return i(this,(function(r){return[2,e-t]}))}))},t.defaultIsEqual=function(t,e){return n(this,void 0,void 0,(function(){return i(this,(function(r){return[2,t===e]}))}))},t.print=function(e){function r(e){var r=t.getParentIndexOf(e);return Math.floor(Math.log2(r+1))}function n(t,e){for(var r="";e>0;--e)r+=t;return r}for(var i=0,o=[],a=r(e.length-1)+2,s=0;i<e.length;){var l=r(i)+1;0===i&&(l=0);var u=String(e.get(i));u.length>s&&(s=u.length),o[l]=o[l]||[],o[l].push(u),i+=1}return o.map((function(t,e){var r=Math.pow(2,a-e)-1;return n(" ",Math.floor(r/2)*s)+t.map((function(t){var e=(s-t.length)/2;return n(" ",Math.ceil(e))+t+n(" ",Math.floor(e))})).join(n(" ",r*s))})).join("\n")},t.heapify=function(e,r){return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return(n=new t(r)).heapArray=e,[4,n.init()];case 1:return i.sent(),[2,n]}}))}))},t.heappop=function(e,r){var n=new t(r);return n.heapArray=e,n.pop()},t.heappush=function(e,r,o){return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return(n=new t(o)).heapArray=e,[4,n.push(r)];case 1:return i.sent(),[2]}}))}))},t.heappushpop=function(e,r,n){var i=new t(n);return i.heapArray=e,i.pushpop(r)},t.heapreplace=function(e,r,n){var i=new t(n);return i.heapArray=e,i.replace(r)},t.heaptop=function(e,r,n){void 0===r&&(r=1);var i=new t(n);return i.heapArray=e,i.top(r)},t.heapbottom=function(e,r,n){void 0===r&&(r=1);var i=new t(n);return i.heapArray=e,i.bottom(r)},t.nlargest=function(e,r,s){return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return(n=new t(s)).heapArray=a([],o(r),!1),[4,n.init()];case 1:return i.sent(),[2,n.top(e)]}}))}))},t.nsmallest=function(e,r,s){return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return(n=new t(s)).heapArray=a([],o(r),!1),[4,n.init()];case 1:return i.sent(),[2,n.bottom(e)]}}))}))},t.prototype.add=function(t){return n(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this._sortNodeUp(this.heapArray.push(t)-1)];case 1:return e.sent(),this._applyLimit(),[2,!0]}}))}))},t.prototype.addAll=function(t){return n(this,void 0,void 0,(function(){var e,r,n;return i(this,(function(i){switch(i.label){case 0:e=this.length,(n=this.heapArray).push.apply(n,a([],o(t),!1)),r=this.length,i.label=1;case 1:return e<r?[4,this._sortNodeUp(e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return++e,[3,1];case 4:return this._applyLimit(),[2,!0]}}))}))},t.prototype.bottom=function(t){return void 0===t&&(t=1),n(this,void 0,void 0,(function(){return i(this,(function(e){return 0===this.heapArray.length||t<=0?[2,[]]:1===this.heapArray.length?[2,[this.heapArray[0]]]:t>=this.heapArray.length?[2,a([],o(this.heapArray),!1)]:[2,this._bottomN_push(~~t)]}))}))},t.prototype.check=function(){return n(this,void 0,void 0,(function(){var t,e,r,n,o,a,l,u,h;return i(this,(function(i){switch(i.label){case 0:t=0,i.label=1;case 1:if(!(t<this.heapArray.length))return[3,10];e=this.heapArray[t],r=this.getChildrenOf(t),i.label=2;case 2:i.trys.push([2,7,8,9]),u=void 0,n=s(r),o=n.next(),i.label=3;case 3:return o.done?[3,6]:(a=o.value,[4,this.compare(e,a)]);case 4:if(i.sent()>0)return[2,e];i.label=5;case 5:return o=n.next(),[3,3];case 6:return[3,9];case 7:return l=i.sent(),u={error:l},[3,9];case 8:try{o&&!o.done&&(h=n.return)&&h.call(n)}finally{if(u)throw u.error}return[7];case 9:return++t,[3,1];case 10:return[2]}}))}))},t.prototype.clear=function(){this.heapArray=[]},t.prototype.clone=function(){var e=new t(this.comparator());return e.heapArray=this.toArray(),e._limit=this._limit,e},t.prototype.comparator=function(){return this.compare},t.prototype.contains=function(e,r){return void 0===r&&(r=t.defaultIsEqual),n(this,void 0,void 0,(function(){var t,n,o,a,l,u;return i(this,(function(i){switch(i.label){case 0:i.trys.push([0,5,6,7]),t=s(this.heapArray),n=t.next(),i.label=1;case 1:return n.done?[3,4]:(o=n.value,[4,r(o,e)]);case 2:if(i.sent())return[2,!0];i.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return a=i.sent(),l={error:a},[3,7];case 6:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(l)throw l.error}return[7];case 7:return[2,!1]}}))}))},t.prototype.init=function(t){return n(this,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:t&&(this.heapArray=a([],o(t),!1)),e=Math.floor(this.heapArray.length),r.label=1;case 1:return e>=0?[4,this._sortNodeDown(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return--e,[3,1];case 4:return this._applyLimit(),[2]}}))}))},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.leafs=function(){if(0===this.heapArray.length)return[];var e=t.getParentIndexOf(this.heapArray.length-1);return this.heapArray.slice(e+1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.heapArray.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit=~~t,this._applyLimit()},enumerable:!1,configurable:!0}),t.prototype.peek=function(){return this.heapArray[0]},t.prototype.pop=function(){return n(this,void 0,void 0,(function(){var t;return i(this,(function(e){return t=this.heapArray.pop(),this.length>0&&void 0!==t?[2,this.replace(t)]:[2,t]}))}))},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n(this,void 0,void 0,(function(){return i(this,(function(e){return t.length<1?[2,!1]:1===t.length?[2,this.add(t[0])]:[2,this.addAll(t)]}))}))},t.prototype.pushpop=function(t){return n(this,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:return[4,this.compare(this.heapArray[0],t)];case 1:return r.sent()<0?(e=o([this.heapArray[0],t],2),t=e[0],this.heapArray[0]=e[1],[4,this._sortNodeDown(0)]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2,t]}}))}))},t.prototype.remove=function(e,r){return void 0===r&&(r=t.defaultIsEqual),n(this,void 0,void 0,(function(){var t,n;return i(this,(function(i){switch(i.label){case 0:return this.length>0?void 0!==e?[3,2]:[4,this.pop()]:[3,13];case 1:return i.sent(),[2,!0];case 2:t=-1,n=0,i.label=3;case 3:return n<this.heapArray.length?[4,r(this.heapArray[n],e)]:[3,6];case 4:if(i.sent())return t=n,[3,6];i.label=5;case 5:return++n,[3,3];case 6:return t>=0?0!==t?[3,8]:[4,this.pop()]:[3,13];case 7:return i.sent(),[3,12];case 8:return t!==this.length-1?[3,9]:(this.heapArray.pop(),[3,12]);case 9:return this.heapArray.splice(t,1,this.heapArray.pop()),[4,this._sortNodeUp(t)];case 10:return i.sent(),[4,this._sortNodeDown(t)];case 11:i.sent(),i.label=12;case 12:return[2,!0];case 13:return[2,!1]}}))}))},t.prototype.replace=function(t){return n(this,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:return e=this.heapArray[0],this.heapArray[0]=t,[4,this._sortNodeDown(0)];case 1:return r.sent(),[2,e]}}))}))},t.prototype.size=function(){return this.length},t.prototype.top=function(t){return void 0===t&&(t=1),n(this,void 0,void 0,(function(){return i(this,(function(e){return 0===this.heapArray.length||t<=0?[2,[]]:1===this.heapArray.length||1===t?[2,[this.heapArray[0]]]:t>=this.heapArray.length?[2,a([],o(this.heapArray),!1)]:[2,this._topN_push(~~t)]}))}))},t.prototype.toArray=function(){return a([],o(this.heapArray),!1)},t.prototype.toString=function(){return this.heapArray.toString()},t.prototype.get=function(t){return this.heapArray[t]},t.prototype.getChildrenOf=function(e){var r=this;return t.getChildrenIndexOf(e).map((function(t){return r.heapArray[t]})).filter((function(t){return void 0!==t}))},t.prototype.getParentOf=function(e){var r=t.getParentIndexOf(e);return this.heapArray[r]},t.prototype[Symbol.iterator]=function(){return i(this,(function(t){switch(t.label){case 0:return this.length?[4,this.pop()]:[3,2];case 1:return t.sent(),[3,0];case 2:return[2]}}))},t.prototype.iterator=function(){return this},t.prototype._applyLimit=function(){if(this._limit&&this._limit<this.heapArray.length)for(var t=this.heapArray.length-this._limit;t;)this.heapArray.pop(),--t},t.prototype._bottomN_push=function(e){return n(this,void 0,void 0,(function(){var r,n,o,a,s,l;return i(this,(function(i){switch(i.label){case 0:return(r=new t(this.compare)).limit=e,r.heapArray=this.heapArray.slice(-e),[4,r.init()];case 1:for(i.sent(),n=this.heapArray.length-1-e,o=t.getParentIndexOf(n),a=[],l=n;l>o;--l)a.push(l);s=this.heapArray,i.label=2;case 2:return a.length?(l=a.shift(),[4,this.compare(s[l],r.peek())]):[3,6];case 3:return i.sent()>0?[4,r.replace(s[l])]:[3,5];case 4:i.sent(),l%2&&a.push(t.getParentIndexOf(l)),i.label=5;case 5:return[3,2];case 6:return[2,r.toArray()]}}))}))},t.prototype._moveNode=function(t,e){var r;r=o([this.heapArray[e],this.heapArray[t]],2),this.heapArray[t]=r[0],this.heapArray[e]=r[1]},t.prototype._sortNodeDown=function(e){return n(this,void 0,void 0,(function(){var r,o,a,s,l,u,h,c,f=this;return i(this,(function(p){switch(p.label){case 0:r=e<this.heapArray.length-1,o=this.heapArray[e],a=function(t,e){return n(f,void 0,void 0,(function(){var r;return i(this,(function(n){switch(n.label){case 0:return(r=this.heapArray.length>e)?[4,this.compare(this.heapArray[e],this.heapArray[t])]:[3,2];case 1:r=n.sent()<0,n.label=2;case 2:return r&&(t=e),[2,t]}}))}))},p.label=1;case 1:if(!r)return[3,8];s=t.getChildrenIndexOf(e),l=s[0],u=1,p.label=2;case 2:return u<s.length?[4,a(l,s[u])]:[3,5];case 3:l=p.sent(),p.label=4;case 4:return++u,[3,2];case 5:return h=this.heapArray[l],(c=void 0!==h)?[4,this.compare(o,h)]:[3,7];case 6:c=p.sent()>0,p.label=7;case 7:return c?(this._moveNode(e,l),e=l):r=!1,[3,1];case 8:return[2]}}))}))},t.prototype._sortNodeUp=function(e){return n(this,void 0,void 0,(function(){var r,n,o;return i(this,(function(i){switch(i.label){case 0:r=e>0,i.label=1;case 1:return r?(n=t.getParentIndexOf(e),(o=n>=0)?[4,this.compare(this.heapArray[n],this.heapArray[e])]:[3,3]):[3,4];case 2:o=i.sent()>0,i.label=3;case 3:return o?(this._moveNode(e,n),e=n):r=!1,[3,1];case 4:return[2]}}))}))},t.prototype._topN_push=function(e){return n(this,void 0,void 0,(function(){var r,n,s,l;return i(this,(function(i){switch(i.label){case 0:(r=new t(this._invertedCompare)).limit=e,n=[0],s=this.heapArray,i.label=1;case 1:return n.length?(l=n.shift())<s.length?r.length<e?[4,r.push(s[l])]:[3,3]:[3,6]:[3,7];case 2:return i.sent(),n.push.apply(n,a([],o(t.getChildrenIndexOf(l)),!1)),[3,6];case 3:return[4,this.compare(s[l],r.peek())];case 4:return i.sent()<0?[4,r.replace(s[l])]:[3,6];case 5:i.sent(),n.push.apply(n,a([],o(t.getChildrenIndexOf(l)),!1)),i.label=6;case 6:return[3,1];case 7:return[2,r.toArray()]}}))}))},t.prototype._topN_fill=function(e){return n(this,void 0,void 0,(function(){var r,n,s,l,u;return i(this,(function(i){switch(i.label){case 0:return r=this.heapArray,(n=new t(this._invertedCompare)).limit=e,n.heapArray=r.slice(0,e),[4,n.init()];case 1:for(i.sent(),s=t.getParentIndexOf(e-1)+1,l=[],u=s;u<e;++u)l.push.apply(l,a([],o(t.getChildrenIndexOf(u).filter((function(t){return t<r.length}))),!1));(e-1)%2&&l.push(e),i.label=2;case 2:return l.length?(u=l.shift())<r.length?[4,this.compare(r[u],n.peek())]:[3,5]:[3,6];case 3:return i.sent()<0?[4,n.replace(r[u])]:[3,5];case 4:i.sent(),l.push.apply(l,a([],o(t.getChildrenIndexOf(u)),!1)),i.label=5;case 5:return[3,2];case 6:return[2,n.toArray()]}}))}))},t.prototype._topN_heap=function(t){return n(this,void 0,void 0,(function(){var e,r,n,o,a;return i(this,(function(i){switch(i.label){case 0:e=this.clone(),r=[],n=0,i.label=1;case 1:return n<t?(a=(o=r).push,[4,e.pop()]):[3,4];case 2:a.apply(o,[i.sent()]),i.label=3;case 3:return++n,[3,1];case 4:return[2,r]}}))}))},t.prototype._topIdxOf=function(t){return n(this,void 0,void 0,(function(){var e,r,n;return i(this,(function(i){switch(i.label){case 0:if(!t.length)return[2,-1];r=t[e=0],n=1,i.label=1;case 1:return n<t.length?[4,this.compare(t[n],r)]:[3,4];case 2:i.sent()<0&&(e=n,r=t[n]),i.label=3;case 3:return++n,[3,1];case 4:return[2,e]}}))}))},t.prototype._topOf=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return n(this,void 0,void 0,(function(){var r;return i(this,(function(n){switch(n.label){case 0:return[4,(r=new t(this.compare)).init(e)];case 1:return n.sent(),[2,r.peek()]}}))}))}}();var l=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},u=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},h=function(){function t(e){void 0===e&&(e=t.minComparator);var r=this;this.compare=e,this.heapArray=[],this._limit=0,this.offer=this.add,this.element=this.peek,this.poll=this.pop,this._invertedCompare=function(t,e){return-1*r.compare(t,e)}}return t.getChildrenIndexOf=function(t){return[2*t+1,2*t+2]},t.getParentIndexOf=function(t){if(t<=0)return-1;var e=t%2?1:2;return Math.floor((t-e)/2)},t.getSiblingIndexOf=function(t){return t<=0?-1:t+(t%2?1:-1)},t.minComparator=function(t,e){return t>e?1:t<e?-1:0},t.maxComparator=function(t,e){return e>t?1:e<t?-1:0},t.minComparatorNumber=function(t,e){return t-e},t.maxComparatorNumber=function(t,e){return e-t},t.defaultIsEqual=function(t,e){return t===e},t.print=function(e){function r(e){var r=t.getParentIndexOf(e);return Math.floor(Math.log2(r+1))}function n(t,e){for(var r="";e>0;--e)r+=t;return r}for(var i=0,o=[],a=r(e.length-1)+2,s=0;i<e.length;){var l=r(i)+1;0===i&&(l=0);var u=String(e.get(i));u.length>s&&(s=u.length),o[l]=o[l]||[],o[l].push(u),i+=1}return o.map((function(t,e){var r=Math.pow(2,a-e)-1;return n(" ",Math.floor(r/2)*s)+t.map((function(t){var e=(s-t.length)/2;return n(" ",Math.ceil(e))+t+n(" ",Math.floor(e))})).join(n(" ",r*s))})).join("\n")},t.heapify=function(e,r){var n=new t(r);return n.heapArray=e,n.init(),n},t.heappop=function(e,r){var n=new t(r);return n.heapArray=e,n.pop()},t.heappush=function(e,r,n){var i=new t(n);i.heapArray=e,i.push(r)},t.heappushpop=function(e,r,n){var i=new t(n);return i.heapArray=e,i.pushpop(r)},t.heapreplace=function(e,r,n){var i=new t(n);return i.heapArray=e,i.replace(r)},t.heaptop=function(e,r,n){void 0===r&&(r=1);var i=new t(n);return i.heapArray=e,i.top(r)},t.heapbottom=function(e,r,n){void 0===r&&(r=1);var i=new t(n);return i.heapArray=e,i.bottom(r)},t.nlargest=function(e,r,n){var i=new t(n);return i.heapArray=u([],l(r),!1),i.init(),i.top(e)},t.nsmallest=function(e,r,n){var i=new t(n);return i.heapArray=u([],l(r),!1),i.init(),i.bottom(e)},t.prototype.add=function(t){return this._sortNodeUp(this.heapArray.push(t)-1),this._applyLimit(),!0},t.prototype.addAll=function(t){var e,r=this.length;(e=this.heapArray).push.apply(e,u([],l(t),!1));for(var n=this.length;r<n;++r)this._sortNodeUp(r);return this._applyLimit(),!0},t.prototype.bottom=function(t){return void 0===t&&(t=1),0===this.heapArray.length||t<=0?[]:1===this.heapArray.length?[this.heapArray[0]]:t>=this.heapArray.length?u([],l(this.heapArray),!1):this._bottomN_push(~~t)},t.prototype.check=function(){var t=this;return this.heapArray.find((function(e,r){return!!t.getChildrenOf(r).find((function(r){return t.compare(e,r)>0}))}))},t.prototype.clear=function(){this.heapArray=[]},t.prototype.clone=function(){var e=new t(this.comparator());return e.heapArray=this.toArray(),e._limit=this._limit,e},t.prototype.comparator=function(){return this.compare},t.prototype.contains=function(e,r){return void 0===r&&(r=t.defaultIsEqual),this.heapArray.findIndex((function(t){return r(t,e)}))>=0},t.prototype.init=function(t){t&&(this.heapArray=u([],l(t),!1));for(var e=Math.floor(this.heapArray.length);e>=0;--e)this._sortNodeDown(e);this._applyLimit()},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.leafs=function(){if(0===this.heapArray.length)return[];var e=t.getParentIndexOf(this.heapArray.length-1);return this.heapArray.slice(e+1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.heapArray.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit=~~t,this._applyLimit()},enumerable:!1,configurable:!0}),t.prototype.peek=function(){return this.heapArray[0]},t.prototype.pop=function(){var t=this.heapArray.pop();return this.length>0&&void 0!==t?this.replace(t):t},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!(t.length<1)&&(1===t.length?this.add(t[0]):this.addAll(t))},t.prototype.pushpop=function(t){var e;return this.compare(this.heapArray[0],t)<0&&(t=(e=l([this.heapArray[0],t],2))[0],this.heapArray[0]=e[1],this._sortNodeDown(0)),t},t.prototype.remove=function(e,r){if(void 0===r&&(r=t.defaultIsEqual),this.length>0){if(void 0===e)return this.pop(),!0;var n=this.heapArray.findIndex((function(t){return r(t,e)}));if(n>=0)return 0===n?this.pop():n===this.length-1?this.heapArray.pop():(this.heapArray.splice(n,1,this.heapArray.pop()),this._sortNodeUp(n),this._sortNodeDown(n)),!0}return!1},t.prototype.replace=function(t){var e=this.heapArray[0];return this.heapArray[0]=t,this._sortNodeDown(0),e},t.prototype.size=function(){return this.length},t.prototype.top=function(t){return void 0===t&&(t=1),0===this.heapArray.length||t<=0?[]:1===this.heapArray.length||1===t?[this.heapArray[0]]:t>=this.heapArray.length?u([],l(this.heapArray),!1):this._topN_push(~~t)},t.prototype.toArray=function(){return u([],l(this.heapArray),!1)},t.prototype.toString=function(){return this.heapArray.toString()},t.prototype.get=function(t){return this.heapArray[t]},t.prototype.getChildrenOf=function(e){var r=this;return t.getChildrenIndexOf(e).map((function(t){return r.heapArray[t]})).filter((function(t){return void 0!==t}))},t.prototype.getParentOf=function(e){var r=t.getParentIndexOf(e);return this.heapArray[r]},t.prototype[Symbol.iterator]=function(){return function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}(this,(function(t){switch(t.label){case 0:return this.length?[4,this.pop()]:[3,2];case 1:return t.sent(),[3,0];case 2:return[2]}}))},t.prototype.iterator=function(){return this.toArray()},t.prototype._applyLimit=function(){if(this._limit&&this._limit<this.heapArray.length)for(var t=this.heapArray.length-this._limit;t;)this.heapArray.pop(),--t},t.prototype._bottomN_push=function(e){var r=new t(this.compare);r.limit=e,r.heapArray=this.heapArray.slice(-e),r.init();for(var n=this.heapArray.length-1-e,i=t.getParentIndexOf(n),o=[],a=n;a>i;--a)o.push(a);for(var s=this.heapArray;o.length;)a=o.shift(),this.compare(s[a],r.peek())>0&&(r.replace(s[a]),a%2&&o.push(t.getParentIndexOf(a)));return r.toArray()},t.prototype._moveNode=function(t,e){var r;r=l([this.heapArray[e],this.heapArray[t]],2),this.heapArray[t]=r[0],this.heapArray[e]=r[1]},t.prototype._sortNodeDown=function(e){for(var r=this,n=e<this.heapArray.length-1,i=this.heapArray[e],o=function(t,e){return r.heapArray.length>e&&r.compare(r.heapArray[e],r.heapArray[t])<0&&(t=e),t};n;){var a=t.getChildrenIndexOf(e),s=a.reduce(o,a[0]),l=this.heapArray[s];void 0!==l&&this.compare(i,l)>0?(this._moveNode(e,s),e=s):n=!1}},t.prototype._sortNodeUp=function(e){for(var r=e>0;r;){var n=t.getParentIndexOf(e);n>=0&&this.compare(this.heapArray[n],this.heapArray[e])>0?(this._moveNode(e,n),e=n):r=!1}},t.prototype._topN_push=function(e){var r=new t(this._invertedCompare);r.limit=e;for(var n=[0],i=this.heapArray;n.length;){var o=n.shift();o<i.length&&(r.length<e?(r.push(i[o]),n.push.apply(n,u([],l(t.getChildrenIndexOf(o)),!1))):this.compare(i[o],r.peek())<0&&(r.replace(i[o]),n.push.apply(n,u([],l(t.getChildrenIndexOf(o)),!1))))}return r.toArray()},t.prototype._topN_fill=function(e){var r=this.heapArray,n=new t(this._invertedCompare);n.limit=e,n.heapArray=r.slice(0,e),n.init();for(var i=[],o=t.getParentIndexOf(e-1)+1;o<e;++o)i.push.apply(i,u([],l(t.getChildrenIndexOf(o).filter((function(t){return t<r.length}))),!1));for((e-1)%2&&i.push(e);i.length;)(o=i.shift())<r.length&&this.compare(r[o],n.peek())<0&&(n.replace(r[o]),i.push.apply(i,u([],l(t.getChildrenIndexOf(o)),!1)));return n.toArray()},t.prototype._topN_heap=function(t){for(var e=this.clone(),r=[],n=0;n<t;++n)r.push(e.pop());return r},t.prototype._topIdxOf=function(t){if(!t.length)return-1;for(var e=0,r=t[e],n=1;n<t.length;++n)this.compare(t[n],r)<0&&(e=n,r=t[n]);return e},t.prototype._topOf=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=new t(this.compare);return n.init(e),n.peek()},t}(),c=function(){function e(e,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var n=this;this._items={},this._heap=new h((function(t,e){var r=n._items[t],i=n._items[e],o=r.priority-i.priority;if(0!==o)return o;var a=r.timeStamp-i.timeStamp;return 0!==a?a:r.id.localeCompare(i.id)})),this._strategy=e,this._updateInterval=r,this._lastUpdateTime=t.browser.now()}return e.prototype.add=function(e,r,n){var i=t.browser.now();this._updatePriority(i),this._items[e]={id:e,groupId:r,timeStamp:i,metadata:n,priority:this._strategy.getPriority(n,0)},this._heap.push(e)},e.prototype.poll=function(){this._updatePriority(t.browser.now());var e=this._heap.pop();if(e){var r=this._items[e];return delete this._items[e],r}return null},e.prototype.removeIf=function(e){var r,n,i,o,a=Object.values(this._items).filter(e);try{for(var s=t.__values(a),l=s.next();!l.done;l=s.next()){var u=l.value.id;this._heap.remove(u)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}try{for(var h=t.__values(a),c=h.next();!c.done;c=h.next())u=c.value.id,delete this._items[u]}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a},e.prototype.isEmpty=function(){return 0===this._heap.length},e.prototype._updatePriority=function(e){var r,n;if(!(e-this._lastUpdateTime<this._updateInterval)){this._lastUpdateTime=e,this._heap.clear();try{for(var i=t.__values(Object.values(this._items)),o=i.next();!o.done;o=i.next()){var a=o.value,s=a.timeStamp,l=a.metadata;a.priority=this._strategy.getPriority(l,e-s)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this._heap.addAll(Object.keys(this._items))}},e}(),f=c,p=t.cubicBezier(.25,1,.5,1),d={getPriority:function(t,e){var r=t.type,n=t.method,i=function(){switch(r){case"WorkerRequest":switch(n){case"LoadTile":return-2;case"AbortTile":return-1;case"ClearTile":return 100;default:return-10}case"WorkerResponse":return 0;case"EntryPoint":return 11;case"RequestTile":case"ParseTile":return 21;case"CreateStyleData":return 1+(t.lowPriority?200:10)}}();if(i<0)return i;var o=Math.min(e/500,1);return(1-.9*p(o))*i}},y=function(){function e(){var t=this;this._tasks={},this._taskQueue=new f(d,33),this._channel=new MessageChannel,this._signaled=!1,this._channel.port2.onmessage=function(){t._signaled=!1,t._process()}}return e.prototype.submitTask=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i=this;return t.__generator(this,(function(o){return[2,new Promise((function(o,a){var s=t.v4();i._tasks[s]={resolve:o,reject:a},i._taskQueue.add(s,e,t.__assign(t.__assign({},n),{type:r})),i._notifyOne()}))]}))}))},e.prototype.clear=function(t){var e=this._taskQueue.removeIf((function(e){return e.groupId===t}));this._removeTasks(e)},e.prototype.cancelTasks=function(t,e){var r=this._taskQueue.removeIf((function(r){return r.groupId===t&&e(r)}));return this._removeTasks(r),r.length},e.prototype._removeTasks=function(e){var r,n,i,o,a={};try{for(var s=t.__values(e),l=s.next();!l.done;l=s.next())a[f=l.value.id]=this._tasks[f],delete this._tasks[f]}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}var u=e.sort((function(t,e){var r=t.priority-e.priority;if(0!==r)return r;var n=t.timeStamp-e.timeStamp;return 0!==n?n:t.id.localeCompare(e.id)}));try{for(var h=t.__values(u),c=h.next();!c.done;c=h.next()){var f;a[f=c.value.id]&&a[f].reject(t.MapWorkerErrorMessage.ScheduledTaskCancelled)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}},e.prototype._notifyOne=function(){this._signaled||(this._signaled=!0,this._channel.port1.postMessage(!0))},e.prototype._process=function(){var t=this._taskQueue.poll();if(t){var e=t.id,r=t.timeStamp,n=t.priority,i=this._tasks[e];delete this._tasks[e],this._taskQueue.isEmpty()||this._notifyOne(),i&&i.resolve({taskId:e,creationTime:r,priority:n})}},e}(),g=function(){function e(t,e){this._scheduler=t,this._mapId=e}return e.prototype.submitTask=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,this._scheduler.submitTask(this._mapId,e,r)]}))}))},e.prototype.cancelTasks=function(t){return this._scheduler.cancelTasks(this._mapId,t)},e.prototype.clear=function(){this._scheduler.clear(this._mapId)},e}(),v=function(){function e(){}return e.create=function(e,r){try{switch(e.conversionType){case t.GeometryConversionType.Line:return t.LineStackStyleData.valueOf(e,r);case t.GeometryConversionType.BufferedLine:return t.BufferedLineStackStyleData.valueOf(e,r);case t.GeometryConversionType.Crosswalk:return t.CrosswalkStackStyleData.valueOf(e,r);case t.GeometryConversionType.Polygon:return t.PolygonStackStyleData.valueOf(e,r);case t.GeometryConversionType.Building:return t.BuildingStackStyleData.valueOf(e,r);case t.GeometryConversionType.Poi:case t.GeometryConversionType.BackgroundPoi:return t.PoiStackStyleData.valueOf(e,r);case t.GeometryConversionType.RoadName:return t.RoadNameStackStyleData.valueOf(e,r);case t.GeometryConversionType.Circle:case t.GeometryConversionType.Heatmap:return t.CircleStackStyleData.valueOf(e,r);default:return null}}catch(t){return console.warn(t),null}},e}(),_=function(){},m=function(e){function r(t){var r=e.call(this)||this;return r._filters=t,r}return t.__extends(r,e),r.prototype.evaluate=function(e){var r,n;try{for(var i=t.__values(this._filters),o=i.next();!o.done;o=i.next())if(!o.value.evaluate(e))return!1}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!0},r}(_),b=function(){function t(t){this._value=t}return t.prototype.evaluate=function(t){return this._value},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),t}(),x=function(){function t(t){this._name=t}return t.prototype.evaluate=function(t){return t.properties.getPreDefined(this._name)},Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}(),w=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.evaluate=function(t){return!0},r}(_),M=w,S=function(e){function r(t,r,n){void 0===n&&(n=!0);var i=e.call(this)||this;return i._expression1=t,i._expression2=r,i._matchCase=n,i}return t.__extends(r,e),Object.defineProperty(r.prototype,"expression1",{get:function(){return this._expression1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"expression2",{get:function(){return this._expression2},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchCase",{get:function(){return this._matchCase},enumerable:!1,configurable:!0}),r}(_);function P(t){return null==t}function T(t){var e=typeof t;return"string"===e||"boolean"===e||t instanceof Object}function E(t){return new Date(t)}var L=function(e){function r(t,r,n){return void 0===n&&(n=!0),e.call(this,t,r,n)||this}return t.__extends(r,e),r.prototype.evaluate=function(t){var e=this.expression1.evaluate(t),r=this.expression2.evaluate(t);if(e===r)return!0;if(P(e))return P(r);if(P(r))return!1;if(k(e)||k(r))return!0;if("boolean"==typeof e){if("boolean"==typeof r)return!1}else if("number"==typeof e){if("number"==typeof r)return!1;if(T(r))return e===parseFloat(r.toString())}else if(e instanceof Date){if(r instanceof Date)return e.getTime()===r.getTime();if(T(r))return e.getTime()===E(r.toString()).getTime()}else if(T(e)){if("number"==typeof r)return parseFloat(e.toString())===r;if(r instanceof Date)return E(e.toString()).getTime()===r.getTime();if(T(r))return this.matchCase?e.toString()===r.toString():e.toString().toUpperCase()===r.toString().toUpperCase()}return!1},r}(S);function k(t){return"*"===t}var I=function(){function t(){}return t.prototype.evaluate=function(t,e){if(P(t)||P(e))return this.rejectNullType(t,e);if("number"==typeof t){if("number"==typeof e)return this.evaluateNumber(t,e);if(T(e))return this.evaluateNumber(t,parseFloat(e.toString()))}else if(t instanceof Date){if(e instanceof Date)return this.evaluateDate(t,e);if(T(e))return this.evaluateDate(t,E(e.toString()))}else if(T(t)){if("number"==typeof e)return this.evaluateNumber(parseFloat(t.toString()),e);if(e instanceof Date)return this.evaluateDate(E(t.toString()),e);if(T(e))return this.evaluateString(t.toString(),e.toString())}return!1},t}(),A=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.rejectNullType=function(t,e){return!1},r.prototype.evaluateNumber=function(t,e){return t<e},r.prototype.evaluateString=function(t,e){return t.localeCompare(e)<0},r.prototype.evaluateDate=function(t,e){return t.getTime()<e.getTime()},r}(I),C=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.rejectNullType=function(t,e){return P(t)&&P(e)},r.prototype.evaluateNumber=function(t,e){return t<=e},r.prototype.evaluateString=function(t,e){return t.localeCompare(e)<=0},r.prototype.evaluateDate=function(t,e){return t.getTime()<=e.getTime()},r}(I),O=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.rejectNullType=function(t,e){return!1},r.prototype.evaluateNumber=function(t,e){return t>e},r.prototype.evaluateString=function(t,e){return t.localeCompare(e)>0},r.prototype.evaluateDate=function(t,e){return t.getTime()>e.getTime()},r}(I),R=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.rejectNullType=function(t,e){return P(t)&&P(e)},r.prototype.evaluateNumber=function(t,e){return t>=e},r.prototype.evaluateString=function(t,e){return t.localeCompare(e)>=0},r.prototype.evaluateDate=function(t,e){return t.getTime()>=e.getTime()},r}(I),D=function(e){function r(t,r,n){return void 0===n&&(n=!0),e.call(this,t,r,n)||this}return t.__extends(r,e),r.prototype.evaluate=function(t){var e,r;return e=this.expression1.evaluate(t),r=this.expression2.evaluate(t),(new O).evaluate(e,r)},r}(S),F=function(e){function r(t,r,n){return void 0===n&&(n=!0),e.call(this,t,r,n)||this}return t.__extends(r,e),r.prototype.evaluate=function(t){var e,r;return e=this.expression1.evaluate(t),r=this.expression2.evaluate(t),(new R).evaluate(e,r)},r}(S),B=function(e){function r(t,r,n){return void 0===n&&(n=!0),e.call(this,t,r,n)||this}return t.__extends(r,e),r.prototype.evaluate=function(t){var e,r;return e=this.expression1.evaluate(t),r=this.expression2.evaluate(t),(new A).evaluate(e,r)},r}(S),N=function(e){function r(t,r,n){return void 0===n&&(n=!0),e.call(this,t,r,n)||this}return t.__extends(r,e),r.prototype.evaluate=function(t){var e,r;return e=this.expression1.evaluate(t),r=this.expression2.evaluate(t),(new C).evaluate(e,r)},r}(S),z=new M;function U(t){return new b(t)}var j=function(e){function r(t,r){var n=e.call(this)||this;return n._expression=t,n._values=r,n}return t.__extends(r,e),r.prototype.evaluate=function(t){var e=this._expression.evaluate(t);return!!T(e)&&this._values.has(e.toString())},Object.defineProperty(r.prototype,"expression",{get:function(){return this._expression},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"values",{get:function(){return this._values},enumerable:!1,configurable:!0}),r}(_),V=function(){function t(t){this._symbol=t}return t.prototype.getSymbol=function(){return this._symbol},t.prototype.getValue=function(){return this._symbol},t}(),G=function(e){function r(t,r){var n=e.call(this,t)||this;return n._priority=r,n}return t.__extends(r,e),r.prototype.getPriority=function(){return this._priority},r}(V),q=function(e){function r(t){var r=e.call(this,t)||this;return r._paramCount=0,r}return t.__extends(r,e),r.prototype.getPriority=function(){return 1},r.prototype.getParamCount=function(){return this._paramCount},r.prototype.addParamCount=function(t){this._paramCount+=t},r}(V),Z=function(e){function r(t){return e.call(this,t)||this}return t.__extends(r,e),r.prototype.getPriority=function(){return 100},r}(V),W=function(e){function r(t){return e.call(this,t)||this}return t.__extends(r,e),r.prototype.getPriority=function(){return 1},r}(V),H={RoundBracketOpen:new Z("("),RoundBracketClose:new Z(")"),Comma:new Z(","),Dollar:new W("$"),DoubleDollar:new W("$$"),Less:new G("<",4),LessOrEqual:new G("<=",4),Greater:new G(">",4),GreaterOrEqual:new G(">=",4),Equals:new G("=",5),And:new G("AND",6),In:new q("IN")},Y=function(){var e,r,n=new Map;try{for(var i=t.__values(Object.values(H)),o=i.next();!o.done;o=i.next()){var a=o.value;n.set(a.getSymbol().toUpperCase(),a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}();function X(t){return Y.get(t.toUpperCase())}var K=function(){function t(t){this._value=t}return t.prototype.getValue=function(){return this._value},t}(),Q={pageLoadDateTime:new Date},J=function(){function t(){}return t.prototype.get=function(t){return"date_time"===t?Q.pageLoadDateTime:null},t}(),$=function(){function e(){this._array=[]}return e.prototype.push=function(t){return this._array.push(t),this},e.prototype.pushAll=function(e){var r;return(r=this._array).push.apply(r,t.__spreadArray([],t.__read(e),!1)),this},e.prototype.pop=function(){return this._array.pop()},e.prototype.peek=function(){var t=this._array.length;if(0!==t)return this._array[t-1]},e.prototype.isEmpty=function(){return 0===this._array.length},e.prototype.size=function(){return this._array.length},e.copyFrom=function(t){return(new e).pushAll(t._array)},e.reverse=function(t){return(new e).pushAll(t._array.slice().reverse())},e}();function tt(t){return t>=48&&t<=57}function et(t){return 46===t}function rt(t){return 36===t}var nt=function(){function e(t){this._str=t,this._next=0,this._mark=0}return e.prototype.read=function(){return this._next>=this._str.length?-1:this._str.charCodeAt(this._next++)},e.prototype.skip=function(e){var r=this._str.length-this._next;return r<=0?0:(e=t.clamp(e,-this._next,r),this._next+=e,e)},e.prototype.mark=function(){this._mark=this._next},e.prototype.reset=function(){this._next=this._mark},e}(),it=new J,ot=function(){function t(t){void 0===t&&(t={}),this._customProperties=t}return t.prototype.parse=function(t){try{var e=function(t){return t.replace(/{(.*?)}/g,(function(t,e){return"='".concat(e,"'")})).trim()}(t);return 0===e.length?z:function(t){var e=function(t){for(var e=new $,r=0;!t.isEmpty();){var n=t.pop();if(n instanceof K)e.push(n);else{var i=n,o=void 0;if(i!==H.Comma){if(i instanceof W)o=ct();else if(i instanceof G)o=ft(i,e);else{if(!(i instanceof q))throw i instanceof Z?new Error("Mismatched brackets"):new Error("Unsupported operation");i.addParamCount(r),r=0,o=pt(i,e)}e.push(new K(o))}else r++}}if(1!==e.size())throw new Error("Illegal condition format");return e.pop()}(t).getValue();if(e instanceof _)return e;throw new Error("Not a filter")}(function(t){for(var e=new $,r=new $;!t.isEmpty();){var n=t.pop();if(n instanceof K)e.push(n);else{var i=n;if(i===H.RoundBracketClose)r.push(i);else if(r.isEmpty()||i!==H.RoundBracketOpen){for(;!r.isEmpty()&&r.peek().getPriority()<i.getPriority()&&r.peek()!==H.RoundBracketClose;)e.push(r.pop());r.push(i)}else for(;!r.isEmpty();){var o=r.pop();if(o===H.RoundBracketClose)break;o!==H.RoundBracketOpen&&e.push(o)}}}for(;!r.isEmpty();)e.push(r.pop());return $.reverse(e)}(function(t,e){for(var r=new $,n=new nt(t);;){var i=at(n,e);if(!i)break;r.push(i)}return r}(e,this._customProperties)))}catch(t){return null}},t}();function at(e,r){var n=ut(e,!0);if(n<0)return null;if(l=n,"()".indexOf(String.fromCharCode(l))>-1)return X(String.fromCharCode(n));if(function(t){return"\"'".indexOf(String.fromCharCode(t))>-1}(n))return new K(U(function(e,r){for(var n,i=[];!((n=e.read())<0||n===r);)i.push(n);if(n!==r)throw new Error("Mismatched quotes");return String.fromCharCode.apply(String,t.__spreadArray([],t.__read(i),!1))}(e,n)));if(rt(n)){var i=ut(e,!0);if(rt(i)){var o=ht(e,i=ut(e,!0),!0),a=t.getOrDefault(r,o,it.get(o));if(P(a))throw new Error("Unknown reserved word");return new K(U(a))}return new K((s=ht(e,i,!0),new x(s)))}if(function(t){return tt(t)||et(t)}(n))return new K(U(function(e,r){for(var n=[r],i=et(r);;){var o=e.read();if(o<0)break;if(tt(o))n.push(o);else{if(!et(o))break;if(i)throw new Error("Invalid number format");i=!0,n.push(o)}}var a=String.fromCharCode.apply(String,t.__spreadArray([],t.__read(n),!1));return e.reset(),e.skip(a.length),Number(a)}(e,n)));if(lt(n))return function(t,e){var r;if(function(t){return"<>".indexOf(String.fromCharCode(t))>-1}(e)){var n=ut(t,!0);lt(n)&&(r=X(String.fromCharCode(e,n)))}if(r||(r=X(String.fromCharCode(e))),!r)throw new Error("Unsupported operation");return r}(e,n);var s,l,u=ht(e,n,!0),h=X(u);if(h){if(h instanceof q){if(!function(t){return 40===t}(function(t){var e=ut(t,!0);return t.reset(),e}(e)))throw new Error("Invalid function format");var c=new q(h.getSymbol()),f=function(t){ut(t,!0);var e=ut(t,!1);return t.reset(),e}(e);if(function(t){return 44===t}(f))throw new Error("Invalid function format");return function(t){return 41===t}(f)||c.addParamCount(1),c}return h}return new K(U(u))}function st(t){return function(t){return function(t){return t>=65&&t<=90||t>=97&&t<=122}(t)||tt(t)}(t)||function(t){return 95===t}(t)||function(t){return 45===t}(t)}function lt(t){return"(),-+*/%<>=".indexOf(String.fromCharCode(t))>-1}function ut(t,e){var r,n;do{e&&t.mark(),r=t.read()}while(r>-1&&(n=r,/\s/.test(String.fromCharCode(n))));return r}function ht(e,r,n){for(var i=[r];;){var o=e.read();if(o<0)break;if(!st(o))break;i.push(o)}var a=String.fromCharCode.apply(String,t.__spreadArray([],t.__read(i),!1));return e.reset(),n&&e.skip(a.length),a}function ct(t,e){throw new Error("Not implemented yet")}function ft(t,e){var r,n=e.pop().getValue(),i=e.pop().getValue();switch(t){case H.Less:return void 0===r&&(r=!0),new B(n,i,r);case H.LessOrEqual:return function(t,e,r){return void 0===r&&(r=!0),new N(t,e,r)}(n,i);case H.Greater:return function(t,e,r){return void 0===r&&(r=!0),new D(t,e,r)}(n,i);case H.GreaterOrEqual:return function(t,e,r){return void 0===r&&(r=!0),new F(t,e,r)}(n,i);case H.Equals:return function(t,e,r){return void 0===r&&(r=!0),new L(t,e,r)}(n,i);case H.And:return new m([n,i]);default:throw new Error("Unsupported operation")}}function pt(t,e){for(var r=e.pop().getValue(),n=[],i=0;i<t.getParamCount();i++){var o=e.pop().getValue();n.push(o.value)}if(t.getSymbol()===H.In.getSymbol())return new j(r,new Set(n.filter(T).map((function(t){return t.toString()}))));throw new Error("Unsupported operation")}var dt=function(e){function r(t,r){void 0===r&&(r=1);var n=e.call(this)||this;return n._rect=t,n._padding=r,n}return t.__extends(r,e),Object.defineProperty(r.prototype,"rect",{get:function(){return this._rect},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"displaySize",{get:function(){return{width:this._rect.width-2*this._padding,height:this._rect.height-2*this._padding}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){var t=this._rect,e=t.x,r=t.y,n=this.displaySize,i=n.width,o=n.height,a=e+this._padding,s=r+this._padding;return[a,s,a+i,s+o]},enumerable:!1,configurable:!0}),r.prototype.getSerializeName=function(){return"IconPosition"},r}(t.Serializable);function yt(e){var r,n,i,o,a=0,s=0;try{for(var l=t.__values(e),u=l.next();!u.done;u=l.next())a+=(y=u.value).w*y.h,s=Math.max(s,y.w)}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}e.sort((function(t,e){return e.h-t.h}));var h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],c=0,f=0;try{for(var p=t.__values(e),d=p.next();!d.done;d=p.next())for(var y=d.value,g=h.length-1;g>=0;g--){var v=h[g];if(!(y.w>v.w||y.h>v.h)){if(y.x=v.x,y.y=v.y,f=Math.max(f,y.y+y.h),c=Math.max(c,y.x+y.w),y.w===v.w&&y.h===v.h){var _=h.pop();g<h.length&&(h[g]=_)}else y.h===v.h?(v.x+=y.w,v.w-=y.w):y.w===v.w?(v.y+=y.h,v.h-=y.h):(h.push({x:v.x+y.w,y:v.y,w:v.w-y.w,h:y.h}),v.y+=y.h,v.h-=y.h);break}}}catch(t){i={error:t}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}return{w:c,h:f,fill:a/(c*f)||0}}function gt(e,r){var n,i,o,a,s,l;void 0===r&&(r=1);var u=[];try{for(var h=t.__values(Object.values(e)),c=h.next();!c.done;c=h.next()){var f=(L=c.value).id,p=L.image;u.push({id:f,x:0,y:0,w:p.getWidth()+2*r,h:p.getHeight()+2*r})}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}var d=yt(u),y=d.w,g=d.h,v={};try{for(var _=t.__values(u),m=_.next();!m.done;m=_.next()){var b=m.value,x=(f=b.id,b.x),w=b.y,M=b.w,S=b.h;v[f]=new dt({x:x,y:w,width:M,height:S},r)}}catch(t){o={error:t}}finally{try{m&&!m.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}var P=new t.RgbaImage(y||1,g||1);try{for(var T=t.__values(Object.values(e)),E=T.next();!E.done;E=T.next()){f=(L=E.value).id;var L,k=L.image;if(0!==k.getWidth()&&0!==k.getHeight()){var I=v[f].rect;P.drawImage(k,{x:0,y:0},{x:I.x+r,y:I.y+r},k.getWidth(),k.getHeight())}}}catch(t){s={error:t}}finally{try{E&&!E.done&&(l=T.return)&&l.call(T)}finally{if(s)throw s.error}}return{image:P,positions:v}}var vt=function(){function e(t,e){this._queryPadding=0,this._glyphMap=null,this._glyphAtlasImage=null,this._glyphPositionMap=null,this._iconMap=null,this._iconAtlasImage=null,this._iconPositionMap=null,this._patternMap=null,this._patternAtlasImage=null,this._patternPositionMap=null,this._featureIndex=t,this._responseBodySize=e}return Object.defineProperty(e.prototype,"featureIndex",{get:function(){return this._featureIndex},enumerable:!1,configurable:!0}),e.prototype.expandQueryPadding=function(t){this._queryPadding=Math.max(this._queryPadding,t)},Object.defineProperty(e.prototype,"queryPadding",{get:function(){return this._queryPadding},enumerable:!1,configurable:!0}),e.prototype.setGlyphMap=function(e){this._glyphMap=e;var r=function(e){var r,n,i,o,a,s,l,u,h,c,f={},p=[];try{for(var d=t.__values(Object.entries(e)),y=d.next();!y.done;y=d.next()){var g=t.__read(y.value,2),v=g[0],_=g[1];f[v]={};try{for(var m=(i=void 0,t.__values(Object.values(_))),b=m.next();!b.done;b=m.next()){var x=b.value,w=x.id,M=x.bitmap,S=x.metrics;0!==M.getWidth()&&0!==M.getHeight()&&p.push({fontStack:v,id:w,metrics:S,x:0,y:0,w:M.getWidth()+2,h:M.getHeight()+2})}}catch(t){i={error:t}}finally{try{b&&!b.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}var P=yt(p),T=P.w,E=P.h;try{for(var L=t.__values(p),k=L.next();!k.done;k=L.next()){var I=k.value,A=(v=I.fontStack,w=I.id,S=I.metrics,I.x),C=I.y,O=I.w,R=I.h;f[v][w]={rect:{x:A,y:C,width:O,height:R},metrics:S}}}catch(t){a={error:t}}finally{try{k&&!k.done&&(s=L.return)&&s.call(L)}finally{if(a)throw a.error}}var D=new t.AlphaImage(T||1,E||1);try{for(var F=t.__values(Object.entries(e)),B=F.next();!B.done;B=F.next()){var N=t.__read(B.value,2);v=N[0],_=N[1];try{for(var z=(h=void 0,t.__values(Object.values(_))),U=z.next();!U.done;U=z.next()){var j=U.value;if(w=j.id,0!==(M=j.bitmap).getWidth()&&0!==M.getHeight()){var V=f[v][w].rect;D.drawImage(M,{x:0,y:0},{x:V.x+1,y:V.y+1},M.getWidth(),M.getHeight())}}}catch(t){h={error:t}}finally{try{U&&!U.done&&(c=z.return)&&c.call(z)}finally{if(h)throw h.error}}}}catch(t){l={error:t}}finally{try{B&&!B.done&&(u=F.return)&&u.call(F)}finally{if(l)throw l.error}}return{image:D,positions:f}}(e),n=r.image,i=r.positions;this._glyphAtlasImage=n,this._glyphPositionMap=i},Object.defineProperty(e.prototype,"glyphMap",{get:function(){return this._glyphMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"glyphAtlasImage",{get:function(){return this._glyphAtlasImage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"glyphPositionMap",{get:function(){return this._glyphPositionMap},enumerable:!1,configurable:!0}),e.prototype.setIconMap=function(t,e){this._iconMap=t;var r=gt(t,e),n=r.image,i=r.positions;this._iconAtlasImage=n,this._iconPositionMap=i},Object.defineProperty(e.prototype,"iconMap",{get:function(){return this._iconMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconAtlasImage",{get:function(){return this._iconAtlasImage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconPositionMap",{get:function(){return this._iconPositionMap},enumerable:!1,configurable:!0}),e.prototype.setPatternMap=function(t,e){void 0===e&&(e=0),this._patternMap=t;var r=gt(t,e),n=r.image,i=r.positions;this._patternAtlasImage=n,this._patternPositionMap=i},Object.defineProperty(e.prototype,"patternMap",{get:function(){return this._patternMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"patternAtlasImage",{get:function(){return this._patternAtlasImage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"patternPositionMap",{get:function(){return this._patternPositionMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseBodySize",{get:function(){return this._responseBodySize},enumerable:!1,configurable:!0}),e}(),_t=function(){function t(t,e){void 0===e&&(e={}),this._message=t,this._eventHandler=e}return Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eventHandler",{get:function(){return this._eventHandler},enumerable:!1,configurable:!0}),t}();function mt(t){let e=t.length;for(;--e>=0;)t[e]=0}const bt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),xt=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),wt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Mt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),St=new Array(576);mt(St);const Pt=new Array(60);mt(Pt);const Tt=new Array(512);mt(Tt);const Et=new Array(256);mt(Et);const Lt=new Array(29);mt(Lt);const kt=new Array(30);function It(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let At,Ct,Ot;function Rt(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}mt(kt);const Dt=t=>t<256?Tt[t]:Tt[256+(t>>>7)],Ft=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Bt=(t,e,r)=>{t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,Ft(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},Nt=(t,e,r)=>{Bt(t,r[2*e],r[2*e+1])},zt=(t,e)=>{let r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1},Ut=(t,e,r)=>{const n=new Array(16);let i,o,a=0;for(i=1;i<=15;i++)a=a+r[i-1]<<1,n[i]=a;for(o=0;o<=e;o++){let e=t[2*o+1];0!==e&&(t[2*o]=zt(n[e]++,e))}},jt=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Vt=t=>{t.bi_valid>8?Ft(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Gt=(t,e,r,n)=>{const i=2*e,o=2*r;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]},qt=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Gt(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Gt(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},Zt=(t,e,r)=>{let n,i,o,a,s=0;if(0!==t.sym_next)do{n=255&t.pending_buf[t.sym_buf+s++],n+=(255&t.pending_buf[t.sym_buf+s++])<<8,i=t.pending_buf[t.sym_buf+s++],0===n?Nt(t,i,e):(o=Et[i],Nt(t,o+256+1,e),a=bt[o],0!==a&&(i-=Lt[o],Bt(t,i,a)),n--,o=Dt(n),Nt(t,o,r),a=xt[o],0!==a&&(n-=kt[o],Bt(t,n,a)))}while(s<t.sym_next);Nt(t,256,e)},Wt=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems;let a,s,l,u=-1;for(t.heap_len=0,t.heap_max=573,a=0;a<o;a++)0!==r[2*a]?(t.heap[++t.heap_len]=u=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=u<2?++u:0,r[2*l]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=n[2*l+1]);for(e.max_code=u,a=t.heap_len>>1;a>=1;a--)qt(t,r,a);l=o;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],qt(t,r,1),s=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=s,r[2*l]=r[2*a]+r[2*s],t.depth[l]=(t.depth[a]>=t.depth[s]?t.depth[a]:t.depth[s])+1,r[2*a+1]=r[2*s+1]=l,t.heap[1]=l++,qt(t,r,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length;let u,h,c,f,p,d,y=0;for(f=0;f<=15;f++)t.bl_count[f]=0;for(r[2*t.heap[t.heap_max]+1]=0,u=t.heap_max+1;u<573;u++)h=t.heap[u],f=r[2*r[2*h+1]+1]+1,f>l&&(f=l,y++),r[2*h+1]=f,h>n||(t.bl_count[f]++,p=0,h>=s&&(p=a[h-s]),d=r[2*h],t.opt_len+=d*(f+p),o&&(t.static_len+=d*(i[2*h+1]+p)));if(0!==y){do{for(f=l-1;0===t.bl_count[f];)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[l]--,y-=2}while(y>0);for(f=l;0!==f;f--)for(h=t.bl_count[f];0!==h;)c=t.heap[--u],c>n||(r[2*c+1]!==f&&(t.opt_len+=(f-r[2*c+1])*r[2*c],r[2*c+1]=f),h--)}})(t,e),Ut(r,u,t.bl_count)},Ht=(t,e,r)=>{let n,i,o=-1,a=e[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=e[2*(n+1)+1],++s<l&&i===a||(s<u?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,o=i,0===a?(l=138,u=3):i===a?(l=6,u=3):(l=7,u=4))},Yt=(t,e,r)=>{let n,i,o=-1,a=e[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),n=0;n<=r;n++)if(i=a,a=e[2*(n+1)+1],!(++s<l&&i===a)){if(s<u)do{Nt(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(Nt(t,i,t.bl_tree),s--),Nt(t,16,t.bl_tree),Bt(t,s-3,2)):s<=10?(Nt(t,17,t.bl_tree),Bt(t,s-3,3)):(Nt(t,18,t.bl_tree),Bt(t,s-11,7));s=0,o=i,0===a?(l=138,u=3):i===a?(l=6,u=3):(l=7,u=4)}};let Xt=!1;const Kt=(t,e,r,n)=>{Bt(t,0+(n?1:0),3),Vt(t),Ft(t,r),Ft(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r};var Qt={_tr_init:t=>{Xt||((()=>{let t,e,r,n,i;const o=new Array(16);for(r=0,n=0;n<28;n++)for(Lt[n]=r,t=0;t<1<<bt[n];t++)Et[r++]=n;for(Et[r-1]=n,i=0,n=0;n<16;n++)for(kt[n]=i,t=0;t<1<<xt[n];t++)Tt[i++]=n;for(i>>=7;n<30;n++)for(kt[n]=i<<7,t=0;t<1<<xt[n]-7;t++)Tt[256+i++]=n;for(e=0;e<=15;e++)o[e]=0;for(t=0;t<=143;)St[2*t+1]=8,t++,o[8]++;for(;t<=255;)St[2*t+1]=9,t++,o[9]++;for(;t<=279;)St[2*t+1]=7,t++,o[7]++;for(;t<=287;)St[2*t+1]=8,t++,o[8]++;for(Ut(St,287,o),t=0;t<30;t++)Pt[2*t+1]=5,Pt[2*t]=zt(t,5);At=new It(St,bt,257,286,15),Ct=new It(Pt,xt,0,30,15),Ot=new It(new Array(0),wt,0,19,7)})(),Xt=!0),t.l_desc=new Rt(t.dyn_ltree,At),t.d_desc=new Rt(t.dyn_dtree,Ct),t.bl_desc=new Rt(t.bl_tree,Ot),t.bi_buf=0,t.bi_valid=0,jt(t)},_tr_stored_block:Kt,_tr_flush_block:(t,e,r,n)=>{let i,o,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),Wt(t,t.l_desc),Wt(t,t.d_desc),a=(t=>{let e;for(Ht(t,t.dyn_ltree,t.l_desc.max_code),Ht(t,t.dyn_dtree,t.d_desc.max_code),Wt(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*Mt[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==e?Kt(t,e,r,n):4===t.strategy||o===i?(Bt(t,2+(n?1:0),3),Zt(t,St,Pt)):(Bt(t,4+(n?1:0),3),((t,e,r,n)=>{let i;for(Bt(t,e-257,5),Bt(t,r-1,5),Bt(t,n-4,4),i=0;i<n;i++)Bt(t,t.bl_tree[2*Mt[i]+1],3);Yt(t,t.dyn_ltree,e-1),Yt(t,t.dyn_dtree,r-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),Zt(t,t.dyn_ltree,t.dyn_dtree)),jt(t),n&&Vt(t)},_tr_tally:(t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(Et[r]+256+1)]++,t.dyn_dtree[2*Dt(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{Bt(t,2,3),Nt(t,256,St),(t=>{16===t.bi_valid?(Ft(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},Jt=(t,e,r,n)=>{let i=65535&t|0,o=t>>>16&65535|0,a=0;for(;0!==r;){a=r>2e3?2e3:r,r-=a;do{i=i+e[n++]|0,o=o+i|0}while(--a);i%=65521,o%=65521}return i|o<<16|0};const $t=new Uint32Array((()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e})());var te=(t,e,r,n)=>{const i=$t,o=n+r;t^=-1;for(let r=n;r<o;r++)t=t>>>8^i[255&(t^e[r])];return-1^t},ee={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},re={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ne,_tr_stored_block:ie,_tr_flush_block:oe,_tr_tally:ae,_tr_align:se}=Qt,{Z_NO_FLUSH:le,Z_PARTIAL_FLUSH:ue,Z_FULL_FLUSH:he,Z_FINISH:ce,Z_BLOCK:fe,Z_OK:pe,Z_STREAM_END:de,Z_STREAM_ERROR:ye,Z_DATA_ERROR:ge,Z_BUF_ERROR:ve,Z_DEFAULT_COMPRESSION:_e,Z_FILTERED:me,Z_HUFFMAN_ONLY:be,Z_RLE:xe,Z_FIXED:we,Z_DEFAULT_STRATEGY:Me,Z_UNKNOWN:Se,Z_DEFLATED:Pe}=re,Te=258,Ee=262,Le=42,ke=113,Ie=666,Ae=(t,e)=>(t.msg=ee[e],e),Ce=t=>2*t-(t>4?9:0),Oe=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Re=t=>{let e,r,n,i=t.w_size;e=t.hash_size,n=e;do{r=t.head[--n],t.head[n]=r>=i?r-i:0}while(--e);e=i,n=e;do{r=t.prev[--n],t.prev[n]=r>=i?r-i:0}while(--e)};let De=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const Fe=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))},Be=(t,e)=>{oe(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Fe(t.strm)},Ne=(t,e)=>{t.pending_buf[t.pending++]=e},ze=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Ue=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),1===t.state.wrap?t.adler=Jt(t.adler,e,i,r):2===t.state.wrap&&(t.adler=te(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},je=(t,e)=>{let r,n,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match;const l=t.strstart>t.w_size-Ee?t.strstart-(t.w_size-Ee):0,u=t.window,h=t.w_mask,c=t.prev,f=t.strstart+Te;let p=u[o+a-1],d=u[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(r=e,u[r+a]===d&&u[r+a-1]===p&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<f);if(n=Te-(f-o),o=f-Te,n>a){if(t.match_start=e,a=n,n>=s)break;p=u[o+a-1],d=u[o+a]}}}while((e=c[e&h])>l&&0!=--i);return a<=t.lookahead?a:t.lookahead},Ve=t=>{const e=t.w_size;let r,n,i;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Ee)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Re(t),n+=e),0===t.strm.avail_in)break;if(r=Ue(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=De(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=De(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Ee&&0!==t.strm.avail_in)},Ge=(t,e)=>{let r,n,i,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,a=0,s=t.strm.avail_in;do{if(r=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i)break;if(i=t.strm.avail_out-i,n=t.strstart-t.block_start,r>n+t.strm.avail_in&&(r=n+t.strm.avail_in),r>i&&(r=i),r<o&&(0===r&&e!==ce||e===le||r!==n+t.strm.avail_in))break;a=e===ce&&r===n+t.strm.avail_in?1:0,ie(t,0,0,a),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,Fe(t.strm),n&&(n>r&&(n=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,r-=n),r&&(Ue(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(0===a);return s-=t.strm.avail_in,s&&(s>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=s&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-s,t.strm.next_in),t.strstart),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?4:e!==le&&e!==ce&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(Ue(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,o=i>t.w_size?t.w_size:i,n=t.strstart-t.block_start,(n>=o||(n||e===ce)&&e!==le&&0===t.strm.avail_in&&n<=i)&&(r=n>i?i:n,a=e===ce&&0===t.strm.avail_in&&r===n?1:0,ie(t,t.block_start,r,a),t.block_start+=r,Fe(t.strm)),a?3:1)},qe=(t,e)=>{let r,n;for(;;){if(t.lookahead<Ee){if(Ve(t),t.lookahead<Ee&&e===le)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=De(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-Ee&&(t.match_length=je(t,r)),t.match_length>=3)if(n=ae(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=De(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=De(t,t.ins_h,t.window[t.strstart+1]);else n=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Be(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===ce?(Be(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Be(t,!1),0===t.strm.avail_out)?1:2},Ze=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<Ee){if(Ve(t),t.lookahead<Ee&&e===le)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=De(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-Ee&&(t.match_length=je(t,r),t.match_length<=5&&(t.strategy===me||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,n=ae(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=De(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(Be(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=ae(t,0,t.window[t.strstart-1]),n&&Be(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ae(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===ce?(Be(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Be(t,!1),0===t.strm.avail_out)?1:2};function We(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const He=[new We(0,0,0,0,Ge),new We(4,4,8,4,qe),new We(4,5,16,8,qe),new We(4,6,32,32,qe),new We(4,4,16,16,Ze),new We(8,16,32,32,Ze),new We(8,16,128,128,Ze),new We(8,32,128,256,Ze),new We(32,128,258,1024,Ze),new We(32,258,258,4096,Ze)];function Ye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Pe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Oe(this.dyn_ltree),Oe(this.dyn_dtree),Oe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Oe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Oe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Xe=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Le&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==ke&&e.status!==Ie?1:0},Ke=t=>{if(Xe(t))return Ae(t,ye);t.total_in=t.total_out=0,t.data_type=Se;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Le:ke,t.adler=2===e.wrap?0:1,e.last_flush=-2,ne(e),pe},Qe=t=>{const e=Ke(t);var r;return e===pe&&((r=t.state).window_size=2*r.w_size,Oe(r.head),r.max_lazy_match=He[r.level].max_lazy,r.good_match=He[r.level].good_length,r.nice_match=He[r.level].nice_length,r.max_chain_length=He[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),e},Je=(t,e,r,n,i,o)=>{if(!t)return ye;let a=1;if(e===_e&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>9||r!==Pe||n<8||n>15||e<0||e>9||o<0||o>we||8===n&&1!==a)return Ae(t,ye);8===n&&(n=9);const s=new Ye;return t.state=s,s.strm=t,s.status=Le,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=e,s.strategy=o,s.method=r,Qe(t)};var $e={deflateInit:(t,e)=>Je(t,e,Pe,15,8,Me),deflateInit2:Je,deflateReset:Qe,deflateResetKeep:Ke,deflateSetHeader:(t,e)=>Xe(t)||2!==t.state.wrap?ye:(t.state.gzhead=e,pe),deflate:(t,e)=>{if(Xe(t)||e>fe||e<0)return t?Ae(t,ye):ye;const r=t.state;if(!t.output||0!==t.avail_in&&!t.input||r.status===Ie&&e!==ce)return Ae(t,0===t.avail_out?ve:ye);const n=r.last_flush;if(r.last_flush=e,0!==r.pending){if(Fe(t),0===t.avail_out)return r.last_flush=-1,pe}else if(0===t.avail_in&&Ce(e)<=Ce(n)&&e!==ce)return Ae(t,ve);if(r.status===Ie&&0!==t.avail_in)return Ae(t,ve);if(r.status===Le&&0===r.wrap&&(r.status=ke),r.status===Le){let e=Pe+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=be||r.level<2?0:r.level<6?1:6===r.level?2:3,e|=n<<6,0!==r.strstart&&(e|=32),e+=31-e%31,ze(r,e),0!==r.strstart&&(ze(r,t.adler>>>16),ze(r,65535&t.adler)),t.adler=1,r.status=ke,Fe(t),0!==r.pending)return r.last_flush=-1,pe}if(57===r.status)if(t.adler=0,Ne(r,31),Ne(r,139),Ne(r,8),r.gzhead)Ne(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Ne(r,255&r.gzhead.time),Ne(r,r.gzhead.time>>8&255),Ne(r,r.gzhead.time>>16&255),Ne(r,r.gzhead.time>>24&255),Ne(r,9===r.level?2:r.strategy>=be||r.level<2?4:0),Ne(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Ne(r,255&r.gzhead.extra.length),Ne(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=te(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Ne(r,0),Ne(r,0),Ne(r,0),Ne(r,0),Ne(r,0),Ne(r,9===r.level?2:r.strategy>=be||r.level<2?4:0),Ne(r,3),r.status=ke,Fe(t),0!==r.pending)return r.last_flush=-1,pe;if(69===r.status){if(r.gzhead.extra){let e=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let i=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>e&&(t.adler=te(t.adler,r.pending_buf,r.pending-e,e)),r.gzindex+=i,Fe(t),0!==r.pending)return r.last_flush=-1,pe;e=0,n-=i}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>e&&(t.adler=te(t.adler,r.pending_buf,r.pending-e,e)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let e,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=te(t.adler,r.pending_buf,r.pending-n,n)),Fe(t),0!==r.pending)return r.last_flush=-1,pe;n=0}e=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Ne(r,e)}while(0!==e);r.gzhead.hcrc&&r.pending>n&&(t.adler=te(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let e,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=te(t.adler,r.pending_buf,r.pending-n,n)),Fe(t),0!==r.pending)return r.last_flush=-1,pe;n=0}e=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Ne(r,e)}while(0!==e);r.gzhead.hcrc&&r.pending>n&&(t.adler=te(t.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Fe(t),0!==r.pending))return r.last_flush=-1,pe;Ne(r,255&t.adler),Ne(r,t.adler>>8&255),t.adler=0}if(r.status=ke,Fe(t),0!==r.pending)return r.last_flush=-1,pe}if(0!==t.avail_in||0!==r.lookahead||e!==le&&r.status!==Ie){let n=0===r.level?Ge(r,e):r.strategy===be?((t,e)=>{let r;for(;;){if(0===t.lookahead&&(Ve(t),0===t.lookahead)){if(e===le)return 1;break}if(t.match_length=0,r=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(Be(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ce?(Be(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Be(t,!1),0===t.strm.avail_out)?1:2})(r,e):r.strategy===xe?((t,e)=>{let r,n,i,o;const a=t.window;for(;;){if(t.lookahead<=Te){if(Ve(t),t.lookahead<=Te&&e===le)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=t.strstart-1,n=a[i],n===a[++i]&&n===a[++i]&&n===a[++i])){o=t.strstart+Te;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);t.match_length=Te-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=ae(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(Be(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ce?(Be(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Be(t,!1),0===t.strm.avail_out)?1:2})(r,e):He[r.level].func(r,e);if(3!==n&&4!==n||(r.status=Ie),1===n||3===n)return 0===t.avail_out&&(r.last_flush=-1),pe;if(2===n&&(e===ue?se(r):e!==fe&&(ie(r,0,0,!1),e===he&&(Oe(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Fe(t),0===t.avail_out))return r.last_flush=-1,pe}return e!==ce?pe:r.wrap<=0?de:(2===r.wrap?(Ne(r,255&t.adler),Ne(r,t.adler>>8&255),Ne(r,t.adler>>16&255),Ne(r,t.adler>>24&255),Ne(r,255&t.total_in),Ne(r,t.total_in>>8&255),Ne(r,t.total_in>>16&255),Ne(r,t.total_in>>24&255)):(ze(r,t.adler>>>16),ze(r,65535&t.adler)),Fe(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?pe:de)},deflateEnd:t=>{if(Xe(t))return ye;const e=t.state.status;return t.state=null,e===ke?Ae(t,ge):pe},deflateSetDictionary:(t,e)=>{let r=e.length;if(Xe(t))return ye;const n=t.state,i=n.wrap;if(2===i||1===i&&n.status!==Le||n.lookahead)return ye;if(1===i&&(t.adler=Jt(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){0===i&&(Oe(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(r-n.w_size,r),0),e=t,r=n.w_size}const o=t.avail_in,a=t.next_in,s=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Ve(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=De(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,Ve(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=a,t.input=s,t.avail_in=o,n.wrap=i,pe},deflateInfo:"pako deflate (from Nodeca project)"};const tr=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var er={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const e in r)tr(r,e)&&(t[e]=r[e])}}return t},flattenChunks:t=>{let e=0;for(let r=0,n=t.length;r<n;r++)e+=t[r].length;const r=new Uint8Array(e);for(let e=0,n=0,i=t.length;e<i;e++){let i=t[e];r.set(i,n),n+=i.length}return r}};let rr=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){rr=!1}const nr=new Uint8Array(256);for(let t=0;t<256;t++)nr[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;nr[254]=nr[254]=1;var ir={string2buf:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,r,n,i,o,a=t.length,s=0;for(i=0;i<a;i++)r=t.charCodeAt(i),55296==(64512&r)&&i+1<a&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(s),o=0,i=0;o<s;i++)r=t.charCodeAt(i),55296==(64512&r)&&i+1<a&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|63&r):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|63&r):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|63&r);return e},buf2string:(t,e)=>{const r=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,i;const o=new Array(2*r);for(i=0,n=0;n<r;){let e=t[n++];if(e<128){o[i++]=e;continue}let a=nr[e];if(a>4)o[i++]=65533,n+=a-1;else{for(e&=2===a?31:3===a?15:7;a>1&&n<r;)e=e<<6|63&t[n++],a--;a>1?o[i++]=65533:e<65536?o[i++]=e:(e-=65536,o[i++]=55296|e>>10&1023,o[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&rr)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r})(o,i)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let r=e-1;for(;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+nr[t[r]]>e?r:e}},or=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ar=Object.prototype.toString,{Z_NO_FLUSH:sr,Z_SYNC_FLUSH:lr,Z_FULL_FLUSH:ur,Z_FINISH:hr,Z_OK:cr,Z_STREAM_END:fr,Z_DEFAULT_COMPRESSION:pr,Z_DEFAULT_STRATEGY:dr,Z_DEFLATED:yr}=re;function gr(t){this.options=er.assign({level:pr,method:yr,chunkSize:16384,windowBits:15,memLevel:8,strategy:dr},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new or,this.strm.avail_out=0;let r=$e.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==cr)throw new Error(ee[r]);if(e.header&&$e.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?ir.string2buf(e.dictionary):"[object ArrayBuffer]"===ar.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,r=$e.deflateSetDictionary(this.strm,t),r!==cr)throw new Error(ee[r]);this._dict_set=!0}}function vr(t,e){const r=new gr(e);if(r.push(t,!0),r.err)throw r.msg||ee[r.err];return r.result}gr.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=e===~~e?e:!0===e?hr:sr,"string"==typeof t?r.input=ir.string2buf(t):"[object ArrayBuffer]"===ar.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===lr||o===ur)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=$e.deflate(r,o),i===fr)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=$e.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===cr;if(0!==r.avail_out){if(o>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},gr.prototype.onData=function(t){this.chunks.push(t)},gr.prototype.onEnd=function(t){t===cr&&(this.result=er.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var _r={Deflate:gr,deflate:vr,deflateRaw:function(t,e){return(e=e||{}).raw=!0,vr(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,vr(t,e)},constants:re};const mr=16209;var br=function(t,e){let r,n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b,x,w,M,S,P;const T=t.state;r=t.next_in,S=t.input,n=r+(t.avail_in-5),i=t.next_out,P=t.output,o=i-(e-t.avail_out),a=i+(t.avail_out-257),s=T.dmax,l=T.wsize,u=T.whave,h=T.wnext,c=T.window,f=T.hold,p=T.bits,d=T.lencode,y=T.distcode,g=(1<<T.lenbits)-1,v=(1<<T.distbits)-1;t:do{p<15&&(f+=S[r++]<<p,p+=8,f+=S[r++]<<p,p+=8),_=d[f&g];e:for(;;){if(m=_>>>24,f>>>=m,p-=m,m=_>>>16&255,0===m)P[i++]=65535&_;else{if(!(16&m)){if(0==(64&m)){_=d[(65535&_)+(f&(1<<m)-1)];continue e}if(32&m){T.mode=16191;break t}t.msg="invalid literal/length code",T.mode=mr;break t}b=65535&_,m&=15,m&&(p<m&&(f+=S[r++]<<p,p+=8),b+=f&(1<<m)-1,f>>>=m,p-=m),p<15&&(f+=S[r++]<<p,p+=8,f+=S[r++]<<p,p+=8),_=y[f&v];r:for(;;){if(m=_>>>24,f>>>=m,p-=m,m=_>>>16&255,!(16&m)){if(0==(64&m)){_=y[(65535&_)+(f&(1<<m)-1)];continue r}t.msg="invalid distance code",T.mode=mr;break t}if(x=65535&_,m&=15,p<m&&(f+=S[r++]<<p,p+=8,p<m&&(f+=S[r++]<<p,p+=8)),x+=f&(1<<m)-1,x>s){t.msg="invalid distance too far back",T.mode=mr;break t}if(f>>>=m,p-=m,m=i-o,x>m){if(m=x-m,m>u&&T.sane){t.msg="invalid distance too far back",T.mode=mr;break t}if(w=0,M=c,0===h){if(w+=l-m,m<b){b-=m;do{P[i++]=c[w++]}while(--m);w=i-x,M=P}}else if(h<m){if(w+=l+h-m,m-=h,m<b){b-=m;do{P[i++]=c[w++]}while(--m);if(w=0,h<b){m=h,b-=m;do{P[i++]=c[w++]}while(--m);w=i-x,M=P}}}else if(w+=h-m,m<b){b-=m;do{P[i++]=c[w++]}while(--m);w=i-x,M=P}for(;b>2;)P[i++]=M[w++],P[i++]=M[w++],P[i++]=M[w++],b-=3;b&&(P[i++]=M[w++],b>1&&(P[i++]=M[w++]))}else{w=i-x;do{P[i++]=P[w++],P[i++]=P[w++],P[i++]=P[w++],b-=3}while(b>2);b&&(P[i++]=P[w++],b>1&&(P[i++]=P[w++]))}break}}break}}while(r<n&&i<a);b=p>>3,r-=b,p-=b<<3,f&=(1<<p)-1,t.next_in=r,t.next_out=i,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=i<a?a-i+257:257-(i-a),T.hold=f,T.bits=p};const xr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),wr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Mr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Sr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Pr=(t,e,r,n,i,o,a,s)=>{const l=s.bits;let u,h,c,f,p,d,y=0,g=0,v=0,_=0,m=0,b=0,x=0,w=0,M=0,S=0,P=null;const T=new Uint16Array(16),E=new Uint16Array(16);let L,k,I,A=null;for(y=0;y<=15;y++)T[y]=0;for(g=0;g<n;g++)T[e[r+g]]++;for(m=l,_=15;_>=1&&0===T[_];_--);if(m>_&&(m=_),0===_)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(v=1;v<_&&0===T[v];v++);for(m<v&&(m=v),w=1,y=1;y<=15;y++)if(w<<=1,w-=T[y],w<0)return-1;if(w>0&&(0===t||1!==_))return-1;for(E[1]=0,y=1;y<15;y++)E[y+1]=E[y]+T[y];for(g=0;g<n;g++)0!==e[r+g]&&(a[E[e[r+g]]++]=g);if(0===t?(P=A=a,d=20):1===t?(P=xr,A=wr,d=257):(P=Mr,A=Sr,d=0),S=0,g=0,y=v,p=o,b=m,x=0,c=-1,M=1<<m,f=M-1,1===t&&M>852||2===t&&M>592)return 1;for(;;){L=y-x,a[g]+1<d?(k=0,I=a[g]):a[g]>=d?(k=A[a[g]-d],I=P[a[g]-d]):(k=96,I=0),u=1<<y-x,h=1<<b,v=h;do{h-=u,i[p+(S>>x)+h]=L<<24|k<<16|I|0}while(0!==h);for(u=1<<y-1;S&u;)u>>=1;if(0!==u?(S&=u-1,S+=u):S=0,g++,0==--T[y]){if(y===_)break;y=e[r+a[g]]}if(y>m&&(S&f)!==c){for(0===x&&(x=m),p+=v,b=y-x,w=1<<b;b+x<_&&(w-=T[b+x],!(w<=0));)b++,w<<=1;if(M+=1<<b,1===t&&M>852||2===t&&M>592)return 1;c=S&f,i[c]=m<<24|b<<16|p-o|0}}return 0!==S&&(i[p+S]=y-x<<24|64<<16|0),s.bits=m,0};const{Z_FINISH:Tr,Z_BLOCK:Er,Z_TREES:Lr,Z_OK:kr,Z_STREAM_END:Ir,Z_NEED_DICT:Ar,Z_STREAM_ERROR:Cr,Z_DATA_ERROR:Or,Z_MEM_ERROR:Rr,Z_BUF_ERROR:Dr,Z_DEFLATED:Fr}=re,Br=16180,Nr=16190,zr=16191,Ur=16192,jr=16194,Vr=16199,Gr=16200,qr=16206,Zr=16209,Wr=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Hr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Yr=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Br||e.mode>16211?1:0},Xr=t=>{if(Yr(t))return Cr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Br,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,kr},Kr=t=>{if(Yr(t))return Cr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Xr(t)},Qr=(t,e)=>{let r;if(Yr(t))return Cr;const n=t.state;return e<0?(r=0,e=-e):(r=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Cr:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,Kr(t))},Jr=(t,e)=>{if(!t)return Cr;const r=new Hr;t.state=r,r.strm=t,r.window=null,r.mode=Br;const n=Qr(t,e);return n!==kr&&(t.state=null),n};let $r,tn,en=!0;const rn=t=>{if(en){$r=new Int32Array(512),tn=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Pr(1,t.lens,0,288,$r,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Pr(2,t.lens,0,32,tn,0,t.work,{bits:5}),en=!1}t.lencode=$r,t.lenbits=9,t.distcode=tn,t.distbits=5},nn=(t,e,r,n)=>{let i;const o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(r-n,r-n+i),o.wnext),(n-=i)?(o.window.set(e.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var on={inflateReset:Kr,inflateReset2:Qr,inflateResetKeep:Xr,inflateInit:t=>Jr(t,15),inflateInit2:Jr,inflate:(t,e)=>{let r,n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b,x,w,M,S=0;const P=new Uint8Array(4);let T,E;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Yr(t)||!t.output||!t.input&&0!==t.avail_in)return Cr;r=t.state,r.mode===zr&&(r.mode=Ur),a=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,u=r.hold,h=r.bits,c=s,f=l,M=kr;t:for(;;)switch(r.mode){case Br:if(0===r.wrap){r.mode=Ur;break}for(;h<16;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(2&r.wrap&&35615===u){0===r.wbits&&(r.wbits=15),r.check=0,P[0]=255&u,P[1]=u>>>8&255,r.check=te(r.check,P,2,0),u=0,h=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",r.mode=Zr;break}if((15&u)!==Fr){t.msg="unknown compression method",r.mode=Zr;break}if(u>>>=4,h-=4,w=8+(15&u),0===r.wbits&&(r.wbits=w),w>15||w>r.wbits){t.msg="invalid window size",r.mode=Zr;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=512&u?16189:zr,u=0,h=0;break;case 16181:for(;h<16;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(r.flags=u,(255&r.flags)!==Fr){t.msg="unknown compression method",r.mode=Zr;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=Zr;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&4&r.wrap&&(P[0]=255&u,P[1]=u>>>8&255,r.check=te(r.check,P,2,0)),u=0,h=0,r.mode=16182;case 16182:for(;h<32;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}r.head&&(r.head.time=u),512&r.flags&&4&r.wrap&&(P[0]=255&u,P[1]=u>>>8&255,P[2]=u>>>16&255,P[3]=u>>>24&255,r.check=te(r.check,P,4,0)),u=0,h=0,r.mode=16183;case 16183:for(;h<16;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&4&r.wrap&&(P[0]=255&u,P[1]=u>>>8&255,r.check=te(r.check,P,2,0)),u=0,h=0,r.mode=16184;case 16184:if(1024&r.flags){for(;h<16;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&4&r.wrap&&(P[0]=255&u,P[1]=u>>>8&255,r.check=te(r.check,P,2,0)),u=0,h=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(p=r.length,p>s&&(p=s),p&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+p),w)),512&r.flags&&4&r.wrap&&(r.check=te(r.check,n,p,o)),s-=p,o+=p,r.length-=p),r.length))break t;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===s)break t;p=0;do{w=n[o+p++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w))}while(w&&p<s);if(512&r.flags&&4&r.wrap&&(r.check=te(r.check,n,p,o)),s-=p,o+=p,w)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===s)break t;p=0;do{w=n[o+p++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w))}while(w&&p<s);if(512&r.flags&&4&r.wrap&&(r.check=te(r.check,n,p,o)),s-=p,o+=p,w)break t}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;h<16;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(4&r.wrap&&u!==(65535&r.check)){t.msg="header crc mismatch",r.mode=Zr;break}u=0,h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=zr;break;case 16189:for(;h<32;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}t.adler=r.check=Wr(u),u=0,h=0,r.mode=Nr;case Nr:if(0===r.havedict)return t.next_out=a,t.avail_out=l,t.next_in=o,t.avail_in=s,r.hold=u,r.bits=h,Ar;t.adler=r.check=1,r.mode=zr;case zr:if(e===Er||e===Lr)break t;case Ur:if(r.last){u>>>=7&h,h-=7&h,r.mode=qr;break}for(;h<3;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}switch(r.last=1&u,u>>>=1,h-=1,3&u){case 0:r.mode=16193;break;case 1:if(rn(r),r.mode=Vr,e===Lr){u>>>=2,h-=2;break t}break;case 2:r.mode=16196;break;case 3:t.msg="invalid block type",r.mode=Zr}u>>>=2,h-=2;break;case 16193:for(u>>>=7&h,h-=7&h;h<32;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Zr;break}if(r.length=65535&u,u=0,h=0,r.mode=jr,e===Lr)break t;case jr:r.mode=16195;case 16195:if(p=r.length,p){if(p>s&&(p=s),p>l&&(p=l),0===p)break t;i.set(n.subarray(o,o+p),a),s-=p,o+=p,l-=p,a+=p,r.length-=p;break}r.mode=zr;break;case 16196:for(;h<14;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(r.nlen=257+(31&u),u>>>=5,h-=5,r.ndist=1+(31&u),u>>>=5,h-=5,r.ncode=4+(15&u),u>>>=4,h-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Zr;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;h<3;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}r.lens[L[r.have++]]=7&u,u>>>=3,h-=3}for(;r.have<19;)r.lens[L[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},M=Pr(0,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,M){t.msg="invalid code lengths set",r.mode=Zr;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;S=r.lencode[u&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,_=65535&S,!(g<=h);){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(_<16)u>>>=g,h-=g,r.lens[r.have++]=_;else{if(16===_){for(E=g+2;h<E;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(u>>>=g,h-=g,0===r.have){t.msg="invalid bit length repeat",r.mode=Zr;break}w=r.lens[r.have-1],p=3+(3&u),u>>>=2,h-=2}else if(17===_){for(E=g+3;h<E;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}u>>>=g,h-=g,w=0,p=3+(7&u),u>>>=3,h-=3}else{for(E=g+7;h<E;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}u>>>=g,h-=g,w=0,p=11+(127&u),u>>>=7,h-=7}if(r.have+p>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Zr;break}for(;p--;)r.lens[r.have++]=w}}if(r.mode===Zr)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=Zr;break}if(r.lenbits=9,T={bits:r.lenbits},M=Pr(1,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,M){t.msg="invalid literal/lengths set",r.mode=Zr;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},M=Pr(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,M){t.msg="invalid distances set",r.mode=Zr;break}if(r.mode=Vr,e===Lr)break t;case Vr:r.mode=Gr;case Gr:if(s>=6&&l>=258){t.next_out=a,t.avail_out=l,t.next_in=o,t.avail_in=s,r.hold=u,r.bits=h,br(t,f),a=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,u=r.hold,h=r.bits,r.mode===zr&&(r.back=-1);break}for(r.back=0;S=r.lencode[u&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,_=65535&S,!(g<=h);){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(v&&0==(240&v)){for(m=g,b=v,x=_;S=r.lencode[x+((u&(1<<m+b)-1)>>m)],g=S>>>24,v=S>>>16&255,_=65535&S,!(m+g<=h);){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}u>>>=m,h-=m,r.back+=m}if(u>>>=g,h-=g,r.back+=g,r.length=_,0===v){r.mode=16205;break}if(32&v){r.back=-1,r.mode=zr;break}if(64&v){t.msg="invalid literal/length code",r.mode=Zr;break}r.extra=15&v,r.mode=16201;case 16201:if(r.extra){for(E=r.extra;h<E;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,h-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;S=r.distcode[u&(1<<r.distbits)-1],g=S>>>24,v=S>>>16&255,_=65535&S,!(g<=h);){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(0==(240&v)){for(m=g,b=v,x=_;S=r.distcode[x+((u&(1<<m+b)-1)>>m)],g=S>>>24,v=S>>>16&255,_=65535&S,!(m+g<=h);){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}u>>>=m,h-=m,r.back+=m}if(u>>>=g,h-=g,r.back+=g,64&v){t.msg="invalid distance code",r.mode=Zr;break}r.offset=_,r.extra=15&v,r.mode=16203;case 16203:if(r.extra){for(E=r.extra;h<E;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,h-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Zr;break}r.mode=16204;case 16204:if(0===l)break t;if(p=f-l,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Zr;break}p>r.wnext?(p-=r.wnext,d=r.wsize-p):d=r.wnext-p,p>r.length&&(p=r.length),y=r.window}else y=i,d=a-r.offset,p=r.length;p>l&&(p=l),l-=p,r.length-=p;do{i[a++]=y[d++]}while(--p);0===r.length&&(r.mode=Gr);break;case 16205:if(0===l)break t;i[a++]=r.length,l--,r.mode=Gr;break;case qr:if(r.wrap){for(;h<32;){if(0===s)break t;s--,u|=n[o++]<<h,h+=8}if(f-=l,t.total_out+=f,r.total+=f,4&r.wrap&&f&&(t.adler=r.check=r.flags?te(r.check,i,f,a-f):Jt(r.check,i,f,a-f)),f=l,4&r.wrap&&(r.flags?u:Wr(u))!==r.check){t.msg="incorrect data check",r.mode=Zr;break}u=0,h=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;h<32;){if(0===s)break t;s--,u+=n[o++]<<h,h+=8}if(4&r.wrap&&u!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=Zr;break}u=0,h=0}r.mode=16208;case 16208:M=Ir;break t;case Zr:M=Or;break t;case 16210:return Rr;default:return Cr}return t.next_out=a,t.avail_out=l,t.next_in=o,t.avail_in=s,r.hold=u,r.bits=h,(r.wsize||f!==t.avail_out&&r.mode<Zr&&(r.mode<qr||e!==Tr))&&nn(t,t.output,t.next_out,f-t.avail_out),c-=t.avail_in,f-=t.avail_out,t.total_in+=c,t.total_out+=f,r.total+=f,4&r.wrap&&f&&(t.adler=r.check=r.flags?te(r.check,i,f,t.next_out-f):Jt(r.check,i,f,t.next_out-f)),t.data_type=r.bits+(r.last?64:0)+(r.mode===zr?128:0)+(r.mode===Vr||r.mode===jr?256:0),(0===c&&0===f||e===Tr)&&M===kr&&(M=Dr),M},inflateEnd:t=>{if(Yr(t))return Cr;let e=t.state;return e.window&&(e.window=null),t.state=null,kr},inflateGetHeader:(t,e)=>{if(Yr(t))return Cr;const r=t.state;return 0==(2&r.wrap)?Cr:(r.head=e,e.done=!1,kr)},inflateSetDictionary:(t,e)=>{const r=e.length;let n,i,o;return Yr(t)?Cr:(n=t.state,0!==n.wrap&&n.mode!==Nr?Cr:n.mode===Nr&&(i=1,i=Jt(i,e,r,0),i!==n.check)?Or:(o=nn(t,e,r,r),o?(n.mode=16210,Rr):(n.havedict=1,kr)))},inflateInfo:"pako inflate (from Nodeca project)"},an=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const sn=Object.prototype.toString,{Z_NO_FLUSH:ln,Z_FINISH:un,Z_OK:hn,Z_STREAM_END:cn,Z_NEED_DICT:fn,Z_STREAM_ERROR:pn,Z_DATA_ERROR:dn,Z_MEM_ERROR:yn}=re;function gn(t){this.options=er.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new or,this.strm.avail_out=0;let r=on.inflateInit2(this.strm,e.windowBits);if(r!==hn)throw new Error(ee[r]);if(this.header=new an,on.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=ir.string2buf(e.dictionary):"[object ArrayBuffer]"===sn.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=on.inflateSetDictionary(this.strm,e.dictionary),r!==hn)))throw new Error(ee[r])}function vn(t,e){const r=new gn(e);if(r.push(t),r.err)throw r.msg||ee[r.err];return r.result}gn.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(a=e===~~e?e:!0===e?un:ln,"[object ArrayBuffer]"===sn.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=on.inflate(r,a),o===fn&&i&&(o=on.inflateSetDictionary(r,i),o===hn?o=on.inflate(r,a):o===dn&&(o=fn));r.avail_in>0&&o===cn&&r.state.wrap>0&&0!==t[r.next_in];)on.inflateReset(r),o=on.inflate(r,a);switch(o){case pn:case dn:case fn:case yn:return this.onEnd(o),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(0===r.avail_out||o===cn))if("string"===this.options.to){let t=ir.utf8border(r.output,r.next_out),e=r.next_out-t,i=ir.buf2string(r.output,t);r.next_out=e,r.avail_out=n-e,e&&r.output.set(r.output.subarray(t,t+e),0),this.onData(i)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(o!==hn||0!==s){if(o===cn)return o=on.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},gn.prototype.onData=function(t){this.chunks.push(t)},gn.prototype.onEnd=function(t){t===hn&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=er.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var _n={Inflate:gn,inflate:vn,inflateRaw:function(t,e){return(e=e||{}).raw=!0,vn(t,e)},ungzip:vn,constants:re};const{Deflate:mn,deflate:bn,deflateRaw:xn,gzip:wn}=_r,{Inflate:Mn,inflate:Sn,inflateRaw:Pn,ungzip:Tn}=_n;var En={Deflate:mn,deflate:bn,deflateRaw:xn,gzip:wn,Inflate:Mn,inflate:Sn,inflateRaw:Pn,ungzip:Tn,constants:re};function Ln(t){var e=t.uniqueId,r=t.loadCount;return"".concat(e,":").concat(r)}var kn=function(){function e(t,e,r){this._configs=t,this._resourceManager=e,this._scheduler=r,this._loadingStates={},this._requestAbortInvokers={},this._partialLoadedTiles={}}return e.prototype._loadTile=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m;return t.__generator(this,(function(b){switch(b.label){case 0:if(i=e.uniqueId,o=e.tileId,a=e.url,s=e.options,l=e.optimize,u=s.tileServiceName,h=s.format,c=(l||{}).noQuery,f=void 0!==c&&c,p=t.tileAdapters[u],d=this._partialLoadedTiles[i])return[2,d];if(!a)throw"tile url missing";return[4,n("RequestTile")];case 1:return b.sent(),r(),[4,this._requestTileBinary(a,Ln(e))];case 2:if(y=b.sent(),r(),function(t){var e=t.statusCode;return 204===e||404===e}(y))throw"Empty";if(!t.isValidStatus(y))throw y;if(0===(g=y.body.byteLength))throw"Empty";return[4,n("ParseTile")];case 3:if(b.sent(),r(),v="mvt"!==h?En.inflate(new Uint8Array(y.body)).buffer:y.body,_=new t.RawVectorTile(o,v,h,u),function(e){var r,n;try{for(var i=t.__values(e.stacks),o=i.next();!o.done;o=i.next())if(o.value.getFeatures().length>0)return!1}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!0}(m=t.RefinedVectorTile.parse(_)))throw"Empty";return[2,{vectorTile:m,tileMemo:new vt(new t.VectorTileFeatureIndex(p.getTileExtent(),f),g)}]}}))}))},e.prototype._requestTileBinary=function(e,r){return t.__awaiter(this,void 0,void 0,(function(){var n,i;return t.__generator(this,(function(o){switch(o.label){case 0:n=new t.DefaultAbortInvoker,this._requestAbortInvokers[r]=n,o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,t.ajax.callBinary(e,t.__assign(t.__assign({},this._configs.getNetworkOptions()),{abortInvoker:n}))];case 2:return[2,o.sent()];case 3:throw i=o.sent(),n.isAborted()?"Aborted":i;case 4:return delete this._requestAbortInvokers[r],[7];case 5:return[2]}}))}))},e.prototype.load=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,u,h,c,f,p,d,y,g,v,_,m,b,x=this;return t.__generator(this,(function(w){switch(w.label){case 0:r=e.uniqueId,n=e.tileId,i=e.options,o=e.loadCount,a=e.sourceType,s=e.reload,l=e.optimize,u=Ln(e),this._loadingStates[u]="Loading",h=function(){var t=x._loadingStates[u];if(!t)throw"invalid tile load state";if("Aborted"===t)throw"Aborted"},c=function(e,r){return t.__awaiter(x,void 0,void 0,(function(){return t.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._scheduler.submitTask(e,t.__assign({sourceType:a,tileLoadKey:u},r))];case 1:return[2,n.sent()];case 2:throw n.sent(),"Aborted";case 3:return[2]}}))}))},w.label=1;case 1:return w.trys.push([1,5,6,7]),[4,c("EntryPoint")];case 2:return w.sent(),h(),[4,this._loadTile(e,h,c)];case 3:return f=w.sent(),p=f.vectorTile,d=f.tileMemo,this._partialLoadedTiles[r]||(this._partialLoadedTiles[r]={vectorTile:p,tileMemo:d}),[4,this._createTileData(p,d,i,h,c,o,s,l)];case 4:return y=w.sent(),g=y.styleDataMap,v=y.tileCompositeData,_=y.isPartial,m={state:_?"Partial":"Done",tileData:new t.PreparedTileData(n,g,v)},[2,new _t(m,{beforePosting:function(t){_||delete x._partialLoadedTiles[r]},afterPosting:function(){},finalize:function(){var t;null===(t=m.tileData)||void 0===t||t.destroy()}})];case 5:if("Aborted"===(b=w.sent()))return delete this._partialLoadedTiles[r],[2,new _t({state:"Aborted"})];if("Empty"===b)return[2,new _t({state:"Empty"})];throw b;case 6:return delete this._loadingStates[u],[7];case 7:return[2]}}))}))},e.prototype._createTileData=function(e,r,n,i,o,a,s,l){return void 0===s&&(s=!1),t.__awaiter(this,void 0,void 0,(function(){var u,h,c,f,p,d,y,g,_,m,b,x,w,M,S,P,T,E,L,k,I,A,C,O,R,D,F,B,N,z,U;return t.__generator(this,(function(j){switch(j.label){case 0:return u=e.stacks,h=n.tileServiceName,c=n.layerId,p=(f=l||{}).noQuery,d=void 0!==p&&p,y=f.tessellationPreset,g=void 0===y?"Medium":y,_=this._configs.getLayer(c),m=this._configs.getStyle(),b=this._configs.getGlobalVariables(),x=m&&m.getLayerStyle(c),w=t.tileAdapters[h],_&&x?(M=this._getStackStyleDataParams(u,_,x,b,e,w,g),S=this._getTargetParams(M,a,s),P=S.targetParams,T=S.partial,E=S.lowPriority,[4,o("CreateStyleData",{lowPriority:E})]):[2,{styleDataMap:new t.StackStyleDataMap,tileCompositeData:new t.VectorTileCompositeData(e,r)}];case 1:return j.sent(),i(),L=this._getResourceDependencies(P),k=L.glyphDependencies,I=L.iconDependencies,A=L.patternDependencies,[4,Promise.all([k.length&&this._requestGlyphs(k).then((function(t){i(),r.setGlyphMap(t)})),I.length&&this._requestIcons(I).then((function(t){i(),r.setIconMap(t)})),A.length&&this._requestIcons(A).then((function(t){i(),r.setPatternMap(t)}))])];case 2:j.sent(),i(),C=new t.StackStyleDataMap;try{for(O=t.__values(P),R=O.next();!R.done;R=O.next())D=R.value,(F=v.create(D,r))&&(B=D.stack,N=D.style,C.put(B.getId(),N.getId(),F),r.expandQueryPadding(F.getQueryPadding()))}catch(t){z={error:t}}finally{try{R&&!R.done&&(U=O.return)&&U.call(O)}finally{if(z)throw z.error}}return T||(r.featureIndex.build(),d&&e.rawVectorTile.clearData()),[2,{styleDataMap:C,tileCompositeData:T?new t.EmptyTileCompositeData:new t.VectorTileCompositeData(e,r),isPartial:T}]}}))}))},e.prototype._getTargetParams=function(e,r,n){var i=[],o=[];if(e.forEach((function(e){var r=e.conversionType;t.isPoiConversionType(r)||r===t.GeometryConversionType.RoadName?i.push(e):o.push(e)})),0===r){var a=o.length>0&&i.length>0,s=!a&&i.length>0;return a&&!n?{targetParams:o,partial:!0}:s?(i.forEach((function(t){t.isPoiLayer=!0})),{targetParams:i,lowPriority:!0}):{targetParams:e}}if(1===r)return{targetParams:i,lowPriority:!0};throw"3rd reload occured"},e.prototype._getStackStyleDataParams=function(e,r,n,i,o,a,s){var l,u,h,c,f,p,d=this._getValidStacks(e,r,n),y=[],g=new ot(i.customStyleProperties);try{for(var v=t.__values(d),_=v.next();!_.done;_=v.next()){var m=_.value,b=m.stack,x=m.stackStyle,w=m.conversionType,M=m.features;try{for(var S=(h=void 0,t.__values(x.getStyles())),P=S.next();!P.done;P=S.next()){var T=P.value,E=g.parse(T.getCondition());if(E){var L=[],k=[];try{for(var I=(f=void 0,t.__values(M)),A=I.next();!A.done;A=I.next()){var C=A.value;E.evaluate(C.feature)?L.push(C):k.push(C)}}catch(t){f={error:t}}finally{try{A&&!A.done&&(p=I.return)&&p.call(I)}finally{if(f)throw f.error}}L.length>0&&y.push({vectorTile:o,features:L,stack:b,style:T,globalVariables:i,conversionType:w,tileAdapter:a,layerId:r.getId(),tessellationPreset:s}),M=k}}}catch(t){h={error:t}}finally{try{P&&!P.done&&(c=S.return)&&c.call(S)}finally{if(h)throw h.error}}}}catch(t){l={error:t}}finally{try{_&&!_.done&&(u=v.return)&&u.call(v)}finally{if(l)throw l.error}}return y},e.prototype._getValidStacks=function(e,r,n){var i,o,a=[];try{for(var s=t.__values(e),l=s.next();!l.done;l=s.next()){var u=l.value,h=u.getStackId(),c=r.getStack(h),f=n.getStackStyle(h);if(c&&f){var p=t.getGeometryConversionType(c,r);p!==t.GeometryConversionType.Invalid&&a.push({stack:c,stackStyle:f,conversionType:p,features:u.getFeatures().map((function(t,e){return{feature:t,pos:e}}))})}}}catch(t){i={error:t}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a},e.prototype._getResourceDependencies=function(e){var r,n,i,o,a,s=[],l=[],u=[];try{for(var h=t.__values(e),c=h.next();!c.done;c=h.next()){var f=c.value,p=f.style,d=f.features,y=f.conversionType;if(y===t.GeometryConversionType.Polygon||y===t.GeometryConversionType.Line){var g=p.getGeomPaint();g&&!t.isDisplayOff(g.display)&&(g["fill-pattern"]||g["stroke-pattern"])&&(g["fill-pattern"]&&u.push(g["fill-pattern"]),g["stroke-pattern"]&&u.push(g["stroke-pattern"]))}else if(y===t.GeometryConversionType.Poi||y===t.GeometryConversionType.RoadName||y===t.GeometryConversionType.BackgroundPoi){var v=p.getLabelPaint(),_=p.getIconPaint();v&&!t.isDisplayOff(v.display)&&s.push(f),_&&_.icon&&!t.isDisplayOff(_.display)&&l.push(_.icon);try{for(var m=(i=void 0,t.__values(d)),b=m.next();!b.done;b=m.next()){var x=b.value.feature,w=x.properties.get("poi_icon"),M=x.properties.get("landmark_icon");if(M){var S=((null===(a=this._configs.getStyle())||void 0===a?void 0:a.getProperties())||{}).replaceLandmarkPackageCode,P=t.__read(S.split(":"),2),T=P[0],E=P[1];M=M.replace(T,E),x.properties.set("landmark_icon_replaced",M),l.push(M)}else w&&l.push(w)}}catch(t){i={error:t}}finally{try{b&&!b.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}}}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}return{glyphDependencies:s,iconDependencies:l,patternDependencies:u}},e.prototype._requestGlyphs=function(r){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,u,h,c,f,p;return t.__generator(this,(function(d){n={};try{for(i=t.__values(r),o=i.next();!o.done;o=i.next())a=o.value,s=a.features,l=a.style,u=e._getNecessaryCharCodes(s,l),h=t.DEFAULT_FONT_STACK,n[h]||(n[h]=[]),(p=n[h]).push.apply(p,t.__spreadArray([],t.__read(u),!1))}catch(t){c={error:t}}finally{try{o&&!o.done&&(f=i.return)&&f.call(i)}finally{if(c)throw c.error}}return[2,this._resourceManager.getGlyphs(n)]}))}))},e._getNecessaryCharCodes=function(e,r){var n,i,o,a,s=new Set;if(!r.getLabelPaint())return s;var l=["name1","name2"];try{for(var u=t.__values(e),h=u.next();!h.done;h=u.next()){var c=h.value.feature;try{for(var f=(o=void 0,t.__values(l)),p=f.next();!p.done;p=f.next()){var d=p.value,y=c.properties.get(d);if(y)for(var g=0;g<y.length;g++)s.add(y.charCodeAt(g))}}catch(t){o={error:t}}finally{try{p&&!p.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return s},e.prototype._requestIcons=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r;return t.__generator(this,(function(n){return r=e.map(t.IconId.parse),[2,this._resourceManager.getIcons(r)]}))}))},e.prototype.abort=function(t){var e,r=Ln(t);"Loading"===this._loadingStates[r]&&(this._loadingStates[r]="Aborted",null===(e=this._requestAbortInvokers[r])||void 0===e||e.abort(),this._scheduler.cancelTasks((function(t){return t.metadata.tileLoadKey===r})))},e.prototype.clear=function(t){var e=t.uniqueId;delete this._partialLoadedTiles[e]},e.prototype.loadData=function(t){},e.prototype.clearData=function(t){},e.prototype.destroy=function(){var e,r;try{for(var n=t.__values(Object.values(this._requestAbortInvokers)),i=n.next();!i.done;i=n.next())i.value.abort()}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},e}(),In=kn;function An(t,e,r,n){for(var i,o=n,a=r-e>>1,s=r-e,l=t[e],u=t[e+1],h=t[r],c=t[r+1],f=e+3;f<r;f+=3){var p=Cn(t[f],t[f+1],l,u,h,c);if(p>o)i=f,o=p;else if(p===o){var d=Math.abs(f-a);d<s&&(i=f,s=d)}}o>n&&(i-e>3&&An(t,e,i,n),t[i+2]=o,r-i>3&&An(t,i,r,n))}function Cn(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var l=((t-r)*a+(e-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return(a=t-r)*a+(s=e-n)*s}function On(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)Rn(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)Rn(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)Rn(t,e[n][i])}(i),i}function Rn(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function Dn(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===o)Fn(i,s);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)Fn(i[u],s);else if("LineString"===o)Bn(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<i.length;u++)s=[],Bn(i[u],s,a,!1),t.push(On(l,"LineString",s,e.properties));return}Nn(i,s,a,!1)}else if("Polygon"===o)Nn(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)Dn(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var h=[];Nn(i[u],h,a,!0),s.push(h)}}t.push(On(l,o,s,e.properties))}}function Fn(t,e){e.push(zn(t[0])),e.push(Un(t[1])),e.push(0)}function Bn(t,e,r,n){for(var i,o,a=0,s=0;s<t.length;s++){var l=zn(t[s][0]),u=Un(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=n?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var h=e.length-3;e[2]=1,An(e,0,h,r),e[h+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function Nn(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];Bn(t[i],o,r,n),e.push(o)}}function zn(t){return t/360+.5}function Un(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function jn(t,e,r,n,i,o,a,s){if(n/=e,o>=(r/=e)&&a<n)return t;if(a<r||o>=n)return null;for(var l=[],u=0;u<t.length;u++){var h=t[u],c=h.geometry,f=h.type,p=0===i?h.minX:h.minY,d=0===i?h.maxX:h.maxY;if(p>=r&&d<n)l.push(h);else if(!(d<r||p>=n)){var y=[];if("Point"===f||"MultiPoint"===f)Vn(c,y,r,n,i);else if("LineString"===f)Gn(c,y,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===f)Zn(c,y,r,n,i,!1);else if("Polygon"===f)Zn(c,y,r,n,i,!0);else if("MultiPolygon"===f)for(var g=0;g<c.length;g++){var v=[];Zn(c[g],v,r,n,i,!0),v.length&&y.push(v)}if(y.length){if(s.lineMetrics&&"LineString"===f){for(g=0;g<y.length;g++)l.push(On(h.id,f,y[g],h.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===y.length?(f="LineString",y=y[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===y.length?"Point":"MultiPoint"),l.push(On(h.id,f,y,h.tags))}}}return l.length?l:null}function Vn(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=r&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Gn(t,e,r,n,i,o,a){for(var s,l,u=qn(t),h=0===i?Hn:Yn,c=t.start,f=0;f<t.length-3;f+=3){var p=t[f],d=t[f+1],y=t[f+2],g=t[f+3],v=t[f+4],_=0===i?p:d,m=0===i?g:v,b=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-v,2))),_<r?m>r&&(l=h(u,p,d,g,v,r),a&&(u.start=c+s*l)):_>n?m<n&&(l=h(u,p,d,g,v,n),a&&(u.start=c+s*l)):Wn(u,p,d,y),m<r&&_>=r&&(l=h(u,p,d,g,v,r),b=!0),m>n&&_<=n&&(l=h(u,p,d,g,v,n),b=!0),!o&&b&&(a&&(u.end=c+s*l),e.push(u),u=qn(t)),a&&(c+=s)}var x=t.length-3;p=t[x],d=t[x+1],y=t[x+2],(_=0===i?p:d)>=r&&_<=n&&Wn(u,p,d,y),x=u.length-3,o&&x>=3&&(u[x]!==u[0]||u[x+1]!==u[1])&&Wn(u,u[0],u[1],u[2]),u.length&&e.push(u)}function qn(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function Zn(t,e,r,n,i,o){for(var a=0;a<t.length;a++)Gn(t[a],e,r,n,i,o,!1)}function Wn(t,e,r,n){t.push(e),t.push(r),t.push(n)}function Hn(t,e,r,n,i,o){var a=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*a),t.push(1),a}function Yn(t,e,r,n,i,o){var a=(o-r)/(i-r);return t.push(e+(n-e)*a),t.push(o),t.push(1),a}function Xn(t,e){for(var r=[],n=0;n<t.length;n++){var i,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=Kn(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(Kn(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(Kn(o.geometry[s][u],e));i.push(l)}r.push(On(o.id,a,i,o.tags))}return r}function Kn(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function Qn(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,h=l.type;if(l.geometry=[],1===h)for(n=0;n<u.length;n+=2)l.geometry.push(Jn(u[n],u[n+1],e,o,a,s));else for(n=0;n<u.length;n++){var c=[];for(i=0;i<u[n].length;i+=2)c.push(Jn(u[n][i],u[n][i+1],e,o,a,s));l.geometry.push(c)}}return t.transformed=!0,t}function Jn(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function $n(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,ti(a,t[s],o,i);var l=t[s].minX,u=t[s].minY,h=t[s].maxX,c=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),h>a.maxX&&(a.maxX=h),c>a.maxY&&(a.maxY=c)}return a}function ti(t,e,r,n){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)ei(a,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)ei(a,i[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)ei(a,u[s],t,r,!0,0===s)}if(a.length){var h=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var c in h={},e.tags)h[c]=e.tags[c];h.mapbox_clip_start=i.start/i.size,h.mapbox_clip_end=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:h};null!==e.id&&(f.id=e.id),t.features.push(f)}}function ei(t,e,r,n,i,o){var a=n*n;if(n>0&&e.size<(i?a:n))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=a,t[i-1-n]=s}}(s,o),t.push(s)}}function ri(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)Dn(r,t.features[n],e,n);else"Feature"===t.type?Dn(r,t,e):Dn(r,{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){var r=e.buffer/e.extent,n=t,i=jn(t,1,-1-r,r,0,-1,2,e),o=jn(t,1,1-r,2+r,0,-1,2,e);return(i||o)&&(n=jn(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=Xn(i,1).concat(n)),o&&(n=n.concat(Xn(o,-1)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),r&&(n.length,console.timeEnd("generate tiles"))}function ni(t,e,r){return 32*((1<<t)*r+e)+t}ri.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ri.prototype.splitTile=function(t,e,r,n,i,o,a){for(var s=[t,e,r,n],l=this.options,u=l.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var h=1<<e,c=ni(e,r,n),f=this.tiles[c];if(!f&&(u>1&&console.time("creation"),f=this.tiles[c]=$n(t,e,r,n,l),this.tileCoords.push({z:e,x:r,y:n}),u)){u>1&&console.timeEnd("creation");var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=t,i){if(e===l.maxZoom||e===i)continue;var d=1<<i-e;if(r!==Math.floor(o/d)||n!==Math.floor(a/d))continue}else if(e===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==t.length){u>1&&console.time("clipping");var y,g,v,_,m,b,x=.5*l.buffer/l.extent,w=.5-x,M=.5+x,S=1+x;y=g=v=_=null,m=jn(t,h,r-x,r+M,0,f.minX,f.maxX,l),b=jn(t,h,r+w,r+S,0,f.minX,f.maxX,l),t=null,m&&(y=jn(m,h,n-x,n+M,1,f.minY,f.maxY,l),g=jn(m,h,n+w,n+S,1,f.minY,f.maxY,l),m=null),b&&(v=jn(b,h,n-x,n+M,1,f.minY,f.maxY,l),_=jn(b,h,n+w,n+S,1,f.minY,f.maxY,l),b=null),u>1&&console.timeEnd("clipping"),s.push(y||[],e+1,2*r,2*n),s.push(g||[],e+1,2*r,2*n+1),s.push(v||[],e+1,2*r+1,2*n),s.push(_||[],e+1,2*r+1,2*n+1)}}},ri.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||t>24)return null;var a=1<<t,s=ni(t,e=(e%a+a)%a,r);if(this.tiles[s])return Qn(this.tiles[s],i);for(var l,u=t,h=e,c=r;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[ni(u,h,c)];return l&&l.source?(o>1&&console.time("drilling down"),this.splitTile(l.source,u,h,c,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?Qn(this.tiles[s],i):null):null};var ii={exports:{}},oi=ai;function ai(t,e){this.x=t,this.y=e}ai.prototype={clone:function(){return new ai(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ai.convert=function(t){return t instanceof ai?t:Array.isArray(t)?new ai(t[0],t[1]):t};var si={},li=oi,ui=hi;function hi(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(ci,this,e)}function ci(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function fi(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n+=((r=t[a]).x-e.x)*(e.y+r.y);return n}hi.types=["Unknown","Point","LineString","Polygon"],hi.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,i=0,o=0,a=0,s=[];t.pos<r;){if(i<=0){var l=t.readVarint();n=7&l,i=l>>3}if(i--,1===n||2===n)o+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&s.push(e),e=[]),e.push(new li(o,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&s.push(e),s},hi.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var h=t.readVarint();r=7&h,n=h>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},hi.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=hi.types[this.type];function h(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+s)/o;t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(n=0;n<l.length;n++)c[n]=l[n][0];h(l=c);break;case 2:for(n=0;n<l.length;n++)h(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var a=fi(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}return r&&i.push(r),i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)h(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var pi=ui,di=yi;function yi(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(gi,this,e),this.length=this._features.length}function gi(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}yi.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new pi(this._pbf,e,this.extent,this._keys,this._values)};var vi=di;function _i(t,e,r){if(3===t){var n=new vi(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}si.VectorTile=function(t,e){this.layers=t.readFields(_i,{},e)},si.VectorTileFeature=ui,si.VectorTileLayer=di;var mi=oi,bi=si.VectorTileFeature,xi=wi;function wi(t,e){this.options=e||{},this.features=t,this.length=t.length}function Mi(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}wi.prototype.feature=function(t){return new Mi(this.features[t],this.options.extent)},Mi.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var r=t[e],n=[],i=0;i<r.length;i++)n.push(new mi(r[i][0],r[i][1]));this.geometry.push(n)}return this.geometry},Mi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,n=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[e,n,r,i]},Mi.prototype.toGeoJSON=bi.prototype.toGeoJSON;var Si=t.pbf,Pi=xi;function Ti(t){var e=new Si;return function(t,e){for(var r in t.layers)e.writeMessage(3,Ei,t.layers[r])}(t,e),e.finish()}function Ei(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)n.feature=t.feature(r),e.writeMessage(2,Li,n);var i=n.keys;for(r=0;r<i.length;r++)e.writeStringField(3,i[r]);var o=n.values;for(r=0;r<o.length;r++)e.writeMessage(4,Oi,o[r])}function Li(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,ki,t),e.writeVarintField(3,r.type),e.writeMessage(4,Ci,r)}function ki(t,e){var r=t.feature,n=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var l=r.properties[s],u=o[s];if(null!==l){void 0===u&&(n.push(s),u=n.length-1,o[s]=u),e.writeVarint(u);var h=typeof l;"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var c=h+":"+l,f=a[c];void 0===f&&(i.push(l),f=i.length-1,a[c]=f),e.writeVarint(f)}}}function Ii(t,e){return(e<<3)+(7&t)}function Ai(t){return t<<1^t>>31}function Ci(t,e){for(var r=t.loadGeometry(),n=t.type,i=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],u=1;1===n&&(u=l.length),e.writeVarint(Ii(1,u));for(var h=3===n?l.length-1:l.length,c=0;c<h;c++){1===c&&1!==n&&e.writeVarint(Ii(2,h-1));var f=l[c].x-i,p=l[c].y-o;e.writeVarint(Ai(f)),e.writeVarint(Ai(p)),i+=f,o+=p}3===n&&e.writeVarint(Ii(7,1))}}function Oi(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}ii.exports=Ti,ii.exports.fromVectorTileJs=Ti,ii.exports.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var n in t)r[n]=new Pi(t[n].features,e),r[n].name=n,r[n].version=e.version,r[n].extent=e.extent;return Ti({layers:r})},ii.exports.GeoJSONWrapper=Pi;var Ri,Di=ii.exports,Fi=t.getDefaultExportFromCjs(Di),Bi=function(e){function r(t,r,n){var i=e.call(this,t,r,n)||this;return i.geojsonIndexes={},i}return t.__extends(r,e),r.prototype.loadData=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,u;return t.__generator(this,(function(h){return r=e.data,n=e.crsCode,i=e.options,o=i.tileServiceName,a=i.layerId,s=i.buffer,l=t.tileAdapters[o],u=this.loadGeoJson(r,n),this.geojsonIndexes[a]=function(t,e){return new ri(t,e)}(u,{maxZoom:t.GoogleMap.MAX_ZOOM,extent:l.getTileExtent(),buffer:null!=s?s:128}),[2]}))}))},r.prototype.loadGeoJson=function(e,r){var n=JSON.parse(e),i="EPSG:4326"!==r,o=t.prepareArrayTransform(r,"EPSG:4326"),a=function(e){i&&(e.geometry=t.transformGeoJsonGeometry(e.geometry,o))};return"Feature"===n.type?a(n):"FeatureCollection"===n.type&&n.features.forEach(a),n},r.prototype._loadTile=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,u,h,c,f,p,d,y,g;return t.__generator(this,(function(v){switch(v.label){case 0:return i=e.tileId,o=e.options,a=e.optimize,s=o.tileServiceName,l=o.format,u=(a||{}).noQuery,h=void 0!==u&&u,c=t.tileAdapters[s],[4,n("RequestTile")];case 1:if(v.sent(),r(),!(f=this.geojsonIndexes[o.layerId].getTile(i.z,i.x,i.y))||!f.features.length)throw"Empty";return[4,n("ParseTile")];case 2:return v.sent(),r(),p=c.getTileExtent(),d=f.features.reduce((function(t,e){var r=e.tags.stackId;return t[r]||(t[r]={features:[]}),t[r].features.push(e),t}),{}),y=Fi.fromGeojsonVt(d,{extent:p}),g=new t.RawVectorTile(i,y,l,s),[2,{vectorTile:t.RefinedVectorTile.parse(g),tileMemo:new vt(new t.VectorTileFeatureIndex(p,h),y.byteLength)}]}}))}))},r.prototype.clear=function(t){},r.prototype.clearData=function(t){delete this.geojsonIndexes[t.options.layerId]},r}(In),Ni=Bi,zi=function(){function e(){this._layers={},this._style=null,this._globalVariables=t.DEFAULT_GLOBAL_VARIABLES,this._networkOptions={}}return e.prototype.getLayer=function(t){return this._layers[t]},e.prototype.getStyle=function(){return this._style},e.prototype.setLayers=function(e){var r,n,i={};try{for(var o=t.__values(e),a=o.next();!a.done;a=o.next()){var s=a.value;i[s.getId()]=s}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}this._layers=i},e.prototype.setStyle=function(t){this._style=t},e.prototype.updateStyleProperty=function(t){var e;for(var r in t){var n=null===(e=this._style)||void 0===e?void 0:e.getLayerStyle(+r);for(var i in t[r]){var o=null==n?void 0:n.getStackStyle(+i),a=function(e){var n=null==o?void 0:o.getStyle(+e),a=t[r][i][e];if(!n)return"break";a.forEach((function(t){switch(t.paintGroup){case"geometry":n.setGeomPaint(t.paintProp,t.paintValue);break;case"label":n.setLabelPaint(t.paintProp,t.paintValue);break;case"icon":n.setIconPaint(t.paintProp,t.paintValue);break;case"poi":n.setPoiPaint(t.paintProp,t.paintValue)}}))};for(var s in t[r][i])if("break"===a(s))break}}},e.prototype.getGlobalVariables=function(){return this._globalVariables},e.prototype.setGlobalVariables=function(t){this._globalVariables=t},e.prototype.getNetworkOptions=function(){return this._networkOptions},e.prototype.setNetworkOptions=function(t){this._networkOptions=t},e}(),Ui=function(){function e(t,e){this._workerConfigs=new zi,this._tileStorages={Vector:new In(this._workerConfigs,t,e),GeoJson:new Ni(this._workerConfigs,t,e)},this._resourceManager=t,this._scheduler=e}return e.prototype.setLayers=function(t){this._workerConfigs.setLayers(t)},e.prototype.setStyle=function(t){this._workerConfigs.setStyle(t),this._scheduler.clear()},e.prototype.updateStyle=function(t){this._workerConfigs.setStyle(t)},e.prototype.updateStyleProperty=function(t){this._workerConfigs.updateStyleProperty(t)},e.prototype.setGlobalVariables=function(t){this._workerConfigs.setGlobalVariables(t)},e.prototype.setNetworkOptions=function(t){this._workerConfigs.setNetworkOptions(t)},e.prototype.registerResource=function(t){this._resourceManager.registerAll(t)},e.prototype.addResource=function(t){this._resourceManager.register(t)},e.prototype.loadTile=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return[2,this._getTileStorage(e.sourceType).load(e)]}))}))},e.prototype._getTileStorage=function(e){var r=this._tileStorages[e];if(!r)throw new t.SourceError("Unregistered tile storage");return r},e.prototype.abortTile=function(t){this._getTileStorage(t.sourceType).abort(t)},e.prototype.clearTile=function(t){this._getTileStorage(t.sourceType).clear(t)},e.prototype.loadData=function(t){this._getTileStorage(t.sourceType).loadData(t)},e.prototype.clearData=function(t){this._getTileStorage(t.sourceType).clearData(t)},e.prototype.destroy=function(){var e,r;this._resourceManager.unregister(),this._scheduler.clear();try{for(var n=t.__values(Object.values(this._tileStorages)),i=n.next();!i.done;i=n.next())i.value.destroy()}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},e}(),ji=function(n){function i(t){var r=n.call(this,t)||this;return r._services={},r._callbacks={},r._scheduler=new y,r._resourceManager=new e(r),r}return t.__extends(i,n),i.prototype.onMessage=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){return"Global"===e.data.type?(this._handleGlobalHook(e),[2]):[2,n.prototype.onMessage.call(this,e)]}))}))},i.prototype._handleRequest=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,u,h;return t.__generator(this,(function(c){switch(c.label){case 0:return r=e.groupId,n=e.method,i=e.params,e.instant?[3,2]:[4,this._scheduler.submitTask(r,"WorkerRequest",{method:n})];case 1:c.sent(),c.label=2;case 2:return[4,this._callService(this._getService(r),n,t.deserialize(i))];case 3:return o=c.sent(),"Destroy"===n&&this._removeService(r),o instanceof _t?(a=o.eventHandler,s=a.beforePosting,l=a.afterPosting,u=a.finalize,h=t.serialize(o.message),[2,t.__assign(t.__assign({},h),{beforePosting:function(){return s&&s(h)},afterPosting:l,finalize:u})]):[2,t.serialize(o)]}}))}))},i.prototype._getService=function(t){var e=this._services[t];return e||(e=new Ui(new r(this._resourceManager,t),new g(this._scheduler,t)),this._services[t]=e),e},i.prototype._removeService=function(t){delete this._services[t]},i.prototype._callService=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(r){case"UpdateStyleProperty":return[2,e.updateStyleProperty(n)];case"SetLayers":return[2,e.setLayers(n)];case"SetStyle":return[2,e.setStyle(n)];case"UpdateStyle":return[2,e.updateStyle(n)];case"SetGlobalVariables":return[2,e.setGlobalVariables(n)];case"SetNetworkOptions":return[2,e.setNetworkOptions(n)];case"RegisterResource":return[2,e.registerResource(n)];case"AddResource":return[2,e.addResource(n)];case"LoadTile":return[2,e.loadTile(n)];case"AbortTile":return[2,e.abortTile(n)];case"ClearTile":return[2,e.clearTile(n)];case"LoadData":return[2,e.loadData(n)];case"ClearData":return[2,e.clearData(n)];case"Destroy":return[2,e.destroy()];default:return[2,new Promise((function(t,e){return e("Unsupported method : ".concat(r))}))]}}))}))},i.prototype._handleResponse=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s;return t.__generator(this,(function(l){switch(l.label){case 0:r=e.groupId,n=e.taskId,i=e.result,o=e.status,a=this._callbacks[n],l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,this._scheduler.submitTask(r,"WorkerResponse")];case 2:return l.sent(),"Ok"===o?a.resolve(t.deserialize(i)):a.reject(t.deserialize(i)),[3,5];case 3:return s=l.sent(),a.reject(s),[3,5];case 4:return delete this._callbacks[n],[7];case 5:return[2]}}))}))},i.prototype.send=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l=this;return t.__generator(this,(function(u){return i=t.serialize(n),o=i.data,a=i.transferable,s={type:"Request",taskId:t.v4(),groupId:e,timeStamp:t.browser.now(),method:r,params:o},this.self().postMessage(s,a),[2,new Promise((function(t,e){l._callbacks[s.taskId]={resolve:t,reject:e}}))]}))}))},i.prototype._handleGlobalHook=function(e){var r=e.data,n=r.method,i=r.params;switch(n){case"SetConnectionLimits":t.ajax.setConnectionLimits(i);break;case"SetReferrer":t.ajax.setReferrer(i)}},i}(function(e){function r(t){return e.call(this,t)||this}return t.__extends(r,e),r.prototype.onMessage=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,u,h;return t.__generator(this,(function(t){switch(t.label){case 0:if(r=e.data,"Request"!==(n=r.type))return[3,6];o=(i=r).taskId,a=i.groupId,s=null,t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this._handleRequest(i)];case 2:return s=t.sent(),u={type:"Response",taskId:o,groupId:a,status:"Ok",result:s.data},s.beforePosting&&s.beforePosting(),this.self().postMessage(u,s.transferable),s.afterPosting&&s.afterPosting(),[3,5];case 3:return l=t.sent(),u={type:"Response",taskId:o,groupId:a,status:"InternalError",result:l},this.self().postMessage(u),[3,5];case 4:return s&&s.finalize&&s.finalize(),[7];case 5:return[3,10];case 6:if("Response"!==n)return[3,10];u=r,t.label=7;case 7:return t.trys.push([7,9,,10]),[4,this._handleResponse(u)];case 8:return t.sent(),[3,10];case 9:return h=t.sent(),console.error(h),[3,10];case 10:return[2]}}))}))},r}(function(){function t(t){this._globalScope=t}return t.prototype.self=function(){return this._globalScope},t}()));(Ri=new ji(self)).self().onmessage=function(t){return Ri.onMessage(t)}})),i.type="deps";i.type,i.name,i.dependencies;const o=i.factory;return function(){const t={};e(t);const r=`\n        const commonModule = {};\n        (${e})(commonModule);\n        (${o})(commonModule);\n    `,i=window.URL.createObjectURL(new Blob([r],{type:"text/javascript"})),a=n(t);return a.registerWorker("map",i),a}()}));
//# sourceMappingURL=vsm.js.map
